import{b as X,c as Y,d as Z}from"./chunk-I43GAN7W.js";import{a as W}from"./chunk-6ZHWXBBQ.js";import{b as B,c as R}from"./chunk-NP55MDY3.js";import{a as q,b as L}from"./chunk-NKX2CJ22.js";import{c as H,d as Q}from"./chunk-IMZ4R6CL.js";import{b as z,h as J,i as $}from"./chunk-EWJIHEWL.js";import"./chunk-SGYCFQGT.js";import{d as w,f as b,h as k,i as N,m as E,n as I,p as D,q as O,r as V,s as T,v as G,x as A}from"./chunk-J63CKRDU.js";import"./chunk-CN565FBG.js";import{f as j,g as U,h as K}from"./chunk-A6LP6NU3.js";import"./chunk-7XXZ3FER.js";import{d as S}from"./chunk-PBEYJMJD.js";import"./chunk-LMLMO6HS.js";import"./chunk-5DTMLZHP.js";import{$c as v,Ib as o,Jb as t,Kb as u,Ob as h,Qb as l,Rb as P,Rc as x,ac as n,bb as d,bc as M,gb as s,ma as _,na as C,nb as f,sb as y,wa as F,zb as p}from"./chunk-IL4QWM46.js";import"./chunk-FJYW2LMB.js";function ie(m,r){if(m&1){let e=h();o(0,"div",17)(1,"mat-form-field",18)(2,"mat-label"),n(3,"Classification"),t(),u(4,"input",19),t(),o(5,"mat-form-field",18)(6,"mat-label"),n(7,"Barcode (optional)"),t(),u(8,"input",20),t(),o(9,"button",21),l("click",function(){let a=_(e).index,c=P();return C(c.removeVariant(a))}),n(10," Remove "),t()()}if(m&2){let e=r.index;p("formGroupName",e)}}function oe(m,r){if(m&1){let e=h();o(0,"div",22)(1,"span",23),n(2),t(),o(3,"button",24),l("click",function(){let a=_(e).index,c=P();return C(c.removeFile(a))}),o(4,"mat-icon"),n(5,"delete"),t()()()}if(m&2){let e=r.$implicit;d(2),M(e.file.name)}}var g=class m{constructor(r){this.fb=r;this.form=this.fb.group({name:["",b.required],description:[""],categoryId:[null,b.required],minimumPercentageProfit:[],variants:this.fb.array([])}),this.addVariant("STANDARD")}submitForm=new F;cancel=new F;form;files=[];get variants(){return this.form.get("variants")}get variantGroups(){return this.variants.controls}addVariant(r=""){this.variants.push(this.fb.group({tempKey:crypto.randomUUID(),classification:[r,b.required],barcode:[""]}))}removeVariant(r){this.variants.removeAt(r)}addFiles(r){Array.from(r.target.files).forEach(i=>{this.files.push({id:crypto.randomUUID(),file:i,target:"PRODUCT",variantKeys:[]})})}removeFile(r){this.files.splice(r,1)}save(){let r={product:{name:this.form.value.name,description:this.form.value.description,categoryId:this.form.value.categoryId,minimumPercentageProfit:this.form.value.minimumPercentageProfit},variants:this.form.value.variants,fileAssignments:this.files.map(i=>({fileName:i.file.name,target:i.target,variantClassifications:this.form.value.variants.filter(a=>i.variantKeys.includes(a.tempKey)).map(a=>a.classification)}))},e=new FormData;e.append("payload",new Blob([JSON.stringify(r)],{type:"application/json"})),this.files.forEach(i=>{e.append("files",i.file)}),this.submitForm.emit(e)}static \u0275fac=function(e){return new(e||m)(s(G))};static \u0275cmp=f({type:m,selectors:[["app-product-form"]],outputs:{submitForm:"submitForm",cancel:"cancel"},decls:31,vars:4,consts:[[1,"form-container",3,"formGroup"],["label","Basics"],[1,"section"],["appearance","fill",1,"w-full"],["matInput","","formControlName","name"],["matInput","","formControlName","description"],["matInput","","type","number","formControlName","minimumPercentageProfit"],["label","Variants"],["formArrayName","variants"],["class","variant-row",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","","type","button",3,"click"],["label","Files"],["type","file","multiple","",3,"change"],["class","file-card",4,"ngFor","ngForOf"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","button",3,"click","disabled"],[1,"variant-row",3,"formGroupName"],["appearance","fill"],["matInput","","formControlName","classification"],["matInput","","formControlName","barcode"],["mat-stroked-button","","color","warn","type","button",3,"click"],[1,"file-card"],[1,"file-name"],["mat-icon-button","","color","warn","type","button",3,"click"]],template:function(e,i){e&1&&(o(0,"form",0)(1,"mat-tab-group")(2,"mat-tab",1)(3,"div",2)(4,"mat-form-field",3)(5,"mat-label"),n(6,"Name"),t(),u(7,"input",4),t(),o(8,"mat-form-field",3)(9,"mat-label"),n(10,"Description"),t(),u(11,"textarea",5),t(),o(12,"mat-form-field",3)(13,"mat-label"),n(14,"Minimum % Profit"),t(),u(15,"input",6),t()()(),o(16,"mat-tab",7)(17,"div",2)(18,"div",8),y(19,ie,11,1,"div",9),t(),o(20,"button",10),l("click",function(){return i.addVariant()}),n(21," + Add Variant "),t()()(),o(22,"mat-tab",11)(23,"div",2)(24,"input",12),l("change",function(c){return i.addFiles(c)}),t(),y(25,oe,6,1,"div",13),t()()(),o(26,"div",14)(27,"button",15),l("click",function(){return i.cancel.emit()}),n(28," Cancel "),t(),o(29,"button",16),l("click",function(){return i.save()}),n(30," Create Product "),t()()()),e&2&&(p("formGroup",i.form),d(19),p("ngForOf",i.variantGroups),d(6),p("ngForOf",i.files),d(4),p("disabled",i.form.invalid))},dependencies:[v,x,A,E,w,I,k,N,D,T,O,V,Z,X,Y,K,U,j,Q,H,J,z,$,R,B],styles:["[_nghost-%COMP%]{display:block}.form-container[_ngcontent-%COMP%]{max-width:1100px;margin:0 auto}.section[_ngcontent-%COMP%]{padding:1.5rem}.variant-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}.variant-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1 1 200px}.file-card[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;border-radius:8px;border:1px solid var(--border);background:var(--surface);margin-bottom:.75rem}.file-name[_ngcontent-%COMP%]{font-size:.85rem;overflow:hidden;text-overflow:ellipsis}@media (max-width: 768px){.variant-row[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-card[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}"]})};var ee=class m{constructor(r,e,i){this.productService=r;this.snackbar=e;this.router=i}saving=!1;handleSubmit(r){this.saving||(this.saving=!0,this.productService.fullCreate(r).subscribe({next:e=>{this.snackbar.open("Product created successfully","Close",{duration:3e3}),this.router.navigate(["/products",e.id])},error:()=>{this.saving=!1,this.snackbar.open("Create failed","Close",{duration:3e3})}}))}cancel(){this.router.navigate(["/products"])}static \u0275fac=function(e){return new(e||m)(s(W),s(q),s(S))};static \u0275cmp=f({type:m,selectors:[["app-product-create"]],decls:5,vars:0,consts:[[1,"page-container"],[1,"page-header"],[3,"submitForm"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),n(3,"Create Product"),t()(),o(4,"app-product-form",2),l("submitForm",function(c){return i.handleSubmit(c)}),t()())},dependencies:[v,g,L],encapsulation:2})};export{ee as ProductCreateComponent};
