import{a as Be,b as he,c as be}from"./chunk-WVN3VHDB.js";import{a as Y}from"./chunk-6PRU4GVW.js";import{a as pt}from"./chunk-HR3AI3AC.js";import{a as at}from"./chunk-QAS6HGXL.js";import{a as P}from"./chunk-JZXEWDXN.js";import{a as Et,b as Mt,c as Tt}from"./chunk-U77Y5IN4.js";import{b as kt,c as Pt,d as Ot}from"./chunk-UTOEPDRR.js";import{a as It}from"./chunk-7B2346SR.js";import{a as wt}from"./chunk-CD2D6BMO.js";import{a as ve,b as yt,c as xe,d as Se}from"./chunk-TWWBRTKE.js";import{a as dt,b as ut,c as _t,d as gt,e as ft,f as Ct,g as vt,h as xt,i as St,j as ht,k as bt}from"./chunk-I3US72OE.js";import"./chunk-N4J5OKMY.js";import{a as rt,b as ot}from"./chunk-YVNRBVUQ.js";import{a as lt,c as ge}from"./chunk-MA6ZSKR6.js";import"./chunk-MS4AQ6UA.js";import{a as fe,b as Ce}from"./chunk-2JRABG3A.js";import{d as se}from"./chunk-T2UYCDC2.js";import{c as tt}from"./chunk-PZ352SLY.js";import{b as N,c as L}from"./chunk-TLF4YXFY.js";import{a as B,b as st}from"./chunk-SNZ3II6O.js";import{c as z,d as j}from"./chunk-CZGJLEOY.js";import{b as X,c as mt,d as ct,h as A,i as $}from"./chunk-J5IGF7DT.js";import"./chunk-SGYCFQGT.js";import{d as V,f as U,h as R,i as q,l as it,m as me,n as ce,p as W,q as de,r as ue,s as Q,v as _e,w as nt,x as K}from"./chunk-D2WFNIGL.js";import"./chunk-AYMLXUSV.js";import{f as J,g as M,h as k}from"./chunk-SRBP6AOE.js";import"./chunk-AQVBCBXZ.js";import{b as pe,d as F}from"./chunk-CSKLPVDL.js";import"./chunk-Z7QKINIM.js";import"./chunk-5DTMLZHP.js";import{$b as Ne,$c as E,Bb as O,Ib as o,J as Z,Jb as n,Kb as S,Lb as b,Mb as y,Nb as Re,Ob as C,Oc as ae,Qb as g,Rb as c,Rc as D,Sc as I,Tc as et,Wb as Ke,Wc as le,Xb as Je,Yb as Xe,_a as We,ac as a,bb as p,bc as h,cc as f,dc as ee,fc as te,gb as v,gc as ie,hc as ne,kc as Ye,lc as Le,na as u,nb as w,nc as re,oa as _,pc as oe,qb as Qe,r as qe,rc as Ze,sb as d,zb as m}from"./chunk-KLCDKTJS.js";import{a as G,b as H,g as Fe,h as Ve}from"./chunk-FJYW2LMB.js";var Dt={title:"Bulk Import Suppliers",confirmLabel:"Import Now",csvFileName:"suppliers-bulk-template.csv",excelFileName:"suppliers-bulk-template.xlsx",headers:["name","emails","phones","address","region","categories"],fields:[{name:"name",required:!0},{name:"emails"},{name:"phones",required:!0},{name:"address"},{name:"region"},{name:"categories"}],previewColumns:[{key:"name",label:"Name"},{key:"email",label:"Emails"},{key:"phoneNumber",label:"Phones"},{key:"region",label:"Region"}],excelSheetName:"Suppliers",excelColumns:[{header:"name",key:"name",width:26},{header:"emails",key:"emails",width:32},{header:"phones",key:"phones",width:22,format:"text"},{header:"address",key:"address",width:26},{header:"region",key:"region",width:18},{header:"categories",key:"categories",width:32}],exampleRow:{name:"Acme Ltd",emails:"info@acme.com",phones:"0712345678",address:"Nairobi",region:"Nairobi",categories:"Electronics,Accessories"},emptyRowCount:200,defaultOptions:{dryRun:!0,skipDuplicates:!0},mapRowToItem(t){return{name:t.name,email:[t.emails],phoneNumber:[t.phones],address:t.address,region:t.region,categoryNames:t.categories?t.categories.split(",").map(i=>i.trim()).filter(Boolean):[]}},mapPreviewRow(t){return t},submit(t){return null}};function Bt(t,i){if(t&1&&(o(0,"div",20),a(1),n()),t&2){let e=c().$implicit;p(),f(" ",e.value._error," ")}}function At(t,i){if(t&1){let e=C();o(0,"div",9)(1,"div",10)(2,"span"),a(3),n(),o(4,"button",11),g("click",function(){let l=u(e).index,s=c();return _(s.removeRow(l))}),o(5,"mat-icon"),a(6,"delete"),n()()(),o(7,"div",12)(8,"mat-form-field"),S(9,"input",13),n(),o(10,"mat-form-field"),S(11,"input",14),n(),o(12,"mat-form-field"),S(13,"input",15),n()(),o(14,"div",12)(15,"mat-form-field"),S(16,"input",16),n(),o(17,"mat-form-field"),S(18,"input",17),n(),o(19,"mat-form-field"),S(20,"input",18),n()(),d(21,Bt,2,1,"div",19),n()}if(t&2){let e=i.$implicit,r=i.index;m("formGroupName",r),p(3),f("Supplier ",r+1,""),p(18),m("ngIf",e.value._error)}}var ye=class t extends Et{constructor(e,r,l,s){super();this.supplierService=e;this.categoryService=r;this.submitEngine=l;this.dialogRef=s}config=Dt;categories=[];ngOnInit(){this.initForm(),this.loadCategories()}loadCategories(){this.categoryService.getAll("flat",!1).subscribe(e=>this.categories=e||[])}submit(){if(this.form.invalid)return;let e={items:this.rows.controls.map(r=>this.config.mapRowToItem(r.value)),options:{dryRun:this.form.value.dryRun,skipDuplicates:!0}};this.submitEngine.execute({submitFn:r=>this.supplierService.bulkImport(r),payload:e,rows:this.rows.controls,dryRun:this.form.value.dryRun,title:this.config.title,confirmLabel:this.config.confirmLabel,columns:this.config.previewColumns,onErrorsApplied:r=>this.cacheErrors(r),onFinalSuccess:()=>this.dialogRef.close(!0),onConfirmRetry:()=>{this.form.patchValue({dryRun:!1}),this.submit()}})}importExcel(e){return Ve(this,null,function*(){if(!e)return;let r=yield this.confirmMerge();r&&Fe(t.prototype,this,"importExcelFile").call(this,e,void 0,r)})}importCsv(e){return Ve(this,null,function*(){if(!e)return;let r=yield this.confirmMerge();r&&Fe(t.prototype,this,"importCsvFile").call(this,e,r)})}close(){this.dialogRef.close()}static \u0275fac=function(r){return new(r||t)(v(P),v(Y),v(Tt),v(lt))};static \u0275cmp=w({type:t,selectors:[["app-supplier-bulk-import-dialog"]],features:[Qe],decls:12,vars:8,consts:[["bottomAnchor",""],[3,"keydown.enter","formGroup"],[3,"importCsv","importExcel","downloadCsv","downloadExcel","submit","cancel","goToLine","goTop","goBottom","prevError","nextError","clearAll","exportCsv","exportExcel","title","rowCount","submitting","formInvalid","loading","progress"],[1,"suppliers-body"],["bulk-options",""],["formControlName","dryRun"],["formArrayName","rows",1,"rows"],["class","row-card",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],[1,"row-card",3,"formGroupName"],[1,"row-header"],["mat-icon-button","","color","warn",3,"click"],[1,"grid-3"],["matInput","","placeholder","Name","formControlName","name"],["matInput","","placeholder","Emails","formControlName","emails"],["matInput","","placeholder","Phones","formControlName","phones"],["matInput","","placeholder","Address","formControlName","address"],["matInput","","placeholder","Region","formControlName","region"],["matInput","","placeholder","Categories","formControlName","categories"],["class","row-error",4,"ngIf"],[1,"row-error"]],template:function(r,l){if(r&1){let s=C();o(0,"form",1),g("keydown.enter",function(T){return u(s),_(T.stopPropagation())}),o(1,"app-bulk-import-shell",2),g("importCsv",function(T){return u(s),_(l.importCsv(T))})("importExcel",function(T){return u(s),_(l.importExcel(T))})("downloadCsv",function(){return u(s),_(l.downloadCsvTemplate())})("downloadExcel",function(){return u(s),_(l.downloadExcelTemplate())})("submit",function(){return u(s),_(l.submit())})("cancel",function(){return u(s),_(l.close())})("goToLine",function(T){return u(s),_(l.goToLine(T))})("goTop",function(){return u(s),_(l.scrollToTop())})("goBottom",function(){return u(s),_(l.scrollToBottom())})("prevError",function(){return u(s),_(l.goToPreviousError())})("nextError",function(){return u(s),_(l.goToNextError())})("clearAll",function(){return u(s),_(l.clearRows())})("exportCsv",function(){return u(s),_(l.exportCsvCurrentRows())})("exportExcel",function(){return u(s),_(l.exportExcelCurrentRows())}),o(2,"div",3)(3,"div",4)(4,"mat-checkbox",5),a(5," Dry run (validate only, do not save) "),n()(),o(6,"div",6),d(7,At,22,3,"div",7),n(),o(8,"button",8),g("click",function(){return u(s),_(l.addRow())}),a(9," + Add Supplier "),n(),S(10,"div",null,0),n()()()}r&2&&(m("formGroup",l.form),p(),m("title",l.config.title)("rowCount",l.rowCount)("submitting",l.submitting)("formInvalid",l.form.invalid)("loading",l.submitting||l.loading)("progress",l.progress),p(6),m("ngForOf",l.rows.controls))},dependencies:[E,D,I,K,me,V,R,q,W,Q,de,ue,Mt,$,A,j,z,Se,xe,k,M,J,L,N],styles:[".suppliers-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.row-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:20px;background:var(--surface);display:flex;flex-direction:column;gap:16px}.row-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;border-bottom:1px dashed var(--border);padding-bottom:6px}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}.mat-form-field[_ngcontent-%COMP%]{width:100%}.row-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.highlight-line[_ngcontent-%COMP%]{outline:2px solid #1976d2;outline-offset:4px;transition:outline .3s ease}"]})};var zt=()=>[5,10,20,50];function jt(t,i){if(t&1){let e=C();o(0,"button",40),g("click",function(){u(e);let l=c(2);return _(l.bulkDisable())}),a(1," Disable "),n()}}function Ut(t,i){if(t&1){let e=C();o(0,"button",41),g("click",function(){u(e);let l=c(2);return _(l.bulkRestore())}),a(1," Restore "),n()}}function Gt(t,i){t&1&&(o(0,"span",42),a(1," Mixed supplier status \u2014 action blocked "),n())}function Ht(t,i){if(t&1&&(o(0,"div",35)(1,"span",36),a(2),n(),d(3,jt,2,0,"button",37)(4,Ut,2,0,"button",38)(5,Gt,2,0,"span",39),n()),t&2){let e=c();p(2),f(" ",e.selection.selected.length," selected "),p(),m("ngIf",e.bulkState==="active"),p(),m("ngIf",e.bulkState==="deleted"),p(),m("ngIf",e.bulkState==="mixed")}}function qt(t,i){if(t&1&&(o(0,"mat-option",43),a(1),n()),t&2){let e=i.$implicit;m("value",e),p(),f(" ",e," ")}}function Wt(t,i){if(t&1){let e=C();o(0,"th",44)(1,"mat-checkbox",45),g("change",function(){u(e);let l=c();return _(l.masterToggle())}),n()()}if(t&2){let e=c();p(),m("checked",e.isAllSelected())("indeterminate",e.selection.selected.length&&!e.isAllSelected())}}function Qt(t,i){if(t&1){let e=C();o(0,"td",46)(1,"mat-checkbox",47),g("click",function(l){return u(e),_(l.stopPropagation())})("change",function(){let l=u(e).$implicit,s=c();return _(s.selection.toggle(l))}),n()()}if(t&2){let e=i.$implicit,r=c();p(),m("checked",r.selection.isSelected(e))}}function Kt(t,i){if(t&1){let e=C();o(0,"th",48),g("click",function(){u(e);let l=c();return _(l.sortBy("name"))}),o(1,"span",49),a(2," Name "),o(3,"mat-icon",50),a(4),n()()()}if(t&2){let e=c();p(4),f(" ",e.sortField==="name"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Jt(t,i){if(t&1){let e=C();o(0,"td",46)(1,"a",51),g("click",function(){let l=u(e).$implicit,s=c();return _(s.view(l))}),a(2),n()()}if(t&2){let e=i.$implicit;p(2),f(" ",e.name," ")}}function Xt(t,i){t&1&&(o(0,"th",44),a(1,"Emails"),n())}function Yt(t,i){if(t&1&&(o(0,"div"),a(1),n()),t&2){let e=i.$implicit;p(),h(e)}}function Zt(t,i){if(t&1&&(o(0,"td",46),d(1,Yt,2,1,"div",52),n()),t&2){let e=i.$implicit;p(),m("ngForOf",e.email)}}function ei(t,i){t&1&&(o(0,"th",44),a(1,"Phones"),n())}function ti(t,i){if(t&1&&(o(0,"div"),a(1),n()),t&2){let e=i.$implicit;p(),h(e)}}function ii(t,i){if(t&1&&(o(0,"td",46),d(1,ti,2,1,"div",52),n()),t&2){let e=i.$implicit;p(),m("ngForOf",e.phoneNumber)}}function ni(t,i){if(t&1){let e=C();o(0,"th",48),g("click",function(){u(e);let l=c();return _(l.sortBy("region"))}),o(1,"span",49),a(2," Region "),o(3,"mat-icon",50),a(4),n()()()}if(t&2){let e=c();p(4),f(" ",e.sortField==="region"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function ri(t,i){if(t&1&&(o(0,"td",46),a(1),n()),t&2){let e=i.$implicit;p(),h(e.region||"\u2014")}}function oi(t,i){t&1&&(o(0,"th",44),a(1,"Rating"),n())}function ai(t,i){if(t&1&&(o(0,"td",46),a(1),n()),t&2){let e,r=i.$implicit;p(),h((e=r.rating)!==null&&e!==void 0?e:"\u2014")}}function li(t,i){if(t&1){let e=C();o(0,"th",48),g("click",function(){u(e);let l=c();return _(l.sortBy("createdAt"))}),o(1,"span",49),a(2," Created "),o(3,"mat-icon",50),a(4),n()()()}if(t&2){let e=c();p(4),f(" ",e.sortField==="createdAt"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function pi(t,i){if(t&1&&(o(0,"td",46),a(1),re(2,"date"),n()),t&2){let e=i.$implicit;p(),f(" ",oe(2,1,e.createdAt,"medium")," ")}}function si(t,i){t&1&&(o(0,"th",44),a(1,"Status"),n())}function mi(t,i){if(t&1&&(o(0,"td",46)(1,"span"),a(2),n()()),t&2){let e=i.$implicit;p(),O("text-red-400",e.deleted)("text-green-400",!e.deleted),p(),f(" ",e.deleted?"Disabled":"Active"," ")}}function ci(t,i){t&1&&(o(0,"th",44),a(1,"Actions"),n())}function di(t,i){if(t&1){let e=C();o(0,"td",46)(1,"button",53),g("click",function(){let l=u(e).$implicit,s=c();return _(s.view(l))}),o(2,"mat-icon"),a(3,"visibility"),n()(),o(4,"button",54),g("click",function(){let l=u(e).$implicit,s=c();return _(s.edit(l))}),o(5,"mat-icon"),a(6,"edit"),n()()()}}function ui(t,i){t&1&&S(0,"tr",55)}function _i(t,i){if(t&1){let e=C();o(0,"tr",56),g("click",function(){let l=u(e).$implicit,s=c();return _(s.toggleRow(l))}),n()}if(t&2){let e=i.$implicit,r=c();O("row-selected",r.selection.isSelected(e))}}var Pe=class t{constructor(i,e,r,l){this.supplierService=i;this.snackbar=e;this.dialog=r;this.router=l}displayedColumns=["select","name","emails","phones","region","rating","createdAt","status","actions"];allSuppliers=[];filteredSuppliers=[];suppliers=[];regions=[];q="";filterRegion="";sortField=null;sortDir="asc";statusFilter="active";total=0;page=0;size=10;loading=!1;selection=new tt(!0,[]);paginator;ngOnInit(){this.loadSuppliers()}loadSuppliers(){this.loading=!0,this.supplierService.getAll().pipe(Z(()=>this.loading=!1)).subscribe({next:i=>{this.allSuppliers=i||[],this.regions=Array.from(new Set(this.allSuppliers.map(e=>e.region).filter(e=>!!e))).sort(),this.page=0,this.applyFilters()},error:()=>this.snackbar.open("Failed to load suppliers","Close",{duration:3e3})})}applyFilters(){let i=[...this.allSuppliers],e=this.q.trim().toLowerCase();switch(e&&(i=i.filter(r=>r.name.toLowerCase().includes(e)||(r.email||[]).some(l=>l.toLowerCase().includes(e))||(r.phoneNumber||[]).some(l=>l.includes(e)))),this.filterRegion&&(i=i.filter(r=>r.region===this.filterRegion)),this.statusFilter){case"active":i=i.filter(r=>!r.deleted);break;case"deleted":i=i.filter(r=>r.deleted);break;case"all":default:break}this.sortField&&i.sort((r,l)=>{let s=r[this.sortField],x=l[this.sortField];return s==null?1:x==null?-1:this.sortDir==="asc"?s>x?1:-1:s<x?1:-1}),this.page=0,this.selection.clear(),this.filteredSuppliers=i,this.total=i.length,this.applyPagination()}sortBy(i){this.sortField===i?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortField=i,this.sortDir="asc"),this.applyFilters()}applyPagination(){let i=this.page*this.size;this.suppliers=this.filteredSuppliers.slice(i,i+this.size)}changePage(i){this.page=i.pageIndex,this.size=i.pageSize,this.applyPagination()}toggleRow(i){this.selection.toggle(i)}isAllSelected(){return this.selection.selected.length===this.suppliers.length&&this.suppliers.length>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.suppliers.forEach(i=>this.selection.select(i))}get bulkState(){let i=this.selection.selected;if(!i.length)return null;let e=new Set(i.map(r=>r.deleted));return e.size>1?"mixed":e.has(!0)?"deleted":"active"}bulkDisable(){if(this.bulkState!=="active"){this.snackbar.open("Selected suppliers have mixed status","Close",{duration:2500});return}this.dialog.open(Be,{width:"420px",data:{title:"Disable Suppliers?",message:`Provide a reason for disabling ${this.selection.selected.length} suppliers.`,action:"DISABLE",confirmText:"Disable"}}).afterClosed().subscribe(e=>{e?.confirmed&&Promise.all(this.selection.selected.map(r=>this.supplierService.softDelete(r.id,e.reason).toPromise())).then(()=>{this.snackbar.open("Suppliers disabled","Close",{duration:2e3}),this.loadSuppliers()})})}bulkRestore(){if(this.bulkState!=="deleted"){this.snackbar.open("Only disabled suppliers can be restored","Close",{duration:2500});return}this.dialog.open(Be,{width:"420px",data:{title:"Restore Suppliers?",message:`Provide a reason for restoring ${this.selection.selected.length} suppliers.`,action:"RESTORE",confirmText:"Restore"}}).afterClosed().subscribe(e=>{e?.confirmed&&Promise.all(this.selection.selected.map(r=>this.supplierService.restore(r.id,e.reason).toPromise())).then(()=>{this.snackbar.open("Suppliers restored","Close",{duration:2e3}),this.loadSuppliers()})})}view(i){this.router.navigate(["/suppliers",i.id],{state:{deleted:i.deleted}})}edit(i){this.router.navigate(["/suppliers",i.id,"edit"],{state:{deleted:i.deleted}})}goCreate(){this.router.navigate(["/suppliers/create"])}openBulkImport(){this.dialog.open(ye,{width:"1100px",maxWidth:"95vw",maxHeight:"90vh",autoFocus:!1}).afterClosed().subscribe(i=>{i===!0&&this.loadSuppliers()})}static \u0275fac=function(e){return new(e||t)(v(P),v(B),v(ge),v(F))};static \u0275cmp=w({type:t,selectors:[["app-supplier-list"]],viewQuery:function(e,r){if(e&1&&Ke(ve,5),e&2){let l;Je(l=Xe())&&(r.paginator=l.first)}},decls:67,vars:12,consts:[[1,"flex","flex-col","gap-4"],[1,"page-header","flex","items-center","mb-6"],[1,"text-xl","font-semibold"],[1,"flex","items-center","gap-2","ml-auto"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["class","flex items-center gap-3 mb-4",4,"ngIf"],[1,"toolbar-card"],["appearance","fill",1,"search"],["matInput","","placeholder","Search name, email or phone",3,"ngModelChange","input","ngModel"],[1,"filters"],["appearance","fill",1,"min-w-[160px]"],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","all"],["value","active"],["value","deleted"],[1,"bg-[var(--surface)]","rounded","shadow","overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","class","sortable",3,"click",4,"matHeaderCellDef"],["matColumnDef","emails"],["matColumnDef","phones"],["matColumnDef","region"],["matColumnDef","rating"],["matColumnDef","createdAt"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable-row",3,"row-selected","click",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageSizeOptions"],[1,"flex","items-center","gap-3","mb-4"],[1,"font-medium","text-blue-500"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["class","text-red-500 font-medium",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],[1,"text-red-500","font-medium"],[3,"value"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"click","change","checked"],["mat-header-cell","",1,"sortable",3,"click"],[1,"sortable-content"],[1,"sort-icon"],[1,"text-blue-600","hover:underline",3,"click"],[4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","View",3,"click"],["mat-icon-button","","matTooltip","Edit",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable-row",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Suppliers"),n(),o(4,"div",3)(5,"button",4),g("click",function(){return r.openBulkImport()}),o(6,"mat-icon"),a(7,"cloud_upload"),n(),a(8," Bulk Import "),n(),o(9,"button",5),g("click",function(){return r.goCreate()}),a(10," Create Supplier "),n()()(),d(11,Ht,6,4,"div",6),o(12,"div",7)(13,"mat-form-field",8)(14,"mat-label"),a(15,"Search suppliers"),n(),o(16,"input",9),ne("ngModelChange",function(s){return ie(r.q,s)||(r.q=s),s}),g("input",function(){return r.applyFilters()}),n()()(),o(17,"div",10)(18,"mat-form-field",11)(19,"mat-label"),a(20,"Region"),n(),o(21,"mat-select",12),ne("ngModelChange",function(s){return ie(r.filterRegion,s)||(r.filterRegion=s),s}),g("selectionChange",function(){return r.applyFilters()}),o(22,"mat-option",13),a(23,"All regions"),n(),d(24,qt,2,2,"mat-option",14),n()(),o(25,"mat-form-field",11)(26,"mat-label"),a(27,"Status"),n(),o(28,"mat-select",12),ne("ngModelChange",function(s){return ie(r.statusFilter,s)||(r.statusFilter=s),s}),g("selectionChange",function(){return r.applyFilters()}),o(29,"mat-option",15),a(30,"All"),n(),o(31,"mat-option",16),a(32,"Active"),n(),o(33,"mat-option",17),a(34,"Disabled"),n()()()(),o(35,"div",18)(36,"table",19),b(37,20),d(38,Wt,2,2,"th",21)(39,Qt,2,1,"td",22),y(),b(40,23),d(41,Kt,5,1,"th",24)(42,Jt,3,1,"td",22),y(),b(43,25),d(44,Xt,2,0,"th",21)(45,Zt,2,1,"td",22),y(),b(46,26),d(47,ei,2,0,"th",21)(48,ii,2,1,"td",22),y(),b(49,27),d(50,ni,5,1,"th",24)(51,ri,2,1,"td",22),y(),b(52,28),d(53,oi,2,0,"th",21)(54,ai,2,1,"td",22),y(),b(55,29),d(56,li,5,1,"th",24)(57,pi,3,4,"td",22),y(),b(58,30),d(59,si,2,0,"th",21)(60,mi,3,5,"td",22),y(),b(61,31),d(62,ci,2,0,"th",21)(63,di,7,0,"td",22),y(),d(64,ui,1,0,"tr",32)(65,_i,1,2,"tr",33),n(),o(66,"mat-paginator",34),g("page",function(s){return r.changePage(s)}),n()()()),e&2&&(p(11),m("ngIf",r.selection.selected.length),p(5),te("ngModel",r.q),p(5),te("ngModel",r.filterRegion),p(3),m("ngForOf",r.regions),p(4),te("ngModel",r.statusFilter),p(8),m("dataSource",r.suppliers),p(28),m("matHeaderRowDef",r.displayedColumns),p(),m("matRowDefColumns",r.displayedColumns),p(),m("length",r.total)("pageSize",r.size)("pageSizeOptions",Ye(11,zt)))},dependencies:[E,D,I,le,nt,V,R,it,bt,dt,_t,vt,gt,ut,xt,ft,Ct,St,ht,yt,ve,L,N,k,M,J,ot,rt,Ce,A,X,fe,se,Se,xe,$,j,z],styles:["[_nghost-%COMP%]{display:block}.toolbar-card[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.toolbar-card[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{flex:1}.filters[_ngcontent-%COMP%]{display:flex;gap:1rem}"]})};function gi(t,i){if(t&1){let e=C();o(0,"div",15),g("click",function(){let l=u(e).index,s=c();return _(s.step=l)}),o(1,"span",16),a(2),n(),o(3,"span",17),a(4),n()()}if(t&2){let e=i.$implicit,r=i.index,l=c();O("active",r===l.step)("completed",r<l.step),p(2),h(r+1),p(2),h(e)}}function fi(t,i){t&1&&(o(0,"section",18)(1,"h3"),a(2,"Basic Information"),n(),o(3,"div",19)(4,"mat-form-field",20)(5,"mat-label"),a(6,"Name"),n(),S(7,"input",21),n(),o(8,"mat-form-field",20)(9,"mat-label"),a(10,"Region"),n(),S(11,"input",22),n(),o(12,"mat-form-field",20)(13,"mat-label"),a(14,"Rating"),n(),S(15,"input",23),n()()())}function Ci(t,i){if(t&1){let e=C();o(0,"section",18)(1,"h3"),a(2,"Contacts"),n(),o(3,"div",24)(4,"mat-form-field",20)(5,"mat-label"),a(6,"Email addresses"),n(),o(7,"input",25),g("change",function(l){u(e);let s=c();return _(s.onEmailsChange(l))}),n()(),o(8,"mat-form-field",20)(9,"mat-label"),a(10,"Phone numbers"),n(),o(11,"input",26),g("change",function(l){u(e);let s=c();return _(s.onPhonesChange(l))}),n()()()()}}function vi(t,i){if(t&1){let e=C();o(0,"li")(1,"label",33)(2,"input",31),g("change",function(){let l=u(e).$implicit,s=c(4);return _(s.toggleCategory(l.id))}),n(),a(3),n()()}if(t&2){let e=i.$implicit,r=c(4);p(2),m("checked",r.isCategorySelected(e.id)),p(),f(" ",e.name," ")}}function xi(t,i){if(t&1&&(o(0,"ul"),d(1,vi,4,2,"li",29),n()),t&2){let e=c().$implicit;p(),m("ngForOf",e.subcategories)}}function Si(t,i){if(t&1){let e=C();o(0,"li")(1,"label",30)(2,"input",31),g("change",function(){let l=u(e).$implicit,s=c(2);return _(s.toggleCategory(l.id))}),n(),a(3),n(),d(4,xi,2,1,"ul",32),n()}if(t&2){let e=i.$implicit,r=c(2);p(2),m("checked",r.isCategorySelected(e.id)),p(),f(" ",e.name," "),p(),m("ngIf",e.subcategories==null?null:e.subcategories.length)}}function hi(t,i){if(t&1&&(o(0,"section",18)(1,"h3"),a(2,"Categories Supplied"),n(),o(3,"p",27),a(4,"Select all product categories this supplier can provide."),n(),o(5,"ul",28),d(6,Si,5,3,"li",29),n()()),t&2){let e=c();p(6),m("ngForOf",e.categories)}}function bi(t,i){if(t&1){let e=C();o(0,"img",49),g("click",function(){u(e);let l=c().$implicit,s=c(3);return _(s.viewImage(l.value.file,l.value.previewUrl))}),n()}if(t&2){let e=c().$implicit;m("src",e.value.previewUrl,We)}}function yi(t,i){if(t&1){let e=C();o(0,"div",50),g("click",function(){u(e);let l=c().$implicit,s=c(3);return _(s.openPdf(l.value.file))}),o(1,"mat-icon"),a(2,"picture_as_pdf"),n(),o(3,"span"),a(4,"Open PDF"),n()()}}function wi(t,i){t&1&&(o(0,"div",51)(1,"mat-icon"),a(2,"attach_file"),n()())}function Ii(t,i){if(t&1&&(o(0,"mat-option",52),a(1),n()),t&2){let e=i.$implicit;m("value",e),p(),f(" ",e," ")}}function Ei(t,i){t&1&&(o(0,"mat-form-field",20)(1,"mat-label"),a(2,"Custom description"),n(),S(3,"input",53),n())}function Mi(t,i){if(t&1){let e=C();o(0,"div",39)(1,"div",40),d(2,bi,1,1,"img",41)(3,yi,5,0,"div",42)(4,wi,3,0,"div",43),n(),o(5,"div",44),a(6),n(),o(7,"mat-form-field",20)(8,"mat-label"),a(9,"Description"),n(),o(10,"mat-select",45),d(11,Ii,2,2,"mat-option",46),n()(),d(12,Ei,4,0,"mat-form-field",47),o(13,"button",48),g("click",function(){let l=u(e).index,s=c(3);return _(s.removeFile(l))}),o(14,"mat-icon"),a(15,"close"),n()()()}if(t&2){let e,r=i.$implicit,l=i.index,s=c(3);m("formGroupName",l),p(2),m("ngIf",r.value.previewUrl),p(),m("ngIf",!r.value.previewUrl&&r.value.file.type==="application/pdf"),p(),m("ngIf",!r.value.previewUrl&&r.value.file.type!=="application/pdf"),p(2),f(" ",r.value.file.name," "),p(5),m("ngForOf",s.descriptionOptions),p(),m("ngIf",((e=r.get("description"))==null?null:e.value)==="Other")}}function ki(t,i){if(t&1&&(o(0,"div",37),d(1,Mi,16,7,"div",38),n()),t&2){let e=c(2);p(),m("ngForOf",e.supplierFiles.controls)}}function Pi(t,i){if(t&1){let e=C();o(0,"section",34)(1,"h3"),a(2,"Documents"),n(),o(3,"input",35),g("change",function(l){u(e);let s=c();return _(s.onFilesPicked(l))}),n(),d(4,ki,2,1,"div",36),n()}if(t&2){let e=c();p(4),m("ngIf",e.supplierFiles.length)}}function Oi(t,i){if(t&1&&(o(0,"section",18)(1,"h3"),a(2,"Review"),n(),o(3,"div",54)(4,"div")(5,"strong"),a(6,"Name:"),n(),a(7),n(),o(8,"div")(9,"strong"),a(10,"Region:"),n(),a(11),n(),o(12,"div")(13,"strong"),a(14,"Rating:"),n(),a(15),n(),o(16,"div")(17,"strong"),a(18,"Emails:"),n(),a(19),n(),o(20,"div")(21,"strong"),a(22,"Phones:"),n(),a(23),n(),o(24,"div")(25,"strong"),a(26,"Categories:"),n(),a(27),n()()()),t&2){let e=c();p(7),f(" ",e.form.value.name,""),p(4),f(" ",e.form.value.region||"\u2014",""),p(4),f(" ",e.form.value.rating||"\u2014",""),p(4),f(" ",e.form.value.email.join(", ")||"\u2014",""),p(4),f(" ",e.form.value.phoneNumber.join(", ")||"\u2014",""),p(4),f(" ",e.form.value.categoryIds.length," ")}}function Ti(t,i){if(t&1){let e=C();o(0,"button",5),g("click",function(){u(e);let l=c();return _(l.prev())}),a(1," Previous "),n()}}function Di(t,i){if(t&1){let e=C();o(0,"button",55),g("click",function(){u(e);let l=c();return _(l.next())}),a(1," Next "),n()}}var Oe=class t{constructor(i,e,r,l,s,x){this.fb=i;this.supplierService=e;this.categoryService=r;this.snackbar=l;this.dialog=s;this.router=x}steps=["Basic","Contacts","Categories","Files","Review"];step=0;form;categories=[];busy=!1;files=[];descriptionOptions=["Contract","Price List","Certificate","License","Other"];ngOnInit(){this.form=this.fb.group({name:["",U.required],region:[""],rating:[null],email:[[]],phoneNumber:[[]],categoryIds:[[]],supplierFiles:this.fb.array([])}),this.loadCategories()}get supplierFiles(){return this.form.get("supplierFiles")}newSupplierFile(i){let e=i.type.startsWith("image/")?URL.createObjectURL(i):null,r=this.fb.group({file:[i],previewUrl:[e],description:["Contract",U.required],custom:[""]});return r.get("description").valueChanges.subscribe(l=>{let s=r.get("custom");l==="Other"?s?.setValidators([U.required,U.minLength(3)]):(s?.clearValidators(),s?.setValue("")),s?.updateValueAndValidity()}),r}openPdf(i){let e=URL.createObjectURL(i);window.open(e,"_blank")}loadCategories(){this.categoryService.getAll("tree",!1).subscribe(i=>this.categories=i||[])}onEmailsChange(i){let e=i.target;if(!e)return;let r=e.value||"";this.form.get("email").setValue(r.split(",").map(l=>l.trim()).filter(Boolean))}onPhonesChange(i){let e=i.target;if(!e)return;let r=e.value||"";this.form.get("phoneNumber").setValue(r.split(",").map(l=>l.trim()).filter(Boolean))}toggleCategory(i){let e=this.form.value.categoryIds;this.form.patchValue({categoryIds:e.includes(i)?e.filter(r=>r!==i):[...e,i]})}isCategorySelected(i){return this.form.value.categoryIds.includes(i)}onFilesPicked(i){let e=i.target;e.files&&(Array.from(e.files).forEach(r=>{this.supplierFiles.push(this.newSupplierFile(r))}),e.value="")}removeFile(i){let r=this.supplierFiles.at(i).value.previewUrl;r&&URL.revokeObjectURL(r),this.supplierFiles.removeAt(i)}validateFiles(){for(let i of this.files)if(!i.description||i.description==="Other"&&!i.custom?.trim())return!1;return!0}viewImage(i,e){this.dialog.open(wt,{data:{preview:{src:e,name:i.name,type:"image"}},width:"80%",maxWidth:"1100px"})}next(){this.step<this.steps.length-1&&this.step++}prev(){this.step>0&&this.step--}submit(){let i=new FormData;if(Object.entries(this.form.value).forEach(([e,r])=>{if(e!=="supplierFiles"&&r!=null){if(Array.isArray(r)){r.forEach((l,s)=>{i.append(`${e}[${s}]`,String(l))});return}i.append(e,String(r))}}),!this.validateFiles()){this.snackbar.open("Please provide a description for all uploaded files","Close",{duration:3e3});return}this.supplierFiles.controls.forEach((e,r)=>{let l=e.value.file,s=e.value.description==="Other"?e.value.custom:e.value.description;i.append(`supplierFiles[${r}].file`,l,l.name),i.append(`supplierFiles[${r}].description`,s)}),this.busy=!0,this.supplierService.create(i).pipe(Z(()=>this.busy=!1)).subscribe({next:()=>{this.snackbar.open("Supplier created","Close",{duration:2e3}),this.router.navigate(["/suppliers"])},error:()=>this.snackbar.open("Failed to create supplier","Close",{duration:3e3})})}static \u0275fac=function(e){return new(e||t)(v(_e),v(P),v(Y),v(B),v(ge),v(F))};static \u0275cmp=w({type:t,selectors:[["app-supplier-create"]],decls:23,vars:10,consts:[[1,"supplier-create-root",3,"formGroup"],[1,"wizard-header"],[1,"left"],[1,"breadcrumb"],[1,"right"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"wizard-steps"],["class","step",3,"active","completed","click",4,"ngFor","ngForOf"],[1,"wizard-body"],["class","card",4,"ngIf"],["formArrayName","supplierFiles","class","card",4,"ngIf"],[1,"nav"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"step",3,"click"],[1,"num"],[1,"label"],[1,"card"],[1,"grid-3"],["appearance","fill"],["matInput","","formControlName","name"],["matInput","","formControlName","region"],["matInput","","type","number","formControlName","rating"],[1,"grid-2"],["matInput","","placeholder","a@x.com, b@y.com",3,"change"],["matInput","","placeholder","+2547\u2026, 07\u2026",3,"change"],[1,"muted"],[1,"category-tree"],[4,"ngFor","ngForOf"],[1,"category"],["type","checkbox",3,"change","checked"],[4,"ngIf"],[1,"subcategory"],["formArrayName","supplierFiles",1,"card"],["type","file","multiple","",3,"change"],["class","file-grid",4,"ngIf"],[1,"file-grid"],["class","file-card",3,"formGroupName",4,"ngFor","ngForOf"],[1,"file-card",3,"formGroupName"],[1,"preview"],["alt","Preview",3,"src","click",4,"ngIf"],["class","pdf-preview",3,"click",4,"ngIf"],["class","file-preview",4,"ngIf"],[1,"filename"],["formControlName","description"],[3,"value",4,"ngFor","ngForOf"],["appearance","fill",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],["alt","Preview",3,"click","src"],[1,"pdf-preview",3,"click"],[1,"file-preview"],[3,"value"],["matInput","","formControlName","custom"],[1,"review-grid"],["mat-stroked-button","","color","primary",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"header",1)(2,"div",2)(3,"h2"),a(4,"Create Supplier"),n(),o(5,"div",3),a(6,"Suppliers / Create"),n()(),o(7,"div",4)(8,"button",5),g("click",function(){return r.router.navigate(["/suppliers"])}),a(9," Cancel "),n(),o(10,"button",6),g("click",function(){return r.submit()}),a(11," Save Supplier "),n()()(),o(12,"nav",7),d(13,gi,5,6,"div",8),n(),o(14,"div",9),d(15,fi,16,0,"section",10)(16,Ci,12,0,"section",10)(17,hi,7,1,"section",10)(18,Pi,5,1,"section",11)(19,Oi,28,6,"section",10),o(20,"div",12),d(21,Ti,2,0,"button",13)(22,Di,2,0,"button",14),n()()()),e&2&&(m("formGroup",r.form),p(10),m("disabled",r.busy),p(3),m("ngForOf",r.steps),p(2),m("ngIf",r.step===0),p(),m("ngIf",r.step===1),p(),m("ngIf",r.step===2),p(),m("ngIf",r.step===3),p(),m("ngIf",r.step===4),p(2),m("ngIf",r.step>0),p(),m("ngIf",r.step<r.steps.length-1))},dependencies:[E,D,I,K,V,ce,R,q,W,Q,de,ue,$,A,X,j,z,Ce,fe,se,k,M,J,L,N,st],styles:[".supplier-create-root[_ngcontent-%COMP%]{max-width:1100px;margin:auto;padding:12px}.wizard-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.wizard-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600}.wizard-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.wizard-header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;gap:8px}.wizard-steps[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:16px}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:6px 12px;border:1px solid var(--border);border-radius:6px;cursor:pointer;background:var(--surface)}.step.active[_ngcontent-%COMP%]{background:#1a73e826;border-color:#1a73e866}.step.completed[_ngcontent-%COMP%]{opacity:.7}.step[_ngcontent-%COMP%]   .num[_ngcontent-%COMP%]{width:22px;height:22px;border-radius:50%;background:var(--surface-hover);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700}.wizard-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.card[_ngcontent-%COMP%]{padding:16px;border:1px solid var(--border);border-radius:8px;background:var(--surface)}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:12px;font-weight:600}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}.category-tree[_ngcontent-%COMP%]{list-style:none;padding-left:0}.category-tree[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:18px;margin-top:6px}.category-tree[_ngcontent-%COMP%]   .category[_ngcontent-%COMP%], .category-tree[_ngcontent-%COMP%]   .subcategory[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:4px 0}.category-tree[_ngcontent-%COMP%]   .subcategory[_ngcontent-%COMP%]{color:var(--text-secondary)}.file-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}.file-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:6px;padding:12px;background:var(--surface);display:flex;flex-direction:column;gap:10px}.filename[_ngcontent-%COMP%]{font-weight:600;font-size:.85rem;word-break:break-word}.preview[_ngcontent-%COMP%]{width:100%;height:140px;border:1px dashed var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;background:var(--surface-hover);cursor:pointer}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:cover;border-radius:4px}.pdf-preview[_ngcontent-%COMP%], .file-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--text-secondary)}.pdf-preview[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;color:#e53935}.filename[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;word-break:break-word}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:zoom-in}.review-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.muted[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.85rem}.nav[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px}"]})};var Rt=t=>({listImages:(i,e)=>t.listImages(i,e),listImageAudits:i=>t.imageAudits(i).pipe(qe(e=>(e??[]).map(r=>({fileName:r.fileName,action:r.action,performedByUsername:r.performedBy??"System",timestamp:r.timestamp})))),getImageBlob:(i,e,r)=>t.getSupplierImageBlob(i,e,r),uploadImages:(i,e)=>t.uploadImages(i,e),softDeleteImage:(i,e)=>t.softDeleteImage(i,e),restoreImage:(i,e)=>t.restoreImage(i,e),hardDeleteImage:(i,e)=>t.hardDeleteImage(i,e)});var Nt=t=>({$implicit:t});function Vi(t,i){if(t&1){let e=C();o(0,"button",27),g("click",function(){u(e);let l=c(2);return _(l.disableSupplier())}),o(1,"mat-icon"),a(2,"block"),n(),a(3," Disable "),n()}}function Ri(t,i){if(t&1){let e=C();o(0,"button",28),g("click",function(){u(e);let l=c(2);return _(l.restoreSupplier())}),o(1,"mat-icon"),a(2,"restore"),n(),a(3," Restore "),n()}}function Ni(t,i){if(t&1){let e=C();o(0,"button",27),g("click",function(){u(e);let l=c(2);return _(l.hardDeleteSupplier())}),o(1,"mat-icon"),a(2,"delete_forever"),n(),a(3," Delete permanently "),n()}}function Li(t,i){if(t&1&&(o(0,"div"),a(1),n()),t&2){let e=i.$implicit;p(),h(e)}}function Bi(t,i){if(t&1&&(o(0,"div"),a(1),n()),t&2){let e=i.$implicit;p(),h(e)}}function Ai(t,i){if(t&1&&S(0,"app-entity-image-manager",29),t&2){let e=c(2);m("entityId",e.supplierId)("adapter",e.imageAdapter)("allowHardDelete",e.isSuperuser())}}function $i(t,i){t&1&&(o(0,"div",30),a(1," No products supplied by this supplier "),n())}function zi(t,i){if(t&1){let e=C();o(0,"tr",33),g("click",function(){let l=u(e).$implicit,s=c(3);return _(s.goProduct(l.id))}),o(1,"td"),a(2),n(),o(3,"td"),a(4),n(),o(5,"td"),a(6),n()()}if(t&2){let e=i.$implicit;p(2),h(e.name),p(2),h(e.categoryName),p(2),h(e.variants.length||0)}}function ji(t,i){if(t&1&&(o(0,"table",31)(1,"tr")(2,"th"),a(3,"Name"),n(),o(4,"th"),a(5,"Category"),n(),o(6,"th"),a(7,"Variants"),n()(),d(8,zi,7,3,"tr",32),n()),t&2){let e=c(2);p(8),m("ngForOf",e.products)}}function Ui(t,i){if(t&1&&(o(0,"span",40),a(1),n()),t&2){let e=c().$implicit;p(),f(" ",e.supplyState==="DIRECT"?"SUPPLIED":e.supplyState==="DERIVED"?"DERIVED":"PARTIAL"," ")}}function Gi(t,i){if(t&1&&(o(0,"span",41),a(1),n()),t&2){let e=c().$implicit;p(),ee(" ",e.suppliedChildrenCount,"/",e.totalChildrenCount," ")}}function Hi(t,i){t&1&&Re(0)}function qi(t,i){if(t&1&&(b(0),d(1,Hi,1,0,"ng-container",42),y()),t&2){let e=i.$implicit;c(3);let r=Ne(48);p(),m("ngTemplateOutlet",r)("ngTemplateOutletContext",Le(2,Nt,e))}}function Wi(t,i){if(t&1&&(o(0,"ul"),d(1,qi,2,4,"ng-container",13),n()),t&2){let e=c().$implicit;p(),m("ngForOf",e.subcategories)}}function Qi(t,i){if(t&1&&(o(0,"li")(1,"div",34)(2,"mat-icon",35),a(3),n(),o(4,"span",36),a(5),n(),d(6,Ui,2,1,"span",37)(7,Gi,2,2,"span",38),n(),d(8,Wi,2,1,"ul",39),n()),t&2){let e=i.$implicit;p(),O("direct",e.supplyState==="DIRECT")("derived",e.supplyState==="DERIVED")("partial",e.supplyState==="PARTIAL"),p(2),f(" ",e.supplyState==="DIRECT"?"check_circle":e.supplyState==="DERIVED"?"check_circle_outline":e.supplyState==="PARTIAL"?"remove_circle_outline":"radio_button_unchecked"," "),p(2),h(e.name),p(),m("ngIf",e.supplyState!=="NONE"),p(),m("ngIf",e.totalChildrenCount),p(),m("ngIf",e.subcategories==null?null:e.subcategories.length)}}function Ki(t,i){if(t&1&&(o(0,"span",40),a(1),n()),t&2){let e=c().$implicit;p(),f(" ",e.supplyState==="DIRECT"?"SUPPLIED":e.supplyState==="DERIVED"?"DERIVED":"PARTIAL"," ")}}function Ji(t,i){if(t&1&&(o(0,"span",41),a(1),n()),t&2){let e=c().$implicit;p(),ee(" ",e.suppliedChildrenCount,"/",e.totalChildrenCount," ")}}function Xi(t,i){t&1&&Re(0)}function Yi(t,i){if(t&1&&(b(0),d(1,Xi,1,0,"ng-container",42),y()),t&2){let e=i.$implicit;c(3);let r=Ne(48);p(),m("ngTemplateOutlet",r)("ngTemplateOutletContext",Le(2,Nt,e))}}function Zi(t,i){if(t&1&&(o(0,"ul"),d(1,Yi,2,4,"ng-container",13),n()),t&2){let e=c().$implicit;p(),m("ngForOf",e.subcategories)}}function en(t,i){if(t&1&&(o(0,"li")(1,"div",34)(2,"mat-icon",35),a(3),n(),o(4,"span",36),a(5),n(),d(6,Ki,2,1,"span",37)(7,Ji,2,2,"span",38),n(),d(8,Zi,2,1,"ul",39),n()),t&2){let e=i.$implicit;p(),O("direct",e.supplyState==="DIRECT")("derived",e.supplyState==="DERIVED")("partial",e.supplyState==="PARTIAL"),p(2),f(" ",e.supplyState==="DIRECT"?"check_circle":e.supplyState==="DERIVED"?"check_circle_outline":e.supplyState==="PARTIAL"?"remove_circle_outline":"radio_button_unchecked"," "),p(2),h(e.name),p(),m("ngIf",e.supplyState!=="NONE"),p(),m("ngIf",e.totalChildrenCount),p(),m("ngIf",e.subcategories==null?null:e.subcategories.length)}}function tn(t,i){if(t&1&&(o(0,"span"),a(1),n()),t&2){let e=c().$implicit;p(),f(" \u2014 by ",e.performedBy," ")}}function nn(t,i){if(t&1&&(o(0,"div",47),a(1),n()),t&2){let e=c().$implicit;p(),ee(" ",e.oldValue||"\u2014"," \u2192 ",e.newValue||"\u2014"," ")}}function rn(t,i){if(t&1&&(o(0,"div",43)(1,"mat-icon"),a(2,"history"),n(),o(3,"div",44)(4,"div",45),a(5),n(),o(6,"div",41),a(7),re(8,"date"),d(9,tn,2,1,"span",39),n(),d(10,nn,2,2,"div",46),n()()),t&2){let e=i.$implicit;p(5),h(e.action),p(2),f(" ",oe(8,4,e.timestamp,"medium")," "),p(2),m("ngIf",e.performedBy),p(),m("ngIf",e.fieldChanged)}}function on(t,i){t&1&&(o(0,"div",48),a(1," No audit records "),n())}function an(t,i){if(t&1){let e=C();o(0,"div",2)(1,"div",3)(2,"div")(3,"h2"),a(4),n(),o(5,"div",4),a(6),n()(),o(7,"div",5)(8,"button",6),g("click",function(){u(e);let l=c();return _(l.back())}),a(9,"Back"),n(),o(10,"button",6),g("click",function(){u(e);let l=c();return _(l.editSupplier())}),o(11,"mat-icon"),a(12,"edit"),n(),a(13," Edit "),n(),d(14,Vi,4,0,"button",7)(15,Ri,4,0,"button",8)(16,Ni,4,0,"button",7),n()(),o(17,"mat-tab-group",9)(18,"mat-tab",10)(19,"mat-card",11)(20,"div")(21,"label"),a(22,"Status"),n(),o(23,"div",12),a(24),n()(),o(25,"div")(26,"label"),a(27,"Region"),n(),o(28,"div"),a(29),n()(),o(30,"div")(31,"label"),a(32,"Emails"),n(),d(33,Li,2,1,"div",13),n(),o(34,"div")(35,"label"),a(36,"Phones"),n(),d(37,Bi,2,1,"div",13),n()()(),o(38,"mat-tab",14),d(39,Ai,1,3,"app-entity-image-manager",15),n(),o(40,"mat-tab",16)(41,"mat-card",17),d(42,$i,2,0,"div",18)(43,ji,9,1,"table",19),n()(),o(44,"mat-tab",20)(45,"ul",21),d(46,Qi,9,11,"li",13),n(),d(47,en,9,11,"ng-template",null,0,Ze),n(),o(49,"mat-tab",22)(50,"mat-card",23)(51,"div",24),d(52,rn,11,7,"div",25)(53,on,2,0,"div",26),n()()()()()}if(t&2){let e=c();p(4),h(e.supplier.name),p(2),f("Suppliers / ",e.supplier.name,""),p(8),m("ngIf",!e.supplier.deleted&&e.canSoftDelete()),p(),m("ngIf",e.supplier.deleted&&e.canSoftDelete()),p(),m("ngIf",e.supplier.deleted&&e.canHardDelete()),p(7),O("deleted",e.supplier.deleted),p(),f(" ",e.status()," "),p(5),h(e.supplier.region||"\u2014"),p(4),m("ngForOf",e.supplier.email),p(4),m("ngForOf",e.supplier.phoneNumber),p(2),m("ngIf",e.supplierId),p(3),m("ngIf",e.products.length===0),p(),m("ngIf",e.products.length),p(3),m("ngForOf",e.categories),p(6),m("ngForOf",e.audits),p(),m("ngIf",!e.audits.length)}}var Te=class t{constructor(i,e,r,l,s,x,T){this.route=i;this.router=e;this.location=r;this.supplierService=l;this.categoryService=s;this.auth=x;this.snackbar=T}supplier;supplierId;loading=!0;role="";products=[];derivedCategories=[];audits=[];imageAdapter;categories=[];ngOnInit(){this.auth.getCurrentUser().subscribe(l=>{this.role=l?.role??""}),this.imageAdapter=Rt(this.supplierService);let i=this.route.snapshot.paramMap.get("identifier");if(!i)return;let r=this.router.getCurrentNavigation()?.extras.state?.deleted??!1;this.loadSupplier(i,r),this.loadCategories()}loadSupplier(i,e){this.loading=!0,this.supplierService.getById(i,e).subscribe({next:r=>{this.supplier=r,this.supplierId=r.id,this.loading=!1,this.loadProducts(),this.loadAudits()},error:()=>{this.snackbar.open("Failed to load supplier","Close",{duration:3e3}),this.router.navigate(["/suppliers"])}})}loadProducts(){this.supplierService.productsSupplied(this.supplierId).subscribe(i=>{this.products=i||[],this.computeCategoriesFromProducts()})}computeCategoriesFromProducts(){let i=new Map;this.products.forEach(e=>{e.categoryId&&e.categoryName&&i.set(e.categoryId,e.categoryName)}),this.derivedCategories=Array.from(i.entries()).map(([e,r])=>({id:e,name:r}))}loadAudits(){this.supplierService.supplierAudits(this.supplierId).subscribe(i=>this.audits=i||[])}loadCategories(){this.categoryService.getAll("tree",!1).subscribe(i=>{this.categories=i.map(e=>He(e,this.supplierId))})}isSupplied(i){return!!i.suppliers?.some(e=>e.id===this.supplierId)}hasSuppliedDescendant(i){return i.subcategories?.length?i.subcategories.some(e=>this.isSupplied(e)||this.hasSuppliedDescendant(e)):!1}isSuperuser(){return this.role==="SUPERUSER"}canSoftDelete(){return["ADMIN","SUPERUSER"].includes(this.role)}canHardDelete(){return this.role==="SUPERUSER"}back(){this.location.back()}editSupplier(){this.router.navigate(["/suppliers",this.supplierId,"edit"],{state:{deleted:this.supplier.deleted}})}disableSupplier(){this.supplierService.softDelete(this.supplierId,"Disabled from supplier details").subscribe(()=>{this.supplier.deleted=!0,this.snackbar.open("Supplier disabled","Close",{duration:2e3})})}restoreSupplier(){this.supplierService.restore(this.supplierId,"Restored from supplier details").subscribe(()=>{this.supplier.deleted=!1,this.snackbar.open("Supplier restored","Close",{duration:2e3})})}hardDeleteSupplier(){this.supplierService.hardDelete(this.supplierId).subscribe(()=>{this.snackbar.open("Supplier permanently deleted","Close",{duration:2e3}),this.router.navigate(["/suppliers"])})}goProduct(i){this.router.navigate(["/products",i])}status(){return this.supplier.deleted?"DISABLED":"ACTIVE"}static \u0275fac=function(e){return new(e||t)(v(pe),v(F),v(ae),v(P),v(Y),v(at),v(B))};static \u0275cmp=w({type:t,selectors:[["app-supplier-details"]],decls:1,vars:1,consts:[["node",""],["class","supplier-details-root",4,"ngIf"],[1,"supplier-details-root"],[1,"page-header"],[1,"breadcrumb"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["dynamicHeight",""],["label","Overview"],[1,"card","grid-2"],[1,"status"],[4,"ngFor","ngForOf"],["label","Documents"],[3,"entityId","adapter","allowHardDelete",4,"ngIf"],["label","Products"],[1,"card"],["class","empty",4,"ngIf"],["class","product-table",4,"ngIf"],["label","Categories"],[1,"category-tree"],["label","Audits"],[1,"card","audit-card"],[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],["class","muted",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],[3,"entityId","adapter","allowHardDelete"],[1,"empty"],[1,"product-table"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"category-row"],[1,"state-icon"],[1,"name"],["class","badge",4,"ngIf"],["class","meta",4,"ngIf"],[4,"ngIf"],[1,"badge"],[1,"meta"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"timeline-item"],[1,"content"],[1,"title"],["class","change",4,"ngIf"],[1,"change"],[1,"muted"]],template:function(e,r){e&1&&d(0,an,54,17,"div",1),e&2&&m("ngIf",!r.loading)},dependencies:[E,D,I,et,le,be,he,Ot,kt,Pt,k,M,L,N,It],styles:[".supplier-details-root[_ngcontent-%COMP%]{max-width:1200px;margin:auto;padding:16px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.4rem}.page-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.page-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.card[_ngcontent-%COMP%]{padding:20px;background:var(--surface);border:1px solid var(--border)}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:20px}.grid-2[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.grid-2[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.03em;color:var(--text-secondary)}.status[_ngcontent-%COMP%]{font-weight:700}.status.deleted[_ngcontent-%COMP%]{color:#dc2626}.product-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;text-align:left}.product-table[_ngcontent-%COMP%]   .product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.03em;color:var(--text-secondary)}.product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid var(--border)}.product-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{cursor:pointer}.product-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:var(--surface-hover)}.category-tree[_ngcontent-%COMP%]{list-style:none;padding-left:0}.category-tree[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding-left:22px;border-left:1px dashed var(--border);margin-left:8px}.category-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 14px;margin-bottom:6px;border-radius:6px;border-left:3px solid transparent;background:var(--surface)}.category-row[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{font-size:20px}.category-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;flex:1}.category-row[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.category-row[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.65rem;font-weight:700;padding:3px 8px;border-radius:12px}.category-row.direct[_ngcontent-%COMP%]{background:#22c55e14;border-left-color:#22c55e}.category-row.direct[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{color:#22c55e}.category-row.direct[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#22c55e26;color:#166534}.category-row.derived[_ngcontent-%COMP%]{background:#22c55e0a;border-left-color:#86efac}.category-row.derived[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{color:#22c55e}.category-row.derived[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#22c55e1a;color:#15803d}.category-row.partial[_ngcontent-%COMP%]{background:#eab30814;border-left-color:#facc15}.category-row.partial[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{color:#eab308}.category-row.partial[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#eab30826;color:#854d0e}.audit-card[_ngcontent-%COMP%]{padding:0;background:var(--app-bg)}.timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px;padding:16px}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:12px;padding:12px;border:1px solid var(--border);border-radius:6px;background:var(--surface)}.timeline-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:20px;margin-top:2px}.timeline-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.timeline-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;font-size:.95rem}.timeline-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.timeline-item[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{font-size:.85rem}.muted[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary);padding:16px}.empty[_ngcontent-%COMP%]{padding:24px;text-align:center;color:var(--text-secondary)}"]})};function He(t,i){let e=t.subcategories??[];if(t.suppliers?.some(x=>x.id===i)??!1)return H(G({},t),{supplyState:"DIRECT",suppliedChildrenCount:e.length,totalChildrenCount:e.length,subcategories:e.map(x=>He(x,i))});if(e.length===0)return H(G({},t),{supplyState:"NONE",suppliedChildrenCount:0,totalChildrenCount:0});let l=e.map(x=>He(x,i)),s=l.filter(x=>x.supplyState==="DIRECT").length;return s===l.length?H(G({},t),{supplyState:"DERIVED",suppliedChildrenCount:s,totalChildrenCount:l.length,subcategories:l}):s>0?H(G({},t),{supplyState:"PARTIAL",suppliedChildrenCount:s,totalChildrenCount:l.length,subcategories:l}):H(G({},t),{supplyState:"NONE",suppliedChildrenCount:0,totalChildrenCount:l.length,subcategories:l})}function ln(t,i){t&1&&(o(0,"mat-error"),a(1," Supplier name is required "),n())}function pn(t,i){if(t&1){let e=C();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),a(4,"Edit Supplier"),n(),o(5,"div",4),a(6),n()(),o(7,"div",5)(8,"button",6),g("click",function(){u(e);let l=c();return _(l.cancel())}),a(9," Cancel "),n(),o(10,"button",7),g("click",function(){u(e);let l=c();return _(l.submit())}),a(11," Save Changes "),n()()(),o(12,"mat-card",8)(13,"div",9)(14,"h3"),a(15,"Basic Information"),n()(),o(16,"form",10)(17,"mat-form-field",11)(18,"mat-label"),a(19,"Supplier Name"),n(),S(20,"input",12),d(21,ln,2,0,"mat-error",13),n(),o(22,"mat-form-field",11)(23,"mat-label"),a(24,"Region"),n(),S(25,"input",14),o(26,"mat-hint"),a(27,"Optional geographical region"),n()(),o(28,"mat-form-field",11)(29,"mat-label"),a(30,"Rating"),n(),S(31,"input",15),o(32,"mat-hint"),a(33,"Internal supplier rating (0\u20135)"),n()()()(),o(34,"mat-card",8)(35,"div",9)(36,"h3"),a(37,"Contact Information"),n()(),o(38,"form",10)(39,"mat-form-field",11)(40,"mat-label"),a(41,"Email Addresses"),n(),S(42,"input",16),o(43,"mat-hint"),a(44,"Comma-separated emails"),n()(),o(45,"mat-form-field",11)(46,"mat-label"),a(47,"Phone Numbers"),n(),S(48,"input",17),o(49,"mat-hint"),a(50,"Comma-separated phone numbers"),n()()()()()}if(t&2){let e,r=c();p(6),f("Suppliers / ",r.form.value.name||"Edit",""),p(4),m("disabled",r.form.invalid),p(6),m("formGroup",r.form),p(5),m("ngIf",(e=r.form.get("name"))==null?null:e.invalid),p(17),m("formGroup",r.form)}}var De=class t{constructor(i,e,r,l,s,x){this.fb=i;this.route=e;this.router=r;this.supplierService=l;this.snackbar=s;this.location=x}form;supplierId;ngOnInit(){this.supplierId=this.route.snapshot.paramMap.get("identifier"),this.buildForm(),this.loadSupplier()}buildForm(){this.form=this.fb.group({name:["",U.required],region:[""],rating:[null],emailsInput:[""],phonesInput:[""]})}loadSupplier(){let e=this.router.getCurrentNavigation()?.extras.state?.deleted??!1;this.supplierService.getById(this.supplierId,e).subscribe(r=>{this.patchForm(r)})}patchForm(i){this.form.patchValue({name:i.name,region:i.region,rating:i.rating,emailsInput:(i.email||[]).join(", "),phonesInput:(i.phoneNumber||[]).join(", ")})}submit(){let i={name:this.form.value.name,region:this.form.value.region,rating:this.form.value.rating,email:this.split(this.form.value.emailsInput),phoneNumber:this.split(this.form.value.phonesInput)};this.supplierService.update(this.supplierId,i).subscribe({next:()=>{this.snackbar.open("Supplier updated","Close",{duration:2e3}),this.router.navigate(["/suppliers",this.supplierId])}})}cancel(){this.location.back()}split(i){return(i||"").split(",").map(e=>e.trim()).filter(Boolean)}static \u0275fac=function(e){return new(e||t)(v(_e),v(pe),v(F),v(P),v(B),v(ae))};static \u0275cmp=w({type:t,selectors:[["app-supplier-edit"]],decls:1,vars:1,consts:[["class","supplier-edit-root",4,"ngIf"],[1,"supplier-edit-root"],[1,"page-header"],[1,"title"],[1,"breadcrumb"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"card"],[1,"card-header"],[1,"form-grid",3,"formGroup"],["appearance","fill"],["matInput","","formControlName","name"],[4,"ngIf"],["matInput","","formControlName","region"],["matInput","","type","number","formControlName","rating"],["matInput","","formControlName","emailsInput"],["matInput","","formControlName","phonesInput"]],template:function(e,r){e&1&&d(0,pn,51,5,"div",0),e&2&&m("ngIf",r.form)},dependencies:[E,I,K,me,V,ce,R,q,W,Q,be,he,$,A,X,ct,mt,j,z,k,M],styles:[".supplier-edit-root[_ngcontent-%COMP%]{max-width:1100px;margin:auto;padding:16px;display:flex;flex-direction:column;gap:18px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:16px}.page-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.4rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary);margin-top:2px}.page-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.card[_ngcontent-%COMP%]{padding:20px}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{margin-bottom:16px}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}mat-form-field[_ngcontent-%COMP%]{width:100%}"]})};var Fr=[{path:"",canActivate:[pt],children:[{path:"",component:Pe},{path:"create",component:Oe},{path:":identifier/edit",component:De},{path:":identifier",component:Te}]}];export{Fr as SUPPLIER_ROUTES};
