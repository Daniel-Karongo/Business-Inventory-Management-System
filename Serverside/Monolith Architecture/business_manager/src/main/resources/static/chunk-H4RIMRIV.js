import{a}from"./chunk-RUIAFSGF.js";import{d as n}from"./chunk-VUFC7WNX.js";import{a as u}from"./chunk-5DTMLZHP.js";import{Z as r,ca as e,xa as s}from"./chunk-3DYKM6ZU.js";var m=class i{constructor(t,o,h){this.auth=t;this.router=o;this.zone=h}timeoutId;loggingOut=!1;idleMs=u.idleLogoutMinutes*60*1e3;events=["mousemove","mousedown","keydown","scroll","touchstart"];boundResetTimer=()=>this.resetTimer();start(){this.resetTimer(),this.zone.runOutsideAngular(()=>{this.events.forEach(t=>document.addEventListener(t,this.boundResetTimer,!0))})}stop(){clearTimeout(this.timeoutId),this.events.forEach(t=>document.removeEventListener(t,this.boundResetTimer,!0))}ngOnDestroy(){this.stop()}resetTimer(){clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.logout()},this.idleMs)}logout(){this.loggingOut||(this.loggingOut=!0,this.stop(),this.zone.run(()=>{this.auth.logout().subscribe({next:()=>this.finishLogout(),error:()=>this.finishLogout()})}))}finishLogout(){this.auth.clearLocalState(),this.loggingOut=!1,this.router.navigate(["/login"],{replaceUrl:!0,queryParams:{reason:"idle"}})}static \u0275fac=function(o){return new(o||i)(e(a),e(n),e(s))};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
