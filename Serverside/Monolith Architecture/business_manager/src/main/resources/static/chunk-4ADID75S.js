import{a as Ge}from"./chunk-OR6PPJ4J.js";import"./chunk-4D3L4XDL.js";import{a as $}from"./chunk-ERCVAAHD.js";import{a as St,b as wt,c as It}from"./chunk-L7HY2LX6.js";import{b as Et,c as Mt,d as yt}from"./chunk-QDY2WV2X.js";import"./chunk-ZPGHPDH7.js";import{a as Le,b as Fe}from"./chunk-3WA4OH2X.js";import{a as fe,b as _e}from"./chunk-KPX6MBY5.js";import{a as ne,b as oe,c as re,d as ae,e as le,f as me,g as se,h as ce,i as pe,j as de,k as ue}from"./chunk-NDRSAYSM.js";import{a as Dt,c as kt,f as Tt,g as At,h as Be}from"./chunk-5GYNI7WA.js";import{a as Ve,b as vt,c as Pe,h as Oe}from"./chunk-G6DPSII6.js";import"./chunk-X5MK7W46.js";import{a as Ne,b as Re}from"./chunk-GQKP7E5B.js";import"./chunk-MS4AQ6UA.js";import{a as j,b as H}from"./chunk-H37LQHOQ.js";import{d as A}from"./chunk-DF6WYVPK.js";import{c as ke}from"./chunk-MJONFXFY.js";import{b as O,c as I}from"./chunk-F3TBVMOI.js";import{a as ie}from"./chunk-BIVTK5YB.js";import{c as B,d as G}from"./chunk-ZFWGKVXC.js";import"./chunk-3RK6DDJD.js";import{a as F}from"./chunk-CONPK5ZF.js";import{b as z,c as bt,d as xt,h as L}from"./chunk-3ZV2DC5Q.js";import"./chunk-SGYCFQGT.js";import{d as N,f as J,h as R,i as Q,k as V,m as X,o as Te,p as Z,q as _t,r as Ct,s as ee,u as gt,v as Ae,x as P}from"./chunk-Z2GGFO6C.js";import"./chunk-75T6YVBZ.js";import{f as te,g as D,h as k}from"./chunk-TENNXE3V.js";import"./chunk-2X53NFZU.js";import{b as De,d as U,e as W,h as K}from"./chunk-VUFC7WNX.js";import"./chunk-CDHEWSLI.js";import{a as ht}from"./chunk-5DTMLZHP.js";import{$b as Y,Bb as we,E as rt,Ib as n,Jb as o,Kb as b,Lb as x,Mb as S,Ob as v,Qb as f,Rb as p,Sc as dt,Tc as ye,Ub as ct,Uc as M,Yc as Ie,Z as at,_c as ut,ac as r,bb as m,bc as T,bd as y,cc as C,da as lt,gb as h,jd as ft,lc as Ee,ma as d,mc as Me,na as u,nb as E,nc as pt,pc as q,qb as mt,qc as tt,rc as ve,sb as _,tc as it,yb as st,zb as c}from"./chunk-3DYKM6ZU.js";import{g as Ze,h as et}from"./chunk-FJYW2LMB.js";var Bt=()=>[1,5,10,20,50];function Gt(i,t){if(i&1&&(n(0,"div",25)(1,"mat-form-field",4)(2,"mat-label"),r(3,"Search customers"),o(),b(4,"input",26),o()()),i&2){let e=p();m(4),c("formControl",e.searchCtrl)}}function jt(i,t){if(i&1&&(n(0,"mat-form-field",28)(1,"mat-label"),r(2,"Gender"),o(),n(3,"mat-select",29)(4,"mat-option",30),r(5,"All"),o(),n(6,"mat-option",34),r(7,"Male"),o(),n(8,"mat-option",35),r(9,"Female"),o()()()),i&2){let e=p(2);m(3),c("formControl",e.filterGenderCtrl)}}function Ht(i,t){if(i&1&&(n(0,"div",27)(1,"mat-form-field",28)(2,"mat-label"),r(3,"Type"),o(),n(4,"mat-select",29)(5,"mat-option",30),r(6,"All"),o(),n(7,"mat-option",31),r(8,"Individual"),o(),n(9,"mat-option",32),r(10,"Company"),o()()(),_(11,jt,10,1,"mat-form-field",33),o()),i&2){let e=p();m(4),c("formControl",e.filterTypeCtrl),m(7),c("ngIf",e.filterTypeCtrl.value==="INDIVIDUAL")}}function $t(i,t){if(i&1){let e=v();n(0,"th",36)(1,"mat-checkbox",37),f("change",function(){d(e);let a=p();return u(a.toggleAll())}),o()()}if(i&2){let e=p();m(),c("checked",e.isAllSelected())("indeterminate",e.isIndeterminate())}}function Ut(i,t){if(i&1){let e=v();n(0,"td",38)(1,"mat-checkbox",39),f("click",function(a){return d(e),u(a.stopPropagation())}),o()()}if(i&2){let e=t.$implicit,l=p();m(),c("checked",l.selection.isSelected(e))}}function zt(i,t){i&1&&(n(0,"th",36),r(1,"Name"),o())}function qt(i,t){if(i&1&&(n(0,"td",38),r(1),o()),i&2){let e=t.$implicit;m(),T(e.name)}}function Yt(i,t){i&1&&(n(0,"th",36),r(1,"Phones"),o())}function Wt(i,t){if(i&1&&(n(0,"td",38),r(1),o()),i&2){let e=t.$implicit;m(),C(" ",(e.phoneNumbers==null?null:e.phoneNumbers.join(", "))||"\u2014"," ")}}function Kt(i,t){i&1&&(n(0,"th",36),r(1,"Emails"),o())}function Jt(i,t){if(i&1&&(n(0,"td",38),r(1),o()),i&2){let e=t.$implicit;m(),C(" ",(e.email==null?null:e.email.join(", "))||"\u2014"," ")}}function Qt(i,t){i&1&&b(0,"tr",40)}function Xt(i,t){if(i&1){let e=v();n(0,"tr",41),f("click",function(){let a=d(e).$implicit,s=p();return u(s.toggleRow(a))}),o()}if(i&2){let e=t.$implicit,l=p();we("row-selected",l.selection.isSelected(e))}}function Zt(i,t){if(i&1){let e=v();n(0,"mat-paginator",42),f("page",function(a){d(e);let s=p();return u(s.onPageChange(a))}),o()}if(i&2){let e=p();c("length",e.total)("pageSize",e.size)("pageSizeOptions",Ee(3,Bt))}}var Ce=class i{constructor(t,e){this.data=t;this.ref=e}allCustomers=[];filteredCustomers=[];customers=[];selection=new ke(!0,[]);searchCtrl=new V("");messageCtrl=new V("",{nonNullable:!0});filterTypeCtrl=new V("");filterGenderCtrl=new V("");displayedColumns=["select","name","phones","emails"];total=0;page=0;size=10;ngOnInit(){this.allCustomers=this.data.customers??[],this.applyFilters(),this.searchCtrl.valueChanges.subscribe(()=>{this.page=0,this.applyFilters()}),this.filterTypeCtrl.valueChanges.subscribe(()=>{this.filterTypeCtrl.value!=="INDIVIDUAL"&&this.filterGenderCtrl.reset(""),this.page=0,this.applyFilters()}),this.filterGenderCtrl.valueChanges.subscribe(()=>{this.page=0,this.applyFilters()})}applyFilters(){let t=[...this.allCustomers],e=(this.searchCtrl.value||"").trim().toLowerCase();e&&(t=t.filter(l=>(l.name||"").toLowerCase().includes(e)||(l.phoneNumbers||[]).some(a=>a.includes(e))||(l.email||[]).some(a=>a.toLowerCase().includes(e)))),this.filterTypeCtrl.value&&(t=t.filter(l=>l.type===this.filterTypeCtrl.value)),this.filterGenderCtrl.value&&(t=t.filter(l=>l.gender===this.filterGenderCtrl.value)),this.filteredCustomers=t,this.total=t.length,this.selection.clear(),this.applyPagination()}applyPagination(){let t=this.page*this.size,e=t+this.size;this.customers=this.filteredCustomers.slice(t,e)}toggleRow(t){this.selection.toggle(t)}isAllSelected(){return this.customers.length>0&&this.selection.selected.length===this.customers.length}isIndeterminate(){return this.selection.selected.length>0&&this.selection.selected.length<this.customers.length}toggleAll(){this.isAllSelected()?this.selection.clear():this.customers.forEach(t=>this.selection.select(t))}onPageChange(t){this.page=t.pageIndex,this.size=t.pageSize,this.applyPagination()}send(){!this.messageCtrl.value.trim()||!this.selection.selected.length||this.ref.close({message:this.messageCtrl.value.trim(),customerIds:this.selection.selected.map(t=>t.id)})}close(){this.ref.close()}static \u0275fac=function(e){return new(e||i)(h(vt),h(Ve))};static \u0275cmp=E({type:i,selectors:[["app-sms-dialog"]],decls:42,vars:10,consts:[[1,"sms-dialog"],[1,"header"],["mat-icon-button","","matTooltip","Close",3,"click"],[1,"message"],["appearance","fill",1,"w-full"],["matInput","","rows","4","maxlength","480",3,"formControl"],["align","end"],["class","search",4,"ngIf"],["class","filters",4,"ngIf"],[1,"table-wrapper"],["mat-table","",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","phones"],["matColumnDef","emails"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"row-selected","click",4,"matRowDef","matRowDefColumns"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],[1,"actions"],[1,"count"],[1,"spacer"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"search"],["matInput","","placeholder","Search by name, phone or email",3,"formControl"],[1,"filters"],["appearance","fill"],[3,"formControl"],["value",""],["value","INDIVIDUAL"],["value","COMPANY"],["appearance","fill",4,"ngIf"],["value","MALE"],["value","FEMALE"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"click","checked"],["mat-header-row",""],["mat-row","",3,"click"],[3,"page","length","pageSize","pageSizeOptions"]],template:function(e,l){e&1&&(n(0,"div",0)(1,"header",1)(2,"h3"),r(3,"Send SMS"),o(),n(4,"button",2),f("click",function(){return l.close()}),n(5,"mat-icon"),r(6,"close"),o()()(),n(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),r(10,"Message"),o(),n(11,"textarea",5),r(12,"    "),o(),n(13,"mat-hint",6),r(14),o()()(),_(15,Gt,5,1,"div",7)(16,Ht,12,2,"div",8),n(17,"div",9)(18,"table",10),x(19,11),_(20,$t,2,2,"th",12)(21,Ut,2,1,"td",13),S(),x(22,14),_(23,zt,2,0,"th",12)(24,qt,2,1,"td",13),S(),x(25,15),_(26,Yt,2,0,"th",12)(27,Wt,2,1,"td",13),S(),x(28,16),_(29,Kt,2,0,"th",12)(30,Jt,2,1,"td",13),S(),_(31,Qt,1,0,"tr",17)(32,Xt,1,2,"tr",18),o(),_(33,Zt,1,4,"mat-paginator",19),o(),n(34,"footer",20)(35,"span",21),r(36),o(),b(37,"div",22),n(38,"button",23),f("click",function(){return l.close()}),r(39,"Cancel"),o(),n(40,"button",24),f("click",function(){return l.send()}),r(41," Send SMS "),o()()()),e&2&&(m(11),c("formControl",l.messageCtrl),m(3),C(" ",l.messageCtrl.value.length,"/480 "),m(),c("ngIf",l.customers.length>1),m(),c("ngIf",l.customers.length>1),m(2),c("dataSource",l.customers),m(13),c("matHeaderRowDef",l.displayedColumns),m(),c("matRowDefColumns",l.displayedColumns),m(),c("ngIf",l.customers.length>1),m(3),C(" ",l.selection.selected.length," selected "),m(4),c("disabled",!l.selection.selected.length||!l.messageCtrl.value.trim()))},dependencies:[y,M,P,N,R,gt,Te,ue,ne,re,se,ae,oe,ce,le,me,pe,de,Fe,Le,k,D,te,I,O,F,L,z,xt,G,B,H,j,A,_e,fe,Re,Ne],styles:[".sms-dialog[_ngcontent-%COMP%]{background:var(--surface);padding:1rem;border-radius:.75rem;overflow-y:auto!important}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.header[_ngcontent-%COMP%], .message[_ngcontent-%COMP%], .search[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]{margin-bottom:.75rem}.filters[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}.filters[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:180px}.table-wrapper[_ngcontent-%COMP%]{max-height:300px;overflow:auto;border:1px solid var(--border);border-radius:6px}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{font-weight:600;white-space:nowrap}.mdc-data-table__row[_ngcontent-%COMP%]{cursor:pointer}.mdc-data-table__row.row-selected[_ngcontent-%COMP%]{background-color:#007aff14!important;border-left:4px solid #007aff}.actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:1rem}.spacer[_ngcontent-%COMP%]{flex:1}.count[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}"]})};var Vt={title:"Bulk Import Customers",confirmLabel:"Import Now",csvFileName:"customers-bulk-template.csv",excelFileName:"customers-bulk-template.xlsx",supportsArchiveImport:!1,headers:["name","phones","emails","type","gender","address","notes"],fields:[{name:"name",required:!0},{name:"phones"},{name:"emails"},{name:"type",defaultValue:"INDIVIDUAL"},{name:"gender"},{name:"address"},{name:"notes"}],previewColumns:[{key:"name",label:"Name"},{key:"phoneNumbers",label:"Phones"},{key:"email",label:"Emails"},{key:"type",label:"Type"}],excelSheetName:"Customers",excelColumns:[{header:"name",key:"name",width:22},{header:"phones",key:"phones",width:22,format:"text"},{header:"emails",key:"emails",width:32},{header:"type",key:"type",width:14},{header:"gender",key:"gender",width:14},{header:"address",key:"address",width:26},{header:"notes",key:"notes",width:32}],exampleRow:{name:"John Doe",phones:"0712345678",emails:"john@doe.com",type:"INDIVIDUAL",gender:"MALE",address:"Nairobi",notes:"VIP customer"},emptyRow:{type:"INDIVIDUAL"},emptyRowCount:200,defaultOptions:{dryRun:!0,skipDuplicates:!0},mapRowToItem(i){return{name:i.name,phone:i.phones,email:i.emails,type:i.type,gender:i.gender||null,address:i.address,notes:i.notes}},mapPreviewRow(i){return i},submit(i){return null}};function ei(i,t){if(i&1&&(n(0,"div",27),r(1),o()),i&2){let e=p().$implicit;m(),C(" ",e.value._error," ")}}function ti(i,t){if(i&1){let e=v();n(0,"div",9)(1,"div",10)(2,"span"),r(3),o(),n(4,"button",11),f("click",function(){let a=d(e).index,s=p();return u(s.removeRow(a))}),n(5,"mat-icon"),r(6,"delete"),o()()(),n(7,"div",12)(8,"mat-form-field"),b(9,"input",13),o(),n(10,"mat-form-field"),b(11,"input",14),o(),n(12,"mat-form-field"),b(13,"input",15),o()(),n(14,"div",12)(15,"mat-form-field")(16,"mat-select",16)(17,"mat-option",17),r(18,"INDIVIDUAL"),o(),n(19,"mat-option",18),r(20,"COMPANY"),o()()(),n(21,"mat-form-field")(22,"mat-select",19)(23,"mat-option",20),r(24,"N/A"),o(),n(25,"mat-option",21),r(26,"MALE"),o(),n(27,"mat-option",22),r(28,"FEMALE"),o(),n(29,"mat-option",23),r(30,"OTHER"),o()()(),n(31,"mat-form-field"),b(32,"input",24),o()(),n(33,"mat-form-field"),b(34,"input",25),o(),_(35,ei,2,1,"div",26),o()}if(i&2){let e=t.$implicit,l=t.index;c("formGroupName",l),m(3),C("Customer ",l+1,""),m(32),c("ngIf",e.value._error)}}var qe=class i extends St{constructor(e,l,a){super();this.customerService=e;this.submitEngine=l;this.dialogRef=a}config=Vt;ngOnInit(){this.initForm()}submit(){if(this.form.invalid)return;let e={items:this.rows.controls.map(l=>this.config.mapRowToItem(l.value)),options:{dryRun:this.form.value.dryRun,skipDuplicates:!0}};this.submitEngine.execute({submitFn:l=>this.customerService.bulkImport(l),payload:e,rows:this.rows.controls,dryRun:this.form.value.dryRun,title:this.config.title,confirmLabel:this.config.confirmLabel,columns:this.config.previewColumns,onErrorsApplied:l=>this.cacheErrors(l),onFinalSuccess:()=>this.dialogRef.close(!0),onConfirmRetry:()=>{this.form.patchValue({dryRun:!1}),this.submit()}})}importExcel(e){return et(this,null,function*(){if(!e)return;let l=yield this.confirmMerge();l&&Ze(i.prototype,this,"importExcelFile").call(this,e,void 0,l)})}importCsv(e){return et(this,null,function*(){if(!e)return;let l=yield this.confirmMerge();l&&Ze(i.prototype,this,"importCsvFile").call(this,e,l)})}close(){this.dialogRef.close()}static \u0275fac=function(l){return new(l||i)(h($),h(It),h(Ve))};static \u0275cmp=E({type:i,selectors:[["app-customer-bulk-import-dialog"]],features:[mt],decls:12,vars:8,consts:[["bottomAnchor",""],[3,"keydown.enter","formGroup"],[3,"importCsv","importExcel","downloadCsv","downloadExcel","submit","cancel","goToLine","goTop","goBottom","prevError","nextError","clearAll","exportCsv","exportExcel","title","rowCount","submitting","formInvalid","loading","progress"],[1,"customers-body"],["bulk-options",""],["formControlName","dryRun"],["formArrayName","rows",1,"rows"],["class","row-card",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],[1,"row-card",3,"formGroupName"],[1,"row-header"],["mat-icon-button","","color","warn",3,"click"],[1,"grid-3"],["matInput","","placeholder","Name","formControlName","name"],["matInput","","placeholder","Phones","formControlName","phones"],["matInput","","placeholder","Emails","formControlName","emails"],["formControlName","type"],["value","INDIVIDUAL"],["value","COMPANY"],["formControlName","gender"],["value",""],["value","MALE"],["value","FEMALE"],["value","OTHER"],["matInput","","placeholder","Address","formControlName","address"],["matInput","","placeholder","Notes","formControlName","notes"],["class","row-error",4,"ngIf"],[1,"row-error"]],template:function(l,a){if(l&1){let s=v();n(0,"form",1),f("keydown.enter",function(w){return d(s),u(w.stopPropagation())}),n(1,"app-bulk-import-shell",2),f("importCsv",function(w){return d(s),u(a.importCsv(w))})("importExcel",function(w){return d(s),u(a.importExcel(w))})("downloadCsv",function(){return d(s),u(a.downloadCsvTemplate())})("downloadExcel",function(){return d(s),u(a.downloadExcelTemplate())})("submit",function(){return d(s),u(a.submit())})("cancel",function(){return d(s),u(a.close())})("goToLine",function(w){return d(s),u(a.goToLine(w))})("goTop",function(){return d(s),u(a.scrollToTop())})("goBottom",function(){return d(s),u(a.scrollToBottom())})("prevError",function(){return d(s),u(a.goToPreviousError())})("nextError",function(){return d(s),u(a.goToNextError())})("clearAll",function(){return d(s),u(a.clearRows())})("exportCsv",function(){return d(s),u(a.exportCsvCurrentRows())})("exportExcel",function(){return d(s),u(a.exportExcelCurrentRows())}),n(2,"div",3)(3,"div",4)(4,"mat-checkbox",5),r(5," Dry run (validate only, do not save) "),o()(),n(6,"div",6),_(7,ti,36,3,"div",7),o(),n(8,"button",8),f("click",function(){return d(s),u(a.addRow())}),r(9," + Add Customer "),o(),b(10,"div",null,0),o()()()}l&2&&(c("formGroup",a.form),m(),c("title",a.config.title)("rowCount",a.rowCount)("submitting",a.submitting)("formInvalid",a.form.invalid)("loading",a.submitting||a.loading)("progress",a.progress),m(6),c("ngForOf",a.rows.controls))},dependencies:[y,ye,M,P,X,N,R,Q,Z,ee,_t,Ct,wt,F,L,G,B,H,j,A,_e,fe,k,D,te,I,O],styles:[".customers-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.row-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:20px;background:var(--surface);display:flex;flex-direction:column;gap:16px}.row-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;border-bottom:1px dashed var(--border);padding-bottom:6px}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}.mat-form-field[_ngcontent-%COMP%]{width:100%}.row-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.highlight-line[_ngcontent-%COMP%]{outline:2px solid #1976d2;outline-offset:4px;transition:outline .3s ease}"]})};var We={DISABLE:["Fraud suspicion","Policy violation","Requested by management"],RESTORE:["Mistaken disable","Issue resolved"],DELETE:["Duplicate record","GDPR removal request","Test data cleanup"]};var he=class i{http=lt(ft);base=`${ht.apiUrl}/notification/sms`;sendToCustomers(t,e){return this.http.post(`${this.base}/send-to-customers`,{customerIds:t,message:e})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=at({token:i,factory:i.\u0275fac,providedIn:"root"})};var ni=()=>[1,5,10,20,50],oi=i=>["/customers",i],ri=(i,t)=>({"text-green-400":i,"text-red-400":t});function ai(i,t){if(i&1&&(n(0,"mat-form-field",11)(1,"mat-label"),r(2,"Gender"),o(),n(3,"mat-select",12)(4,"mat-option",13),r(5,"All"),o(),n(6,"mat-option",42),r(7,"Male"),o(),n(8,"mat-option",43),r(9,"Female"),o()()()),i&2){let e=p();m(3),c("formControl",e.filterGenderCtrl)}}function li(i,t){if(i&1){let e=v();n(0,"button",49),f("click",function(){d(e);let a=p(2);return u(a.bulkDisable())}),r(1," Disable selected "),o()}}function mi(i,t){if(i&1){let e=v();n(0,"button",50),f("click",function(){d(e);let a=p(2);return u(a.bulkRestore())}),r(1," Restore selected "),o()}}function si(i,t){if(i&1){let e=v();n(0,"button",51),f("click",function(){d(e);let a=p(2);return u(a.bulkHardDelete())}),r(1," Delete permanently "),o()}}function ci(i,t){i&1&&(n(0,"span",52),r(1," Mixed status \u2014 bulk action disabled "),o())}function pi(i,t){if(i&1&&(n(0,"div",44)(1,"span"),r(2),o(),_(3,li,2,0,"button",45)(4,mi,2,0,"button",46)(5,si,2,0,"button",47)(6,ci,2,0,"span",48),o()),i&2){let e=p();m(2),C("",e.selection.selected.length," selected"),m(),c("ngIf",e.bulkState==="active"),m(),c("ngIf",e.bulkState==="deleted"),m(),c("ngIf",e.bulkState==="deleted"),m(),c("ngIf",e.bulkState==="mixed")}}function di(i,t){if(i&1){let e=v();n(0,"th",53)(1,"mat-checkbox",54),f("change",function(){d(e);let a=p();return u(a.toggleAll())}),o()()}if(i&2){let e=p();m(),c("checked",e.isAllSelected())("indeterminate",e.isIndeterminate())}}function ui(i,t){if(i&1){let e=v();n(0,"td",55)(1,"mat-checkbox",56),f("click",function(a){return d(e),u(a.stopPropagation())}),o()()}if(i&2){let e=t.$implicit,l=p();m(),c("checked",l.selection.isSelected(e))}}function fi(i,t){if(i&1){let e=v();n(0,"th",57),f("click",function(){d(e);let a=p();return u(a.sortBy("name"))}),n(1,"span",58),r(2," Name "),n(3,"mat-icon",59),r(4),o()()()}if(i&2){let e=p();m(4),C(" ",e.sortField==="name"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function _i(i,t){if(i&1&&(n(0,"td",55)(1,"a",60),r(2),o()()),i&2){let e=t.$implicit;m(),c("routerLink",Me(2,oi,e.id)),m(),C(" ",e.name," ")}}function Ci(i,t){if(i&1){let e=v();n(0,"th",61),f("click",function(){d(e);let a=p();return u(a.sortBy("gender"))}),n(1,"span",58),r(2," Gender "),n(3,"mat-icon",59),r(4),o()()()}if(i&2){let e=p();m(4),C(" ",e.sortField==="gender"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function gi(i,t){if(i&1&&(n(0,"td",55),r(1),o()),i&2){let e=t.$implicit;m(),C(" ",e.gender||"\u2014"," ")}}function hi(i,t){if(i&1){let e=v();n(0,"th",62),f("click",function(){d(e);let a=p();return u(a.sortBy("phones"))}),n(1,"span",58),r(2," Phones "),n(3,"mat-icon",59),r(4),o()()()}if(i&2){let e=p();m(4),C(" ",e.sortField==="phones"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function vi(i,t){if(i&1&&(n(0,"td",55),r(1),o()),i&2){let e=t.$implicit;m(),C(" ",(e.phoneNumbers==null?null:e.phoneNumbers.join(", "))||"\u2014"," ")}}function bi(i,t){if(i&1){let e=v();n(0,"th",63),f("click",function(){d(e);let a=p();return u(a.sortBy("emails"))}),n(1,"span",58),r(2," Emails "),n(3,"mat-icon",59),r(4),o()()()}if(i&2){let e=p();m(4),C(" ",e.sortField==="emails"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function xi(i,t){if(i&1&&(n(0,"td",55),r(1),o()),i&2){let e=t.$implicit;m(),C(" ",(e.email==null?null:e.email.join(", "))||"\u2014"," ")}}function Si(i,t){if(i&1){let e=v();n(0,"th",64),f("click",function(){d(e);let a=p();return u(a.sortBy("createdAt"))}),n(1,"span",58),r(2," Created "),n(3,"mat-icon",59),r(4),o()()()}if(i&2){let e=p();m(4),C(" ",e.sortField==="createdAt"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function wi(i,t){if(i&1&&(n(0,"td",55),r(1),q(2,"date"),o()),i&2){let e=t.$implicit;m(),C(" ",ve(2,1,e.createdAt,"medium")," ")}}function Ei(i,t){if(i&1){let e=v();n(0,"th",65),f("click",function(){d(e);let a=p();return u(a.sortBy("status"))}),n(1,"span",58),r(2," Status "),n(3,"mat-icon",59),r(4),o()()()}if(i&2){let e=p();m(4),C(" ",e.sortField==="status"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Mi(i,t){if(i&1&&(n(0,"td",55)(1,"span",66),r(2),o()()),i&2){let e=t.$implicit;m(),c("ngClass",pt(2,ri,!e.deleted,e.deleted)),m(),C(" ",e.deleted?"Disabled":"Active"," ")}}function yi(i,t){i&1&&(n(0,"th",53),r(1," Actions"),o()),i&2&&st("aria-label","Customer actions")}function Ii(i,t){if(i&1){let e=v();n(0,"td",67)(1,"button",68),f("click",function(){let a=d(e).$implicit,s=p();return u(s.view(a.id))}),n(2,"mat-icon"),r(3,"visibility"),o()(),n(4,"button",69),f("click",function(){let a=d(e).$implicit,s=p();return u(s.edit(a.id))}),n(5,"mat-icon"),r(6,"edit"),o()(),n(7,"button",70),f("click",function(){let a=d(e).$implicit,s=p();return u(s.toggleCustomer(a))}),n(8,"mat-icon"),r(9),o()()()}if(i&2){let e=t.$implicit;m(7),ct("matTooltip",e.deleted?"Restore/Delete customer":"Disable customer"),m(2),T(e.deleted?"toggle_off":"toggle_on")}}function Di(i,t){i&1&&b(0,"tr",71)}function ki(i,t){if(i&1){let e=v();n(0,"tr",72),f("click",function(){let a=d(e).$implicit,s=p();return u(s.toggleRow(a))}),o()}if(i&2){let e=t.$implicit,l=p();we("row-selected",l.selection.isSelected(e))}}var Ke=class i{constructor(t,e,l,a,s,g){this.service=t;this.entityAction=e;this.smsService=l;this.dialog=a;this.router=s;this.snackbar=g}allCustomers=[];customers=[];selection=new ke(!0,[]);displayedColumns=[];page=0;size=20;total=0;sortField="createdAt";sortDir="desc";searchCtrl=new V("");filterTypeCtrl=new V("");filterGenderCtrl=new V("");filterStatusCtrl=new V("");showDeleted=!1;customerActionConfig={entityName:"Customer",displayName:t=>t.name,disableReasons:We.DISABLE,restoreReasons:We.RESTORE,deleteReasons:We.DELETE,disable:(t,e)=>this.service.softDelete(t,e),restore:(t,e)=>this.service.restore(t,e),hardDelete:(t,e)=>this.service.hardDelete(t,e),disableBulk:(t,e)=>this.service.softDeleteBulk(t,e),restoreBulk:(t,e)=>this.service.restoreBulk(t,e),hardDeleteBulk:(t,e)=>this.service.hardDeleteBulk(t,e),reload:()=>this.loadAllCustomersOnce()};ngOnInit(){this.loadAllCustomersOnce(),this.searchCtrl.valueChanges.pipe(rt(200)).subscribe(()=>this.applyAll()),this.filterTypeCtrl.valueChanges.subscribe(t=>{t!=="INDIVIDUAL"&&this.filterGenderCtrl.reset(""),this.applyAll()}),this.filterGenderCtrl.valueChanges.subscribe(()=>this.applyAll()),this.filterStatusCtrl.valueChanges.subscribe(()=>this.applyAll())}loadAllCustomersOnce(){this.service.list(0,999999).subscribe(t=>{this.allCustomers=t.content||[],this.applyAll()})}applyAll(){let t=[...this.allCustomers],e=(this.searchCtrl.value||"").toLowerCase();e&&(t=t.filter(s=>(s.name||"").toLowerCase().includes(e)||(s.phoneNumbers||[]).some(g=>g.includes(e))||(s.email||[]).some(g=>g.toLowerCase().includes(e)))),this.filterTypeCtrl.value&&(t=t.filter(s=>s.type===this.filterTypeCtrl.value)),this.filterGenderCtrl.value&&(t=t.filter(s=>s.gender===this.filterGenderCtrl.value)),this.filterStatusCtrl.value==="active"&&(t=t.filter(s=>!s.deleted)),this.filterStatusCtrl.value==="deleted"&&(t=t.filter(s=>s.deleted)),this.showDeleted||(t=t.filter(s=>!s.deleted)),t.sort((s,g)=>this.compare(s,g)),this.total=t.length;let l=this.page*this.size,a=l+this.size;this.customers=t.slice(l,a),this.selection.clear(),this.computeDisplayedColumns()}compare(t,e){let l=this.sortDir==="asc"?1:-1,a="",s="";switch(this.sortField){case"phones":a=t.phoneNumbers?.[0]||"",s=e.phoneNumbers?.[0]||"";break;case"emails":a=t.email?.[0]||"",s=e.email?.[0]||"";break;case"createdAt":a=new Date(t.createdAt||0).getTime(),s=new Date(e.createdAt||0).getTime();break;case"status":a=t.deleted?1:0,s=e.deleted?1:0;break;case"gender":a=t.gender||"",s=e.gender||"";break;default:a=t.name||"",s=e.name||""}return a>s?l:a<s?-l:0}sortBy(t){this.sortField===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortField=t,this.sortDir="asc"),this.applyAll()}computeDisplayedColumns(){let t=["select","name"];this.filterTypeCtrl.value==="INDIVIDUAL"&&t.push("gender"),t.push("phones","emails","createdAt"),this.showDeleted&&t.push("status"),t.push("actions"),this.displayedColumns=t}toggleRow(t){this.selection.toggle(t)}toggleAll(){this.isAllSelected()?this.selection.clear():this.customers.forEach(t=>this.selection.select(t))}isAllSelected(){return this.customers.length&&this.selection.selected.length===this.customers.length}isIndeterminate(){return this.selection.selected.length>0&&this.selection.selected.length<this.customers.length}get bulkState(){if(!this.selection.selected.length)return null;let t=new Set(this.selection.selected.map(e=>e.deleted));return t.size>1?"mixed":t.has(!0)?"deleted":"active"}onPageChange(t){this.page=t.pageIndex,this.size=t.pageSize,this.applyAll()}toggleCustomer(t){this.entityAction.toggleSingle(t,this.customerActionConfig)}bulkDisable(){this.entityAction.bulkDisable(this.selection.selected,this.customerActionConfig)}bulkRestore(){this.entityAction.bulkRestore(this.selection.selected,this.customerActionConfig)}bulkHardDelete(){this.entityAction.bulkHardDelete(this.selection.selected,this.customerActionConfig)}toggleDeleted(){this.showDeleted=!this.showDeleted,this.applyAll()}exportCsv(){this.service.exportCsv(this.searchCtrl.value||"",this.filterTypeCtrl.value||void 0,this.filterGenderCtrl.value||void 0,this.showDeleted).subscribe(t=>{let e=document.createElement("a");e.href=URL.createObjectURL(t),e.download="customers.csv",e.click()})}openSmsDialog(){let t=this.allCustomers.filter(l=>!l.deleted&&l.phoneNumbers?.length);this.dialog.open(Ce,{maxWidth:"95vw",maxHeight:"90vh",data:{customers:t}}).afterClosed().subscribe(l=>{l&&this.smsService.sendToCustomers(l.customerIds,l.message).subscribe()})}view(t){this.router.navigate(["/customers",t])}edit(t){this.router.navigate(["/customers",t,"edit"])}openBulkImport(){this.dialog.open(qe,{width:"1100px",maxWidth:"95vw",maxHeight:"90vh",autoFocus:!1}).afterClosed().subscribe(t=>{t===!0&&this.loadAllCustomersOnce()})}static \u0275fac=function(e){return new(e||i)(h($),h(Ge),h(he),h(Pe),h(U),h(ie))};static \u0275cmp=E({type:i,selectors:[["app-customer-list"]],decls:74,vars:12,consts:[[1,"flex","flex-col","gap-4"],[1,"page-header"],[1,"text-xl","font-semibold"],[1,"page-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary","routerLink","/customers/create"],[1,"toolbar-card"],["appearance","fill",1,"search"],["matInput","",3,"formControl"],[3,"change"],[1,"filters-card"],["appearance","fill"],[3,"formControl"],["value",""],["value","INDIVIDUAL"],["value","COMPANY"],["appearance","fill",4,"ngIf"],["value","active"],["value","deleted"],["class","bulk-bar",4,"ngIf"],[1,"table-card","rounded","shadow","overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","class","sortable","matTooltip","Sort by name","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","gender"],["mat-header-cell","","class","sortable","matTooltip","Sort by gender","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","phones"],["mat-header-cell","","class","sortable","matTooltip","Sort by phone numbers","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","emails"],["mat-header-cell","","class","sortable","matTooltip","Sort by emails","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","createdAt"],["mat-header-cell","","class","sortable","matTooltip","Sort by creation date","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","class","sortable","matTooltip","Sort by status","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-cell","","class","actions",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"row-selected","click",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageSizeOptions"],["value","MALE"],["value","FEMALE"],[1,"bulk-bar"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["class","error",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"error"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"click","checked"],["mat-header-cell","","matTooltip","Sort by name","matTooltipPosition","above",1,"sortable",3,"click"],[1,"sortable-content"],[1,"sort-icon"],[1,"text-blue-600","hover:underline",3,"routerLink"],["mat-header-cell","","matTooltip","Sort by gender","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by phone numbers","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by emails","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by creation date","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by status","matTooltipPosition","above",1,"sortable",3,"click"],[3,"ngClass"],["mat-cell","",1,"actions"],["mat-icon-button","","matTooltip","View",3,"click"],["mat-icon-button","","matTooltip","Edit",3,"click"],["mat-icon-button","",3,"click","matTooltip"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,l){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),r(3,"Customers"),o(),n(4,"div",3)(5,"button",4),f("click",function(){return l.exportCsv()}),r(6,"Export CSV"),o(),n(7,"button",4),f("click",function(){return l.openSmsDialog()}),r(8,"Send SMS"),o(),n(9,"button",4),f("click",function(){return l.openBulkImport()}),n(10,"mat-icon"),r(11,"cloud_upload"),o(),r(12,"Bulk Import Customers"),o(),n(13,"button",5),r(14,"New Customer"),o()()(),n(15,"div",6)(16,"mat-form-field",7)(17,"mat-label"),r(18,"Search customers"),o(),b(19,"input",8),o(),n(20,"mat-checkbox",9),f("change",function(){return l.toggleDeleted()}),r(21,"Show deleted"),o()(),n(22,"div",10)(23,"mat-form-field",11)(24,"mat-label"),r(25,"Type"),o(),n(26,"mat-select",12)(27,"mat-option",13),r(28,"All"),o(),n(29,"mat-option",14),r(30,"Individual"),o(),n(31,"mat-option",15),r(32,"Company"),o()()(),_(33,ai,10,1,"mat-form-field",16),n(34,"mat-form-field",11)(35,"mat-label"),r(36,"Status"),o(),n(37,"mat-select",12)(38,"mat-option",13),r(39,"All"),o(),n(40,"mat-option",17),r(41,"Active"),o(),n(42,"mat-option",18),r(43,"Disabled"),o()()()(),_(44,pi,7,5,"div",19),n(45,"div",20)(46,"table",21),x(47,22),_(48,di,2,2,"th",23)(49,ui,2,1,"td",24),S(),x(50,25),_(51,fi,5,1,"th",26)(52,_i,3,4,"td",24),S(),x(53,27),_(54,Ci,5,1,"th",28)(55,gi,2,1,"td",24),S(),x(56,29),_(57,hi,5,1,"th",30)(58,vi,2,1,"td",24),S(),x(59,31),_(60,bi,5,1,"th",32)(61,xi,2,1,"td",24),S(),x(62,33),_(63,Si,5,1,"th",34)(64,wi,3,4,"td",24),S(),x(65,35),_(66,Ei,5,1,"th",36)(67,Mi,3,5,"td",24),S(),x(68,37),_(69,yi,2,1,"th",23)(70,Ii,10,2,"td",38),S(),_(71,Di,1,0,"tr",39)(72,ki,1,2,"tr",40),o(),n(73,"mat-paginator",41),f("page",function(s){return l.onPageChange(s)}),o()()()),e&2&&(m(19),c("formControl",l.searchCtrl),m(7),c("formControl",l.filterTypeCtrl),m(7),c("ngIf",l.filterTypeCtrl.value==="INDIVIDUAL"),m(4),c("formControl",l.filterStatusCtrl),m(7),c("ngIf",l.selection.selected.length),m(2),c("dataSource",l.customers),m(25),c("matHeaderRowDef",l.displayedColumns),m(),c("matRowDefColumns",l.displayedColumns),m(),c("length",l.total)("pageSize",l.size)("pageSizeOptions",Ee(11,ni)))},dependencies:[y,dt,M,Ie,K,W,P,N,R,Te,ue,ne,re,se,ae,oe,ce,le,me,pe,de,Fe,Le,k,D,te,I,O,F,L,z,G,B,H,j,A,_e,fe,Re,Ne,Oe],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.page-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.toolbar-card[_ngcontent-%COMP%], .filters-card[_ngcontent-%COMP%], .table-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:var(--shadow-sm)}.toolbar-card[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.toolbar-card[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{flex:1}.filters-card[_ngcontent-%COMP%]{display:flex;gap:1rem;margin:1rem 0 1.5rem}.bulk-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.bulk-bar[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:#dc2626;font-weight:500}.table-card[_ngcontent-%COMP%]{overflow-x:auto}.mat-mdc-table[_ngcontent-%COMP%]{table-layout:fixed;width:max-content;min-width:max-content}.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{white-space:nowrap}"]})};function Ti(i,t){i&1&&(n(0,"mat-error"),r(1,"Name is required"),o())}function Ai(i,t){i&1&&(n(0,"mat-form-field",2)(1,"mat-label"),r(2,"Gender"),o(),n(3,"mat-select",16)(4,"mat-option",17),r(5,"Male"),o(),n(6,"mat-option",18),r(7,"Female"),o()()())}var Je=class i{constructor(t,e,l,a){this.fb=t;this.service=e;this.router=l;this.snackbar=a}fg;ngOnInit(){this.fg=this.fb.group({name:["",J.required],type:["INDIVIDUAL",J.required],gender:[null],address:[""],notes:[""],phoneNumbers:[[]],emailAddresses:[[]]}),this.fg.get("type").valueChanges.subscribe(t=>{t==="COMPANY"&&this.fg.get("gender").reset()})}onPhonesChange(t){let l=(t.target.value||"").split(",").map(a=>a.trim()).filter(a=>a.length>=7);this.fg.get("phoneNumbers").setValue(l)}onEmailsChange(t){let l=(t.target.value||"").split(",").map(a=>a.trim()).filter(a=>a.includes("@"));this.fg.get("emailAddresses").setValue(l)}validateEmailsPhones(){let t=this.fg.get("emailAddresses").value||[],e=this.fg.get("phoneNumbers").value||[],l=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,a=/^\+?\d{7,15}$/;for(let s of t)if(!l.test(s))return this.snackbar.open(`Invalid email: ${s}`,"Close",{duration:1800}),!1;for(let s of e)if(!a.test(s))return this.snackbar.open(`Invalid phone number: ${s}`,"Close",{duration:1800}),!1;return!0}save(){this.fg.invalid||this.validateEmailsPhones()&&this.service.create(this.fg.value).subscribe({next:()=>{this.snackbar.open("Customer created successfully","Close",{duration:2e3}),this.router.navigate(["/customers"])},error:()=>this.snackbar.open("Failed to create customer","Close",{duration:2e3})})}static \u0275fac=function(e){return new(e||i)(h(Ae),h($),h(U),h(ie))};static \u0275cmp=E({type:i,selectors:[["app-customer-create"]],decls:38,vars:6,consts:[[1,"text-xl","font-semibold","mb-4"],[1,"card","space-y-4",3,"formGroup"],["appearance","fill",1,"w-full"],["matInput","","formControlName","name"],[4,"ngIf"],["formControlName","type"],["value","INDIVIDUAL"],["value","COMPANY"],["appearance","fill","class","w-full",4,"ngIf"],["matInput","","formControlName","address"],["matInput","","rows","3","formControlName","notes"],["matInput","","placeholder","0712xxxxxxx, +254712xxxxxx",3,"change","value"],["matInput","","placeholder","alice@example.com, bob@acme.test",3,"change","value"],[1,"actions","mt-4"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","routerLink","/customers"],["formControlName","gender"],["value","MALE"],["value","FEMALE"]],template:function(e,l){if(e&1&&(n(0,"h2",0),r(1,"Create Customer"),o(),n(2,"form",1)(3,"mat-form-field",2)(4,"mat-label"),r(5,"Name"),o(),b(6,"input",3),_(7,Ti,2,0,"mat-error",4),o(),n(8,"mat-form-field",2)(9,"mat-label"),r(10,"Customer Type"),o(),n(11,"mat-select",5)(12,"mat-option",6),r(13,"Individual"),o(),n(14,"mat-option",7),r(15,"Company"),o()()(),_(16,Ai,8,0,"mat-form-field",8),n(17,"mat-form-field",2)(18,"mat-label"),r(19,"Address"),o(),b(20,"input",9),o(),n(21,"mat-form-field",2)(22,"mat-label"),r(23,"Notes"),o(),b(24,"textarea",10),o(),n(25,"mat-form-field",2)(26,"mat-label"),r(27,"Phone numbers (comma separated)"),o(),n(28,"input",11),f("change",function(s){return l.onPhonesChange(s)}),o()(),n(29,"mat-form-field",2)(30,"mat-label"),r(31,"Email addresses (comma separated)"),o(),n(32,"input",12),f("change",function(s){return l.onEmailsChange(s)}),o()()(),n(33,"div",13)(34,"button",14),f("click",function(){return l.save()}),r(35," Save "),o(),n(36,"button",15),r(37,"Cancel"),o()()),e&2){let a,s,g,w;m(2),c("formGroup",l.fg),m(5),c("ngIf",(a=l.fg.get("name"))==null?null:a.invalid),m(9),c("ngIf",((s=l.fg.get("type"))==null?null:s.value)==="INDIVIDUAL"),m(12),c("value",(g=l.fg.get("phoneNumbers"))==null||g.value==null?null:g.value.join(", ")),m(4),c("value",(w=l.fg.get("emailAddresses"))==null||w.value==null?null:w.value.join(", ")),m(2),c("disabled",l.fg.invalid)}},dependencies:[y,M,P,X,N,R,Q,Z,ee,F,L,z,bt,G,B,k,D,Be,H,j,A,I,K,W],encapsulation:2})};var Ni=i=>["/customers",i];function Ri(i,t){i&1&&(n(0,"mat-form-field",4)(1,"mat-label"),r(2,"Gender"),o(),n(3,"mat-select",18)(4,"mat-option",19),r(5,"Male"),o(),n(6,"mat-option",20),r(7,"Female"),o()()())}function Vi(i,t){if(i&1){let e=v();n(0,"mat-chip-row",21),f("removed",function(){let a=d(e).index,s=p();return u(s.removePhone(a))}),r(1),n(2,"button",22)(3,"mat-icon"),r(4,"cancel"),o()()()}if(i&2){let e=t.$implicit;m(),C(" ",e.value," ")}}function Pi(i,t){if(i&1){let e=v();n(0,"mat-chip-row",21),f("removed",function(){let a=d(e).index,s=p();return u(s.removeEmail(a))}),r(1),n(2,"button",22)(3,"mat-icon"),r(4,"cancel"),o()()()}if(i&2){let e=t.$implicit;m(),C(" ",e.value," ")}}var Qe=class i{constructor(t,e,l,a){this.route=t;this.fb=e;this.service=l;this.router=a}id;fg;ngOnInit(){this.fg=this.fb.group({name:["",J.required],type:["INDIVIDUAL",J.required],gender:[null],address:[""],notes:[""],phoneNumbers:this.fb.array([]),emailAddresses:this.fb.array([])}),this.fg.get("type").valueChanges.subscribe(t=>{t==="COMPANY"&&this.fg.get("gender").reset()}),this.id=this.route.snapshot.paramMap.get("id"),this.service.get(this.id).subscribe(t=>this.patch(t))}get phoneNumbers(){return this.fg.get("phoneNumbers")}get emailAddresses(){return this.fg.get("emailAddresses")}patch(t){this.fg.patchValue(t),this.phoneNumbers.clear(),this.emailAddresses.clear(),t.phoneNumbers?.forEach(e=>this.phoneNumbers.push(this.fb.control(e))),t.emailAddresses?.forEach(e=>this.emailAddresses.push(this.fb.control(e)))}addPhone(t){let e=t.value?.trim();e&&(this.phoneNumbers.push(this.fb.control(e)),t.chipInput?.clear())}removePhone(t){this.phoneNumbers.removeAt(t)}addEmail(t){let e=t.value?.trim();e&&(this.emailAddresses.push(this.fb.control(e)),t.chipInput?.clear())}removeEmail(t){this.emailAddresses.removeAt(t)}save(){this.fg.invalid||this.service.update(this.id,this.fg.value).subscribe(()=>this.router.navigate(["/customers",this.id]))}static \u0275fac=function(e){return new(e||i)(h(De),h(Ae),h($),h(U))};static \u0275cmp=E({type:i,selectors:[["app-customer-edit"]],decls:43,vars:10,consts:[["phoneGrid",""],["emailGrid",""],[1,"text-xl","font-semibold","mb-4"],[1,"card","space-y-4",3,"formGroup"],["appearance","fill",1,"w-full"],["matInput","","formControlName","name"],["formControlName","type"],["value","INDIVIDUAL"],["value","COMPANY"],["appearance","fill","class","w-full",4,"ngIf"],["matInput","","formControlName","address"],["matInput","","rows","3","formControlName","notes"],[3,"removed",4,"ngFor","ngForOf"],["placeholder","Add phone number",3,"matChipInputTokenEnd","matChipInputFor"],["placeholder","Add email",3,"matChipInputTokenEnd","matChipInputFor"],[1,"actions","mt-4"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-stroked-button","",3,"routerLink"],["formControlName","gender"],["value","MALE"],["value","FEMALE"],[3,"removed"],["matChipRemove",""]],template:function(e,l){if(e&1){let a=v();n(0,"h2",2),r(1,"Edit Customer"),o(),n(2,"form",3)(3,"mat-form-field",4)(4,"mat-label"),r(5,"Name"),o(),b(6,"input",5),o(),n(7,"mat-form-field",4)(8,"mat-label"),r(9,"Customer Type"),o(),n(10,"mat-select",6)(11,"mat-option",7),r(12,"Individual"),o(),n(13,"mat-option",8),r(14,"Company"),o()()(),_(15,Ri,8,0,"mat-form-field",9),n(16,"mat-form-field",4)(17,"mat-label"),r(18,"Address"),o(),b(19,"input",10),o(),n(20,"mat-form-field",4)(21,"mat-label"),r(22,"Notes"),o(),b(23,"textarea",11),o(),n(24,"mat-form-field",4)(25,"mat-label"),r(26,"Phone Numbers"),o(),n(27,"mat-chip-grid",null,0),_(29,Vi,5,1,"mat-chip-row",12),n(30,"input",13),f("matChipInputTokenEnd",function(g){return d(a),u(l.addPhone(g))}),o()()(),n(31,"mat-form-field",4)(32,"mat-label"),r(33,"Email Addresses"),o(),n(34,"mat-chip-grid",null,1),_(36,Pi,5,1,"mat-chip-row",12),n(37,"input",14),f("matChipInputTokenEnd",function(g){return d(a),u(l.addEmail(g))}),o()()()(),n(38,"div",15)(39,"button",16),f("click",function(){return d(a),u(l.save())}),r(40," Save Changes "),o(),n(41,"button",17),r(42,"Cancel"),o()()}if(e&2){let a,s=Y(28),g=Y(35);m(2),c("formGroup",l.fg),m(13),c("ngIf",((a=l.fg.get("type"))==null?null:a.value)==="INDIVIDUAL"),m(14),c("ngForOf",l.phoneNumbers.controls),m(),c("matChipInputFor",s),m(6),c("ngForOf",l.emailAddresses.controls),m(),c("matChipInputFor",g),m(2),c("disabled",l.fg.invalid),m(2),c("routerLink",Me(8,Ni,l.id))}},dependencies:[y,ye,M,P,X,N,R,Q,Z,ee,K,W,F,L,z,G,B,H,j,A,k,D,Be,Tt,At,Dt,kt,I,O],styles:["[_nghost-%COMP%]{display:block}.card[_ngcontent-%COMP%]{background:var(--surface);padding:1.5rem;border-radius:.75rem;display:grid;grid-template-columns:1fr;gap:1rem;max-width:640px}.actions[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;gap:.75rem}mat-form-field[_ngcontent-%COMP%]{width:100%}"]})};function Oi(i,t){i&1&&(n(0,"th",30),r(1,"Date"),o())}function Li(i,t){if(i&1&&(n(0,"td",31),r(1),q(2,"date"),o()),i&2){let e=t.$implicit;m(),C(" ",ve(2,1,e.timestamp,"medium")," ")}}function Fi(i,t){i&1&&(n(0,"th",30),r(1,"Amount"),o())}function Bi(i,t){if(i&1&&(n(0,"td",31),r(1),q(2,"number"),o()),i&2){let e=t.$implicit;m(),C(" ",tt(2,1,e.amount)," ")}}function Gi(i,t){i&1&&(n(0,"th",30),r(1,"Note"),o())}function ji(i,t){if(i&1&&(n(0,"td",31),r(1),o()),i&2){let e=t.$implicit;m(),C(" ",e.note||"\u2014"," ")}}function Hi(i,t){i&1&&b(0,"tr",32)}function $i(i,t){i&1&&b(0,"tr",33)}function Ui(i,t){if(i&1&&(n(0,"div",21)(1,"table",22),x(2,23),_(3,Oi,2,0,"th",24)(4,Li,3,4,"td",25),S(),x(5,26),_(6,Fi,2,0,"th",24)(7,Bi,3,3,"td",25),S(),x(8,27),_(9,Gi,2,0,"th",24)(10,ji,2,1,"td",25),S(),_(11,Hi,1,0,"tr",28)(12,$i,1,0,"tr",29),o()()),i&2){let e=p(2);m(),c("dataSource",e.payments),m(10),c("matHeaderRowDef",e.paymentColumns),m(),c("matRowDefColumns",e.paymentColumns)}}function zi(i,t){i&1&&(n(0,"div",34),r(1,"No payments recorded"),o())}function qi(i,t){i&1&&(n(0,"th",30),r(1,"Date"),o())}function Yi(i,t){if(i&1&&(n(0,"td",31),r(1),q(2,"date"),o()),i&2){let e=t.$implicit;m(),C(" ",ve(2,1,e.createdAt,"medium")," ")}}function Wi(i,t){i&1&&(n(0,"th",30),r(1,"Total"),o())}function Ki(i,t){if(i&1&&(n(0,"td",31),r(1),q(2,"number"),o()),i&2){let e=t.$implicit;m(),C(" ",tt(2,1,e.totalAmount)," ")}}function Ji(i,t){i&1&&(n(0,"th",30),r(1,"Status"),o())}function Qi(i,t){if(i&1&&(n(0,"td",31),r(1),o()),i&2){let e=t.$implicit;m(),C(" ",e.status," ")}}function Xi(i,t){i&1&&b(0,"tr",32)}function Zi(i,t){i&1&&b(0,"tr",33)}function en(i,t){if(i&1&&(n(0,"div",21)(1,"table",22),x(2,23),_(3,qi,2,0,"th",24)(4,Yi,3,4,"td",25),S(),x(5,35),_(6,Wi,2,0,"th",24)(7,Ki,3,3,"td",25),S(),x(8,36),_(9,Ji,2,0,"th",24)(10,Qi,2,1,"td",25),S(),_(11,Xi,1,0,"tr",28)(12,Zi,1,0,"tr",29),o()()),i&2){let e=p(2);m(),c("dataSource",e.sales),m(10),c("matHeaderRowDef",e.saleColumns),m(),c("matRowDefColumns",e.saleColumns)}}function tn(i,t){i&1&&(n(0,"div",34),r(1,"No sales found"),o())}function nn(i,t){if(i&1){let e=v();n(0,"div",3)(1,"div",4)(2,"div",5)(3,"h2"),r(4),o(),n(5,"span",6),r(6),o()(),n(7,"div",7)(8,"button",8),f("click",function(){d(e);let a=p();return u(a.sendSms())}),n(9,"mat-icon"),r(10,"sms"),o(),r(11," SMS "),o(),n(12,"button",9),f("click",function(){d(e);let a=p();return u(a.edit())}),n(13,"mat-icon"),r(14,"edit"),o(),r(15," Edit "),o(),n(16,"button",10),f("click",function(){d(e);let a=p();return u(a.toggleActive())}),n(17,"mat-icon"),r(18),o(),r(19),o()()(),n(20,"mat-tab-group",11)(21,"mat-tab",12)(22,"div",13)(23,"div",14)(24,"div",15),r(25,"Phones"),o(),n(26,"div",16),r(27),o()(),n(28,"div",14)(29,"div",15),r(30,"Emails"),o(),n(31,"div",16),r(32),o()(),n(33,"div",14)(34,"div",15),r(35,"Gender"),o(),n(36,"div",16),r(37),o()(),n(38,"div",17)(39,"div",15),r(40,"Address"),o(),n(41,"div",16),r(42),o()(),n(43,"div",17)(44,"div",15),r(45,"Notes"),o(),n(46,"div",16),r(47),o()()()(),n(48,"mat-tab",18),_(49,Ui,13,3,"div",19)(50,zi,2,0,"ng-template",null,0,it),o(),n(52,"mat-tab",20),_(53,en,13,3,"div",19)(54,tn,2,0,"ng-template",null,1,it),o()()()}if(i&2){let e=Y(51),l=Y(55),a=p();m(4),T(a.customer.name),m(2),C(" ",a.customer.type==="INDIVIDUAL"?"Individual Customer":"Company Customer"," "),m(2),c("disabled",!(a.customer.phoneNumbers!=null&&a.customer.phoneNumbers.length)),m(8),c("color",a.customer.deleted?"primary":"warn"),m(2),C(" ",a.customer.deleted?"restore":"block"," "),m(),C(" ",a.customer.deleted?"Restore":"Disable"," "),m(8),T((a.customer.phoneNumbers==null?null:a.customer.phoneNumbers.join(", "))||"\u2014"),m(5),T((a.customer.email==null?null:a.customer.email.join(", "))||"\u2014"),m(5),T(a.customer.gender||"\u2014"),m(5),T(a.customer.address||"\u2014"),m(5),T(a.customer.notes||"\u2014"),m(2),c("ngIf",a.payments.length)("ngIfElse",e),m(4),c("ngIf",a.sales.length)("ngIfElse",l)}}var Xe=class i{constructor(t,e,l,a,s,g,w){this.route=t;this.router=e;this.service=l;this.entityAction=a;this.smsService=s;this.dialog=g;this.snackbar=w}id;customer;payments=[];sales=[];paymentColumns=["date","amount","note"];saleColumns=["date","total","status"];loading=!0;ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),this.load()}load(){this.service.get(this.id).subscribe(t=>this.customer=t),this.service.payments(this.id).subscribe(t=>this.payments=t||[]),this.service.sales(this.id).subscribe(t=>this.sales=t||[]),this.loading=!1}edit(){this.router.navigate(["/customers",this.id,"edit"])}toggleActive(){this.customer&&this.entityAction.toggleSingle(this.customer,{entityName:"Customer",displayName:t=>t.name,disableReasons:[],restoreReasons:[],deleteReasons:[],disable:(t,e)=>this.service.softDelete(t,e),restore:(t,e)=>this.service.restore(t,e),hardDelete:(t,e)=>this.service.hardDelete(t,e),reload:()=>this.load()})}sendSms(){if(!this.customer?.phoneNumbers?.length)return;this.dialog.open(Ce,{maxWidth:"95vw",data:{customers:[this.customer]}}).afterClosed().subscribe(e=>{e&&this.smsService.sendToCustomers(e.customerIds,e.message).subscribe(()=>{this.snackbar.open("SMS sent","Close",{duration:2e3})})})}static \u0275fac=function(e){return new(e||i)(h(De),h(U),h($),h(Ge),h(he),h(Pe),h(ie))};static \u0275cmp=E({type:i,selectors:[["app-customer-details"]],decls:1,vars:1,consts:[["noPayments",""],["noSales",""],["class","page-container",4,"ngIf"],[1,"page-container"],[1,"page-header"],[1,"title-block"],[1,"subtitle"],[1,"actions"],["mat-stroked-button","","matTooltip","Send SMS",3,"click","disabled"],["mat-stroked-button","","matTooltip","Edit Customer",3,"click"],["mat-flat-button","",3,"click","color"],[1,"details-tabs"],["label","Overview"],[1,"overview-grid"],[1,"info-card"],[1,"label"],[1,"value"],[1,"info-card","full"],["label","Payments"],["class","table-wrapper",4,"ngIf","ngIfElse"],["label","Sales"],[1,"table-wrapper"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["matColumnDef","note"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"empty-state"],["matColumnDef","total"],["matColumnDef","status"]],template:function(e,l){e&1&&_(0,nn,56,15,"div",2),e&2&&c("ngIf",l.customer)},dependencies:[y,M,ut,Ie,yt,Et,Mt,I,O,ue,ne,re,se,ae,oe,ce,le,me,pe,de,Oe,k,D],styles:[".page-container[_ngcontent-%COMP%]{padding:1rem}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25rem}.title-block[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:600;margin:0}.title-block[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.details-tabs[_ngcontent-%COMP%]{background:var(--surface);border-radius:8px;padding:.5rem}.overview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;padding:1rem}.info-card[_ngcontent-%COMP%]{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:.75rem}.info-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;color:var(--text-secondary);margin-bottom:4px}.info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500}.info-card.full[_ngcontent-%COMP%]{grid-column:1/-1}.table-wrapper[_ngcontent-%COMP%]{margin-top:1rem;overflow-x:auto}.empty-state[_ngcontent-%COMP%]{padding:2rem;text-align:center;color:var(--text-secondary)}"]})};var tr=[{path:"",component:Ke},{path:"create",component:Je},{path:":id",component:Xe},{path:":id/edit",component:Qe}];export{tr as CUSTOMER_ROUTES};
