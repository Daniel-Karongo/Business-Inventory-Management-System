import{a as ye,b as Ee}from"./chunk-RI2EOWWF.js";import{a as be}from"./chunk-OR6PPJ4J.js";import"./chunk-4D3L4XDL.js";import{a as kt,b as Ot,c as Ft}from"./chunk-L7HY2LX6.js";import{b as Pt,c as Tt,d as Dt}from"./chunk-QDY2WV2X.js";import{a as Mt}from"./chunk-VMKMSPCZ.js";import{a as wt}from"./chunk-AASPAG7H.js";import"./chunk-ZPGHPDH7.js";import{a as Se,b as It}from"./chunk-3WA4OH2X.js";import{a as xe,b as he}from"./chunk-KPX6MBY5.js";import{a as _t,b as gt,c as ft,d as Ct,e as vt,f as St,g as xt,h as ht,i as bt,j as yt,k as Et}from"./chunk-NDRSAYSM.js";import{a as O}from"./chunk-U5YT4ZGI.js";import{a as Z}from"./chunk-22FAI265.js";import{a as st,c as fe}from"./chunk-G6DPSII6.js";import"./chunk-X5MK7W46.js";import{a as at,b as lt}from"./chunk-GQKP7E5B.js";import{a as mt}from"./chunk-TYUPRCFW.js";import{a as pt}from"./chunk-RUIAFSGF.js";import"./chunk-MS4AQ6UA.js";import{a as Ce,b as ve}from"./chunk-H37LQHOQ.js";import{d as se}from"./chunk-DF6WYVPK.js";import{c as nt}from"./chunk-MJONFXFY.js";import{b as A,c as N}from"./chunk-F3TBVMOI.js";import{a as L,b as ct}from"./chunk-BIVTK5YB.js";import{c as $,d as j}from"./chunk-ZFWGKVXC.js";import"./chunk-3RK6DDJD.js";import{a as z}from"./chunk-CONPK5ZF.js";import{b as Y,c as dt,d as ut,h as B}from"./chunk-3ZV2DC5Q.js";import"./chunk-SGYCFQGT.js";import{d as V,f as G,h as R,i as W,l as rt,m as ce,n as de,p as Q,q as ue,r as _e,s as K,v as ge,w as ot,x as J}from"./chunk-Z2GGFO6C.js";import"./chunk-75T6YVBZ.js";import{f as X,g as M,h as k}from"./chunk-TENNXE3V.js";import"./chunk-2X53NFZU.js";import{b as me,d as F}from"./chunk-VUFC7WNX.js";import"./chunk-CDHEWSLI.js";import"./chunk-5DTMLZHP.js";import{$b as Le,Bb as P,I as ee,Ib as o,Jb as n,Kb as x,Lb as b,Mb as y,Nb as Ne,Ob as v,Qb as g,Qc as le,Rb as c,Tc as D,Ub as Je,Uc as I,Vc as it,Wb as Xe,Xb as Ye,Yb as Ze,Yc as pe,Za as Qe,ac as l,bb as p,bc as h,bd as w,cc as f,dc as te,gb as C,gc as ie,hc as ne,ic as re,lc as et,ma as u,mc as Be,na as _,nb as E,pc as oe,q as We,qb as Ke,rc as ae,sb as d,tc as tt,zb as m}from"./chunk-3DYKM6ZU.js";import{a as H,b as q,g as Re,h as Ae}from"./chunk-FJYW2LMB.js";var Vt={title:"Bulk Import Suppliers",confirmLabel:"Import Now",csvFileName:"suppliers-bulk-template.csv",excelFileName:"suppliers-bulk-template.xlsx",supportsArchiveImport:!0,supportsFileDescription:!0,headers:["name","emails","phones","address","region","categories"],fields:[{name:"name",required:!0},{name:"emails"},{name:"phones",required:!0},{name:"address"},{name:"region"},{name:"categories"}],previewColumns:[{key:"name",label:"Name"},{key:"email",label:"Emails"},{key:"phoneNumber",label:"Phones"},{key:"region",label:"Region"}],excelSheetName:"Suppliers",excelColumns:[{header:"name",key:"name",width:26},{header:"emails",key:"emails",width:32},{header:"phones",key:"phones",width:22,format:"text"},{header:"address",key:"address",width:26},{header:"region",key:"region",width:18},{header:"categories",key:"categories",width:32}],exampleRow:{name:"Acme Ltd",emails:"info@acme.com",phones:"0712345678",address:"Nairobi",region:"Nairobi",categories:"Electronics,Accessories"},emptyRowCount:200,defaultOptions:{dryRun:!0,skipDuplicates:!0},mapRowToItem(i){return{name:i.name,email:[i.emails],phoneNumber:[i.phones],address:i.address,region:i.region,categoryNames:i.categories?i.categories.split(",").map(t=>t.trim()).filter(Boolean):[]}},mapPreviewRow(i){return i},submit(i){return null}};function zt(i,t){if(i&1&&(o(0,"div",20),l(1),n()),i&2){let e=c().$implicit;p(),f(" ",e.value._error," ")}}function $t(i,t){if(i&1){let e=v();o(0,"div",9)(1,"div",10)(2,"span"),l(3),n(),o(4,"button",11),g("click",function(){let a=u(e).index,s=c();return _(s.removeRow(a))}),o(5,"mat-icon"),l(6,"delete"),n()()(),o(7,"div",12)(8,"mat-form-field"),x(9,"input",13),n(),o(10,"mat-form-field"),x(11,"input",14),n(),o(12,"mat-form-field"),x(13,"input",15),n()(),o(14,"div",12)(15,"mat-form-field"),x(16,"input",16),n(),o(17,"mat-form-field"),x(18,"input",17),n(),o(19,"mat-form-field"),x(20,"input",18),n()(),d(21,zt,2,1,"div",19),n()}if(i&2){let e=t.$implicit,r=t.index;m("formGroupName",r),p(3),f("Supplier ",r+1,""),p(18),m("ngIf",e.value._error)}}var Ie=class i extends kt{constructor(e,r,a,s){super();this.supplierService=e;this.categoryService=r;this.submitEngine=a;this.dialogRef=s}config=Vt;categories=[];ngOnInit(){this.initForm(),this.loadCategories()}loadCategories(){this.categoryService.getAll("flat",!1).subscribe(e=>this.categories=e||[])}submit(){if(this.form.invalid)return;let e={items:this.rows.controls.map(r=>this.config.mapRowToItem(r.value)),options:{dryRun:this.form.value.dryRun,skipDuplicates:!0}};this.submitEngine.execute({submitFn:r=>this.supplierService.bulkImport(r),payload:e,rows:this.rows.controls,dryRun:this.form.value.dryRun,title:this.config.title,confirmLabel:this.config.confirmLabel,columns:this.config.previewColumns,onErrorsApplied:r=>this.cacheErrors(r),onFinalSuccess:()=>this.dialogRef.close(!0),onConfirmRetry:()=>{this.form.patchValue({dryRun:!1}),this.submit()}})}importExcel(e){return Ae(this,null,function*(){if(!e)return;let r=yield this.confirmMerge();r&&Re(i.prototype,this,"importExcelFile").call(this,e,void 0,r)})}importCsv(e){return Ae(this,null,function*(){if(!e)return;let r=yield this.confirmMerge();r&&Re(i.prototype,this,"importCsvFile").call(this,e,r)})}close(){this.dialogRef.close()}static \u0275fac=function(r){return new(r||i)(C(O),C(Z),C(Ft),C(st))};static \u0275cmp=E({type:i,selectors:[["app-supplier-bulk-import-dialog"]],features:[Ke],decls:12,vars:8,consts:[["bottomAnchor",""],[3,"keydown.enter","formGroup"],[3,"importCsv","importExcel","downloadCsv","downloadExcel","submit","cancel","goToLine","goTop","goBottom","prevError","nextError","clearAll","exportCsv","exportExcel","title","rowCount","submitting","formInvalid","loading","progress"],[1,"suppliers-body"],["bulk-options",""],["formControlName","dryRun"],["formArrayName","rows",1,"rows"],["class","row-card",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],[1,"row-card",3,"formGroupName"],[1,"row-header"],["mat-icon-button","","color","warn",3,"click"],[1,"grid-3"],["matInput","","placeholder","Name","formControlName","name"],["matInput","","placeholder","Emails","formControlName","emails"],["matInput","","placeholder","Phones","formControlName","phones"],["matInput","","placeholder","Address","formControlName","address"],["matInput","","placeholder","Region","formControlName","region"],["matInput","","placeholder","Categories","formControlName","categories"],["class","row-error",4,"ngIf"],[1,"row-error"]],template:function(r,a){if(r&1){let s=v();o(0,"form",1),g("keydown.enter",function(T){return u(s),_(T.stopPropagation())}),o(1,"app-bulk-import-shell",2),g("importCsv",function(T){return u(s),_(a.importCsv(T))})("importExcel",function(T){return u(s),_(a.importExcel(T))})("downloadCsv",function(){return u(s),_(a.downloadCsvTemplate())})("downloadExcel",function(){return u(s),_(a.downloadExcelTemplate())})("submit",function(){return u(s),_(a.submit())})("cancel",function(){return u(s),_(a.close())})("goToLine",function(T){return u(s),_(a.goToLine(T))})("goTop",function(){return u(s),_(a.scrollToTop())})("goBottom",function(){return u(s),_(a.scrollToBottom())})("prevError",function(){return u(s),_(a.goToPreviousError())})("nextError",function(){return u(s),_(a.goToNextError())})("clearAll",function(){return u(s),_(a.clearRows())})("exportCsv",function(){return u(s),_(a.exportCsvCurrentRows())})("exportExcel",function(){return u(s),_(a.exportExcelCurrentRows())}),o(2,"div",3)(3,"div",4)(4,"mat-checkbox",5),l(5," Dry run (validate only, do not save) "),n()(),o(6,"div",6),d(7,$t,22,3,"div",7),n(),o(8,"button",8),g("click",function(){return u(s),_(a.addRow())}),l(9," + Add Supplier "),n(),x(10,"div",null,0),n()()()}r&2&&(m("formGroup",a.form),p(),m("title",a.config.title)("rowCount",a.rowCount)("submitting",a.submitting)("formInvalid",a.form.invalid)("loading",a.submitting||a.loading)("progress",a.progress),p(6),m("ngForOf",a.rows.controls))},dependencies:[w,D,I,J,ce,V,R,W,Q,K,ue,_e,Ot,z,B,j,$,he,xe,k,M,X,N,A],styles:[".suppliers-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.row-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:20px;background:var(--surface);display:flex;flex-direction:column;gap:16px}.row-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;border-bottom:1px dashed var(--border);padding-bottom:6px}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}.mat-form-field[_ngcontent-%COMP%]{width:100%}.row-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.highlight-line[_ngcontent-%COMP%]{outline:2px solid #1976d2;outline-offset:4px;transition:outline .3s ease}"]})};var U={DISABLE:["Contract terminated","Compliance issue","Low performance rating"],RESTORE:["Contract renewed","Compliance resolved"],DELETE:["Duplicate supplier","Fraudulent record","Test data cleanup","Regulatory removal request"]};var Ht=()=>[5,10,20,50];function qt(i,t){if(i&1){let e=v();o(0,"button",41),g("click",function(){u(e);let a=c(2);return _(a.bulkDisable())}),l(1," Disable "),n()}}function Wt(i,t){if(i&1){let e=v();o(0,"button",42),g("click",function(){u(e);let a=c(2);return _(a.bulkRestore())}),l(1," Restore "),n()}}function Qt(i,t){if(i&1){let e=v();o(0,"button",43),g("click",function(){u(e);let a=c(2);return _(a.bulkHardDelete())}),l(1," Hard Delete "),n()}}function Kt(i,t){i&1&&(o(0,"span",44),l(1," Mixed supplier status \u2014 action blocked "),n())}function Jt(i,t){if(i&1&&(o(0,"div",35)(1,"span",36),l(2),n(),d(3,qt,2,0,"button",37)(4,Wt,2,0,"button",38)(5,Qt,2,0,"button",39)(6,Kt,2,0,"span",40),n()),i&2){let e=c();p(2),f(" ",e.selection.selected.length," selected "),p(),m("ngIf",e.bulkState==="active"),p(),m("ngIf",e.bulkState==="deleted"),p(),m("ngIf",e.bulkState==="deleted"),p(),m("ngIf",e.bulkState==="mixed")}}function Xt(i,t){if(i&1&&(o(0,"mat-option",45),l(1),n()),i&2){let e=t.$implicit;m("value",e),p(),f(" ",e," ")}}function Yt(i,t){if(i&1){let e=v();o(0,"th",46)(1,"mat-checkbox",47),g("change",function(){u(e);let a=c();return _(a.masterToggle())}),n()()}if(i&2){let e=c();p(),m("checked",e.isAllSelected())("indeterminate",e.selection.selected.length&&!e.isAllSelected())}}function Zt(i,t){if(i&1){let e=v();o(0,"td",48)(1,"mat-checkbox",49),g("click",function(a){return u(e),_(a.stopPropagation())})("change",function(){let a=u(e).$implicit,s=c();return _(s.selection.toggle(a))}),n()()}if(i&2){let e=t.$implicit,r=c();p(),m("checked",r.selection.isSelected(e))}}function ei(i,t){if(i&1){let e=v();o(0,"th",50),g("click",function(){u(e);let a=c();return _(a.sortBy("name"))}),o(1,"span",51),l(2," Name "),o(3,"mat-icon",52),l(4),n()()()}if(i&2){let e=c();p(4),f(" ",e.sortField==="name"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function ti(i,t){if(i&1){let e=v();o(0,"td",48)(1,"a",53),g("click",function(){let a=u(e).$implicit,s=c();return _(s.view(a))}),l(2),n()()}if(i&2){let e=t.$implicit;p(2),f(" ",e.name," ")}}function ii(i,t){i&1&&(o(0,"th",46),l(1,"Emails"),n())}function ni(i,t){if(i&1&&(o(0,"div"),l(1),n()),i&2){let e=t.$implicit;p(),h(e)}}function ri(i,t){if(i&1&&(o(0,"td",48),d(1,ni,2,1,"div",54),n()),i&2){let e=t.$implicit;p(),m("ngForOf",e.email)}}function oi(i,t){i&1&&(o(0,"th",46),l(1,"Phones"),n())}function ai(i,t){if(i&1&&(o(0,"div"),l(1),n()),i&2){let e=t.$implicit;p(),h(e)}}function li(i,t){if(i&1&&(o(0,"td",48),d(1,ai,2,1,"div",54),n()),i&2){let e=t.$implicit;p(),m("ngForOf",e.phoneNumber)}}function pi(i,t){if(i&1){let e=v();o(0,"th",50),g("click",function(){u(e);let a=c();return _(a.sortBy("region"))}),o(1,"span",51),l(2," Region "),o(3,"mat-icon",52),l(4),n()()()}if(i&2){let e=c();p(4),f(" ",e.sortField==="region"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function si(i,t){if(i&1&&(o(0,"td",48),l(1),n()),i&2){let e=t.$implicit;p(),h(e.region||"\u2014")}}function mi(i,t){i&1&&(o(0,"th",46),l(1,"Rating"),n())}function ci(i,t){if(i&1&&(o(0,"td",48),l(1),n()),i&2){let e,r=t.$implicit;p(),h((e=r.rating)!==null&&e!==void 0?e:"\u2014")}}function di(i,t){if(i&1){let e=v();o(0,"th",50),g("click",function(){u(e);let a=c();return _(a.sortBy("createdAt"))}),o(1,"span",51),l(2," Created "),o(3,"mat-icon",52),l(4),n()()()}if(i&2){let e=c();p(4),f(" ",e.sortField==="createdAt"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function ui(i,t){if(i&1&&(o(0,"td",48),l(1),oe(2,"date"),n()),i&2){let e=t.$implicit;p(),f(" ",ae(2,1,e.createdAt,"medium")," ")}}function _i(i,t){i&1&&(o(0,"th",46),l(1,"Status"),n())}function gi(i,t){if(i&1&&(o(0,"td",48)(1,"span"),l(2),n()()),i&2){let e=t.$implicit;p(),P("text-red-400",e.deleted)("text-green-400",!e.deleted),p(),f(" ",e.deleted?"Disabled":"Active"," ")}}function fi(i,t){i&1&&(o(0,"th",46),l(1,"Actions"),n())}function Ci(i,t){if(i&1){let e=v();o(0,"td",48)(1,"button",55),g("click",function(){let a=u(e).$implicit,s=c();return _(s.view(a))}),o(2,"mat-icon"),l(3,"visibility"),n()(),o(4,"button",56),g("click",function(){let a=u(e).$implicit,s=c();return _(s.edit(a))}),o(5,"mat-icon"),l(6,"edit"),n()(),o(7,"button",57),g("click",function(){let a=u(e).$implicit,s=c();return _(s.toggleSupplier(a))}),o(8,"mat-icon"),l(9),n()()()}if(i&2){let e=t.$implicit;p(7),Je("matTooltip",e.deleted?"Restore/Delete supplier":"Disable supplier"),p(2),h(e.deleted?"toggle_off":"toggle_on")}}function vi(i,t){i&1&&x(0,"tr",58)}function Si(i,t){if(i&1){let e=v();o(0,"tr",59),g("click",function(){let a=u(e).$implicit,s=c();return _(s.toggleRow(a))}),n()}if(i&2){let e=t.$implicit,r=c();P("row-selected",r.selection.isSelected(e))}}var Te=class i{constructor(t,e,r,a,s){this.supplierService=t;this.entityAction=e;this.snackbar=r;this.dialog=a;this.router=s}displayedColumns=["select","name","emails","phones","region","rating","createdAt","status","actions"];allSuppliers=[];filteredSuppliers=[];suppliers=[];regions=[];q="";filterRegion="";sortField=null;sortDir="asc";statusFilter="active";total=0;page=0;size=10;loading=!1;selection=new nt(!0,[]);paginator;supplierActionConfig={entityName:"Supplier",displayName:t=>t.name,disableReasons:U.DISABLE,restoreReasons:U.RESTORE,deleteReasons:U.DELETE,disable:(t,e)=>this.supplierService.softDelete(t,e),restore:(t,e)=>this.supplierService.restore(t,e),hardDelete:(t,e)=>this.supplierService.hardDelete(t,e),disableBulk:(t,e)=>this.supplierService.softDeleteBulk(t,e),restoreBulk:(t,e)=>this.supplierService.restoreBulk(t,e),hardDeleteBulk:(t,e)=>this.supplierService.hardDeleteBulk(t,e),reload:()=>this.loadSuppliers()};ngOnInit(){this.loadSuppliers()}loadSuppliers(){this.loading=!0,this.supplierService.getAll().pipe(ee(()=>this.loading=!1)).subscribe({next:t=>{this.allSuppliers=t||[],this.regions=Array.from(new Set(this.allSuppliers.map(e=>e.region).filter(e=>!!e))).sort(),this.page=0,this.applyFilters()},error:()=>this.snackbar.open("Failed to load suppliers","Close",{duration:3e3})})}applyFilters(){let t=[...this.allSuppliers],e=this.q.trim().toLowerCase();switch(e&&(t=t.filter(r=>r.name.toLowerCase().includes(e)||(r.email||[]).some(a=>a.toLowerCase().includes(e))||(r.phoneNumber||[]).some(a=>a.includes(e)))),this.filterRegion&&(t=t.filter(r=>r.region===this.filterRegion)),this.statusFilter){case"active":t=t.filter(r=>!r.deleted);break;case"deleted":t=t.filter(r=>r.deleted);break;case"all":default:break}this.sortField&&t.sort((r,a)=>{let s=r[this.sortField],S=a[this.sortField];return s==null?1:S==null?-1:this.sortDir==="asc"?s>S?1:-1:s<S?1:-1}),this.page=0,this.selection.clear(),this.filteredSuppliers=t,this.total=t.length,this.applyPagination()}sortBy(t){this.sortField===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortField=t,this.sortDir="asc"),this.applyFilters()}applyPagination(){let t=this.page*this.size;this.suppliers=this.filteredSuppliers.slice(t,t+this.size)}changePage(t){this.page=t.pageIndex,this.size=t.pageSize,this.applyPagination()}toggleRow(t){this.selection.toggle(t)}isAllSelected(){return this.selection.selected.length===this.suppliers.length&&this.suppliers.length>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.suppliers.forEach(t=>this.selection.select(t))}get bulkState(){let t=this.selection.selected;if(!t.length)return null;let e=new Set(t.map(r=>r.deleted));return e.size>1?"mixed":e.has(!0)?"deleted":"active"}toggleSupplier(t){this.entityAction.toggleSingle(t,this.supplierActionConfig)}bulkDisable(){this.entityAction.bulkDisable(this.selection.selected,this.supplierActionConfig)}bulkRestore(){this.entityAction.bulkRestore(this.selection.selected,this.supplierActionConfig)}bulkHardDelete(){this.entityAction.bulkHardDelete(this.selection.selected,this.supplierActionConfig)}view(t){this.router.navigate(["/suppliers",t.id],{state:{deleted:t.deleted}})}edit(t){this.router.navigate(["/suppliers",t.id,"edit"],{state:{deleted:t.deleted}})}goCreate(){this.router.navigate(["/suppliers/create"])}openBulkImport(){this.dialog.open(Ie,{width:"1100px",maxWidth:"95vw",maxHeight:"90vh",autoFocus:!1}).afterClosed().subscribe(t=>{t===!0&&this.loadSuppliers()})}static \u0275fac=function(e){return new(e||i)(C(O),C(be),C(L),C(fe),C(F))};static \u0275cmp=E({type:i,selectors:[["app-supplier-list"]],viewQuery:function(e,r){if(e&1&&Xe(Se,5),e&2){let a;Ye(a=Ze())&&(r.paginator=a.first)}},decls:67,vars:12,consts:[[1,"flex","flex-col","gap-4"],[1,"page-header","flex","items-center","mb-6"],[1,"text-xl","font-semibold"],[1,"flex","items-center","gap-2","ml-auto"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["class","flex items-center gap-3 mb-4",4,"ngIf"],[1,"toolbar-card"],["appearance","fill",1,"search"],["matInput","","placeholder","Search name, email or phone",3,"ngModelChange","input","ngModel"],[1,"filters"],["appearance","fill",1,"min-w-[160px]"],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","all"],["value","active"],["value","deleted"],[1,"bg-[var(--surface)]","rounded","shadow","overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","class","sortable",3,"click",4,"matHeaderCellDef"],["matColumnDef","emails"],["matColumnDef","phones"],["matColumnDef","region"],["matColumnDef","rating"],["matColumnDef","createdAt"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable-row",3,"row-selected","click",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageSizeOptions"],[1,"flex","items-center","gap-3","mb-4"],[1,"font-medium","text-blue-500"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["class","text-red-500 font-medium",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"text-red-500","font-medium"],[3,"value"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"click","change","checked"],["mat-header-cell","",1,"sortable",3,"click"],[1,"sortable-content"],[1,"sort-icon"],[1,"text-blue-600","hover:underline",3,"click"],[4,"ngFor","ngForOf"],["mat-icon-button","","matTooltip","View",3,"click"],["mat-icon-button","","matTooltip","Edit",3,"click"],["mat-icon-button","",3,"click","matTooltip"],["mat-header-row",""],["mat-row","",1,"clickable-row",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"Suppliers"),n(),o(4,"div",3)(5,"button",4),g("click",function(){return r.openBulkImport()}),o(6,"mat-icon"),l(7,"cloud_upload"),n(),l(8," Bulk Import "),n(),o(9,"button",5),g("click",function(){return r.goCreate()}),l(10," Create Supplier "),n()()(),d(11,Jt,7,5,"div",6),o(12,"div",7)(13,"mat-form-field",8)(14,"mat-label"),l(15,"Search suppliers"),n(),o(16,"input",9),re("ngModelChange",function(s){return ne(r.q,s)||(r.q=s),s}),g("input",function(){return r.applyFilters()}),n()()(),o(17,"div",10)(18,"mat-form-field",11)(19,"mat-label"),l(20,"Region"),n(),o(21,"mat-select",12),re("ngModelChange",function(s){return ne(r.filterRegion,s)||(r.filterRegion=s),s}),g("selectionChange",function(){return r.applyFilters()}),o(22,"mat-option",13),l(23,"All regions"),n(),d(24,Xt,2,2,"mat-option",14),n()(),o(25,"mat-form-field",11)(26,"mat-label"),l(27,"Status"),n(),o(28,"mat-select",12),re("ngModelChange",function(s){return ne(r.statusFilter,s)||(r.statusFilter=s),s}),g("selectionChange",function(){return r.applyFilters()}),o(29,"mat-option",15),l(30,"All"),n(),o(31,"mat-option",16),l(32,"Active"),n(),o(33,"mat-option",17),l(34,"Disabled"),n()()()(),o(35,"div",18)(36,"table",19),b(37,20),d(38,Yt,2,2,"th",21)(39,Zt,2,1,"td",22),y(),b(40,23),d(41,ei,5,1,"th",24)(42,ti,3,1,"td",22),y(),b(43,25),d(44,ii,2,0,"th",21)(45,ri,2,1,"td",22),y(),b(46,26),d(47,oi,2,0,"th",21)(48,li,2,1,"td",22),y(),b(49,27),d(50,pi,5,1,"th",24)(51,si,2,1,"td",22),y(),b(52,28),d(53,mi,2,0,"th",21)(54,ci,2,1,"td",22),y(),b(55,29),d(56,di,5,1,"th",24)(57,ui,3,4,"td",22),y(),b(58,30),d(59,_i,2,0,"th",21)(60,gi,3,5,"td",22),y(),b(61,31),d(62,fi,2,0,"th",21)(63,Ci,10,2,"td",22),y(),d(64,vi,1,0,"tr",32)(65,Si,1,2,"tr",33),n(),o(66,"mat-paginator",34),g("page",function(s){return r.changePage(s)}),n()()()),e&2&&(p(11),m("ngIf",r.selection.selected.length),p(5),ie("ngModel",r.q),p(5),ie("ngModel",r.filterRegion),p(3),m("ngForOf",r.regions),p(4),ie("ngModel",r.statusFilter),p(8),m("dataSource",r.suppliers),p(28),m("matHeaderRowDef",r.displayedColumns),p(),m("matRowDefColumns",r.displayedColumns),p(),m("length",r.total)("pageSize",r.size)("pageSizeOptions",et(11,Ht)))},dependencies:[w,D,I,pe,ot,V,R,rt,Et,_t,ft,xt,Ct,gt,ht,vt,St,bt,yt,It,Se,N,A,k,M,X,lt,at,ve,B,Y,Ce,se,he,xe,z,j,$],styles:["[_nghost-%COMP%]{display:block}.toolbar-card[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.toolbar-card[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{flex:1}.filters[_ngcontent-%COMP%]{display:flex;gap:1rem}"]})};function xi(i,t){if(i&1){let e=v();o(0,"div",15),g("click",function(){let a=u(e).index,s=c();return _(s.step=a)}),o(1,"span",16),l(2),n(),o(3,"span",17),l(4),n()()}if(i&2){let e=t.$implicit,r=t.index,a=c();P("active",r===a.step)("completed",r<a.step),p(2),h(r+1),p(2),h(e)}}function hi(i,t){i&1&&(o(0,"section",18)(1,"h3"),l(2,"Basic Information"),n(),o(3,"div",19)(4,"mat-form-field",20)(5,"mat-label"),l(6,"Name"),n(),x(7,"input",21),n(),o(8,"mat-form-field",20)(9,"mat-label"),l(10,"Region"),n(),x(11,"input",22),n(),o(12,"mat-form-field",20)(13,"mat-label"),l(14,"Rating"),n(),x(15,"input",23),n()()())}function bi(i,t){if(i&1){let e=v();o(0,"section",18)(1,"h3"),l(2,"Contacts"),n(),o(3,"div",24)(4,"mat-form-field",20)(5,"mat-label"),l(6,"Email addresses"),n(),o(7,"input",25),g("change",function(a){u(e);let s=c();return _(s.onEmailsChange(a))}),n()(),o(8,"mat-form-field",20)(9,"mat-label"),l(10,"Phone numbers"),n(),o(11,"input",26),g("change",function(a){u(e);let s=c();return _(s.onPhonesChange(a))}),n()()()()}}function yi(i,t){if(i&1){let e=v();o(0,"li")(1,"label",33)(2,"input",31),g("change",function(){let a=u(e).$implicit,s=c(4);return _(s.toggleCategory(a.id))}),n(),l(3),n()()}if(i&2){let e=t.$implicit,r=c(4);p(2),m("checked",r.isCategorySelected(e.id)),p(),f(" ",e.name," ")}}function Ei(i,t){if(i&1&&(o(0,"ul"),d(1,yi,4,2,"li",29),n()),i&2){let e=c().$implicit;p(),m("ngForOf",e.subcategories)}}function Ii(i,t){if(i&1){let e=v();o(0,"li")(1,"label",30)(2,"input",31),g("change",function(){let a=u(e).$implicit,s=c(2);return _(s.toggleCategory(a.id))}),n(),l(3),n(),d(4,Ei,2,1,"ul",32),n()}if(i&2){let e=t.$implicit,r=c(2);p(2),m("checked",r.isCategorySelected(e.id)),p(),f(" ",e.name," "),p(),m("ngIf",e.subcategories==null?null:e.subcategories.length)}}function wi(i,t){if(i&1&&(o(0,"section",18)(1,"h3"),l(2,"Categories Supplied"),n(),o(3,"p",27),l(4,"Select all product categories this supplier can provide."),n(),o(5,"ul",28),d(6,Ii,5,3,"li",29),n()()),i&2){let e=c();p(6),m("ngForOf",e.categories)}}function Mi(i,t){if(i&1){let e=v();o(0,"img",49),g("click",function(){u(e);let a=c().$implicit,s=c(3);return _(s.viewImage(a.value.file,a.value.previewUrl))}),n()}if(i&2){let e=c().$implicit;m("src",e.value.previewUrl,Qe)}}function ki(i,t){if(i&1){let e=v();o(0,"div",50),g("click",function(){u(e);let a=c().$implicit,s=c(3);return _(s.openPdf(a.value.file))}),o(1,"mat-icon"),l(2,"picture_as_pdf"),n(),o(3,"span"),l(4,"Open PDF"),n()()}}function Oi(i,t){i&1&&(o(0,"div",51)(1,"mat-icon"),l(2,"attach_file"),n()())}function Pi(i,t){if(i&1&&(o(0,"mat-option",52),l(1),n()),i&2){let e=t.$implicit;m("value",e),p(),f(" ",e," ")}}function Ti(i,t){i&1&&(o(0,"mat-form-field",20)(1,"mat-label"),l(2,"Custom description"),n(),x(3,"input",53),n())}function Di(i,t){if(i&1){let e=v();o(0,"div",39)(1,"div",40),d(2,Mi,1,1,"img",41)(3,ki,5,0,"div",42)(4,Oi,3,0,"div",43),n(),o(5,"div",44),l(6),n(),o(7,"mat-form-field",20)(8,"mat-label"),l(9,"Description"),n(),o(10,"mat-select",45),d(11,Pi,2,2,"mat-option",46),n()(),d(12,Ti,4,0,"mat-form-field",47),o(13,"button",48),g("click",function(){let a=u(e).index,s=c(3);return _(s.removeFile(a))}),o(14,"mat-icon"),l(15,"close"),n()()()}if(i&2){let e,r=t.$implicit,a=t.index,s=c(3);m("formGroupName",a),p(2),m("ngIf",r.value.previewUrl),p(),m("ngIf",!r.value.previewUrl&&r.value.file.type==="application/pdf"),p(),m("ngIf",!r.value.previewUrl&&r.value.file.type!=="application/pdf"),p(2),f(" ",r.value.file.name," "),p(5),m("ngForOf",s.descriptionOptions),p(),m("ngIf",((e=r.get("description"))==null?null:e.value)==="Other")}}function Fi(i,t){if(i&1&&(o(0,"div",37),d(1,Di,16,7,"div",38),n()),i&2){let e=c(2);p(),m("ngForOf",e.supplierFiles.controls)}}function Vi(i,t){if(i&1){let e=v();o(0,"section",34)(1,"h3"),l(2,"Documents"),n(),o(3,"input",35),g("change",function(a){u(e);let s=c();return _(s.onFilesPicked(a))}),n(),d(4,Fi,2,1,"div",36),n()}if(i&2){let e=c();p(4),m("ngIf",e.supplierFiles.length)}}function Ri(i,t){if(i&1&&(o(0,"section",18)(1,"h3"),l(2,"Review"),n(),o(3,"div",54)(4,"div")(5,"strong"),l(6,"Name:"),n(),l(7),n(),o(8,"div")(9,"strong"),l(10,"Region:"),n(),l(11),n(),o(12,"div")(13,"strong"),l(14,"Rating:"),n(),l(15),n(),o(16,"div")(17,"strong"),l(18,"Emails:"),n(),l(19),n(),o(20,"div")(21,"strong"),l(22,"Phones:"),n(),l(23),n(),o(24,"div")(25,"strong"),l(26,"Categories:"),n(),l(27),n()()()),i&2){let e=c();p(7),f(" ",e.form.value.name,""),p(4),f(" ",e.form.value.region||"\u2014",""),p(4),f(" ",e.form.value.rating||"\u2014",""),p(4),f(" ",e.form.value.email.join(", ")||"\u2014",""),p(4),f(" ",e.form.value.phoneNumber.join(", ")||"\u2014",""),p(4),f(" ",e.form.value.categoryIds.length," ")}}function Ai(i,t){if(i&1){let e=v();o(0,"button",5),g("click",function(){u(e);let a=c();return _(a.prev())}),l(1," Previous "),n()}}function Ni(i,t){if(i&1){let e=v();o(0,"button",55),g("click",function(){u(e);let a=c();return _(a.next())}),l(1," Next "),n()}}var De=class i{constructor(t,e,r,a,s,S){this.fb=t;this.supplierService=e;this.categoryService=r;this.snackbar=a;this.dialog=s;this.router=S}steps=["Basic","Contacts","Categories","Files","Review"];step=0;form;categories=[];busy=!1;files=[];descriptionOptions=["Contract","Price List","Certificate","License","Other"];ngOnInit(){this.form=this.fb.group({name:["",G.required],region:[""],rating:[null],email:[[]],phoneNumber:[[]],categoryIds:[[]],supplierFiles:this.fb.array([])}),this.loadCategories()}get supplierFiles(){return this.form.get("supplierFiles")}newSupplierFile(t){let e=t.type.startsWith("image/")?URL.createObjectURL(t):null,r=this.fb.group({file:[t],previewUrl:[e],description:["Contract",G.required],custom:[""]});return r.get("description").valueChanges.subscribe(a=>{let s=r.get("custom");a==="Other"?s?.setValidators([G.required,G.minLength(3)]):(s?.clearValidators(),s?.setValue("")),s?.updateValueAndValidity()}),r}openPdf(t){let e=URL.createObjectURL(t);window.open(e,"_blank")}loadCategories(){this.categoryService.getAll("tree",!1).subscribe(t=>this.categories=t||[])}onEmailsChange(t){let e=t.target;if(!e)return;let r=e.value||"";this.form.get("email").setValue(r.split(",").map(a=>a.trim()).filter(Boolean))}onPhonesChange(t){let e=t.target;if(!e)return;let r=e.value||"";this.form.get("phoneNumber").setValue(r.split(",").map(a=>a.trim()).filter(Boolean))}toggleCategory(t){let e=this.form.value.categoryIds;this.form.patchValue({categoryIds:e.includes(t)?e.filter(r=>r!==t):[...e,t]})}isCategorySelected(t){return this.form.value.categoryIds.includes(t)}onFilesPicked(t){let e=t.target;e.files&&(Array.from(e.files).forEach(r=>{this.supplierFiles.push(this.newSupplierFile(r))}),e.value="")}removeFile(t){let r=this.supplierFiles.at(t).value.previewUrl;r&&URL.revokeObjectURL(r),this.supplierFiles.removeAt(t)}validateFiles(){for(let t of this.files)if(!t.description||t.description==="Other"&&!t.custom?.trim())return!1;return!0}viewImage(t,e){this.dialog.open(wt,{data:{preview:{src:e,name:t.name,type:"image"}},width:"80%",maxWidth:"1100px"})}next(){this.step<this.steps.length-1&&this.step++}prev(){this.step>0&&this.step--}submit(){let t=new FormData;if(Object.entries(this.form.value).forEach(([e,r])=>{if(e!=="supplierFiles"&&r!=null){if(Array.isArray(r)){r.forEach((a,s)=>{t.append(`${e}[${s}]`,String(a))});return}t.append(e,String(r))}}),!this.validateFiles()){this.snackbar.open("Please provide a description for all uploaded files","Close",{duration:3e3});return}this.supplierFiles.controls.forEach((e,r)=>{let a=e.value.file,s=e.value.description==="Other"?e.value.custom:e.value.description;t.append(`supplierFiles[${r}].file`,a,a.name),t.append(`supplierFiles[${r}].description`,s)}),this.busy=!0,this.supplierService.create(t).pipe(ee(()=>this.busy=!1)).subscribe({next:()=>{this.snackbar.open("Supplier created","Close",{duration:2e3}),this.router.navigate(["/suppliers"])},error:()=>this.snackbar.open("Failed to create supplier","Close",{duration:3e3})})}static \u0275fac=function(e){return new(e||i)(C(ge),C(O),C(Z),C(L),C(fe),C(F))};static \u0275cmp=E({type:i,selectors:[["app-supplier-create"]],decls:23,vars:10,consts:[[1,"supplier-create-root",3,"formGroup"],[1,"wizard-header"],[1,"left"],[1,"breadcrumb"],[1,"right"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"wizard-steps"],["class","step",3,"active","completed","click",4,"ngFor","ngForOf"],[1,"wizard-body"],["class","card",4,"ngIf"],["formArrayName","supplierFiles","class","card",4,"ngIf"],[1,"nav"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"step",3,"click"],[1,"num"],[1,"label"],[1,"card"],[1,"grid-3"],["appearance","fill"],["matInput","","formControlName","name"],["matInput","","formControlName","region"],["matInput","","type","number","formControlName","rating"],[1,"grid-2"],["matInput","","placeholder","a@x.com, b@y.com",3,"change"],["matInput","","placeholder","+2547\u2026, 07\u2026",3,"change"],[1,"muted"],[1,"category-tree"],[4,"ngFor","ngForOf"],[1,"category"],["type","checkbox",3,"change","checked"],[4,"ngIf"],[1,"subcategory"],["formArrayName","supplierFiles",1,"card"],["type","file","multiple","",3,"change"],["class","file-grid",4,"ngIf"],[1,"file-grid"],["class","file-card",3,"formGroupName",4,"ngFor","ngForOf"],[1,"file-card",3,"formGroupName"],[1,"preview"],["alt","Preview",3,"src","click",4,"ngIf"],["class","pdf-preview",3,"click",4,"ngIf"],["class","file-preview",4,"ngIf"],[1,"filename"],["formControlName","description"],[3,"value",4,"ngFor","ngForOf"],["appearance","fill",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],["alt","Preview",3,"click","src"],[1,"pdf-preview",3,"click"],[1,"file-preview"],[3,"value"],["matInput","","formControlName","custom"],[1,"review-grid"],["mat-stroked-button","","color","primary",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"header",1)(2,"div",2)(3,"h2"),l(4,"Create Supplier"),n(),o(5,"div",3),l(6,"Suppliers / Create"),n()(),o(7,"div",4)(8,"button",5),g("click",function(){return r.router.navigate(["/suppliers"])}),l(9," Cancel "),n(),o(10,"button",6),g("click",function(){return r.submit()}),l(11," Save Supplier "),n()()(),o(12,"nav",7),d(13,xi,5,6,"div",8),n(),o(14,"div",9),d(15,hi,16,0,"section",10)(16,bi,12,0,"section",10)(17,wi,7,1,"section",10)(18,Vi,5,1,"section",11)(19,Ri,28,6,"section",10),o(20,"div",12),d(21,Ai,2,0,"button",13)(22,Ni,2,0,"button",14),n()()()),e&2&&(m("formGroup",r.form),p(10),m("disabled",r.busy),p(3),m("ngForOf",r.steps),p(2),m("ngIf",r.step===0),p(),m("ngIf",r.step===1),p(),m("ngIf",r.step===2),p(),m("ngIf",r.step===3),p(),m("ngIf",r.step===4),p(2),m("ngIf",r.step>0),p(),m("ngIf",r.step<r.steps.length-1))},dependencies:[w,D,I,J,V,de,R,W,Q,K,ue,_e,z,B,Y,j,$,ve,Ce,se,k,M,X,N,A,ct],styles:[".supplier-create-root[_ngcontent-%COMP%]{max-width:1100px;margin:auto;padding:12px}.wizard-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.wizard-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600}.wizard-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.wizard-header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;gap:8px}.wizard-steps[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:16px}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:6px 12px;border:1px solid var(--border);border-radius:6px;cursor:pointer;background:var(--surface)}.step.active[_ngcontent-%COMP%]{background:#1a73e826;border-color:#1a73e866}.step.completed[_ngcontent-%COMP%]{opacity:.7}.step[_ngcontent-%COMP%]   .num[_ngcontent-%COMP%]{width:22px;height:22px;border-radius:50%;background:var(--surface-hover);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700}.wizard-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.card[_ngcontent-%COMP%]{padding:16px;border:1px solid var(--border);border-radius:8px;background:var(--surface)}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:12px;font-weight:600}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}.category-tree[_ngcontent-%COMP%]{list-style:none;padding-left:0}.category-tree[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:18px;margin-top:6px}.category-tree[_ngcontent-%COMP%]   .category[_ngcontent-%COMP%], .category-tree[_ngcontent-%COMP%]   .subcategory[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:4px 0}.category-tree[_ngcontent-%COMP%]   .subcategory[_ngcontent-%COMP%]{color:var(--text-secondary)}.file-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}.file-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:6px;padding:12px;background:var(--surface);display:flex;flex-direction:column;gap:10px}.filename[_ngcontent-%COMP%]{font-weight:600;font-size:.85rem;word-break:break-word}.preview[_ngcontent-%COMP%]{width:100%;height:140px;border:1px dashed var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;background:var(--surface-hover);cursor:pointer}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:cover;border-radius:4px}.pdf-preview[_ngcontent-%COMP%], .file-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--text-secondary)}.pdf-preview[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;color:#e53935}.filename[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;word-break:break-word}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:zoom-in}.review-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.muted[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.85rem}.nav[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px}"]})};var Nt=i=>({listImages:(t,e)=>i.listImages(t,e),listImageAudits:t=>i.imageAudits(t).pipe(We(e=>(e??[]).map(r=>({fileName:r.fileName,action:r.action,performedByUsername:r.performedBy??"System",timestamp:r.timestamp})))),getImageBlob:(t,e,r)=>i.getSupplierImageBlob(t,e,r),uploadImages:(t,e)=>i.uploadImages(t,e),softDeleteImage:(t,e)=>i.softDeleteImage(t,e),restoreImage:(t,e)=>i.restoreImage(t,e),hardDeleteImage:(t,e)=>i.hardDeleteImage(t,e)});var Lt=i=>({$implicit:i});function Bi(i,t){if(i&1){let e=v();o(0,"button",26),g("click",function(){u(e);let a=c(2);return _(a.toggleSupplier())}),o(1,"mat-icon"),l(2),n(),l(3),n()}if(i&2){let e=c(2);m("color",e.supplier.deleted?"primary":"warn"),p(2),f(" ",e.supplier.deleted?"restore":"block"," "),p(),f(" ",e.supplier.deleted?"Restore":"Disable"," ")}}function zi(i,t){if(i&1&&(o(0,"div"),l(1),n()),i&2){let e=t.$implicit;p(),h(e)}}function $i(i,t){if(i&1&&(o(0,"div"),l(1),n()),i&2){let e=t.$implicit;p(),h(e)}}function ji(i,t){if(i&1&&x(0,"app-entity-image-manager",27),i&2){let e=c(2);m("entityId",e.supplierId)("adapter",e.imageAdapter)("allowHardDelete",e.isSuperuser())}}function Ui(i,t){i&1&&(o(0,"div",28),l(1," No products supplied by this supplier "),n())}function Gi(i,t){if(i&1){let e=v();o(0,"tr",31),g("click",function(){let a=u(e).$implicit,s=c(3);return _(s.goProduct(a.id))}),o(1,"td"),l(2),n(),o(3,"td"),l(4),n(),o(5,"td"),l(6),n()()}if(i&2){let e=t.$implicit;p(2),h(e.name),p(2),h(e.categoryName),p(2),h(e.variants.length||0)}}function Hi(i,t){if(i&1&&(o(0,"table",29)(1,"tr")(2,"th"),l(3,"Name"),n(),o(4,"th"),l(5,"Category"),n(),o(6,"th"),l(7,"Variants"),n()(),d(8,Gi,7,3,"tr",30),n()),i&2){let e=c(2);p(8),m("ngForOf",e.products)}}function qi(i,t){if(i&1&&(o(0,"span",38),l(1),n()),i&2){let e=c().$implicit;p(),f(" ",e.supplyState==="DIRECT"?"SUPPLIED":e.supplyState==="DERIVED"?"DERIVED":"PARTIAL"," ")}}function Wi(i,t){if(i&1&&(o(0,"span",39),l(1),n()),i&2){let e=c().$implicit;p(),te(" ",e.suppliedChildrenCount,"/",e.totalChildrenCount," ")}}function Qi(i,t){i&1&&Ne(0)}function Ki(i,t){if(i&1&&(b(0),d(1,Qi,1,0,"ng-container",40),y()),i&2){let e=t.$implicit;c(3);let r=Le(46);p(),m("ngTemplateOutlet",r)("ngTemplateOutletContext",Be(2,Lt,e))}}function Ji(i,t){if(i&1&&(o(0,"ul"),d(1,Ki,2,4,"ng-container",12),n()),i&2){let e=c().$implicit;p(),m("ngForOf",e.subcategories)}}function Xi(i,t){if(i&1&&(o(0,"li")(1,"div",32)(2,"mat-icon",33),l(3),n(),o(4,"span",34),l(5),n(),d(6,qi,2,1,"span",35)(7,Wi,2,2,"span",36),n(),d(8,Ji,2,1,"ul",37),n()),i&2){let e=t.$implicit;p(),P("direct",e.supplyState==="DIRECT")("derived",e.supplyState==="DERIVED")("partial",e.supplyState==="PARTIAL"),p(2),f(" ",e.supplyState==="DIRECT"?"check_circle":e.supplyState==="DERIVED"?"check_circle_outline":e.supplyState==="PARTIAL"?"remove_circle_outline":"radio_button_unchecked"," "),p(2),h(e.name),p(),m("ngIf",e.supplyState!=="NONE"),p(),m("ngIf",e.totalChildrenCount),p(),m("ngIf",e.subcategories==null?null:e.subcategories.length)}}function Yi(i,t){if(i&1&&(o(0,"span",38),l(1),n()),i&2){let e=c().$implicit;p(),f(" ",e.supplyState==="DIRECT"?"SUPPLIED":e.supplyState==="DERIVED"?"DERIVED":"PARTIAL"," ")}}function Zi(i,t){if(i&1&&(o(0,"span",39),l(1),n()),i&2){let e=c().$implicit;p(),te(" ",e.suppliedChildrenCount,"/",e.totalChildrenCount," ")}}function en(i,t){i&1&&Ne(0)}function tn(i,t){if(i&1&&(b(0),d(1,en,1,0,"ng-container",40),y()),i&2){let e=t.$implicit;c(3);let r=Le(46);p(),m("ngTemplateOutlet",r)("ngTemplateOutletContext",Be(2,Lt,e))}}function nn(i,t){if(i&1&&(o(0,"ul"),d(1,tn,2,4,"ng-container",12),n()),i&2){let e=c().$implicit;p(),m("ngForOf",e.subcategories)}}function rn(i,t){if(i&1&&(o(0,"li")(1,"div",32)(2,"mat-icon",33),l(3),n(),o(4,"span",34),l(5),n(),d(6,Yi,2,1,"span",35)(7,Zi,2,2,"span",36),n(),d(8,nn,2,1,"ul",37),n()),i&2){let e=t.$implicit;p(),P("direct",e.supplyState==="DIRECT")("derived",e.supplyState==="DERIVED")("partial",e.supplyState==="PARTIAL"),p(2),f(" ",e.supplyState==="DIRECT"?"check_circle":e.supplyState==="DERIVED"?"check_circle_outline":e.supplyState==="PARTIAL"?"remove_circle_outline":"radio_button_unchecked"," "),p(2),h(e.name),p(),m("ngIf",e.supplyState!=="NONE"),p(),m("ngIf",e.totalChildrenCount),p(),m("ngIf",e.subcategories==null?null:e.subcategories.length)}}function on(i,t){if(i&1&&(o(0,"span"),l(1),n()),i&2){let e=c().$implicit;p(),f(" \u2014 by ",e.performedBy," ")}}function an(i,t){if(i&1&&(o(0,"div",45),l(1),n()),i&2){let e=c().$implicit;p(),te(" ",e.oldValue||"\u2014"," \u2192 ",e.newValue||"\u2014"," ")}}function ln(i,t){if(i&1&&(o(0,"div",41)(1,"mat-icon"),l(2,"history"),n(),o(3,"div",42)(4,"div",43),l(5),n(),o(6,"div",39),l(7),oe(8,"date"),d(9,on,2,1,"span",37),n(),d(10,an,2,2,"div",44),n()()),i&2){let e=t.$implicit;p(5),h(e.action),p(2),f(" ",ae(8,4,e.timestamp,"medium")," "),p(2),m("ngIf",e.performedBy),p(),m("ngIf",e.fieldChanged)}}function pn(i,t){i&1&&(o(0,"div",46),l(1," No audit records "),n())}function sn(i,t){if(i&1){let e=v();o(0,"div",2)(1,"div",3)(2,"div")(3,"h2"),l(4),n(),o(5,"div",4),l(6),n()(),o(7,"div",5)(8,"button",6),g("click",function(){u(e);let a=c();return _(a.back())}),l(9,"Back"),n(),o(10,"button",6),g("click",function(){u(e);let a=c();return _(a.editSupplier())}),o(11,"mat-icon"),l(12,"edit"),n(),l(13," Edit "),n(),d(14,Bi,4,3,"button",7),n()(),o(15,"mat-tab-group",8)(16,"mat-tab",9)(17,"mat-card",10)(18,"div")(19,"label"),l(20,"Status"),n(),o(21,"div",11),l(22),n()(),o(23,"div")(24,"label"),l(25,"Region"),n(),o(26,"div"),l(27),n()(),o(28,"div")(29,"label"),l(30,"Emails"),n(),d(31,zi,2,1,"div",12),n(),o(32,"div")(33,"label"),l(34,"Phones"),n(),d(35,$i,2,1,"div",12),n()()(),o(36,"mat-tab",13),d(37,ji,1,3,"app-entity-image-manager",14),n(),o(38,"mat-tab",15)(39,"mat-card",16),d(40,Ui,2,0,"div",17)(41,Hi,9,1,"table",18),n()(),o(42,"mat-tab",19)(43,"ul",20),d(44,Xi,9,11,"li",12),n(),d(45,rn,9,11,"ng-template",null,0,tt),n(),o(47,"mat-tab",21)(48,"mat-card",22)(49,"div",23),d(50,ln,11,7,"div",24)(51,pn,2,0,"div",25),n()()()()()}if(i&2){let e=c();p(4),h(e.supplier.name),p(2),f("Suppliers / ",e.supplier.name,""),p(8),m("ngIf",e.canManageSupplier()),p(7),P("deleted",e.supplier.deleted),p(),f(" ",e.status()," "),p(5),h(e.supplier.region||"\u2014"),p(4),m("ngForOf",e.supplier.email),p(4),m("ngForOf",e.supplier.phoneNumber),p(2),m("ngIf",e.supplierId),p(3),m("ngIf",e.products.length===0),p(),m("ngIf",e.products.length),p(3),m("ngForOf",e.categories),p(6),m("ngForOf",e.audits),p(),m("ngIf",!e.audits.length)}}var Fe=class i{constructor(t,e,r,a,s,S,T,dn){this.route=t;this.router=e;this.location=r;this.supplierService=a;this.categoryService=s;this.entityAction=S;this.auth=T;this.snackbar=dn}supplier;supplierId;loading=!0;role="";products=[];audits=[];categories=[];imageAdapter;actionConfig;ngOnInit(){this.auth.getCurrentUser().subscribe(a=>{this.role=a?.role??""}),this.imageAdapter=Nt(this.supplierService);let t=this.route.snapshot.paramMap.get("identifier");if(!t)return;let r=this.router.getCurrentNavigation()?.extras.state?.deleted??!1;this.loadSupplier(t,r),this.loadCategories()}loadSupplier(t,e){this.loading=!0,this.supplierService.getById(t,e).subscribe({next:r=>{this.supplier=r,this.supplierId=r.id,this.loading=!1,this.initializeActionConfig(),this.loadProducts(),this.loadAudits()},error:()=>{this.snackbar.open("Failed to load supplier","Close",{duration:3e3}),this.router.navigate(["/suppliers"])}})}initializeActionConfig(){this.actionConfig={entityName:"Supplier",displayName:t=>t.name,disableReasons:U.DISABLE,restoreReasons:U.RESTORE,deleteReasons:U.DELETE,disable:(t,e)=>this.supplierService.softDelete(t,e),restore:(t,e)=>this.supplierService.restore(t,e),hardDelete:(t,e)=>this.supplierService.hardDelete(t,e),reload:()=>this.loadSupplier(this.supplierId,this.supplier.deleted)}}loadProducts(){this.supplierService.productsSupplied(this.supplierId).subscribe(t=>this.products=t||[])}loadAudits(){this.supplierService.supplierAudits(this.supplierId).subscribe(t=>this.audits=t||[])}loadCategories(){this.categoryService.getAll("tree",!1).subscribe(t=>{this.categories=t.map(e=>qe(e,this.supplierId))})}canManageSupplier(){return["ADMIN","SUPERUSER"].includes(this.role)}isSuperuser(){return this.role==="SUPERUSER"}toggleSupplier(){this.entityAction.toggleSingle(this.supplier,this.actionConfig)}back(){this.location.back()}editSupplier(){this.router.navigate(["/suppliers",this.supplierId,"edit"],{state:{deleted:this.supplier.deleted}})}goProduct(t){this.router.navigate(["/products",t])}status(){return this.supplier.deleted?"DISABLED":"ACTIVE"}static \u0275fac=function(e){return new(e||i)(C(me),C(F),C(le),C(O),C(Z),C(be),C(pt),C(L))};static \u0275cmp=E({type:i,selectors:[["app-supplier-details"]],decls:1,vars:1,consts:[["node",""],["class","supplier-details-root",4,"ngIf"],[1,"supplier-details-root"],[1,"page-header"],[1,"breadcrumb"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-stroked-button","",3,"color","click",4,"ngIf"],["dynamicHeight",""],["label","Overview"],[1,"card","grid-2"],[1,"status"],[4,"ngFor","ngForOf"],["label","Documents"],[3,"entityId","adapter","allowHardDelete",4,"ngIf"],["label","Products"],[1,"card"],["class","empty",4,"ngIf"],["class","product-table",4,"ngIf"],["label","Categories"],[1,"category-tree"],["label","Audits"],[1,"card","audit-card"],[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],["class","muted",4,"ngIf"],["mat-stroked-button","",3,"click","color"],[3,"entityId","adapter","allowHardDelete"],[1,"empty"],[1,"product-table"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"category-row"],[1,"state-icon"],[1,"name"],["class","badge",4,"ngIf"],["class","meta",4,"ngIf"],[4,"ngIf"],[1,"badge"],[1,"meta"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"timeline-item"],[1,"content"],[1,"title"],["class","change",4,"ngIf"],[1,"change"],[1,"muted"]],template:function(e,r){e&1&&d(0,sn,52,15,"div",1),e&2&&m("ngIf",!r.loading)},dependencies:[w,D,I,it,pe,Ee,ye,Dt,Pt,Tt,k,M,N,A,Mt],styles:[".supplier-details-root[_ngcontent-%COMP%]{max-width:1200px;margin:auto;padding:16px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.4rem}.page-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.page-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.card[_ngcontent-%COMP%]{padding:20px;background:var(--surface);border:1px solid var(--border)}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:20px}.grid-2[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.grid-2[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.03em;color:var(--text-secondary)}.status[_ngcontent-%COMP%]{font-weight:700}.status.deleted[_ngcontent-%COMP%]{color:#dc2626}.product-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;text-align:left}.product-table[_ngcontent-%COMP%]   .product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.03em;color:var(--text-secondary)}.product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid var(--border)}.product-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{cursor:pointer}.product-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:var(--surface-hover)}.category-tree[_ngcontent-%COMP%]{list-style:none;padding-left:0}.category-tree[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding-left:22px;border-left:1px dashed var(--border);margin-left:8px}.category-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 14px;margin-bottom:6px;border-radius:6px;border-left:3px solid transparent;background:var(--surface)}.category-row[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{font-size:20px}.category-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;flex:1}.category-row[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.category-row[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.65rem;font-weight:700;padding:3px 8px;border-radius:12px}.category-row.direct[_ngcontent-%COMP%]{background:#22c55e14;border-left-color:#22c55e}.category-row.direct[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{color:#22c55e}.category-row.direct[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#22c55e26;color:#166534}.category-row.derived[_ngcontent-%COMP%]{background:#22c55e0a;border-left-color:#86efac}.category-row.derived[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{color:#22c55e}.category-row.derived[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#22c55e1a;color:#15803d}.category-row.partial[_ngcontent-%COMP%]{background:#eab30814;border-left-color:#facc15}.category-row.partial[_ngcontent-%COMP%]   .state-icon[_ngcontent-%COMP%]{color:#eab308}.category-row.partial[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#eab30826;color:#854d0e}.audit-card[_ngcontent-%COMP%]{padding:0;background:var(--app-bg)}.timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px;padding:16px}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:12px;padding:12px;border:1px solid var(--border);border-radius:6px;background:var(--surface)}.timeline-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:20px;margin-top:2px}.timeline-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.timeline-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;font-size:.95rem}.timeline-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.timeline-item[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{font-size:.85rem}.muted[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary);padding:16px}.empty[_ngcontent-%COMP%]{padding:24px;text-align:center;color:var(--text-secondary)}"]})};function qe(i,t){let e=i.subcategories??[];if(i.suppliers?.some(S=>S.id===t)??!1)return q(H({},i),{supplyState:"DIRECT",suppliedChildrenCount:e.length,totalChildrenCount:e.length,subcategories:e.map(S=>qe(S,t))});if(e.length===0)return q(H({},i),{supplyState:"NONE",suppliedChildrenCount:0,totalChildrenCount:0});let a=e.map(S=>qe(S,t)),s=a.filter(S=>S.supplyState==="DIRECT").length;return s===a.length?q(H({},i),{supplyState:"DERIVED",suppliedChildrenCount:s,totalChildrenCount:a.length,subcategories:a}):s>0?q(H({},i),{supplyState:"PARTIAL",suppliedChildrenCount:s,totalChildrenCount:a.length,subcategories:a}):q(H({},i),{supplyState:"NONE",suppliedChildrenCount:0,totalChildrenCount:a.length,subcategories:a})}function mn(i,t){i&1&&(o(0,"mat-error"),l(1," Supplier name is required "),n())}function cn(i,t){if(i&1){let e=v();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),l(4,"Edit Supplier"),n(),o(5,"div",4),l(6),n()(),o(7,"div",5)(8,"button",6),g("click",function(){u(e);let a=c();return _(a.cancel())}),l(9," Cancel "),n(),o(10,"button",7),g("click",function(){u(e);let a=c();return _(a.submit())}),l(11," Save Changes "),n()()(),o(12,"mat-card",8)(13,"div",9)(14,"h3"),l(15,"Basic Information"),n()(),o(16,"form",10)(17,"mat-form-field",11)(18,"mat-label"),l(19,"Supplier Name"),n(),x(20,"input",12),d(21,mn,2,0,"mat-error",13),n(),o(22,"mat-form-field",11)(23,"mat-label"),l(24,"Region"),n(),x(25,"input",14),o(26,"mat-hint"),l(27,"Optional geographical region"),n()(),o(28,"mat-form-field",11)(29,"mat-label"),l(30,"Rating"),n(),x(31,"input",15),o(32,"mat-hint"),l(33,"Internal supplier rating (0\u20135)"),n()()()(),o(34,"mat-card",8)(35,"div",9)(36,"h3"),l(37,"Contact Information"),n()(),o(38,"form",10)(39,"mat-form-field",11)(40,"mat-label"),l(41,"Email Addresses"),n(),x(42,"input",16),o(43,"mat-hint"),l(44,"Comma-separated emails"),n()(),o(45,"mat-form-field",11)(46,"mat-label"),l(47,"Phone Numbers"),n(),x(48,"input",17),o(49,"mat-hint"),l(50,"Comma-separated phone numbers"),n()()()()()}if(i&2){let e,r=c();p(6),f("Suppliers / ",r.form.value.name||"Edit",""),p(4),m("disabled",r.form.invalid),p(6),m("formGroup",r.form),p(5),m("ngIf",(e=r.form.get("name"))==null?null:e.invalid),p(17),m("formGroup",r.form)}}var Ve=class i{constructor(t,e,r,a,s,S){this.fb=t;this.route=e;this.router=r;this.supplierService=a;this.snackbar=s;this.location=S}form;supplierId;ngOnInit(){this.supplierId=this.route.snapshot.paramMap.get("identifier"),this.buildForm(),this.loadSupplier()}buildForm(){this.form=this.fb.group({name:["",G.required],region:[""],rating:[null],emailsInput:[""],phonesInput:[""]})}loadSupplier(){let e=this.router.getCurrentNavigation()?.extras.state?.deleted??!1;this.supplierService.getById(this.supplierId,e).subscribe(r=>{this.patchForm(r)})}patchForm(t){this.form.patchValue({name:t.name,region:t.region,rating:t.rating,emailsInput:(t.email||[]).join(", "),phonesInput:(t.phoneNumber||[]).join(", ")})}submit(){let t={name:this.form.value.name,region:this.form.value.region,rating:this.form.value.rating,email:this.split(this.form.value.emailsInput),phoneNumber:this.split(this.form.value.phonesInput)};this.supplierService.update(this.supplierId,t).subscribe({next:()=>{this.snackbar.open("Supplier updated","Close",{duration:2e3}),this.router.navigate(["/suppliers",this.supplierId])}})}cancel(){this.location.back()}split(t){return(t||"").split(",").map(e=>e.trim()).filter(Boolean)}static \u0275fac=function(e){return new(e||i)(C(ge),C(me),C(F),C(O),C(L),C(le))};static \u0275cmp=E({type:i,selectors:[["app-supplier-edit"]],decls:1,vars:1,consts:[["class","supplier-edit-root",4,"ngIf"],[1,"supplier-edit-root"],[1,"page-header"],[1,"title"],[1,"breadcrumb"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"card"],[1,"card-header"],[1,"form-grid",3,"formGroup"],["appearance","fill"],["matInput","","formControlName","name"],[4,"ngIf"],["matInput","","formControlName","region"],["matInput","","type","number","formControlName","rating"],["matInput","","formControlName","emailsInput"],["matInput","","formControlName","phonesInput"]],template:function(e,r){e&1&&d(0,cn,51,5,"div",0),e&2&&m("ngIf",r.form)},dependencies:[w,I,J,ce,V,de,R,W,Q,K,Ee,ye,z,B,Y,ut,dt,j,$,k,M],styles:[".supplier-edit-root[_ngcontent-%COMP%]{max-width:1100px;margin:auto;padding:16px;display:flex;flex-direction:column;gap:18px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:16px}.page-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.4rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary);margin-top:2px}.page-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.card[_ngcontent-%COMP%]{padding:20px}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{margin-bottom:16px}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}mat-form-field[_ngcontent-%COMP%]{width:100%}"]})};var Br=[{path:"",canActivate:[mt],children:[{path:"",component:Te},{path:"create",component:De},{path:":identifier/edit",component:Ve},{path:":identifier",component:Fe}]}];export{Br as SUPPLIER_ROUTES};
