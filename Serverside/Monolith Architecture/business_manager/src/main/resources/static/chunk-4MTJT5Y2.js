import{a as U,b as q}from"./chunk-7DWOBMMK.js";import{a as We,b as Ke}from"./chunk-SE5AOJFE.js";import{a as qe}from"./chunk-VGRWNKBL.js";import"./chunk-7GLSX2AB.js";import{a as Lt}from"./chunk-46EFOYSR.js";import{a as le}from"./chunk-L3RCXL5W.js";import{a as Yt,b as qt,c as Jt}from"./chunk-DHVK64AT.js";import{a as Wt,b as Kt,c as Qt,d as Zt}from"./chunk-I43GAN7W.js";import{a as Gt}from"./chunk-AM43YPRF.js";import{a as $t}from"./chunk-VQD42P6V.js";import{a as $e,b as zt,c as Ge,d as Ye}from"./chunk-PUDW2OXT.js";import{a as Te,b as Ae,c as Re,d as Fe,e as Ve,f as Ne,g as Be,h as Le,i as je,j as He,k as ze}from"./chunk-IFBDMVRJ.js";import"./chunk-VGEQVDR7.js";import{a as Vt,b as Nt}from"./chunk-JNUXAAQA.js";import{a as Bt,c as Oe,h as Pe}from"./chunk-727AWRP5.js";import{a as j}from"./chunk-HHYKBKON.js";import"./chunk-MS4AQ6UA.js";import{a as G,b as Y}from"./chunk-NUV7N7IM.js";import{d as V}from"./chunk-PJQ2W5C7.js";import{c as Rt}from"./chunk-2CD73GIG.js";import{b as P,c as T}from"./chunk-NP55MDY3.js";import{a as H,b as z}from"./chunk-NKX2CJ22.js";import{c as de,d as pe}from"./chunk-IMZ4R6CL.js";import{b as me,c as jt,e as Ht,h as $,i as ce}from"./chunk-EWJIHEWL.js";import"./chunk-SGYCFQGT.js";import{d as N,f as w,h as B,i as re,l as Ft,m as Me,p as oe,q as Ie,r as ke,s as ae,v as De,w as Ue,x as se}from"./chunk-J63CKRDU.js";import"./chunk-CN565FBG.js";import{f as L,g as A,h as R}from"./chunk-A6LP6NU3.js";import{G as At}from"./chunk-7XXZ3FER.js";import{b as Ee,d as F}from"./chunk-PBEYJMJD.js";import"./chunk-LMLMO6HS.js";import"./chunk-5DTMLZHP.js";import{$b as Se,$c as D,Bb as he,C as xe,I as Ce,Ib as o,Jb as r,Kb as C,Lb as E,Mb as M,Ob as x,Qb as f,Qc as Tt,Rb as d,Rc as O,Sc as k,Ub as Et,Wb as Mt,Wc as ne,Xb as It,Yb as kt,Z as ye,Za as yt,_ as bt,ac as s,bb as l,bc as v,cc as b,dc as ve,ec as Dt,f as vt,fa as xt,fc as Z,ga as Ct,gb as h,gc as J,hc as X,kc as Ut,lc as Ot,m as ee,ma as u,mc as Pt,na as _,nb as I,nc as te,ob as St,pc as ie,qb as wt,rc as we,sb as p,xc as at,yb as S,zb as c}from"./chunk-IL4QWM46.js";import{a as gt,b as ht,g as rt,h as ot}from"./chunk-FJYW2LMB.js";var st=(()=>{class i{changes=new vt;static \u0275fac=function(n){return new(n||i)};static \u0275prov=ye({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function si(i){return i||new st}var li={provide:st,deps:[[new xt,new Ct,st]],useFactory:si};var Xt=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=St({type:i});static \u0275inj=bt({providers:[li],imports:[At]})}return i})();var mi=new Set(["SUPERUSER","ADMIN","MANAGER"]);function ei(i){return!!i&&mi.has(i.role)}var ti={title:"Bulk Import Users",confirmLabel:"Import Now",csvFileName:"users-bulk-template.csv",excelFileName:"users-bulk-template.xlsx",supportsArchiveImport:!0,supportsFileDescription:!0,headers:["username","password","role","emails","phones","branchCode","departmentName","position"],fields:[{name:"username",required:!0},{name:"password",defaultValue:"1234"},{name:"role",defaultValue:"EMPLOYEE"},{name:"emails"},{name:"phones"},{name:"branchCode"},{name:"departmentName"},{name:"position",defaultValue:"member"}],previewColumns:[{key:"username",label:"Username"},{key:"role",label:"Role"},{key:"emails",label:"Emails"},{key:"phones",label:"Phones"},{key:"branchCode",label:"Branch"},{key:"departmentName",label:"Department"}],excelSheetName:"Users",excelColumns:[{header:"username",key:"username",width:18},{header:"password",key:"password",width:12},{header:"role",key:"role",width:14},{header:"emails",key:"emails",width:32},{header:"phones",key:"phones",width:22,format:"text"},{header:"branchCode",key:"branchCode",width:14},{header:"departmentName",key:"departmentName",width:18},{header:"position",key:"position",width:12}],exampleRow:{username:"jdoe",password:"1234",role:"EMPLOYEE",emails:"jdoe@company.com",phones:"0712345678",branchCode:"MAIN",departmentName:"GENERAL",position:"member"},emptyRow:{password:"1234",role:"EMPLOYEE",position:"member"},emptyRowCount:200,defaultOptions:{dryRun:!0,skipDuplicates:!0},mapRowToItem(i){return{username:i.username,password:i.password,role:i.role,emailAddresses:i.emails?[i.emails]:[],phoneNumbers:i.phones?[i.phones]:[],branchCode:i.branchCode||null,departmentName:i.departmentName||null,position:i.position}},mapPreviewRow(i){return ht(gt({},i),{emails:Array.isArray(i.emailAddresses)?i.emailAddresses.join(", "):"",phones:Array.isArray(i.phoneNumbers)?i.phoneNumbers.join(", "):""})},submit(i){return null}};function di(i,t){if(i&1&&(o(0,"mat-option",32),s(1),r()),i&2){let e=t.$implicit;c("value",e.branchCode),l(),b(" ",e.name," ")}}function pi(i,t){if(i&1&&(o(0,"mat-option",32),s(1),r()),i&2){let e=t.$implicit;c("value",e.name),l(),b(" ",e.name," ")}}function ui(i,t){if(i&1&&(o(0,"div",12)(1,"mat-form-field")(2,"mat-select",25)(3,"mat-option",26),s(4,"Auto"),r(),p(5,di,2,2,"mat-option",27),r()(),o(6,"mat-form-field")(7,"mat-select",28)(8,"mat-option",26),s(9,"Auto"),r(),p(10,pi,2,2,"mat-option",27),r()(),o(11,"mat-form-field")(12,"mat-select",29)(13,"mat-option",30),s(14,"Member"),r(),o(15,"mat-option",31),s(16,"Head"),r()()()()),i&2){let e=d(2);l(5),c("ngForOf",e.branches),l(5),c("ngForOf",e.departments)}}function _i(i,t){if(i&1&&(o(0,"div",33),s(1),r()),i&2){let e=d().$implicit;l(),b(" ",e.value._error," ")}}function fi(i,t){if(i&1){let e=x();o(0,"div",9)(1,"div",10)(2,"span"),s(3),r(),o(4,"button",11),f("click",function(){let a=u(e).index,m=d();return _(m.removeRow(a))}),o(5,"mat-icon"),s(6,"delete"),r()()(),o(7,"div",12)(8,"mat-form-field"),C(9,"input",13),r(),o(10,"mat-form-field"),C(11,"input",14),r(),o(12,"mat-form-field")(13,"mat-select",15)(14,"mat-option",16),s(15,"EMPLOYEE"),r(),o(16,"mat-option",17),s(17,"SUPERVISOR"),r(),o(18,"mat-option",18),s(19,"MANAGER"),r(),o(20,"mat-option",19),s(21,"ADMIN"),r()()()(),o(22,"div",20)(23,"mat-form-field"),C(24,"input",21),r(),o(25,"mat-form-field"),C(26,"input",22),r()(),p(27,ui,17,2,"div",23)(28,_i,2,1,"div",24),r()}if(i&2){let e=t.$implicit,n=t.index,a=d();c("formGroupName",n),l(3),b("User ",n+1,""),l(24),c("ngIf",!a.hideOrgFields),l(),c("ngIf",e.value._error)}}var Qe=class i extends Yt{constructor(e,n,a,m,g){super();this.userService=e;this.branchService=n;this.departmentService=a;this.submitEngine=m;this.dialogRef=g}config=ti;branches=[];departments=[];hideOrgFields=!1;ngOnInit(){this.initForm(),this.loadOrgMeta()}loadOrgMeta(){Promise.all([this.branchService.getAll(!1).toPromise(),this.departmentService.getAll(!1).toPromise()]).then(([e,n])=>{this.branches=e||[],this.departments=n||[],this.hideOrgFields=this.branches.length===1&&this.departments.length===1})}submit(){if(this.form.invalid)return;let e={items:this.rows.controls.map(n=>this.config.mapRowToItem(n.value)),options:{dryRun:this.form.value.dryRun,skipDuplicates:!0}};this.submitEngine.execute({submitFn:n=>this.userService.bulkImport(n),payload:e,rows:this.rows.controls,dryRun:this.form.value.dryRun,title:this.config.title,confirmLabel:this.config.confirmLabel,columns:this.config.previewColumns,onErrorsApplied:n=>{this.cacheErrors(n),this.config.mapPreviewRow&&Array.isArray(n.data)&&(n.data=n.data.map(a=>this.config.mapPreviewRow(a)))},onFinalSuccess:()=>this.dialogRef.close(!0),onConfirmRetry:()=>{this.form.patchValue({dryRun:!1}),this.submit()}})}importExcel(e){return ot(this,null,function*(){if(!e)return;let n=yield this.confirmMerge();n&&rt(i.prototype,this,"importExcelFile").call(this,e,void 0,n)})}importCsv(e){return ot(this,null,function*(){if(!e)return;let n=yield this.confirmMerge();n&&rt(i.prototype,this,"importCsvFile").call(this,e,n)})}close(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||i)(h(U),h(j),h(q),h(Jt),h(Bt))};static \u0275cmp=I({type:i,selectors:[["app-user-bulk-import-dialog"]],features:[wt],decls:12,vars:8,consts:[["bottomAnchor",""],[3,"keydown.enter","formGroup"],[3,"importCsv","importExcel","downloadCsv","downloadExcel","submit","cancel","goToLine","goTop","goBottom","prevError","nextError","clearAll","exportCsv","exportExcel","title","rowCount","submitting","formInvalid","loading","progress"],[1,"users-body"],["bulk-options","",1,"grid-2"],["formControlName","dryRun"],["formArrayName","rows",1,"rows"],["class","row-card",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],[1,"row-card",3,"formGroupName"],[1,"row-header"],["mat-icon-button","","color","warn",3,"click"],[1,"grid-3"],["matInput","","placeholder","Username","formControlName","username"],["matInput","","placeholder","Password","formControlName","password"],["formControlName","role"],["value","EMPLOYEE"],["value","SUPERVISOR"],["value","MANAGER"],["value","ADMIN"],[1,"grid-2"],["matInput","","placeholder","Emails","formControlName","emails"],["matInput","","placeholder","Phones","formControlName","phones"],["class","grid-3",4,"ngIf"],["class","row-error",4,"ngIf"],["formControlName","branchCode"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","departmentName"],["formControlName","position"],["value","member"],["value","head"],[3,"value"],[1,"row-error"]],template:function(n,a){if(n&1){let m=x();o(0,"form",1),f("keydown.enter",function(y){return u(m),_(y.stopPropagation())}),o(1,"app-bulk-import-shell",2),f("importCsv",function(y){return u(m),_(a.importCsv(y))})("importExcel",function(y){return u(m),_(a.importExcel(y))})("downloadCsv",function(){return u(m),_(a.downloadCsvTemplate())})("downloadExcel",function(){return u(m),_(a.downloadExcelTemplate())})("submit",function(){return u(m),_(a.submit())})("cancel",function(){return u(m),_(a.close())})("goToLine",function(y){return u(m),_(a.goToLine(y))})("goTop",function(){return u(m),_(a.scrollToTop())})("goBottom",function(){return u(m),_(a.scrollToBottom())})("prevError",function(){return u(m),_(a.goToPreviousError())})("nextError",function(){return u(m),_(a.goToNextError())})("clearAll",function(){return u(m),_(a.clearRows())})("exportCsv",function(){return u(m),_(a.exportCsvCurrentRows())})("exportExcel",function(){return u(m),_(a.exportExcelCurrentRows())}),o(2,"div",3)(3,"div",4)(4,"mat-checkbox",5),s(5," Dry run (validate only) "),r()(),o(6,"div",6),p(7,fi,29,4,"div",7),r(),o(8,"button",8),f("click",function(){return u(m),_(a.addRow())}),s(9," + Add User "),r(),C(10,"div",null,0),r()()()}n&2&&(c("formGroup",a.form),l(),c("title",a.config.title)("rowCount",a.rowCount)("submitting",a.submitting)("formInvalid",a.form.invalid)("loading",a.submitting||a.loading)("progress",a.progress),l(6),c("ngForOf",a.rows.controls))},dependencies:[D,O,k,se,Me,N,B,re,oe,ae,Ie,ke,qt,ce,$,pe,de,Y,G,V,Ye,Ge,R,A,L,T,P],styles:[".users-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.row-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:20px;background:var(--surface);display:flex;flex-direction:column;gap:16px}.row-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;border-bottom:1px dashed var(--border);padding-bottom:6px}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}.mat-form-field[_ngcontent-%COMP%]{width:100%}.row-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.highlight-line[_ngcontent-%COMP%]{outline:2px solid #1976d2;outline-offset:4px;transition:outline .3s ease}"]})};var K={DISABLE:["Security violation","Policy breach","Left organization","Temporary suspension","Access misuse detected"],RESTORE:["Mistaken disable","Investigation cleared","Reinstated by management"],DELETE:["Duplicate account","Test user cleanup","GDPR data removal"]};var Q=class i{roles=[{name:"SUPERUSER"},{name:"ADMIN"},{name:"MANAGER"},{name:"SUPERVISOR"},{name:"EMPLOYEE"}];list(){return ee(this.roles)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=ye({token:i,factory:i.\u0275fac,providedIn:"root"})};var bi=()=>[1,5,10,20,50],xi=(i,t)=>({"text-green-400":i,"text-red-400":t}),Ci=i=>({"row-selected":i});function yi(i,t){if(i&1){let e=x();o(0,"button",26),f("click",function(){u(e);let a=d(2);return _(a.bulkDisable())}),s(1," Disable Selected "),r()}}function Si(i,t){if(i&1){let e=x();o(0,"button",27),f("click",function(){u(e);let a=d(2);return _(a.bulkRestore())}),s(1," Restore Selected "),r()}}function wi(i,t){if(i&1){let e=x();o(0,"button",28),f("click",function(){u(e);let a=d(2);return _(a.bulkDelete())}),s(1," Delete Permanently "),r()}}function Ei(i,t){i&1&&(o(0,"span",29),s(1," Cannot perform bulk action \u2014 selected users have mixed status "),r())}function Mi(i,t){if(i&1&&(o(0,"div",20)(1,"span",21),s(2),r(),p(3,yi,2,0,"button",22)(4,Si,2,0,"button",23)(5,wi,2,0,"button",24)(6,Ei,2,0,"span",25),r()),i&2){let e=d();l(2),b(" ",e.selection.selected.length," selected "),l(),c("ngIf",e.bulkState==="active"),l(),c("ngIf",e.bulkState==="deleted"),l(),c("ngIf",e.bulkState==="deleted"),l(),c("ngIf",e.bulkState==="mixed")}}function Ii(i,t){if(i&1){let e=x();o(0,"mat-checkbox",30),X("ngModelChange",function(a){u(e);let m=d();return J(m.showDeleted,a)||(m.showDeleted=a),_(a)}),f("change",function(){u(e);let a=d();return _(a.applyFilters())}),s(1," Show deleted users "),r()}if(i&2){let e=d();Z("ngModel",e.showDeleted),S("aria-label","Toggle visibility of deleted users")}}function ki(i,t){if(i&1&&(o(0,"mat-option",31),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),b(" ",e.name," ")}}function Di(i,t){if(i&1&&(o(0,"mat-option",31),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),b(" ",e.name," ")}}function Ui(i,t){if(i&1&&(o(0,"mat-option",31),s(1),r()),i&2){let e=t.$implicit;c("value",e.name),l(),b(" ",e.name," ")}}function Oi(i,t){if(i&1){let e=x();o(0,"mat-form-field",11)(1,"mat-label"),s(2,"Status"),r(),o(3,"mat-select",12),X("ngModelChange",function(a){u(e);let m=d();return J(m.filterStatus,a)||(m.filterStatus=a),_(a)}),f("selectionChange",function(){u(e);let a=d();return _(a.applyFilters())}),o(4,"mat-option",13),s(5,"All"),r(),o(6,"mat-option",32),s(7,"Active"),r(),o(8,"mat-option",33),s(9,"Disabled"),r()()()}if(i&2){let e=d();l(3),Z("ngModel",e.filterStatus)}}function Pi(i,t){i&1&&(o(0,"div",34),s(1," Loading\u2026 "),r())}function Ti(i,t){if(i&1){let e=x();o(0,"mat-header-cell")(1,"mat-checkbox",55),f("change",function(){u(e);let a=d(2);return _(a.masterToggle())}),r()()}if(i&2){let e=d(2);l(),c("checked",e.isAllSelected())("indeterminate",e.selection.selected.length>0&&!e.isAllSelected()),S("aria-label","Select all users")}}function Ai(i,t){if(i&1){let e=x();o(0,"mat-cell")(1,"mat-checkbox",56),f("click",function(a){return u(e),_(a.stopPropagation())})("change",function(){let a=u(e).$implicit,m=d(2);return _(m.selection.toggle(a))}),r()()}if(i&2){let e=t.$implicit,n=d(2);l(),c("checked",n.selection.isSelected(e)),S("aria-label","Select user {{ row.username }}")}}function Ri(i,t){if(i&1){let e=x();o(0,"mat-header-cell",57),f("click",function(){u(e);let a=d(2);return _(a.sortBy("username"))}),s(1," Username "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);S("aria-label","Sort by username"),l(3),b(" ",e.sortField==="username"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Fi(i,t){if(i&1){let e=x();o(0,"mat-cell")(1,"a",59),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.view(a))}),s(2),r()()}if(i&2){let e=t.$implicit;l(2),b(" ",e.username," ")}}function Vi(i,t){i&1&&(o(0,"mat-header-cell"),s(1," Emails "),r()),i&2&&S("aria-label","User email addresses")}function Ni(i,t){if(i&1&&(o(0,"div",62),s(1),r()),i&2){let e=t.$implicit;l(),v(e)}}function Bi(i,t){if(i&1&&(o(0,"mat-cell")(1,"div",60),p(2,Ni,2,1,"div",61),r()()),i&2){let e=t.$implicit;l(2),c("ngForOf",e.emailAddresses)}}function Li(i,t){i&1&&(o(0,"mat-header-cell"),s(1," Phones "),r()),i&2&&S("aria-label","User phone numbers")}function ji(i,t){if(i&1&&(o(0,"div",65),s(1),r()),i&2){let e=t.$implicit;l(),b(" ",e," ")}}function Hi(i,t){if(i&1&&(o(0,"mat-cell")(1,"div",63),p(2,ji,2,1,"div",64),r()()),i&2){let e=t.$implicit;l(2),c("ngForOf",e.phoneNumbers)}}function zi(i,t){if(i&1){let e=x();o(0,"mat-header-cell",66),f("click",function(){u(e);let a=d(2);return _(a.sortBy("branch"))}),s(1," Branches / Departments "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);S("aria-label","Sort by branch or department"),l(3),b(" ",e.sortField==="branch"||e.sortField==="department"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function $i(i,t){if(i&1&&(E(0),o(1,"div",69),s(2),r(),o(3,"div",70),s(4),r(),o(5,"div",71),s(6),r(),M()),i&2){let e=t.$implicit;l(2),v(e.branchName),l(2),v(e.departmentName),l(2),v(e.position||"\u2014")}}function Gi(i,t){if(i&1&&(o(0,"mat-cell")(1,"div",67),p(2,$i,7,3,"ng-container",68),r()()),i&2){let e=t.$implicit,n=d(2);l(2),c("ngForOf",n.branchDeptRows(e))}}function Yi(i,t){if(i&1){let e=x();o(0,"mat-header-cell",72),f("click",function(){u(e);let a=d(2);return _(a.sortBy("role"))}),s(1," Role "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);S("aria-label","Sort by role"),l(3),b(" ",e.sortField==="role"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function qi(i,t){if(i&1&&(o(0,"mat-cell"),s(1),r()),i&2){let e=t.$implicit;l(),b(" ",e.role," ")}}function Wi(i,t){if(i&1&&(o(0,"mat-icon",58),s(1),r()),i&2){let e=d(3);l(),b(" ",e.sortField==="status"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Ki(i,t){if(i&1){let e=x();o(0,"mat-header-cell",73),f("click",function(){u(e);let a=d(2);return _(a.sortBy("status"))}),s(1," Status "),p(2,Wi,2,1,"mat-icon",74),r()}if(i&2){let e=d(2);S("aria-label","User status"),l(2),c("ngIf",e.allowShowDeleted)}}function Qi(i,t){if(i&1&&(o(0,"mat-cell")(1,"span",75),s(2),r()()),i&2){let e=t.$implicit;l(),c("ngClass",Pt(2,xi,!e.deleted,e.deleted)),l(),b(" ",e.deleted?"Disabled":"Active"," ")}}function Zi(i,t){if(i&1){let e=x();o(0,"mat-header-cell",76),f("click",function(){u(e);let a=d(2);return _(a.sortBy("createdAt"))}),s(1," Created "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);S("aria-label","Sort by date created"),l(3),b(" ",e.sortField==="createdAt"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Ji(i,t){if(i&1&&(o(0,"mat-cell"),s(1),te(2,"date"),r()),i&2){let e=t.$implicit;l(),b(" ",ie(2,1,e.createdAt,"medium")," ")}}function Xi(i,t){i&1&&(o(0,"mat-header-cell"),s(1," Actions "),r()),i&2&&S("aria-label","User actions")}function en(i,t){if(i&1){let e=x();o(0,"mat-cell",77)(1,"button",78),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.view(a))}),o(2,"mat-icon"),s(3,"visibility"),r()(),o(4,"button",79),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.edit(a))}),o(5,"mat-icon"),s(6,"edit"),r()(),o(7,"button",80),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.toggleActive(a))}),o(8,"mat-icon"),s(9),r()()()}if(i&2){let e=t.$implicit;l(),S("aria-label","View user {{ u.username }}"),l(3),S("aria-label","Edit user {{ u.username }}"),l(3),Et("matTooltip",e.deleted?"Restore/Delete user":"Disable User"),S("aria-label",(e.deleted?"Restore/Delete user ":"Disable user ")+e.username),l(2),v(e.deleted?"toggle_off":"toggle_on")}}function tn(i,t){i&1&&C(0,"mat-header-row")}function nn(i,t){if(i&1){let e=x();o(0,"mat-row",81),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.toggleRowSelection(a))}),r()}if(i&2){let e=t.$implicit,n=d(2);c("ngClass",Ot(1,Ci,n.selection.isSelected(e)))}}function rn(i,t){if(i&1&&(o(0,"mat-table",35),E(1,36),p(2,Ti,2,3,"mat-header-cell",37)(3,Ai,2,2,"mat-cell",38),M(),E(4,39),p(5,Ri,4,2,"mat-header-cell",40)(6,Fi,3,1,"mat-cell",38),M(),E(7,41),p(8,Vi,2,1,"mat-header-cell",37)(9,Bi,3,1,"mat-cell",38),M(),E(10,42),p(11,Li,2,1,"mat-header-cell",37)(12,Hi,3,1,"mat-cell",38),M(),E(13,43),p(14,zi,4,2,"mat-header-cell",44)(15,Gi,3,1,"mat-cell",38),M(),E(16,45),p(17,Yi,4,2,"mat-header-cell",46)(18,qi,2,1,"mat-cell",38),M(),E(19,47),p(20,Ki,3,2,"mat-header-cell",48)(21,Qi,3,5,"mat-cell",38),M(),E(22,49),p(23,Zi,4,2,"mat-header-cell",50)(24,Ji,3,4,"mat-cell",38),M(),E(25,51),p(26,Xi,2,1,"mat-header-cell",37)(27,en,10,5,"mat-cell",52),M(),p(28,tn,1,0,"mat-header-row",53)(29,nn,1,3,"mat-row",54),r()),i&2){let e=d();c("dataSource",e.users),l(28),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns)}}var Je=class i{constructor(t,e,n,a,m,g,y,ge,ai){this.userService=t;this.branchService=e;this.authService=n;this.departmentService=a;this.roleService=m;this.entityAction=g;this.snackbar=y;this.dialog=ge;this.router=ai}displayedColumns=["select","username","emails","phones","branches_depts","role","status","createdAt","actions"];allUsers=[];filteredUsers=[];users=[];branches=[];departments=[];roles=[];total=0;page=0;size=10;q="";filterBranch="";filterDepartment="";filterRole="";filterStatus="";showDeleted=!1;allowShowDeleted=!1;loading=!1;selection=new Rt(!0,[]);sortField=null;sortDir="asc";paginator;userActionConfig={entityName:"User",displayName:t=>t.username,disableReasons:K.DISABLE,restoreReasons:K.RESTORE,deleteReasons:K.DELETE,disable:(t,e)=>this.userService.softDelete(t,e),restore:(t,e)=>this.userService.restore(t,e),hardDelete:(t,e)=>this.userService.hardDelete(t,e),disableBulk:(t,e)=>this.userService.softDeleteBulk(t,e),restoreBulk:(t,e)=>this.userService.restoreBulk(t,e),hardDeleteBulk:(t,e)=>this.userService.hardDeleteBulk(t,e),reload:()=>this.loadUsersOnce()};ngOnInit(){this.loadFilters(),this.loadUsersOnce();let t=this.authService.getSnapshot();this.allowShowDeleted=ei(t)}loadFilters(){this.branchService.getAll().subscribe(t=>this.branches=t||[]),this.departmentService.getAll().subscribe(t=>this.departments=t||[]),this.roleService.list().subscribe(t=>this.roles=t||[])}loadUsersOnce(){this.loading=!0,this.userService.list(0,999999,{}).pipe(Ce(()=>this.loading=!1)).subscribe({next:t=>{this.allUsers=t.data||[],this.filteredUsers=[...this.allUsers],this.total=this.filteredUsers.length,this.applyFilters()},error:()=>{this.snackbar.open("Failed to load users","Close",{duration:3e3})}})}applyFilters(){let t=[...this.allUsers],e=(this.q||"").trim().toLowerCase();e&&(t=t.filter(n=>(n.username||"").toLowerCase().includes(e)||(n.emailAddresses||[]).some(a=>a.toLowerCase().includes(e))||(n.phoneNumbers||[]).some(a=>a.includes(e)))),this.filterBranch&&(t=t.filter(n=>(n.branchHierarchy||[]).some(a=>a.branchId===this.filterBranch))),this.filterDepartment&&(t=t.filter(n=>(n.branchHierarchy||[]).some(a=>(a.departments||[]).some(m=>m.departmentId===this.filterDepartment)))),this.filterRole&&(t=t.filter(n=>n.role===this.filterRole)),this.filterStatus==="active"?t=t.filter(n=>n.deleted===!1):this.filterStatus==="deleted"&&(t=t.filter(n=>n.deleted===!0)),!this.showDeleted&&this.filterStatus===""&&(t=t.filter(n=>!n.deleted)),this.sortField&&t.sort((n,a)=>this.compareForField(n,a,this.sortField,this.sortDir)),this.filteredUsers=t,this.total=t.length,this.selection.clear(),this.applyPagination()}compareForField(t,e,n,a){let m=a==="asc"?1:-1,g=null,y=null;switch(n){case"username":g=(t.username||"").toLowerCase(),y=(e.username||"").toLowerCase();break;case"role":g=(t.role||"").toLowerCase(),y=(e.role||"").toLowerCase();break;case"createdAt":g=t.createdAt?new Date(t.createdAt).getTime():0,y=e.createdAt?new Date(e.createdAt).getTime():0;break;case"email":g=t.emailAddresses&&t.emailAddresses[0]?t.emailAddresses[0].toLowerCase():"",y=e.emailAddresses&&e.emailAddresses[0]?e.emailAddresses[0].toLowerCase():"";break;case"phone":g=t.phoneNumbers&&t.phoneNumbers[0]?t.phoneNumbers[0]:"",y=e.phoneNumbers&&e.phoneNumbers[0]?e.phoneNumbers[0]:"";break;case"department":g=this.firstDepartmentName(t).toLowerCase(),y=this.firstDepartmentName(e).toLowerCase();break;case"branch":g=t.branchHierarchy&&t.branchHierarchy[0]&&t.branchHierarchy[0].branchName||"",y=e.branchHierarchy&&e.branchHierarchy[0]&&e.branchHierarchy[0].branchName||"",g=g.toLowerCase(),y=y.toLowerCase();break;case"status":g=t.deleted||"",y=e.deleted||"";break;default:g="",y=""}return g<y?-1*m:g>y?1*m:0}firstDepartmentName(t){if(!t.branchHierarchy||!t.branchHierarchy.length)return"";for(let e of t.branchHierarchy)if(e.departments&&e.departments.length){let n=e.departments[0];return n.departmentName||n.departmentId||""}return""}sortBy(t){this.sortField===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortField=t,this.sortDir="asc"),this.applyFilters()}applyPagination(){let t=this.page*this.size,e=t+this.size;this.users=this.filteredUsers.slice(t,e)}changePage(t){this.page=t.pageIndex,this.size=t.pageSize,this.applyPagination()}get bulkState(){let t=this.selection.selected;if(t.length===0)return null;let e=new Set(t.map(n=>n.deleted));return e.size>1?"mixed":e.has(!1)?"active":"deleted"}isAllSelected(){let t=this.selection.selected.length,e=this.users.length;return t===e&&e>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.users.forEach(t=>this.selection.select(t))}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"Deselect":"Select"} row ${t.username}`:`${this.isAllSelected()?"Deselect":"Select"} all`}toggleRowSelection(t){this.selection.toggle(t)}toggleActive(t){this.entityAction.toggleSingle(t,this.userActionConfig)}bulkDisable(){this.entityAction.bulkDisable(this.selection.selected,this.userActionConfig)}bulkRestore(){this.entityAction.bulkRestore(this.selection.selected,this.userActionConfig)}bulkDelete(){this.entityAction.bulkHardDelete(this.selection.selected,this.userActionConfig)}goCreate(){this.router.navigate(["/users/create"])}edit(t){this.router.navigate([`/users/${t.username}/edit`])}view(t){this.router.navigate([`/users/${t.username}`])}openBulkImport(){this.dialog.open(Qe,{width:"1100px",maxWidth:"95vw",maxHeight:"90vh",autoFocus:!1}).afterClosed().subscribe(t=>{t===!0&&this.loadUsersOnce()})}branchDeptRows(t){let e=[];return(t.branchHierarchy||[]).forEach(n=>{let a=n.branchName||"";!n.departments||!n.departments.length?e.push({branchName:a,departmentName:"\u2014",position:""}):(n.departments||[]).forEach(m=>{e.push({branchName:a,departmentName:m.departmentName||m.departmentId||"\u2014",position:m.position})})}),e}static \u0275fac=function(e){return new(e||i)(h(U),h(j),h(le),h(q),h(Q),h(qe),h(H),h(Oe),h(F))};static \u0275cmp=I({type:i,selectors:[["app-user-list"]],viewQuery:function(e,n){if(e&1&&Mt($e,5),e&2){let a;It(a=kt())&&(n.paginator=a.first)}},decls:42,vars:21,consts:[[1,"page-container","p-4"],[1,"page-header","flex","items-center","mb-6"],[1,"text-xl","font-semibold"],[1,"flex","items-center","gap-2","ml-auto"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["class","flex items-center gap-3 mb-4",4,"ngIf"],[1,"flex","items-center","gap-4","mb-4"],["placeholder","Search username, email or phone number",1,"search-input","px-3","py-2","rounded","border",3,"ngModelChange","input","ngModel"],[3,"ngModel","ngModelChange","change",4,"ngIf"],[1,"filters","grid","grid-cols-1","md:grid-cols-auto-fit","md:grid-cols-[repeat(auto-fit,minmax(100px,1fr))]","gap-4","mb-6"],["appearance","fill"],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["appearance","fill",4,"ngIf"],["class","py-8 text-center text-gray-400",4,"ngIf"],[1,"table-wrapper"],["class","mat-elevation-z1 rounded bg-[var(--surface)]",3,"dataSource",4,"ngIf"],[3,"page","length","pageSize","pageSizeOptions"],[1,"flex","items-center","gap-3","mb-4"],[1,"font-medium","text-blue-500"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["class","text-red-500 font-medium",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"text-red-500","font-medium"],[3,"ngModelChange","change","ngModel"],[3,"value"],["value","active"],["value","deleted"],[1,"py-8","text-center","text-gray-400"],[1,"mat-elevation-z1","rounded","bg-[var(--surface)]",3,"dataSource"],["matColumnDef","select"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","username"],["class","sortable","matTooltip","Sort by username","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","emails"],["matColumnDef","phones"],["matColumnDef","branches_depts"],["class","sortable","matTooltip","Sort by branch or department","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","role"],["class","sortable","matTooltip","Sort by role","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","status"],["class","sortable","matTooltip","Sort by status","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","createdAt"],["class","sortable","matTooltip","Sort by date created","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","actions"],["class","action-cell",4,"matCellDef"],[4,"matHeaderRowDef"],["class","clickable-row",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[3,"change","checked","indeterminate"],[3,"click","change","checked"],["matTooltip","Sort by username","matTooltipPosition","above",1,"sortable",3,"click"],[1,"sort-icon"],[1,"text-blue-600","hover:underline",3,"click"],[1,"email-grid"],["class","email-item",4,"ngFor","ngForOf"],[1,"email-item"],[1,"phone-grid"],["class","phone-item",4,"ngFor","ngForOf"],[1,"phone-item"],["matTooltip","Sort by branch or department","matTooltipPosition","above",1,"sortable",3,"click"],[1,"branch-dept-table"],[4,"ngFor","ngForOf"],[1,"bd-row","bd-row-name"],[1,"bd-row","bd-row-department"],[1,"bd-row","bd-row-position"],["matTooltip","Sort by role","matTooltipPosition","above",1,"sortable",3,"click"],["matTooltip","Sort by status","matTooltipPosition","above",1,"sortable",3,"click"],["class","sort-icon",4,"ngIf"],[3,"ngClass"],["matTooltip","Sort by date created","matTooltipPosition","above",1,"sortable",3,"click"],[1,"action-cell"],["mat-icon-button","","matTooltip","View User Details","matTooltipPosition","above",3,"click"],["mat-icon-button","","matTooltip","Edit User","matTooltipPosition","above",3,"click"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],[1,"clickable-row",3,"click","ngClass"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),s(3," Users "),r(),o(4,"div",3)(5,"button",4),f("click",function(){return n.openBulkImport()}),o(6,"mat-icon"),s(7,"cloud_upload"),r(),s(8," Bulk Import "),r(),o(9,"button",5),f("click",function(){return n.goCreate()}),s(10," Create User "),r()()(),p(11,Mi,7,5,"div",6),o(12,"div",7)(13,"input",8),X("ngModelChange",function(m){return J(n.q,m)||(n.q=m),m}),f("input",function(){return n.applyFilters()}),r(),p(14,Ii,2,2,"mat-checkbox",9),r(),o(15,"div",10)(16,"mat-form-field",11)(17,"mat-label"),s(18,"Branch"),r(),o(19,"mat-select",12),X("ngModelChange",function(m){return J(n.filterBranch,m)||(n.filterBranch=m),m}),f("selectionChange",function(){return n.applyFilters()}),o(20,"mat-option",13),s(21,"All"),r(),p(22,ki,2,2,"mat-option",14),r()(),o(23,"mat-form-field",11)(24,"mat-label"),s(25,"Department"),r(),o(26,"mat-select",12),X("ngModelChange",function(m){return J(n.filterDepartment,m)||(n.filterDepartment=m),m}),f("selectionChange",function(){return n.applyFilters()}),o(27,"mat-option",13),s(28,"All"),r(),p(29,Di,2,2,"mat-option",14),r()(),o(30,"mat-form-field",11)(31,"mat-label"),s(32,"Role"),r(),o(33,"mat-select",12),X("ngModelChange",function(m){return J(n.filterRole,m)||(n.filterRole=m),m}),f("selectionChange",function(){return n.applyFilters()}),o(34,"mat-option",13),s(35,"All"),r(),p(36,Ui,2,2,"mat-option",14),r()(),p(37,Oi,10,1,"mat-form-field",15),r(),p(38,Pi,2,0,"div",16),o(39,"div",17),p(40,rn,30,3,"mat-table",18),r(),o(41,"mat-paginator",19),f("page",function(m){return n.changePage(m)}),r()()),e&2&&(l(11),c("ngIf",n.selection.selected.length>0),l(2),Z("ngModel",n.q),S("aria-label","Search users"),l(),c("ngIf",n.allowShowDeleted),l(5),Z("ngModel",n.filterBranch),S("aria-label","Filter users by branch"),l(3),c("ngForOf",n.branches),l(4),Z("ngModel",n.filterDepartment),S("aria-label","Filter users by department"),l(3),c("ngForOf",n.departments),l(4),Z("ngModel",n.filterRole),S("aria-label","Filter users by role"),l(3),c("ngForOf",n.roles),l(),c("ngIf",n.allowShowDeleted),l(),c("ngIf",n.loading),l(2),c("ngIf",!n.loading),l(),c("length",n.total)("pageSize",n.size)("pageSizeOptions",Ut(20,bi)),S("aria-label","Users pagination"))},dependencies:[D,Tt,O,k,ne,Ue,N,B,Ft,ze,Te,Re,Be,Fe,Ae,Le,Ve,Ne,je,He,zt,$e,T,P,R,A,L,z,Nt,Vt,Y,$,me,G,V,Pe,Ye,Ge,Xt],styles:[".page-container[_ngcontent-%COMP%]{overflow-x:hidden;padding-top:0}mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:var(--text-secondary)!important;background:var(--surface)!important;padding:12px 16px}mat-cell[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem;padding:12px 16px}mat-cell[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{white-space:nowrap}.branch-grid[_ngcontent-%COMP%], .dept-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-table[_ngcontent-%COMP%]{width:100%;border-radius:6px;overflow-x:auto!important}.mat-column-username[_ngcontent-%COMP%], .mat-header-cell.mat-column-username[_ngcontent-%COMP%], .mat-column-emails[_ngcontent-%COMP%], .mat-header-cell.mat-column-emails[_ngcontent-%COMP%], .mat-column-phones[_ngcontent-%COMP%], .mat-header-cell.mat-column-phones[_ngcontent-%COMP%], .mat-column-branches_depts[_ngcontent-%COMP%], .mat-header-cell.mat-column-branches_depts[_ngcontent-%COMP%], .mat-column-role[_ngcontent-%COMP%], .mat-header-cell.mat-column-role[_ngcontent-%COMP%], .mat-column-status[_ngcontent-%COMP%], .mat-header-cell.mat-column-status[_ngcontent-%COMP%], .mat-column-createdAt[_ngcontent-%COMP%], .mat-header-cell.mat-column-createdAt[_ngcontent-%COMP%], .mat-column-actions[_ngcontent-%COMP%], .mat-header-cell.mat-column-actions[_ngcontent-%COMP%], .mat-column-select[_ngcontent-%COMP%], .mat-header-cell.mat-column-select[_ngcontent-%COMP%]{flex:0 0 auto!important;width:auto!important;max-width:none!important}.mat-column-username[_ngcontent-%COMP%]{min-width:160px}.mat-column-emails[_ngcontent-%COMP%]{min-width:250px}.mat-column-phones[_ngcontent-%COMP%]{min-width:140px}.mat-column-branches_depts[_ngcontent-%COMP%]{min-width:450px}.bd-row-name[_ngcontent-%COMP%]{min-width:100px!important}.bd-row-department[_ngcontent-%COMP%]{min-width:155px!important}.bd-row-position[_ngcontent-%COMP%]{min-width:100px!important}.mat-column-role[_ngcontent-%COMP%]{min-width:120px}.mat-column-status[_ngcontent-%COMP%]{min-width:110px}.mat-column-createdAt[_ngcontent-%COMP%]{min-width:230px}.mat-column-actions[_ngcontent-%COMP%]{min-width:150px;text-align:center}.mat-cell[_ngcontent-%COMP%]{padding:12px 16px;vertical-align:middle;word-break:break-word}.mat-column-select[_ngcontent-%COMP%]{width:48px;text-align:center}.mat-column-actions[_ngcontent-%COMP%]{width:120px;text-align:center}.mat-column-createdAt[_ngcontent-%COMP%]{width:160px;text-align:left}.email-grid[_ngcontent-%COMP%], .phone-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:7px;min-width:fit-content}.branch-dept-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:.6fr 1fr 120px;gap:10px 15px;align-items:start;padding-top:10px;padding-bottom:10px;font-size:.9rem}.branch-dept-table[_ngcontent-%COMP%]   .bd-heading[_ngcontent-%COMP%]{font-weight:600;color:var(--text-secondary)}.branch-dept-table[_ngcontent-%COMP%]   .bd-row[_ngcontent-%COMP%]{color:var(--text-primary)}mat-paginator[_ngcontent-%COMP%]{margin-top:12px}.table-wrapper[_ngcontent-%COMP%]{display:block;border-radius:6px}@media (max-width: 900px){.search-input[_ngcontent-%COMP%]{width:100%}.branch-dept-table[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]})};function on(i,t){i&1&&(o(0,"mat-icon"),s(1,"hourglass_top"),r())}function an(i,t){i&1&&(o(0,"div",17),s(1,"Completed"),r())}function sn(i,t){if(i&1){let e=x();o(0,"div",12),f("click",function(){let a=u(e).index,m=d();return _(m.goTo(a))}),o(1,"div",13),s(2),r(),o(3,"div",14)(4,"div",15),s(5),r(),p(6,an,2,0,"div",16),r()()}if(i&2){let e=t.$implicit,n=t.index,a=d();he("active",n===a.step)("completed",n<a.step),l(2),v(n+1),l(3),v(e),l(),c("ngIf",n<a.step)}}function ln(i,t){if(i&1){let e=x();o(0,"section")(1,"div",18)(2,"mat-form-field",19)(3,"mat-label"),s(4,"Username"),r(),C(5,"input",20),r(),o(6,"mat-form-field",19)(7,"mat-label"),s(8,"ID Number"),r(),C(9,"input",21),r()(),o(10,"div",22)(11,"button",23),f("click",function(){u(e);let a=d();return _(a.next())}),s(12,"Next"),r()()()}}function mn(i,t){if(i&1){let e=x();o(0,"section")(1,"mat-form-field",24)(2,"mat-label"),s(3,"Email addresses (comma separated)"),r(),o(4,"input",25),f("change",function(a){u(e);let m=d();return _(m.onEmailsChange(a))}),r()(),o(5,"mat-form-field",24)(6,"mat-label"),s(7,"Phone numbers (comma separated)"),r(),o(8,"input",26),f("change",function(a){u(e);let m=d();return _(m.onPhonesChange(a))}),r()(),o(9,"div",22)(10,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(11,"Previous"),r(),o(12,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(13,"Next"),r()()()}if(i&2){let e,n,a=d();l(4),c("value",(e=a.form.get("emailAddresses"))==null||e.value==null?null:e.value.join(", ")),l(4),c("value",(n=a.form.get("phoneNumbers"))==null||n.value==null?null:n.value.join(", "))}}function cn(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e),l(),v(e)}}function dn(i,t){i&1&&(o(0,"mat-error"),s(1," Passwords do not match "),r())}function pn(i,t){if(i&1){let e=x();o(0,"section")(1,"mat-form-field",24)(2,"mat-label"),s(3,"Role"),r(),o(4,"mat-select",28),p(5,cn,2,2,"mat-option",29),r()(),o(6,"mat-form-field",24)(7,"mat-label"),s(8,"Password"),r(),C(9,"input",30),o(10,"button",31),f("click",function(){u(e);let a=d();return _(a.hidePw=!a.hidePw)}),o(11,"mat-icon"),s(12),r()()(),o(13,"mat-form-field",24)(14,"mat-label"),s(15,"Confirm Password"),r(),C(16,"input",32),o(17,"button",31),f("click",function(){u(e);let a=d();return _(a.hideConfirmPw=!a.hideConfirmPw)}),o(18,"mat-icon"),s(19),r()(),p(20,dn,2,0,"mat-error",6),r(),o(21,"div",22)(22,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(23,"Previous"),r(),o(24,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(25,"Next"),r()()()}if(i&2){let e,n=d();l(5),c("ngForOf",n.assignableRoles),l(4),c("type",n.hidePw?"password":"text"),l(3),v(n.hidePw?"visibility":"visibility_off"),l(4),c("type",n.hideConfirmPw?"password":"text"),l(3),v(n.hideConfirmPw?"visibility":"visibility_off"),l(),c("ngIf",(e=n.form.get("confirmPassword"))==null?null:e.hasError("pwMismatch"))}}function un(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),v(e.name)}}function _n(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),b(" ",e.name," ")}}function fn(i,t){if(i&1){let e=x();o(0,"div",37)(1,"mat-form-field",38)(2,"mat-label"),s(3,"Branch"),r(),o(4,"mat-select",39),f("selectionChange",function(){let a=u(e).$implicit;return _(a.get("departmentId").setValue(""))}),p(5,un,2,2,"mat-option",29),r()(),o(6,"mat-form-field",38)(7,"mat-label"),s(8,"Department"),r(),o(9,"mat-select",40),p(10,_n,2,2,"mat-option",29),r()(),o(11,"mat-form-field",41)(12,"mat-label"),s(13,"Position"),r(),o(14,"mat-select",42)(15,"mat-option",43),s(16,"Member"),r(),o(17,"mat-option",44),s(18,"Head"),r()()(),o(19,"button",45),f("click",function(){let a=u(e).index,m=d(2);return _(m.removeAssignment(a))}),o(20,"mat-icon"),s(21,"delete"),r()()()}if(i&2){let e=t.$implicit,n=d(2);c("formGroup",e),l(5),c("ngForOf",n.branches),l(5),c("ngForOf",n.departmentsForBranch(e.get("branchId").value))}}function gn(i,t){if(i&1){let e=x();o(0,"section")(1,"div",34),p(2,fn,22,3,"div",35),o(3,"button",23),f("click",function(){u(e);let a=d();return _(a.addAssignment())}),s(4,"Add Assignment"),r(),o(5,"div",36),s(6,"If none provided, system will apply MAIN \u2192 GENERAL by default."),r()(),o(7,"div",22)(8,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(9,"Previous"),r(),o(10,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(11,"Next"),r()()()}if(i&2){let e=d();l(2),c("ngForOf",e.assignments.controls)}}function hn(i,t){if(i&1&&C(0,"img",61),i&2){let e=d().index,n=d(2);c("src",n.previews[e].src,yt)}}function vn(i,t){if(i&1&&(o(0,"div",62)(1,"mat-icon"),s(2,"picture_as_pdf"),r(),o(3,"span"),s(4),r()()),i&2){let e=d().index,n=d(2);l(4),v(n.previews[e].name)}}function bn(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e),l(),b(" ",e," ")}}function xn(i,t){i&1&&(o(0,"mat-form-field",19)(1,"mat-label"),s(2,"Enter description"),r(),C(3,"input",63),r())}function Cn(i,t){if(i&1){let e=x();o(0,"div",51)(1,"div",52),f("click",function(){let a=u(e).index,m=d(2);return _(m.viewFile(a))}),p(2,hn,1,1,"img",53)(3,vn,5,1,"div",54),r(),o(4,"div",55)(5,"div",56),s(6),r(),o(7,"mat-form-field",19)(8,"mat-label"),s(9,"Description"),r(),o(10,"mat-select",57),p(11,bn,2,2,"mat-option",29),r()(),p(12,xn,4,0,"mat-form-field",58),o(13,"div",59)(14,"button",60),f("click",function(){let a=u(e).index,m=d(2);return _(m.viewFile(a))}),o(15,"mat-icon"),s(16,"visibility"),r(),s(17," View "),r(),o(18,"button",45),f("click",function(){let a=u(e).index,m=d(2);return _(m.removeFile(a))}),o(19,"mat-icon"),s(20,"close"),r()()()()()}if(i&2){let e,n=t.$implicit,a=t.index,m=d(2);c("formGroupName",a),l(2),c("ngIf",m.previews[a].src),l(),c("ngIf",m.previews[a].type==="application/pdf"),l(3),v(m.previews[a].name),l(5),c("ngForOf",m.descriptionOptions),l(),c("ngIf",((e=n.get("type"))==null?null:e.value)==="Other")}}function yn(i,t){if(i&1){let e=x();o(0,"section",46)(1,"div",47)(2,"input",48),f("change",function(a){u(e);let m=d();return _(m.onFilesPicked(a))}),r(),o(3,"button",23),f("click",function(){u(e);let a=d();return _(a.openFilePicker())}),s(4,"Upload files"),r(),o(5,"div",49),p(6,Cn,21,6,"div",50),r()(),o(7,"div",22)(8,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(9,"Previous"),r(),o(10,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(11,"Next"),r()()()}if(i&2){let e=d();c("formArrayName","files"),l(6),c("ngForOf",e.filesArray.controls)}}function Sn(i,t){if(i&1&&(o(0,"li"),s(1),r()),i&2){let e=t.$implicit;l(),ve(" ",e.value.file==null?null:e.value.file.name," \u2014 ",e.value.type==="Other"?e.value.custom||"Other":e.value.type," ")}}function wn(i,t){if(i&1&&(o(0,"ul"),p(1,Sn,2,2,"li",69),r()),i&2){let e=d(2);l(),c("ngForOf",e.filesArray.controls)}}function En(i,t){i&1&&(o(0,"span",36),s(1,"No files uploaded"),r())}function Mn(i,t){if(i&1&&(o(0,"li"),s(1),r()),i&2){let e=t.$implicit,n=d(2);l(),Dt(" ",n.getBranchName(e.branchId)," \u2192 ",n.getDeptName(e.departmentId)," (",e.position,") ")}}function In(i,t){if(i&1){let e=x();o(0,"section")(1,"div",64)(2,"h3",65),s(3,"Summary"),r(),o(4,"div",66)(5,"div",67)(6,"dt"),s(7,"Username"),r(),o(8,"dd"),s(9),r(),o(10,"dt"),s(11,"ID Number"),r(),o(12,"dd"),s(13),r(),o(14,"dt"),s(15,"Emails"),r(),o(16,"dd"),s(17),r()(),o(18,"div",67)(19,"dt"),s(20,"Phones"),r(),o(21,"dd"),s(22),r(),o(23,"dt"),s(24,"Role"),r(),o(25,"dd"),s(26),r(),o(27,"dt"),s(28,"Files"),r(),o(29,"dd"),p(30,wn,2,1,"ul",68)(31,En,2,0,"ng-template",null,0,we),r()()(),o(33,"dt"),s(34,"Assignments"),r(),o(35,"dd")(36,"ul"),p(37,Mn,2,3,"li",69),r()()(),o(38,"div",22)(39,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(40,"Previous"),r(),o(41,"button",70),f("click",function(){u(e);let a=d();return _(a.submit())}),s(42,"Create User"),r()()()}if(i&2){let e=Se(32),n=d();l(9),v(n.form.value.username),l(4),v(n.form.value.idNumber||"\u2014"),l(4),v((n.form.value.emailAddresses==null?null:n.form.value.emailAddresses.join(", "))||"\u2014"),l(5),v((n.form.value.phoneNumbers==null?null:n.form.value.phoneNumbers.join(", "))||"\u2014"),l(4),v(n.form.value.role),l(4),c("ngIf",n.filesArray.length)("ngIfElse",e),l(7),c("ngForOf",n.assignments.value)}}var Xe=class i{constructor(t,e,n,a,m,g,y,ge,ai,dr){this.fb=t;this.userService=e;this.branchService=n;this.departmentService=a;this.roleService=m;this.auth=g;this.snackbar=y;this.cdr=ge;this.dialog=ai;this.router=dr}steps=["Basic","Contacts","Role","Branches and Departments Assignments","Files","Review"];step=0;maxStep=5;form;branches=[];departments=[];assignableRoles=[];hidePw=!0;hideConfirmPw=!0;files=[];previews=[];descriptionOptions=["ID","Passport","Signature","CV","Other"];get filesArray(){return this.form.get("files")}busy=!1;get assignments(){return this.form.get("departmentsAndPositions")}ngOnInit(){this.form=this.fb.group({username:["",w.required],idNumber:[""],emailAddresses:[[]],phoneNumbers:[[]],role:["",w.required],password:["",[w.required,w.minLength(8)]],confirmPassword:["",w.required],departmentsAndPositions:this.fb.array([]),files:this.fb.array([])},{validators:this.passwordValidator}),this.loadBranches(),this.loadDepts(),this.loadRoles(),this.addAssignment()}newFileGroup(t){let e=this.fb.group({file:[t],type:["ID",w.required],custom:[""]});return e.get("type").valueChanges.subscribe(n=>{let a=e.get("custom");n==="Other"?a?.setValidators([w.required,w.minLength(3)]):(a?.clearValidators(),a?.setValue("")),a?.updateValueAndValidity()}),e}get pwMismatch(){return this.form.get("confirmPassword")?.hasError("pwMismatch")}passwordValidator(t){let e=t.get("password").value,n=t.get("confirmPassword").value,a=t.get("confirmPassword");return!e||!n?(a?.setErrors(null),null):e!==n?(a?.setErrors({pwMismatch:!0}),{pwMismatch:!0}):(a?.setErrors(null),null)}validateEmailsPhones(){let t=this.form.get("emailAddresses").value||[],e=this.form.get("phoneNumbers").value||[],n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;for(let m of t)if(m&&!n.test(m))return this.snackbar.open(`Invalid email: ${m}`,"Close",{duration:1800}),!1;let a=/^\+?\d{7,15}$/;for(let m of e)if(m&&!a.test(m))return this.snackbar.open(`Invalid phone number: ${m}`,"Close",{duration:1800}),!1;return!0}validateAssignments(){let t=this.assignments.controls;for(let a=0;a<t.length;a++){let m=t[a].value;if(!m.branchId||!m.departmentId)return this.snackbar.open("Fill all assignment fields","Close",{duration:1800}),!1}let e=new Set;for(let a=0;a<t.length;a++){let m=t[a].value,g=`${m.branchId}::${m.departmentId}`;if(e.has(g))return this.snackbar.open("Duplicate branch/department assignment","Close",{duration:1800}),!1;e.add(g)}let n=new Map;for(let a=0;a<t.length;a++){let m=t[a].value,g=m.departmentId,y=(m.position||"").toLowerCase(),ge=n.get(g)||new Set;ge.add(y),n.set(g,ge)}for(let[a,m]of n.entries())if(m.has("head")&&m.has("member"))return this.snackbar.open("A department cannot have the same user as both Head and Member","Close",{duration:2e3}),!1;return!0}validateStep(t){switch(t){case 0:return this.form.get("username").valid;case 1:return this.validateEmailsPhones();case 2:let e=this.form.get("role").valid,n=!this.pwMismatch&&this.form.get("password").valid&&this.form.get("confirmPassword").valid;return e&&n;case 3:return this.validateAssignments();case 4:return!0;case 5:return!0;default:return!1}}loadBranches(){this.branchService.getAll(!1).pipe(xe(()=>ee([]))).subscribe(t=>{console.log(t),this.branches=t})}loadDepts(){this.departmentService.getAll(!1).pipe(xe(()=>ee([]))).subscribe(t=>{console.log(t),this.departments=t})}loadRoles(){this.roleService.list().pipe(xe(()=>ee([]))).subscribe(t=>{let e=t.map(g=>typeof g=="string"?g:g.name),n=["EMPLOYEE","SUPERVISOR","MANAGER","ADMIN","SUPERUSER"],a=this.auth.getSnapshot()?.role??"",m=n.indexOf(a);this.assignableRoles=e.filter(g=>n.indexOf(g)<=m)})}onEmailsChange(t){let n=t.target.value.split(",").map(a=>a.trim()).filter(a=>a.includes("@"));this.form.get("emailAddresses").setValue(n)}onPhonesChange(t){let n=t.target.value.split(",").map(a=>a.trim()).filter(a=>a.length>=7);this.form.get("phoneNumbers").setValue(n)}newAssignment(){return this.fb.group({branchId:["",w.required],departmentId:["",w.required],position:["member",w.required]})}addAssignment(){this.assignments.push(this.newAssignment())}removeAssignment(t){this.assignments.removeAt(t)}departmentsForBranch(t){return this.departments.filter(e=>e.branches?.some(n=>n.id===t))}getBranchName(t){return this.branches.find(e=>e.id===t)?.name}getDeptName(t){return this.departments.find(e=>e.id===t)?.name}openFilePicker(){document.getElementById("fileInput").click()}onFilesPicked(t){let e=t.target.files;if(e){for(let n=0;n<e.length;n++){let a=e.item(n);if(this.files.push(a),this.filesArray.push(this.newFileGroup(a)),a.type.startsWith("image/")){let m=new FileReader;m.onload=()=>{this.previews.push({src:m.result,name:a.name,type:a.type})},m.readAsDataURL(a)}else this.previews.push({name:a.name,type:a.type})}t.target.value=""}}removeFile(t){this.files.splice(t,1),this.previews.splice(t,1),this.filesArray.removeAt(t)}viewFile(t){this.dialog.open($t,{data:{file:this.files[t],preview:this.previews[t]},width:"80%",maxWidth:"1100px"})}next(){if(!this.validateStep(this.step)){this.snackbar.open("Please complete this step before continuing","Close",{duration:1800});return}this.step<this.maxStep&&this.step++}prev(){this.step>0&&this.step--}goTo(t){if(t<this.step){this.step=t;return}for(let e=0;e<t;e++)if(!this.validateStep(e)){this.snackbar.open("Please complete previous steps first","Close",{duration:1800});return}this.step=t}submit(){let t=new FormData;t.append("username",this.form.value.username),t.append("password",this.form.value.password),t.append("role",this.form.value.role),t.append("idNumber",this.form.value.idNumber),this.form.value.emailAddresses?.forEach((e,n)=>{t.append(`emailAddresses[${n}]`,e)}),this.form.value.phoneNumbers?.forEach((e,n)=>{t.append(`phoneNumbers[${n}]`,e)}),this.assignments.value.forEach((e,n)=>{t.append(`departmentsAndPositions[${n}].branchId`,e.branchId),t.append(`departmentsAndPositions[${n}].departmentId`,e.departmentId),t.append(`departmentsAndPositions[${n}].position`,e.position)}),this.filesArray.controls.forEach((e,n)=>{let a=e.value.file,m=e.value.type,g=e.value.custom;t.append(`userFiles[${n}].file`,a,a.name),t.append(`userFiles[${n}].description`,m==="Other"?g:m)}),this.busy=!0,this.userService.create(t).pipe(Ce(()=>this.busy=!1)).subscribe({next:()=>{this.snackbar.open("User created","Close",{duration:2e3}),this.router.navigate(["/users"])},error:()=>this.snackbar.open("Failed to create user","Close",{duration:2e3})})}static \u0275fac=function(e){return new(e||i)(h(De),h(U),h(j),h(q),h(Q),h(le),h(H),h(at),h(Oe),h(F))};static \u0275cmp=I({type:i,selectors:[["app-user-create"]],decls:18,vars:10,consts:[["noFiles",""],[1,"user-create-root",3,"formGroup"],[1,"wizard-header"],[1,"right"],["mat-stroked-button","",1,"cancel-button",3,"click"],["mat-flat-button","","color","primary",1,"save-button",3,"click","disabled"],[4,"ngIf"],[1,"create-body"],[1,"wizard-steps"],["class","step",3,"active","completed","click",4,"ngFor","ngForOf"],[1,"wizard-body"],[3,"formArrayName",4,"ngIf"],[1,"step",3,"click"],[1,"num"],[1,"label"],[1,"title"],["class","subtitle",4,"ngIf"],[1,"subtitle"],[1,"grid"],["appearance","fill"],["matInput","","formControlName","username","placeholder","e.g. j.smith"],["matInput","","formControlName","idNumber","placeholder","Optional"],[1,"nav"],["mat-stroked-button","",3,"click"],["appearance","fill",1,"w-full"],["matInput","","placeholder","alice@example.com, bob@acme.test",3,"change","value"],["matInput","","placeholder","0712xxxxxxx, +254712xxxxxx",3,"change","value"],["mat-stroked-button","","color","primary",3,"click"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","confirmPassword",3,"type"],[3,"value"],[1,"assignments"],["class","assignment-row",3,"formGroup",4,"ngFor","ngForOf"],[1,"muted"],[1,"assignment-row",3,"formGroup"],["appearance","fill",1,"col"],["formControlName","branchId",3,"selectionChange"],["formControlName","departmentId"],["appearance","fill",1,"col-fluid"],["formControlName","position"],["value","member"],["value","head"],["mat-icon-button","","color","warn",3,"click"],[3,"formArrayName"],[1,"files-section"],["id","fileInput","type","file","hidden","","multiple","","accept","image/*,application/pdf",3,"change"],[1,"preview-grid"],["class","preview-card",3,"formGroupName",4,"ngFor","ngForOf"],[1,"preview-card",3,"formGroupName"],[1,"thumb",3,"click"],[3,"src",4,"ngIf"],["class","pdf-placeholder",4,"ngIf"],[1,"meta"],[1,"filename"],["formControlName","type"],["appearance","fill",4,"ngIf"],[1,"card-actions"],["mat-button","",3,"click"],[3,"src"],[1,"pdf-placeholder"],["matInput","","formControlName","custom"],[1,"review-card"],[1,"summary-title"],[1,"summary-grid"],[1,"col"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,n){e&1&&(o(0,"div",1)(1,"header",2)(2,"div",3)(3,"button",4),f("click",function(){return n.router.navigate(["/users"])}),s(4," Cancel "),r(),o(5,"button",5),f("click",function(){return n.submit()}),p(6,on,2,0,"mat-icon",6),s(7," Save "),r()()(),o(8,"div",7)(9,"nav",8),p(10,sn,7,7,"div",9),r(),o(11,"main",10),p(12,ln,13,0,"section",6)(13,mn,14,2,"section",6)(14,pn,26,6,"section",6)(15,gn,12,1,"section",6)(16,yn,12,2,"section",11)(17,In,43,8,"section",6),r()()()),e&2&&(c("formGroup",n.form),l(5),c("disabled",n.busy),l(),c("ngIf",n.busy),l(4),c("ngForOf",n.steps),l(2),c("ngIf",n.step===0),l(),c("ngIf",n.step===1),l(),c("ngIf",n.step===2),l(),c("ngIf",n.step===3),l(),c("ngIf",n.step===4),l(),c("ngIf",n.step===5))},dependencies:[D,O,k,Ue,N,B,re,se,oe,ae,Ie,ke,ce,$,me,jt,Ht,pe,de,Y,G,V,R,A,L,T,P,z,Pe],styles:[".user-create-root[_ngcontent-%COMP%]{display:block;padding-top:0}.wizard-header[_ngcontent-%COMP%]{height:80px;position:sticky;top:0;z-index:50;background:var(--surface);border-bottom:1px solid var(--border);padding:12px 18px;display:flex;justify-content:flex-end;align-items:center;margin-top:0;box-shadow:2px 3px 5px 1px #00000040!important}.create-body[_ngcontent-%COMP%]{margin-top:10px;overflow-y:auto}.wizard-steps[_ngcontent-%COMP%]{margin-top:10px;background:var(--surface);display:flex;gap:12px;overflow-x:auto;padding:8px;box-shadow:1px 2px 3px #00000059!important}.step[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:10px;font-size:.9rem;padding:5px 10px;background:var(--surface);border:1px solid var(--border);border-radius:6px;cursor:pointer;box-shadow:1px 1px 1px 1px #0003!important;white-space:nowrap;width:auto;min-width:max-content;flex-shrink:0}.step[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{width:max-content}.step.active[_ngcontent-%COMP%]{background:#1a73e824;border-color:#1a73e873;color:var(--success)}.step.active[_ngcontent-%COMP%]   .num[_ngcontent-%COMP%]{background:var(--active);color:#fff}.step.completed[_ngcontent-%COMP%]   .num[_ngcontent-%COMP%]{background:var(--success);color:#fff}.step.completed[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:var(--text-success)}.num[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;background:var(--surface-hover);display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:1px 1px 1px 1px #00000017!important}.cancel-button[_ngcontent-%COMP%]{margin-right:5px}.wizard-body[_ngcontent-%COMP%]{padding:32px 10px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.assignments[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.assignment-row[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.col[_ngcontent-%COMP%]{width:220px}.col-fluid[_ngcontent-%COMP%]{flex:1}.preview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}.preview-card[_ngcontent-%COMP%]{border:1px solid var(--border);background:var(--surface);border-radius:8px;overflow:hidden;display:flex;flex-direction:column}.thumb[_ngcontent-%COMP%]{height:160px;background:var(--surface-hover);display:flex;justify-content:center;align-items:center;cursor:pointer}.thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.pdf-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--text-secondary)}.meta[_ngcontent-%COMP%]{padding:12px;display:flex;flex-direction:column;gap:8px}.filename[_ngcontent-%COMP%]{font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:8px}.review-card[_ngcontent-%COMP%]{box-shadow:0 0 1px 1px #00000059!important;border-radius:8px;padding:20px;align-self:center}.summary-title[_ngcontent-%COMP%]{text-align:left;font-weight:500;font-size:1.2rem;margin-bottom:10px}.summary-grid[_ngcontent-%COMP%]{display:flex;gap:24px}dt[_ngcontent-%COMP%]{font-weight:700;margin-top:12px;color:var(--text-secondary)}.nav[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px}"]})};function Dn(i,t){if(i&1&&(o(0,"mat-option",18),s(1),r()),i&2){let e=t.$implicit;c("value",e.name),l(),b(" ",e.name," ")}}function Un(i,t){if(i&1&&(o(0,"mat-option",18),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),b(" ",e.name," ")}}function On(i,t){i&1&&(o(0,"mat-option",27),s(1," No departments for this branch "),r())}function Pn(i,t){if(i&1&&(o(0,"mat-option",18),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),b(" ",e.name," ")}}function Tn(i,t){if(i&1){let e=x();o(0,"div",19)(1,"mat-form-field",9)(2,"mat-label"),s(3,"Branch"),r(),o(4,"mat-select",20),p(5,Un,2,2,"mat-option",13),r()(),o(6,"mat-form-field",9)(7,"mat-label"),s(8,"Department"),r(),o(9,"mat-select",21),p(10,On,2,0,"mat-option",22)(11,Pn,2,2,"mat-option",13),r()(),o(12,"mat-form-field",9)(13,"mat-label"),s(14,"Position"),r(),o(15,"mat-select",23)(16,"mat-option",24),s(17,"Member"),r(),o(18,"mat-option",25),s(19,"Head"),r()()(),o(20,"button",26),f("click",function(){let a=u(e).index,m=d(2);return _(m.removeAssignment(a))}),o(21,"mat-icon"),s(22,"delete"),r()()()}if(i&2){let e=t.$implicit,n=d(2);c("formGroup",e),l(5),c("ngForOf",n.branches),l(5),c("ngIf",n.departmentsForBranch(e.get("branchId").value).length===0),l(),c("ngForOf",n.departmentsForBranch(e.get("branchId").value))}}function An(i,t){if(i&1){let e=x();o(0,"div",1)(1,"div",2)(2,"div")(3,"h2"),s(4,"Edit User"),r(),o(5,"div",3),s(6),r()(),o(7,"div",4)(8,"button",5),f("click",function(){u(e);let a=d();return _(a.cancel())}),s(9,"Cancel"),r(),o(10,"button",6),f("click",function(){u(e);let a=d();return _(a.submit())}),s(11," Save Changes "),r()()(),o(12,"form",7)(13,"mat-card")(14,"h3"),s(15,"Basic Information"),r(),o(16,"div",8)(17,"mat-form-field",9)(18,"mat-label"),s(19,"Username"),r(),C(20,"input",10),r(),o(21,"mat-form-field",9)(22,"mat-label"),s(23,"ID Number"),r(),C(24,"input",11),r()(),o(25,"mat-form-field",9)(26,"mat-label"),s(27,"Role"),r(),o(28,"mat-select",12),p(29,Dn,2,2,"mat-option",13),r()()(),o(30,"mat-card")(31,"h3"),s(32,"Contact"),r(),o(33,"mat-form-field",9)(34,"mat-label"),s(35,"Email Addresses"),r(),C(36,"input",14),r(),o(37,"mat-form-field",9)(38,"mat-label"),s(39,"Phone Numbers"),r(),C(40,"input",15),r()(),o(41,"mat-card")(42,"h3"),s(43,"Branch & Department Assignments"),r(),p(44,Tn,23,4,"div",16),o(45,"button",17),f("click",function(){u(e);let a=d();return _(a.addAssignment())}),o(46,"mat-icon"),s(47,"add"),r(),s(48," Add Assignment "),r()()()()}if(i&2){let e=d();l(6),b("Users / ",e.originalUsername," / Edit"),l(4),c("disabled",e.form.invalid),l(2),c("formGroup",e.form),l(17),c("ngForOf",e.roles),l(15),c("ngForOf",e.assignments.controls)}}var et=class i{constructor(t,e,n,a,m,g,y,ge){this.route=t;this.router=e;this.fb=n;this.userService=a;this.roleService=m;this.branchService=g;this.departmentService=y;this.snackbar=ge}form;originalUsername="";roles=[];branches=[];departments=[];ngOnInit(){let t=this.route.snapshot.paramMap.get("username");t&&(this.originalUsername=t,this.form=this.fb.group({username:["",w.required],idNumber:[""],role:["",w.required],emailsInput:[""],phonesInput:[""],departmentsAndPositions:this.fb.array([])}),this.roleService.list().subscribe(e=>this.roles=e),this.branchService.getAll().subscribe(e=>this.branches=e),this.departmentService.getAll().subscribe(e=>this.departments=e),this.userService.get(t).subscribe(e=>this.patchUser(e)))}get assignments(){return this.form.get("departmentsAndPositions")}addAssignment(t){let e=this.fb.group({branchId:[t?.branchId||"",w.required],departmentId:[t?.departmentId||"",w.required],position:[t?.position||"member",w.required]});e.get("branchId").valueChanges.subscribe(()=>{e.get("departmentId").reset()}),this.assignments.push(e)}removeAssignment(t){this.assignments.removeAt(t)}departmentsForBranch(t){return t?this.departments.filter(e=>e.branches?.some(n=>n.id===t)):[]}patchUser(t){this.form.patchValue({username:t.username,idNumber:t.idNumber,role:t.role,emailsInput:(t.emailAddresses||[]).join(", "),phonesInput:(t.phoneNumbers||[]).join(", ")}),this.assignments.clear(),t.branchHierarchy?.length&&this.hydrateAssignmentsFromHierarchy(t.branchHierarchy)}hydrateAssignmentsFromHierarchy(t){t.forEach(e=>{e.departments.forEach(n=>{this.addAssignment({branchId:e.branchId,departmentId:n.departmentId,position:n.position?.toLowerCase()==="head"?"head":"member"})})})}submit(){if(this.form.invalid)return;let t={username:this.form.value.username,idNumber:this.form.value.idNumber,role:this.form.value.role,emailAddresses:this.split(this.form.value.emailsInput),phoneNumbers:this.split(this.form.value.phonesInput),departmentsAndPositions:this.assignments.value};this.userService.update(this.originalUsername,t).subscribe({next:()=>{this.snackbar.open("User updated successfully","Close",{duration:2e3}),this.router.navigate(["/users",t.username])},error:()=>this.snackbar.open("Failed to update user","Close",{duration:3e3})})}cancel(){this.router.navigate(["/users",this.originalUsername])}split(t){return(t||"").split(",").map(e=>e.trim()).filter(Boolean)}static \u0275fac=function(e){return new(e||i)(h(Ee),h(F),h(De),h(U),h(Q),h(j),h(q),h(H))};static \u0275cmp=I({type:i,selectors:[["app-user-edit"]],decls:1,vars:1,consts:[["class","user-edit-root",4,"ngIf"],[1,"user-edit-root"],[1,"page-header"],[1,"breadcrumb"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"form-grid",3,"formGroup"],[1,"grid-2"],["appearance","fill"],["matInput","","formControlName","username"],["matInput","","formControlName","idNumber"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","emailsInput","placeholder","comma-separated"],["matInput","","formControlName","phonesInput","placeholder","comma-separated"],["class","assignment-row",3,"formGroup",4,"ngFor","ngForOf"],["mat-stroked-button","","type","button",3,"click"],[3,"value"],[1,"assignment-row",3,"formGroup"],["formControlName","branchId"],["formControlName","departmentId"],["disabled","",4,"ngIf"],["formControlName","position"],["value","member"],["value","head"],["mat-icon-button","","color","warn",3,"click"],["disabled",""]],template:function(e,n){e&1&&p(0,An,49,5,"div",0),e&2&&c("ngIf",n.form)},dependencies:[D,O,k,se,Me,N,B,re,oe,ae,Ke,We,ce,$,me,Y,G,V,pe,de,R,A,L,T,P,z],styles:[".user-edit-root[_ngcontent-%COMP%]{max-width:1100px;margin:auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600}.page-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.page-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}mat-card[_ngcontent-%COMP%]{padding:1rem}mat-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;font-weight:600}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}.assignment-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 160px auto;gap:.75rem;align-items:center;margin-bottom:.5rem}"]})};var oi=i=>({listImages:t=>i.listImages(t),listImageAudits:t=>i.imageAuditTarget(t),getImageBlob:(t,e,n)=>i.getUserImageBlob(t,e,n??!1),uploadImages:(t,e)=>i.uploadImages(t,e),softDeleteImage:(t,e)=>i.softDeleteImage(t,e),restoreImage:(t,e)=>i.restoreImage(t,e),hardDeleteImage:(t,e)=>i.hardDeleteImage(t,e)});function Rn(i,t){if(i&1&&(o(0,"div",3)(1,"mat-icon"),s(2,"history"),r(),o(3,"div",4)(4,"div",5),s(5),r(),o(6,"div",6),s(7),te(8,"date"),r(),o(9,"div",7),s(10),r()()()),i&2){let e=t.$implicit;l(5),v(e.action),l(2),ve(" ",ie(8,5,e.timestamp,"medium")," \u2014 by ",e.performedByUsername," "),l(3),ve(" ",e.oldValue||"\u2014"," \u2192 ",e.newValue||"\u2014"," ")}}function Fn(i,t){i&1&&(o(0,"div",8),s(1," No audit records "),r())}var tt=class i{constructor(t){this.userService=t}userId;audits=[];ngOnInit(){this.userId&&this.userService.auditsForUser(this.userId).subscribe(t=>this.audits=t||[])}static \u0275fac=function(e){return new(e||i)(h(U))};static \u0275cmp=I({type:i,selectors:[["app-user-audit-timeline"]],inputs:{userId:"userId"},decls:3,vars:2,consts:[[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],["class","muted",4,"ngIf"],[1,"timeline-item"],[1,"content"],[1,"title"],[1,"meta"],[1,"change"],[1,"muted"]],template:function(e,n){e&1&&(o(0,"div",0),p(1,Rn,11,8,"div",1)(2,Fn,2,0,"div",2),r()),e&2&&(l(),c("ngForOf",n.audits),l(),c("ngIf",!n.audits.length))},dependencies:[D,O,k,ne,T,P],styles:["[_nghost-%COMP%]{display:block}.timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px;padding:16px}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:12px;padding:12px;border:1px solid var(--border);border-radius:6px;background:var(--surface)}.timeline-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:20px;margin-top:2px}.timeline-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.timeline-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;font-size:.95rem}.timeline-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.timeline-item[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{font-size:.85rem}.muted[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}"]})};function Vn(i,t){i&1&&(o(0,"th",11),s(1," Time "),r())}function Nn(i,t){if(i&1&&(o(0,"td",12),s(1),te(2,"date"),r()),i&2){let e=t.$implicit,n=d();l(),b(" ",ie(2,1,e.timestamp,n.DATE_FORMAT)," ")}}function Bn(i,t){i&1&&(o(0,"th",11),s(1," Branch "),r())}function Ln(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),v(e.branchName)}}function jn(i,t){i&1&&(o(0,"th",11),s(1," Department "),r())}function Hn(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),v(e.departmentName)}}function zn(i,t){i&1&&(o(0,"th",11),s(1," Status "),r())}function $n(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),v(e.status)}}function Gn(i,t){i&1&&(o(0,"th",11),s(1," Method "),r())}function Yn(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),v(e.method)}}function qn(i,t){i&1&&C(0,"tr",13)}function Wn(i,t){i&1&&C(0,"tr",14)}function Kn(i,t){i&1&&(o(0,"div",15),s(1,` No rollcalls found
`),r())}var it=class i{constructor(t){this.userService=t}userId;displayedColumns=["time","branch","department","status","method"];rollcalls=[];DATE_FORMAT="dd/MM/yy, hh:mm a";ngOnInit(){this.userId&&(this.userService.getUserRollcalls(this.userId).subscribe(t=>this.rollcalls=t||[]),console.log(this.rollcalls))}static \u0275fac=function(e){return new(e||i)(h(U))};static \u0275cmp=I({type:i,selectors:[["app-user-rollcalls"]],inputs:{userId:"userId"},decls:19,vars:4,consts:[["mat-table","",1,"rollcall-table",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","branch"],["matColumnDef","department"],["matColumnDef","status"],["matColumnDef","method"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","muted",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"muted"]],template:function(e,n){e&1&&(o(0,"table",0),E(1,1),p(2,Vn,2,0,"th",2)(3,Nn,3,4,"td",3),M(),E(4,4),p(5,Bn,2,0,"th",2)(6,Ln,2,1,"td",3),M(),E(7,5),p(8,jn,2,0,"th",2)(9,Hn,2,1,"td",3),M(),E(10,6),p(11,zn,2,0,"th",2)(12,$n,2,1,"td",3),M(),E(13,7),p(14,Gn,2,0,"th",2)(15,Yn,2,1,"td",3),M(),p(16,qn,1,0,"tr",8)(17,Wn,1,0,"tr",9),r(),p(18,Kn,2,0,"div",10)),e&2&&(c("dataSource",n.rollcalls),l(16),c("matHeaderRowDef",n.displayedColumns),l(),c("matRowDefColumns",n.displayedColumns),l(),c("ngIf",!n.rollcalls.length))},dependencies:[D,k,ne,ze,Te,Re,Be,Fe,Ae,Le,Ve,Ne,je,He],styles:["[_nghost-%COMP%]{display:block}.rollcall-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:12px}.rollcall-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;font-weight:700;color:var(--text-secondary);padding:10px;border-bottom:1px solid var(--border)}.rollcall-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;font-size:.85rem;border-bottom:1px solid var(--border)}.rollcall-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:var(--surface-hover)}.muted[_ngcontent-%COMP%]{margin-top:16px;font-size:.85rem;color:var(--text-secondary)}"]})};function Qn(i,t){if(i&1&&(o(0,"div",22),s(1),r()),i&2){let e=d(2);l(),b(" ",e.user.id," ")}}function Zn(i,t){if(i&1){let e=x();o(0,"button",25),f("click",function(){u(e);let a=d(3);return _(a.toggleUser())}),o(1,"mat-icon"),s(2),r(),s(3),r()}if(i&2){let e=d(3);c("color",e.user.deleted?"primary":"warn"),l(2),b(" ",e.user.deleted?"restore":"block"," "),l(),b(" ",e.user.deleted?"Restore":"Disable"," ")}}function Jn(i,t){if(i&1&&(o(0,"div",23),p(1,Zn,4,3,"button",24),r()),i&2){let e=d(2);l(),c("ngIf",e.canManageUser())}}function Xn(i,t){if(i&1&&(o(0,"div"),s(1),r()),i&2){let e=t.$implicit;l(),v(e)}}function er(i,t){if(i&1&&(o(0,"div"),s(1),r()),i&2){let e=t.$implicit;l(),v(e)}}function tr(i,t){if(i&1&&(o(0,"li")(1,"span",29),s(2),r(),o(3,"span",30),s(4),r()()),i&2){let e=t.$implicit;l(2),v(e.departmentName),l(2),v(e.position)}}function ir(i,t){if(i&1&&(o(0,"div",26)(1,"div",27),s(2),r(),o(3,"ul",28),p(4,tr,5,2,"li",18),r()()),i&2){let e=t.$implicit;l(2),v(e.branchName),l(2),c("ngForOf",e.departments)}}function nr(i,t){if(i&1&&(s(0," Documents "),o(1,"span",33),s(2),r()),i&2){let e=d(3);l(2),v(e.imageCount)}}function rr(i,t){if(i&1&&(o(0,"mat-tab"),p(1,nr,3,1,"ng-template",31),C(2,"app-entity-image-manager",32),r()),i&2){let e=d(2);l(2),c("entityId",e.user.id)("adapter",e.imageAdapter)("allowHardDelete",e.role==="SUPERUSER")}}function or(i,t){if(i&1&&(s(0," Audits "),o(1,"span",33),s(2),r()),i&2){let e=d(3);l(2),v(e.auditCount)}}function ar(i,t){if(i&1&&(o(0,"mat-tab"),p(1,or,3,1,"ng-template",31),C(2,"app-user-audit-timeline",34),r()),i&2){let e=d(2);l(2),c("userId",e.user.id)}}function sr(i,t){if(i&1&&(s(0," Rollcalls "),o(1,"span",33),s(2),r()),i&2){let e=d(3);l(2),v(e.rollcallCount)}}function lr(i,t){if(i&1&&(o(0,"mat-tab"),p(1,sr,3,1,"ng-template",31),C(2,"app-user-rollcalls",34),r()),i&2){let e=d(2);l(2),c("userId",e.user.id)}}function mr(i,t){if(i&1){let e=x();o(0,"div",2)(1,"div",3)(2,"div")(3,"h2"),s(4,"User Profile"),r(),o(5,"div",4),s(6),r()(),o(7,"button",5),f("click",function(){u(e);let a=d();return _(a.editUser())}),o(8,"mat-icon"),s(9,"edit"),r(),s(10," Edit "),r()(),o(11,"div",6)(12,"mat-card",7)(13,"div",8),s(14),r(),p(15,Qn,2,1,"div",9),o(16,"div",10),s(17),r(),o(18,"div",11),s(19),r(),p(20,Jn,2,1,"div",12),r(),o(21,"div",13)(22,"mat-tab-group",14)(23,"mat-tab",15)(24,"mat-card",16)(25,"h3"),s(26,"Profile"),r(),o(27,"div",17)(28,"div")(29,"label"),s(30,"ID Number"),r(),o(31,"div"),s(32),r()(),o(33,"div")(34,"label"),s(35,"Role"),r(),o(36,"div"),s(37),r()(),o(38,"div")(39,"label"),s(40,"Emails"),r(),p(41,Xn,2,1,"div",18),r(),o(42,"div")(43,"label"),s(44,"Phones"),r(),p(45,er,2,1,"div",18),r(),o(46,"div")(47,"label"),s(48,"Status"),r(),o(49,"div"),s(50),r()(),o(51,"div",19)(52,"label"),s(53,"Branches & Departments"),r(),p(54,ir,5,2,"div",20),r()()()(),p(55,rr,3,3,"mat-tab",21)(56,ar,3,1,"mat-tab",21)(57,lr,3,1,"mat-tab",21),r()()()()}if(i&2){let e=d();l(6),b("Users / ",e.user.username,""),l(8),v(e.initials()),l(),c("ngIf",e.canViewUserId()),l(2),v(e.user.username),l(),he("deleted",e.user.deleted),l(),b(" ",e.user.deleted?"DISABLED":e.user.role," "),l(),c("ngIf",e.canManageUser()),l(12),v(e.user.idNumber||"\u2014"),l(5),v(e.user.role),l(4),c("ngForOf",e.user.emailAddresses),l(4),c("ngForOf",e.user.phoneNumbers),l(5),v(e.status()),l(4),c("ngForOf",e.user.branchHierarchy),l(),c("ngIf",e.canViewImages()),l(),c("ngIf",e.canViewAudits()),l(),c("ngIf",e.canViewRollcalls())}}function cr(i,t){i&1&&(o(0,"div",35),s(1,"Loading user\u2026"),r())}var nt=class i{constructor(t,e,n,a,m,g){this.route=t;this.router=e;this.userService=n;this.auth=a;this.snackbar=m;this.entityAction=g}user;loading=!0;role="";auditCount=0;imageCount=0;rollcallCount=0;imageAdapter;actionConfig;ngOnInit(){let t=this.route.snapshot.paramMap.get("username");t&&(this.auth.getCurrentUser().subscribe(e=>{this.role=e?.role??""}),this.imageAdapter=oi(this.userService),this.userService.get(t).subscribe({next:e=>{this.user=e,this.loading=!1,this.initializeActionConfig(),this.loadCounts()},error:()=>{this.snackbar.open("Failed to load user","Close",{duration:3e3}),this.loading=!1}}))}initializeActionConfig(){this.actionConfig={entityName:"User",displayName:t=>t.username,disableReasons:K.DISABLE,restoreReasons:K.RESTORE,deleteReasons:K.DELETE,disable:(t,e)=>this.userService.softDelete(t,e),restore:(t,e)=>this.userService.restore(t,e),hardDelete:(t,e)=>this.userService.hardDelete(t,e),reload:()=>{this.userService.get(this.user.username).subscribe(t=>{this.user=t})}}}canViewImages(){return["ADMIN","SUPERUSER"].includes(this.role)}canViewAudits(){return["MANAGER","ADMIN","SUPERUSER"].includes(this.role)}canViewRollcalls(){return["SUPERVISOR","MANAGER","ADMIN","SUPERUSER"].includes(this.role)}canViewUserId(){return this.role==="SUPERUSER"}canManageUser(){return["ADMIN","SUPERUSER"].includes(this.role)}loadCounts(){this.canViewAudits()&&this.userService.auditsForUser(this.user.id).subscribe(t=>this.auditCount=t?.length||0),this.canViewImages()&&this.userService.listImages(this.user.id).subscribe(t=>this.imageCount=t?.length||0),this.canViewRollcalls()&&this.userService.getUserRollcalls(this.user.id).subscribe(t=>this.rollcallCount=t?.length||0)}initials(){return this.user.username.charAt(0).toUpperCase()}status(){return this.user.deleted?"DISABLED":"ACTIVE"}editUser(){this.router.navigate(["/users",this.user.username,"edit"])}toggleUser(){this.user&&this.entityAction.toggleSingle(this.user,this.actionConfig)}static \u0275fac=function(e){return new(e||i)(h(Ee),h(F),h(U),h(le),h(H),h(qe))};static \u0275cmp=I({type:i,selectors:[["app-user-details"]],decls:3,vars:2,consts:[["loadingTpl",""],["class","user-details-root",4,"ngIf","ngIfElse"],[1,"user-details-root"],[1,"page-header"],[1,"breadcrumb"],["mat-stroked-button","",3,"click"],[1,"content-grid"],[1,"identity-card"],[1,"avatar"],["class","user-id",4,"ngIf"],[1,"username"],[1,"role-chip"],["class","identity-actions",4,"ngIf"],[1,"details-column"],["dynamicHeight","",1,"user-tabs"],["label","Profile"],[1,"info-card"],[1,"info-grid"],[4,"ngFor","ngForOf"],[1,"col-span-2"],["class","branch-block",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"user-id"],[1,"identity-actions"],["mat-stroked-button","",3,"color","click",4,"ngIf"],["mat-stroked-button","",3,"click","color"],[1,"branch-block"],[1,"branch-name"],[1,"department-list"],[1,"dept-name"],[1,"dept-role"],["mat-tab-label",""],[3,"entityId","adapter","allowHardDelete"],[1,"badge"],[3,"userId"],[1,"loading"]],template:function(e,n){if(e&1&&p(0,mr,58,17,"div",1)(1,cr,2,0,"ng-template",null,0,we),e&2){let a=Se(2);c("ngIf",!n.loading)("ngIfElse",a)}},dependencies:[D,O,k,Ke,We,R,A,T,P,Zt,Wt,Kt,Qt,z,Gt,tt,it],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.4rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:280px 1fr;gap:16px}.identity-card[_ngcontent-%COMP%]{padding:24px;text-align:center}.identity-card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:50%;background:linear-gradient(135deg,#1a73e8,#4f9cff);color:#fff;font-size:2.2rem;font-weight:700;display:flex;align-items:center;justify-content:center;margin:0 auto 12px}.identity-card[_ngcontent-%COMP%]   .user-id[_ngcontent-%COMP%]{margin-top:6px;font-size:.7rem;color:var(--text-secondary);word-break:break-all}.identity-card[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600}.identity-card[_ngcontent-%COMP%]   .role-chip[_ngcontent-%COMP%]{margin-top:10px;display:inline-block;padding:4px 12px;border-radius:12px;font-size:.75rem;font-weight:700;background:#1a73e81f;color:#1a73e8}.identity-card[_ngcontent-%COMP%]   .role-chip.deleted[_ngcontent-%COMP%]{background:#dc262626;color:#dc2626}.identity-card[_ngcontent-%COMP%]   .identity-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;flex-direction:column;gap:8px;width:100%}.identity-card[_ngcontent-%COMP%]   .identity-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center;gap:6px;padding:6px 12px!important;min-height:36px;font-size:.85rem}.identity-card[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]{border-color:#ef4444!important;color:#ef4444!important}.identity-card[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]:hover{background:#ef444414!important}.details-column[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-tabs[_ngcontent-%COMP%]   .mat-mdc-tab-label[_ngcontent-%COMP%]{font-weight:600}.user-tabs[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{margin-left:6px;padding:2px 8px;border-radius:10px;font-size:.7rem;font-weight:700;background:#1a73e826;color:#1a73e8}.info-card[_ngcontent-%COMP%]{padding:18px}.info-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 12px;font-size:1rem;font-weight:600}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.info-grid[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:var(--text-secondary)}.branch-block[_ngcontent-%COMP%]{margin-top:10px;padding:10px 12px;border:1px solid var(--border);border-radius:6px;background:var(--surface-hover)}.branch-name[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem;margin-bottom:6px}.department-list[_ngcontent-%COMP%]{list-style:none;padding-left:12px;margin:0}.department-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:.85rem}.dept-role[_ngcontent-%COMP%]{font-size:.7rem;font-weight:700;padding:2px 8px;border-radius:10px;background:#1a73e81f;color:#1a73e8;text-transform:capitalize}.loading[_ngcontent-%COMP%]{padding:32px;text-align:center;color:var(--text-secondary)}@media (max-width: 900px){.content-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}']})};var Fa=[{path:"",canActivate:[Lt],children:[{path:"",component:Je},{path:"create",component:Xe},{path:":username/edit",component:et},{path:":username",component:nt}]}];export{Fa as USER_ROUTES};
