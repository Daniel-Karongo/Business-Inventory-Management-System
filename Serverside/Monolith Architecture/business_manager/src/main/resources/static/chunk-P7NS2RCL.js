import{a as it}from"./chunk-6PRU4GVW.js";import{a as tt}from"./chunk-EZ6T5JTH.js";import{a as et}from"./chunk-JZXEWDXN.js";import{a as Je,b as Xe,c as Ze}from"./chunk-U77Y5IN4.js";import"./chunk-UTOEPDRR.js";import{a as q}from"./chunk-LVP7ARRB.js";import{a as Ye}from"./chunk-CD2D6BMO.js";import{a as G,b as Qe,c as U,d as K}from"./chunk-TWWBRTKE.js";import{a as Re,b as Ae,c as ze,d as $e,e as je,f as He,g as Ge,h as Ue,i as Ke,j as qe,k as We}from"./chunk-I3US72OE.js";import"./chunk-N4J5OKMY.js";import{a as Ee,b as Ve}from"./chunk-YVNRBVUQ.js";import{a as De,c as Le}from"./chunk-MA6ZSKR6.js";import"./chunk-2JRABG3A.js";import"./chunk-T2UYCDC2.js";import"./chunk-PZ352SLY.js";import{b as B,c as F}from"./chunk-TLF4YXFY.js";import{a as Be}from"./chunk-SNZ3II6O.js";import{c as j,d as H}from"./chunk-CZGJLEOY.js";import{b as Fe,e as Ne,h as z,i as $}from"./chunk-J5IGF7DT.js";import"./chunk-SGYCFQGT.js";import{d as D,h as L,i as be,l as xe,m as we,n as ke,p as Pe,q as ye,r as Se,s as Me,w as Te,x as Ie}from"./chunk-D2WFNIGL.js";import"./chunk-AYMLXUSV.js";import{f as N,g as R,h as A}from"./chunk-SRBP6AOE.js";import{p as Ce}from"./chunk-AQVBCBXZ.js";import{d as ge,e as ve,h as he}from"./chunk-CSKLPVDL.js";import"./chunk-Z7QKINIM.js";import{a as Oe}from"./chunk-5DTMLZHP.js";import{$c as O,Bb as P,Ib as o,Jb as a,Kb as k,Lb as x,Mb as w,Ob as v,Qb as _,Qc as _e,Rb as p,Rc as E,Sc as V,Wb as ne,Wc as fe,Xb as re,Yb as ae,_a as te,ac as c,bb as l,bc as I,cc as f,dc as le,fc as ce,gb as C,gc as se,hc as de,kc as me,lc as b,mc as X,na as d,nb as T,nc as pe,oa as m,pc as ue,qb as ie,sb as g,yb as oe,zb as u}from"./chunk-KLCDKTJS.js";import{a as S,b as M,g as Y,h as J}from"./chunk-FJYW2LMB.js";var ot={title:"Bulk Import Products",confirmLabel:"Import Products",csvFileName:"products-bulk-template.csv",excelFileName:"products-bulk-template.xlsx",headers:["name","description","categoryName","supplierNames","variants","minimumPercentageProfit"],fields:[{name:"name",required:!0},{name:"description"},{name:"categoryName",required:!0},{name:"supplierNames"},{name:"variants",defaultValue:"STANDARD"},{name:"minimumPercentageProfit"}],previewColumns:[{key:"name",label:"Name"},{key:"categoryName",label:"Category"},{key:"variantNames",label:"Variants"},{key:"minimumPercentageProfit",label:"Min % Profit"}],excelSheetName:"Products",excelColumns:[{header:"name",key:"name",width:26},{header:"description",key:"description",width:36},{header:"categoryName",key:"categoryName",width:22},{header:"supplierNames",key:"supplierNames",width:30},{header:"variants",key:"variants",width:20},{header:"minimumPercentageProfit",key:"minimumPercentageProfit",width:18}],exampleRow:{name:"Milk 1L",description:"Fresh whole milk",categoryName:"Dairy",supplierNames:"Local Supplier",variants:"STANDARD",minimumPercentageProfit:15},emptyRow:{variants:"STANDARD"},emptyRowCount:200,defaultOptions:{dryRun:!0,skipDuplicates:!0},mapRowToItem(t){return{name:t.name,description:t.description,categoryName:t.categoryName,supplierNames:t.supplierNames?t.supplierNames.split(",").map(i=>i.trim()).filter(Boolean):[],variants:t.variants?t.variants.split(",").map(i=>i.trim()).filter(Boolean):["STANDARD"],minimumPercentageProfit:t.minimumPercentageProfit}},mapPreviewRow(t){return M(S({},t),{variantNames:Array.isArray(t.variants)?t.variants.map(i=>i.classification).filter(Boolean).join(", "):""})},submit(t){return null}};function vt(t,i){if(t&1&&(o(0,"div",19),c(1),a()),t&2){let e=p().$implicit;l(),f(" ",e.value._error," ")}}function ht(t,i){if(t&1){let e=v();o(0,"div",9)(1,"div",10)(2,"span"),c(3),a(),o(4,"button",11),_("click",function(){let r=d(e).index,s=p();return m(s.removeRow(r))}),o(5,"mat-icon"),c(6,"delete"),a()()(),o(7,"div",12)(8,"mat-form-field"),k(9,"input",13),a(),o(10,"mat-form-field"),k(11,"input",14),a()(),o(12,"div",12)(13,"mat-form-field"),k(14,"input",15),a(),o(15,"mat-form-field"),k(16,"input",16),a()(),o(17,"mat-form-field"),k(18,"input",17),a(),g(19,vt,2,1,"div",18),a()}if(t&2){let e=i.$implicit,n=i.index;u("formGroupName",n),l(3),f("Product ",n+1,""),l(16),u("ngIf",e.value._error)}}var W=class t extends Je{constructor(e,n,r,s,h){super();this.productService=e;this.categoryService=n;this.supplierService=r;this.submitEngine=s;this.dialogRef=h}config=ot;categories=[];suppliers=[];ngOnInit(){this.initForm(),this.loadMeta()}loadMeta(){Promise.all([this.categoryService.getAll("flat",!1).toPromise(),this.supplierService.getAll(!1).toPromise()]).then(([e,n])=>{this.categories=e||[],this.suppliers=n||[]})}submit(){if(this.form.invalid)return;let e={items:this.rows.controls.map(n=>this.config.mapRowToItem(n.value)),options:{dryRun:this.form.value.dryRun,skipDuplicates:!0}};this.submitEngine.execute({submitFn:n=>this.productService.bulkImport(n),payload:e,rows:this.rows.controls,dryRun:this.form.value.dryRun,title:this.config.title,confirmLabel:this.config.confirmLabel,columns:this.config.previewColumns,onErrorsApplied:n=>{this.cacheErrors(n),this.config.mapPreviewRow&&Array.isArray(n.data)&&(n.data=n.data.map(r=>this.config.mapPreviewRow(r)))},onFinalSuccess:()=>this.dialogRef.close(!0),onConfirmRetry:()=>{this.form.patchValue({dryRun:!1}),this.submit()}})}importExcel(e){return J(this,null,function*(){if(!e)return;let n=yield this.confirmMerge();n&&Y(t.prototype,this,"importExcelFile").call(this,e,void 0,n)})}importCsv(e){return J(this,null,function*(){if(!e)return;let n=yield this.confirmMerge();n&&Y(t.prototype,this,"importCsvFile").call(this,e,n)})}close(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||t)(C(q),C(it),C(et),C(Ze),C(De))};static \u0275cmp=T({type:t,selectors:[["app-product-bulk-import-dialog"]],features:[ie],decls:12,vars:8,consts:[["bottomAnchor",""],[3,"keydown.enter","formGroup"],[3,"importCsv","importExcel","downloadCsv","downloadExcel","submit","cancel","goToLine","goTop","goBottom","prevError","nextError","clearAll","exportCsv","exportExcel","title","rowCount","submitting","formInvalid","loading","progress"],[1,"products-body"],["bulk-options",""],["formControlName","dryRun"],["formArrayName","rows",1,"rows"],["class","row-card",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],[1,"row-card",3,"formGroupName"],[1,"row-header"],["mat-icon-button","","color","warn",3,"click"],[1,"grid-2"],["matInput","","placeholder","Name","formControlName","name"],["matInput","","placeholder","Category","formControlName","categoryName"],["matInput","","placeholder","Suppliers","formControlName","supplierNames"],["matInput","","placeholder","Variants","formControlName","variants"],["matInput","","type","number","placeholder","Minimum % Profit","formControlName","minimumPercentageProfit"],["class","row-error",4,"ngIf"],[1,"row-error"]],template:function(n,r){if(n&1){let s=v();o(0,"form",1),_("keydown.enter",function(y){return d(s),m(y.stopPropagation())}),o(1,"app-bulk-import-shell",2),_("importCsv",function(y){return d(s),m(r.importCsv(y))})("importExcel",function(y){return d(s),m(r.importExcel(y))})("downloadCsv",function(){return d(s),m(r.downloadCsvTemplate())})("downloadExcel",function(){return d(s),m(r.downloadExcelTemplate())})("submit",function(){return d(s),m(r.submit())})("cancel",function(){return d(s),m(r.close())})("goToLine",function(y){return d(s),m(r.goToLine(y))})("goTop",function(){return d(s),m(r.scrollToTop())})("goBottom",function(){return d(s),m(r.scrollToBottom())})("prevError",function(){return d(s),m(r.goToPreviousError())})("nextError",function(){return d(s),m(r.goToNextError())})("clearAll",function(){return d(s),m(r.clearRows())})("exportCsv",function(){return d(s),m(r.exportCsvCurrentRows())})("exportExcel",function(){return d(s),m(r.exportExcelCurrentRows())}),o(2,"div",3)(3,"div",4)(4,"mat-checkbox",5),c(5," Dry run (validate only) "),a()(),o(6,"div",6),g(7,ht,20,3,"div",7),a(),o(8,"button",8),_("click",function(){return d(s),m(r.addRow())}),c(9," + Add Product "),a(),k(10,"div",null,0),a()()()}n&2&&(u("formGroup",r.form),l(),u("title",r.config.title)("rowCount",r.rowCount)("submitting",r.submitting)("formInvalid",r.form.invalid)("loading",r.submitting||r.loading)("progress",r.progress),l(6),u("ngForOf",r.rows.controls))},dependencies:[O,E,V,Ie,we,D,ke,L,be,Pe,Me,ye,Se,Xe,$,z,H,j,K,U,A,R,N,F,B],styles:[".products-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.row-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:20px;background:var(--surface);display:flex;flex-direction:column;gap:16px}.row-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;border-bottom:1px dashed var(--border);padding-bottom:6px}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.mat-form-field[_ngcontent-%COMP%]{width:100%}.row-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.highlight-line[_ngcontent-%COMP%]{outline:2px solid #1976d2;outline-offset:4px;transition:outline .3s ease}"]})};var Ct=()=>[5,10,20,50,100],Q=t=>["/products",t],ee=t=>["/products",t,"edit"],Z=t=>({deleted:t}),rt=(t,i)=>({"text-green-400":t,"text-red-400":i}),bt=t=>({"row-selected":t});function xt(t,i){if(t&1){let e=v();o(0,"button",20),_("click",function(){d(e);let r=p();return m(r.toggleDensity())}),o(1,"mat-icon"),c(2,"format_line_spacing"),a()()}}function wt(t,i){if(t&1){let e=v();o(0,"button",21),_("click",function(){d(e);let r=p();return r.searchTerm="",m(r.applySearch())}),o(1,"mat-icon"),c(2,"close"),a()()}}function kt(t,i){if(t&1){let e=v();o(0,"button",29),_("click",function(){d(e);let r=p(2);return m(r.bulkSoftDelete())}),c(1," Soft Delete "),a()}}function Pt(t,i){if(t&1){let e=v();o(0,"button",30),_("click",function(){d(e);let r=p(2);return m(r.bulkRestore())}),c(1," Restore "),a()}}function yt(t,i){if(t&1){let e=v();o(0,"button",31),_("click",function(){d(e);let r=p(2);return m(r.bulkHardDelete())}),c(1," Hard Delete "),a()}}function St(t,i){t&1&&(o(0,"span",32),c(1," Mixed selection \u2014 cannot perform bulk action "),a())}function Mt(t,i){if(t&1){let e=v();o(0,"div",22)(1,"span",23),c(2),a(),g(3,kt,2,0,"button",24)(4,Pt,2,0,"button",25)(5,yt,2,0,"button",26)(6,St,2,0,"span",27),o(7,"button",28),_("click",function(){d(e);let r=p();return m(r.clearSelection())}),c(8," Cancel Selection "),a()()}if(t&2){let e=p();l(2),f(" ",e.selectedIds.size," selected "),l(),u("ngIf",e.bulkState==="active"),l(),u("ngIf",e.bulkState==="deleted"),l(),u("ngIf",e.bulkState==="deleted"),l(),u("ngIf",e.bulkState==="mixed")}}function Tt(t,i){if(t&1){let e=v();o(0,"img",47),_("error",function(){d(e);let r=p().$implicit,s=p(2);return m(s.onThumbnailError(r))}),a()}if(t&2){let e=p().$implicit;u("src",e.thumbnail,te)}}function It(t,i){t&1&&(o(0,"div",48)(1,"mat-icon"),c(2,"inventory_2"),a()())}function Et(t,i){if(t&1){let e=v();o(0,"div",35),_("click",function(){let r=d(e).$implicit,s=p(2);return m(s.toggleRowSelection(r))}),o(1,"div",36),_("click",function(r){let s=d(e).$implicit;return p(2).openImageViewer(s),m(r.stopPropagation())}),g(2,Tt,1,1,"img",37)(3,It,3,0,"div",38),a(),o(4,"div",39),c(5),a(),o(6,"div",40),c(7),a(),o(8,"div",41),c(9),a(),o(10,"div",42),c(11),a(),o(12,"div",43)(13,"button",44),_("click",function(){let r=d(e).$implicit,s=p(2);return m(s.createSale(r))}),o(14,"mat-icon"),c(15,"point_of_sale"),a()(),o(16,"button",45)(17,"mat-icon"),c(18,"visibility"),a()(),o(19,"button",46)(20,"mat-icon"),c(21,"edit"),a()()()()}if(t&2){let e=i.$implicit,n=p(2);P("compact",n.density==="compact")("comfortable",n.density==="comfortable")("deleted",e.deleted)("selected",n.selectedIds.has(e.id)),l(2),u("ngIf",e.thumbnail),l(),u("ngIf",!e.thumbnail),l(2),f(" ",e.name," "),l(2),f(" ",e.categoryName||"\u2014"," "),l(2),f(" SKU: ",e.sku||"\u2014"," "),l(2),le(" Variants: ",e.variants.length||0," \xB7 Suppliers: ",e.suppliers.length||0," "),l(5),u("routerLink",b(17,Q,e.id)),l(3),u("routerLink",b(19,ee,e.id))}}function Vt(t,i){if(t&1&&(o(0,"div",33),g(1,Et,22,21,"div",34),a()),t&2){let e=p();P("compact",e.density==="compact")("comfortable",e.density==="comfortable"),l(),u("ngForOf",e.products)}}function Ot(t,i){if(t&1){let e=v();o(0,"th",72)(1,"mat-checkbox",73),_("change",function(){d(e);let r=p(3);return m(r.masterToggle())}),a()()}if(t&2){let e=p(3);l(),u("checked",e.isAllSelected())("indeterminate",e.selectedIds.size>0&&!e.isAllSelected())}}function Dt(t,i){if(t&1){let e=v();o(0,"td",74)(1,"mat-checkbox",75),_("click",function(r){return d(e),m(r.stopPropagation())})("change",function(){let r=d(e).$implicit,s=p(3);return m(s.toggleRowSelection(r))}),a()()}if(t&2){let e=i.$implicit,n=p(3);l(),u("checked",n.selectedIds.has(e.id))}}function Lt(t,i){if(t&1){let e=v();o(0,"th",76),_("click",function(){d(e);let r=p(3);return m(r.sortBy("name"))}),o(1,"span",77),c(2," Name "),o(3,"mat-icon",78),c(4),a()()()}if(t&2){let e=p(3);l(4),f(" ",e.sortField==="name"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Bt(t,i){if(t&1&&(o(0,"td",74)(1,"a",79),c(2),a()()),t&2){let e=i.$implicit;l(),u("routerLink",b(3,Q,e.id))("state",b(5,Z,e.deleted)),l(),f(" ",e.name," ")}}function Ft(t,i){if(t&1){let e=v();o(0,"th",80),_("click",function(){d(e);let r=p(3);return m(r.sortBy("category"))}),o(1,"span",77),c(2," Category "),o(3,"mat-icon",78),c(4),a()()()}if(t&2){let e=p(3);l(4),f(" ",e.sortField==="category"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Nt(t,i){if(t&1&&(o(0,"td",74),c(1),a()),t&2){let e=i.$implicit;l(),f(" ",e.categoryName||"\u2014"," ")}}function Rt(t,i){t&1&&(o(0,"th",72),c(1," Variants "),a())}function At(t,i){if(t&1&&(o(0,"td",74),c(1),a()),t&2){let e=i.$implicit;l(),f(" ",(e.variants==null?null:e.variants.length)||0," ")}}function zt(t,i){if(t&1){let e=v();o(0,"th",81),_("click",function(){d(e);let r=p(3);return m(r.sortBy("sku"))}),o(1,"span",77),c(2," SKU "),o(3,"mat-icon",78),c(4),a()()()}if(t&2){let e=p(3);l(4),f(" ",e.sortField==="sku"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function $t(t,i){if(t&1&&(o(0,"td",74),c(1),a()),t&2){let e=i.$implicit;l(),f(" ",e.sku||"\u2014"," ")}}function jt(t,i){t&1&&(o(0,"th",72),c(1," Suppliers "),a())}function Ht(t,i){if(t&1&&(o(0,"td",74),c(1),a()),t&2){let e=i.$implicit;l(),f(" ",(e.suppliers==null?null:e.suppliers.length)||0," ")}}function Gt(t,i){if(t&1){let e=v();o(0,"th",82),_("click",function(){d(e);let r=p(3);return m(r.sortBy("deleted"))}),o(1,"span",77),c(2," Status "),o(3,"mat-icon",78),c(4),a()()()}if(t&2){let e=p(3);l(4),f(" ",e.sortField==="deleted"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Ut(t,i){if(t&1&&(o(0,"td",74)(1,"span",83),c(2),a()()),t&2){let e=i.$implicit;l(),u("ngClass",X(2,rt,!e.deleted,e.deleted)),l(),f(" ",e.deleted?"Disabled":"Active"," ")}}function Kt(t,i){if(t&1){let e=v();o(0,"th",84),_("click",function(){d(e);let r=p(3);return m(r.sortBy("updatedAt"))}),o(1,"span",77),c(2," Updated "),o(3,"mat-icon",78),c(4),a()()()}if(t&2){let e=p(3);l(4),f(" ",e.sortField==="updatedAt"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function qt(t,i){if(t&1&&(o(0,"td",74),c(1),pe(2,"date"),a()),t&2){let e=i.$implicit;l(),f(" ",ue(2,1,e.updatedAt,"medium")," ")}}function Wt(t,i){t&1&&(o(0,"th",72),c(1," Actions"),a()),t&2&&oe("aria-label","Product actions")}function Qt(t,i){if(t&1){let e=v();o(0,"td",74)(1,"button",44),_("click",function(r){let s=d(e).$implicit;return p(3).createSale(s),m(r.stopPropagation())}),o(2,"mat-icon"),c(3,"point_of_sale"),a()(),o(4,"button",85)(5,"mat-icon"),c(6,"visibility"),a()(),o(7,"button",86)(8,"mat-icon"),c(9,"edit"),a()()()}if(t&2){let e=i.$implicit;l(4),u("routerLink",b(4,Q,e.id))("state",b(6,Z,e.deleted)),l(3),u("routerLink",b(8,ee,e.id))("state",b(10,Z,e.deleted))}}function Yt(t,i){t&1&&k(0,"tr",87)}function Jt(t,i){if(t&1){let e=v();o(0,"tr",88),_("click",function(){let r=d(e).$implicit,s=p(3);return m(s.toggleRowSelection(r))}),a()}if(t&2){let e=i.$implicit,n=p(3);u("ngClass",b(1,bt,n.selectedIds.has(e.id)))}}function Xt(t,i){if(t&1&&(o(0,"div",52)(1,"table",53),x(2,54),g(3,Ot,2,2,"th",55)(4,Dt,2,1,"td",56),w(),x(5,57),g(6,Lt,5,1,"th",58)(7,Bt,3,7,"td",56),w(),x(8,59),g(9,Ft,5,1,"th",60)(10,Nt,2,1,"td",56),w(),x(11,61),g(12,Rt,2,0,"th",55)(13,At,2,1,"td",56),w(),x(14,62),g(15,zt,5,1,"th",63)(16,$t,2,1,"td",56),w(),x(17,64),g(18,jt,2,0,"th",55)(19,Ht,2,1,"td",56),w(),x(20,65),g(21,Gt,5,1,"th",66)(22,Ut,3,5,"td",56),w(),x(23,67),g(24,Kt,5,1,"th",68)(25,qt,3,4,"td",56),w(),x(26,69),g(27,Wt,2,1,"th",55)(28,Qt,10,12,"td",56),w(),g(29,Yt,1,0,"tr",70)(30,Jt,1,3,"tr",71),a()()),t&2){let e=p(2);l(),u("dataSource",e.products),l(28),u("matHeaderRowDef",e.displayedColumns),l(),u("matRowDefColumns",e.displayedColumns)}}function Zt(t,i){if(t&1){let e=v();o(0,"div",91),_("click",function(){let r=d(e).$implicit,s=p(3);return m(s.toggleRowSelection(r))}),o(1,"div",92)(2,"mat-checkbox",75),_("click",function(r){return d(e),m(r.stopPropagation())})("change",function(){let r=d(e).$implicit,s=p(3);return m(s.toggleRowSelection(r))}),a(),o(3,"div",93),c(4),a()(),o(5,"div",94),c(6),a(),o(7,"div",95)(8,"div")(9,"div",96),c(10,"SKU"),a(),o(11,"div",97),c(12),a()(),o(13,"div")(14,"div",96),c(15,"Variants"),a(),o(16,"div",97),c(17),a()(),o(18,"div")(19,"div",96),c(20,"Suppliers"),a(),o(21,"div",97),c(22),a()(),o(23,"div")(24,"div",96),c(25,"Status"),a(),o(26,"div",98),c(27),a()()(),o(28,"div",99)(29,"button",44),_("click",function(r){let s=d(e).$implicit;return p(3).createSale(s),m(r.stopPropagation())}),o(30,"mat-icon"),c(31,"point_of_sale"),a()(),o(32,"button",100),_("click",function(r){return d(e),m(r.stopPropagation())}),o(33,"mat-icon"),c(34,"visibility"),a()(),o(35,"button",101),_("click",function(r){return d(e),m(r.stopPropagation())}),o(36,"mat-icon"),c(37,"edit"),a()()()()}if(t&2){let e=i.$implicit,n=p(3);P("deleted",e.deleted)("selected",n.selectedIds.has(e.id)),l(2),u("checked",n.selectedIds.has(e.id)),l(2),f(" ",e.name," "),l(2),f(" ",e.categoryName||"\u2014"," "),l(6),I(e.sku),l(5),I(e.variants.length||0),l(5),I(e.suppliers.length||0),l(4),u("ngClass",X(14,rt,!e.deleted,e.deleted)),l(),f(" ",e.deleted?"Disabled":"Active"," "),l(5),u("routerLink",b(17,Q,e.id)),l(3),u("routerLink",b(19,ee,e.id))}}function ei(t,i){if(t&1&&(o(0,"div",89),g(1,Zt,38,21,"div",90),a()),t&2){let e=p(2);P("compact",e.density==="compact")("comfortable",e.density==="comfortable"),l(),u("ngForOf",e.products)("ngForTrackBy",e.trackById)}}function ti(t,i){if(t&1&&(o(0,"div",49),g(1,Xt,31,3,"div",50)(2,ei,2,6,"div",51),a()),t&2){let e=p();P("compact",e.density==="compact"),l(),u("ngIf",!e.isMobile),l(),u("ngIf",e.isMobile)}}var nt=class t{constructor(i,e,n,r,s){this.productService=i;this.snackbar=e;this.dialog=n;this.breakpoint=r;this.router=s}products=[];loading=!0;showDeleted=!1;filters={name:"",categoryIds:[],includeDeleted:!1};selectedIds=new Set;sortField=null;sortDir="asc";displayedColumns=["select","name","category","variants","sku","suppliers","status","updated","actions"];total=0;page=0;size=10;STORAGE_KEY="product_list_prefs";viewMode="table";density="compact";isMobile=!1;searchTerm="";searchTimeout;paginator;ngOnInit(){this.breakpoint.observe(["(max-width: 640px)"]).subscribe(i=>{this.isMobile=i.matches,this.isMobile?(this.viewMode="grid",this.density="comfortable"):(this.viewMode="table",this.density="compact")}),this.loadPreferences(),this.loadProducts()}loadProducts(){this.loading=!0;let i={page:this.page,size:this.size,includeDeleted:this.showDeleted};this.searchTerm?.trim()&&(i.keyword=this.searchTerm.trim()),this.sortField&&(i.sortBy=this.sortField,i.direction=this.sortDir),this.productService.getAdvanced(i).subscribe({next:e=>{this.products=(e.content||[]).map(n=>M(S({},n),{thumbnail:`${Oe.apiUrl}/products/${n.id}/thumbnail`})),this.total=e.totalElements||0,this.loading=!1},error:()=>{this.loading=!1}})}applySearch(){this.page=0,this.loadProducts()}onSearchChange(i){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.page=0,this.loadProducts()},300)}setView(i){this.viewMode=i,this.size=this.viewMode==="grid"?this.density==="compact"?24:12:this.density==="compact"?25:10,this.page=0,this.savePreferences(),this.loadProducts()}toggleDensity(){this.density=this.density==="compact"?"comfortable":"compact",this.size=this.viewMode==="grid"?this.density==="compact"?24:12:this.density==="compact"?25:10,this.page=0,this.savePreferences(),this.loadProducts()}createSale(i){this.router.navigate(["/sales/new"],{state:{inventorySeed:{productId:i.id,productName:i.name,variantId:null,branchId:null}}})}savePreferences(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify({viewMode:this.viewMode,density:this.density,size:this.size}))}loadPreferences(){let i=localStorage.getItem(this.STORAGE_KEY);if(!i)return;let e=JSON.parse(i);this.viewMode=e.viewMode??this.viewMode,this.density=e.density??this.density,this.size=e.size??this.size}get bulkState(){if(!this.selectedIds.size)return null;let i=this.products.filter(n=>this.selectedIds.has(n.id)),e=new Set(i.map(n=>n.deleted));return e.size>1?"mixed":e.has(!0)?"deleted":"active"}changePage(i){this.page=i.pageIndex,this.size=i.pageSize,this.loadProducts()}sortBy(i){this.sortField===i?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortField=i,this.sortDir="asc"),this.loadProducts()}toggleDeleted(){this.showDeleted=!this.showDeleted,this.loadProducts()}isAllSelected(){return this.products.every(i=>this.selectedIds.has(i.id))}masterToggle(){this.products.every(e=>this.selectedIds.has(e.id))?this.products.forEach(e=>this.selectedIds.delete(e.id)):this.products.forEach(e=>this.selectedIds.add(e.id))}toggleRowSelection(i){this.selectedIds.has(i.id)?this.selectedIds.delete(i.id):this.selectedIds.add(i.id)}trackById(i,e){return e.id}clearSelection(){this.selectedIds.clear()}onThumbnailError(i){i.thumbnail=void 0}openImageViewer(i){i.thumbnail&&this.dialog.open(Ye,{width:"90vw",maxWidth:"900px",panelClass:"file-viewer-dialog",data:{preview:{src:i.thumbnail,name:i.name,type:"image"}}})}bulkSoftDelete(){if(this.bulkState!=="active"){this.snackbar.open("Bulk delete failed \u2014 selected products have mixed or invalid status","Close",{duration:2500});return}let i=Array.from(this.selectedIds);this.productService.bulkSoftDelete(i).subscribe({next:()=>{this.snackbar.open("Products deleted","Close",{duration:2e3}),this.loadProducts()},error:()=>{this.snackbar.open("Bulk delete failed","Close",{duration:3e3})}})}bulkRestore(){if(this.bulkState!=="deleted"){this.snackbar.open("Cannot restore active products","Close",{duration:2e3});return}let i=Array.from(this.selectedIds);this.productService.bulkRestore(i).subscribe({next:()=>{this.snackbar.open("Products restored","Close",{duration:2e3}),this.loadProducts()},error:()=>{this.snackbar.open("Bulk restore failed","Close",{duration:3e3})}})}bulkHardDelete(){if(this.bulkState!=="deleted"){this.snackbar.open("Only deleted products can be permanently removed","Close",{duration:2500});return}let i=Array.from(this.selectedIds);this.productService.bulkHardDelete(i).subscribe({next:()=>{this.snackbar.open("Products permanently deleted","Close",{duration:2e3}),this.loadProducts()},error:()=>{this.snackbar.open("Bulk hard delete failed","Close",{duration:3e3})}})}openBulkImport(){this.dialog.open(W,{width:"1100px",maxWidth:"95vw",maxHeight:"90vh",autoFocus:!1}).afterClosed().subscribe(i=>{i===!0&&this.loadProducts()})}static \u0275fac=function(e){return new(e||t)(C(q),C(Be),C(Le),C(Ce),C(ge))};static \u0275cmp=T({type:t,selectors:[["app-product-list"]],viewQuery:function(e,n){if(e&1&&ne(G,5),e&2){let r;re(r=ae())&&(n.paginator=r.first)}},decls:30,vars:16,consts:[["page-header",""],[1,"product-header"],[1,"header-left"],["mat-icon-button","","matTooltip","Grid View",3,"click"],["mat-icon-button","","matTooltip","Table View",3,"click"],["mat-icon-button","","matTooltip","Toggle Density",3,"click",4,"ngIf"],[1,"header-right"],["mat-stroked-button","",3,"click"],["mat-flat-button","","routerLink","/products/create"],["page-toolbar","",1,"product-toolbar"],["appearance","fill",1,"search-field"],["matInput","",3,"ngModelChange","ngModel"],["matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],[3,"change","checked"],["page-content",""],["class","bulk-bar",4,"ngIf"],["class","product-grid",3,"compact","comfortable",4,"ngIf"],["class","table-wrapper",3,"compact",4,"ngIf"],[1,"shared-paginator"],["showFirstLastButtons","",3,"page","disabled","length","pageSize","pageSizeOptions"],["mat-icon-button","","matTooltip","Toggle Density",3,"click"],["matSuffix","","mat-icon-button","",3,"click"],[1,"bulk-bar"],[1,"bulk-count"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["class","bulk-error",4,"ngIf"],["mat-button","",1,"cancel-selection",3,"click"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"bulk-error"],[1,"product-grid"],["class","product-card",3,"compact","comfortable","deleted","selected","click",4,"ngFor","ngForOf"],[1,"product-card",3,"click"],[1,"card-thumb",3,"click"],["loading","lazy","class","product-thumb",3,"src","error",4,"ngIf"],["class","thumb-placeholder",4,"ngIf"],[1,"card-title"],[1,"card-sub"],[1,"card-sub","text-xs"],[1,"card-meta"],[1,"card-actions"],["mat-icon-button","","matTooltip","Create Sale",3,"click"],["mat-icon-button","","matTooltip","View",3,"routerLink"],["mat-icon-button","","matTooltip","Edit",3,"routerLink"],["loading","lazy",1,"product-thumb",3,"error","src"],[1,"thumb-placeholder"],[1,"table-wrapper"],["class","overflow-x-auto",4,"ngIf"],["class","stacked-wrapper",3,"compact","comfortable",4,"ngIf"],[1,"overflow-x-auto"],["mat-table","",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","class","sortable","matTooltip","Sort by name","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","category"],["mat-header-cell","","class","sortable","matTooltip","Sort by category","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","variants"],["matColumnDef","sku"],["mat-header-cell","","class","sortable","matTooltip","Sort by sku code","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","suppliers"],["matColumnDef","status"],["mat-header-cell","","class","sortable","matTooltip","Sort by status","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","updated"],["mat-header-cell","","class","sortable","matTooltip","Sort by date of last update","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable-row",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"click","change","checked"],["mat-header-cell","","matTooltip","Sort by name","matTooltipPosition","above",1,"sortable",3,"click"],[1,"sortable-content"],[1,"sort-icon"],[1,"text-blue-600","hover:underline",3,"routerLink","state"],["mat-header-cell","","matTooltip","Sort by category","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by sku code","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by status","matTooltipPosition","above",1,"sortable",3,"click"],[3,"ngClass"],["mat-header-cell","","matTooltip","Sort by date of last update","matTooltipPosition","above",1,"sortable",3,"click"],["mat-icon-button","","matTooltip","View Product",3,"routerLink","state"],["mat-icon-button","","matTooltip","Edit Product",3,"routerLink","state"],["mat-header-row",""],["mat-row","",1,"clickable-row",3,"click","ngClass"],[1,"stacked-wrapper"],["class","stacked-row",3,"deleted","selected","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"stacked-row",3,"click"],[1,"stacked-top"],[1,"stacked-title"],[1,"stacked-sub"],[1,"stacked-grid"],[1,"label"],[1,"value"],[1,"value",3,"ngClass"],[1,"stacked-actions"],["mat-icon-button","","matTooltip","View",3,"click","routerLink"],["mat-icon-button","","matTooltip","Edit",3,"click","routerLink"]],template:function(e,n){e&1&&(o(0,"app-page-shell")(1,"div",0)(2,"div",1)(3,"div",2)(4,"button",3),_("click",function(){return n.setView("grid")}),o(5,"mat-icon"),c(6,"grid_view"),a()(),o(7,"button",4),_("click",function(){return n.setView("table")}),o(8,"mat-icon"),c(9,"table_rows"),a()(),g(10,xt,3,0,"button",5),a(),o(11,"div",6)(12,"button",7),_("click",function(){return n.openBulkImport()}),c(13," Bulk Import "),a(),o(14,"button",8),c(15," + Create Product "),a()()()(),o(16,"div",9)(17,"mat-form-field",10)(18,"mat-label"),c(19,"Search name, category or SKU"),a(),o(20,"input",11),de("ngModelChange",function(s){return se(n.searchTerm,s)||(n.searchTerm=s),s}),_("ngModelChange",function(s){return n.onSearchChange(s)}),a(),g(21,wt,3,0,"button",12),a(),o(22,"mat-checkbox",13),_("change",function(){return n.toggleDeleted()}),c(23," Show deleted "),a()(),o(24,"div",14),g(25,Mt,9,5,"div",15)(26,Vt,2,5,"div",16)(27,ti,3,4,"div",17),o(28,"div",18)(29,"mat-paginator",19),_("page",function(s){return n.changePage(s)}),a()()()()),e&2&&(l(4),P("active",n.viewMode==="grid"),l(3),P("active",n.viewMode==="table"),l(3),u("ngIf",!n.isMobile),l(10),ce("ngModel",n.searchTerm),l(),u("ngIf",n.searchTerm),l(),u("checked",n.showDeleted),l(3),u("ngIf",n.selectedIds.size>0),l(),u("ngIf",!n.loading&&n.viewMode==="grid"),l(),u("ngIf",!n.loading&&n.viewMode==="table"),l(2),u("disabled",n.loading)("length",n.total)("pageSize",n.size)("pageSizeOptions",me(15,Ct)))},dependencies:[O,_e,E,V,fe,he,ve,tt,We,Re,ze,Ge,$e,Ae,Ue,je,He,Ke,qe,K,U,A,R,N,F,B,Qe,G,Ve,Ee,$,z,Fe,Ne,Te,D,L,xe,H,j],styles:["[_nghost-%COMP%]     [page-header]{width:100%;display:block}.product-header[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.header-left[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#3b82f626;border-radius:6px}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-left:auto;flex-wrap:wrap}.header-right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{white-space:nowrap}.product-toolbar[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap;align-items:center}.search-field[_ngcontent-%COMP%]{flex:1;min-width:260px}.bulk-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:.75rem 1rem;border-radius:6px;background:#60a5fa14;border:1px solid rgba(96,165,250,.35)}.bulk-count[_ngcontent-%COMP%]{font-weight:600;color:var(--active)}.bulk-error[_ngcontent-%COMP%]{color:#c62828;font-weight:600}.cancel-selection[_ngcontent-%COMP%]{margin-left:auto;font-weight:500;color:var(--text-secondary)}.product-grid[_ngcontent-%COMP%]{display:grid;gap:1.25rem;grid-template-columns:1fr}@media (min-width: 640px){.product-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 1024px){.product-grid.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}.product-grid.comfortable[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.product-card[_ngcontent-%COMP%]{background:var(--surface);border:1px solid var(--border);border-radius:10px;display:flex;flex-direction:column;gap:.75rem;transition:transform .15s ease,box-shadow .15s ease}.product-card.selected[_ngcontent-%COMP%]{border:2px solid var(--active);background:#60a5fa14}.card-thumb[_ngcontent-%COMP%]{aspect-ratio:1/1;overflow:hidden;border-radius:8px;background:var(--surface-hover)}.product-thumb[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:8px;aspect-ratio:1/1;transition:transform .15s ease}.product-card[_ngcontent-%COMP%]:hover   .product-thumb[_ngcontent-%COMP%]{transform:scale(1.03)}.product-card.compact[_ngcontent-%COMP%]{padding:.75rem;gap:.5rem}.product-card.compact[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:.9rem}.product-card.compact[_ngcontent-%COMP%]   .card-sub[_ngcontent-%COMP%], .product-card.compact[_ngcontent-%COMP%]   .card-meta[_ngcontent-%COMP%]{font-size:.75rem}.product-card.compact[_ngcontent-%COMP%]   .card-thumb[_ngcontent-%COMP%]{height:90px}.product-card.compact[_ngcontent-%COMP%]   .thumb-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px}.product-card.comfortable[_ngcontent-%COMP%]{padding:1.25rem;gap:.85rem}.product-card.comfortable[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:1rem}.product-card.comfortable[_ngcontent-%COMP%]   .card-sub[_ngcontent-%COMP%], .product-card.comfortable[_ngcontent-%COMP%]   .card-meta[_ngcontent-%COMP%]{font-size:.85rem}.product-card.comfortable[_ngcontent-%COMP%]   .card-thumb[_ngcontent-%COMP%]{height:140px}.product-card.comfortable[_ngcontent-%COMP%]   .thumb-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:42px}.product-card.deleted[_ngcontent-%COMP%]{opacity:.65;border:1px solid #ef4444;background:#ef44440d}.product-card.deleted[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{text-decoration:line-through}.card-thumb[_ngcontent-%COMP%]{height:120px;display:flex;justify-content:center;align-items:center}.thumb-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;background:var(--surface-hover);border-radius:8px;display:flex;align-items:center;justify-content:center}.thumb-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;opacity:.4}.card-title[_ngcontent-%COMP%]{font-weight:600}.card-sub[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary)}.card-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.card-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;border-top:1px solid var(--border);padding-top:.5rem}.table-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.stacked-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.stacked-wrapper.compact[_ngcontent-%COMP%]   .stacked-row[_ngcontent-%COMP%]{padding:.75rem;gap:.5rem}.stacked-wrapper.comfortable[_ngcontent-%COMP%]   .stacked-row[_ngcontent-%COMP%]{padding:1rem;gap:.85rem}.stacked-row[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;background:var(--surface);display:flex;flex-direction:column;transition:all .15s ease}.stacked-row[_ngcontent-%COMP%]:hover{transform:translate(2px);background:var(--surface-hover);cursor:pointer}.stacked-row.selected[_ngcontent-%COMP%]{background:#007aff14;border-left:4px solid #007aff}.stacked-row.deleted[_ngcontent-%COMP%]{opacity:.65;border:1px solid #ef4444;background:#ef44440d}.stacked-row.deleted[_ngcontent-%COMP%]   .stacked-title[_ngcontent-%COMP%]{text-decoration:line-through}.stacked-top[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.stacked-title[_ngcontent-%COMP%]{font-weight:600}.stacked-sub[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary)}.stacked-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem}.label[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-secondary)}.value[_ngcontent-%COMP%]{font-weight:500}.stacked-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;border-top:1px solid var(--border);padding-top:.5rem}.table-wrapper.compact[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]{height:32px}.table-wrapper.compact[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%], .table-wrapper.compact[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{padding-top:2px!important;padding-bottom:2px!important;font-size:.82rem}.table-wrapper[_ngcontent-%COMP%]:not(.compact)   .mat-mdc-row[_ngcontent-%COMP%]{height:48px}.shared-paginator[_ngcontent-%COMP%]{margin-top:2rem;display:flex;justify-content:center}"]})};export{nt as ProductListComponent};
