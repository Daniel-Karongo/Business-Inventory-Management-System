import{a as Q,b as X}from"./chunk-4DCSEN5G.js";import{a as z}from"./chunk-H4RIMRIV.js";import{a as j}from"./chunk-MS5I24WJ.js";import{a as B}from"./chunk-RUIAFSGF.js";import{a as J,b as K}from"./chunk-H37LQHOQ.js";import{d as C}from"./chunk-DF6WYVPK.js";import{b as N,c as A}from"./chunk-F3TBVMOI.js";import{a as R,b as G}from"./chunk-BIVTK5YB.js";import{c as $,d as H}from"./chunk-ZFWGKVXC.js";import{a as W}from"./chunk-CONPK5ZF.js";import{b as Y,e as U,h as V}from"./chunk-3ZV2DC5Q.js";import{d as k,f as u,h as w,i as O,p as F,s as P,v as E,x as L}from"./chunk-Z2GGFO6C.js";import{f as T,g as q,h as D}from"./chunk-TENNXE3V.js";import{b as S,d as I}from"./chunk-VUFC7WNX.js";import{I as v,Ib as t,Jb as i,Kb as p,Lb as g,Mb as h,Qb as d,Tc as M,Uc as y,ac as o,bb as a,bd as _,cc as c,da as m,nb as x,sb as f,zb as s}from"./chunk-3DYKM6ZU.js";function ee(l,r){if(l&1&&(t(0,"mat-option",20),o(1),i()),l&2){let n=r.$implicit;s("value",n.id),a(),c(" ",n.name," ")}}function te(l,r){l&1&&(g(0),o(1,"Sign in"),h())}function ie(l,r){l&1&&(g(0),p(1,"mat-progress-spinner",21),h())}var Z=class l{fb=m(E);auth=m(B);router=m(I);branchService=m(j);snack=m(R);route=m(S);idle=m(z);form=this.fb.nonNullable.group({identifier:["",u.required],password:["",u.required],branchId:["",u.required]});branches=[];hide=!0;loading=!1;currentYear=new Date().getFullYear();ngOnInit(){this.route.snapshot.queryParamMap.get("reason")==="idle"&&this.snack.open("You were logged out due to inactivity.","Close",{duration:4e3}),this.branchService.getAll().subscribe({next:r=>{this.branches=(Array.isArray(r)?r:[]).map(n=>({id:n.id??"",name:n.name??""}))},error:()=>{this.snack.open("Could not load branches","Close",{duration:3500})}})}onForgot(){this.router.navigate(["/auth/forgot-password"])}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading=!0;let r=this.form.value;this.auth.login(r).pipe(v(()=>this.loading=!1)).subscribe({next:n=>{this.snack.open("Login successful",void 0,{duration:1200}),console.log("Starting idle service..."),this.idle.start(),this.router.navigate(["/dashboard"])},error:n=>{let e=n?.error?.message||"Invalid login credentials";this.snack.open(e,"Close",{duration:5e3})}})}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=x({type:l,selectors:[["app-login"]],decls:37,vars:8,consts:[[1,"auth-root"],[1,"auth-card",3,"formGroup"],[1,"dialog-header"],[1,"logo"],[1,"dialog-title"],[1,"dialog-subtitle"],[1,"form-section"],[1,"form-grid"],["appearance","fill"],["matInput","","formControlName","identifier","autocomplete","username"],["matInput","","formControlName","password","autocomplete","current-password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["formControlName","branchId"],[3,"value",4,"ngFor","ngForOf"],[1,"forgot-row"],["mat-button","","type","button",3,"click"],[1,"dialog-footer"],["mat-flat-button","","color","primary",1,"primary-action",3,"click","disabled"],[4,"ngIf"],[1,"footer-note"],[3,"value"],["diameter","20","strokeWidth","3","mode","indeterminate"]],template:function(n,e){n&1&&(t(0,"div",0)(1,"div",1)(2,"header",2)(3,"div",3)(4,"span"),o(5,"BM"),i()(),t(6,"div",4),o(7,"Business Manager"),i(),t(8,"div",5),o(9," Log in to your account "),i()(),t(10,"section",6)(11,"div",7)(12,"mat-form-field",8)(13,"mat-label"),o(14,"Username"),i(),p(15,"input",9),i(),t(16,"mat-form-field",8)(17,"mat-label"),o(18,"Password"),i(),p(19,"input",10),t(20,"button",11),d("click",function(){return e.hide=!e.hide}),t(21,"mat-icon"),o(22),i()()(),t(23,"mat-form-field",8)(24,"mat-label"),o(25,"Branch"),i(),t(26,"mat-select",12),f(27,ee,2,2,"mat-option",13),i()()(),t(28,"div",14)(29,"button",15),d("click",function(){return e.onForgot()}),o(30," Forgot password? "),i()()(),t(31,"footer",16)(32,"button",17),d("click",function(){return e.onSubmit()}),f(33,te,2,0,"ng-container",18)(34,ie,2,0,"ng-container",18),i()(),t(35,"div",19),o(36),i()()()),n&2&&(a(),s("formGroup",e.form),a(18),s("type",e.hide?"password":"text"),a(3),c(" ",e.hide?"visibility":"visibility_off"," "),a(5),s("ngForOf",e.branches),a(5),s("disabled",e.loading||e.form.invalid),a(),s("ngIf",!e.loading),a(),s("ngIf",e.loading),a(2),c(" \xA9 ",e.currentYear," Integrity Technologies "))},dependencies:[_,M,y,L,k,w,O,F,P,W,V,Y,U,H,$,K,J,C,D,q,T,A,N,X,Q,G],styles:['@charset "UTF-8";.auth-root[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--app-bg);padding:24px}.auth-card[_ngcontent-%COMP%]{width:100%;max-width:560px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:32px;box-shadow:0 12px 32px #00000014}.dialog-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;margin-bottom:28px}.logo[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;display:flex;align-items:center;justify-content:center;font-size:1.6rem;font-weight:700;letter-spacing:.5px;margin-bottom:20px;box-shadow:0 8px 20px #2563eb59,inset 0 0 0 1px #ffffff26}.dialog-title[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:600}.dialog-subtitle[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary)}.form-section[_ngcontent-%COMP%]{margin-top:16px}.form-grid[_ngcontent-%COMP%]{display:grid;gap:16px}.forgot-row[_ngcontent-%COMP%]{margin-top:8px;display:flex;justify-content:flex-end}.dialog-footer[_ngcontent-%COMP%]{margin-top:32px;display:flex;justify-content:center}.primary-action[_ngcontent-%COMP%]{min-width:200px;font-weight:600}.footer-note[_ngcontent-%COMP%]{margin-top:28px;text-align:center;font-size:.75rem;color:var(--text-secondary)}']})};export{Z as a};
