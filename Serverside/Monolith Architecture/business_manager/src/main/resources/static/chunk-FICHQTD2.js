import"./chunk-MS4AQ6UA.js";import{a as j,b as N}from"./chunk-H37LQHOQ.js";import{d as $}from"./chunk-DF6WYVPK.js";import"./chunk-MJONFXFY.js";import"./chunk-CONPK5ZF.js";import"./chunk-3ZV2DC5Q.js";import"./chunk-Z2GGFO6C.js";import"./chunk-75T6YVBZ.js";import{h as T}from"./chunk-TENNXE3V.js";import"./chunk-2X53NFZU.js";import{a as z}from"./chunk-5DTMLZHP.js";import{$b as M,Db as x,Ib as o,Jb as i,Kb as v,Ob as C,Qb as P,Rb as l,Tc as I,Uc as S,Xc as k,Z as h,ac as s,bb as r,bc as O,bd as A,cc as f,da as d,jd as F,ma as u,na as b,nb as _,pc as y,qc as E,sb as c,tc as w,zb as p}from"./chunk-3DYKM6ZU.js";import"./chunk-FJYW2LMB.js";var m=class n{http=d(F);base=`${z.apiUrl}/admin/acl`;endpoints(){return this.http.get(`${this.base}/endpoints`)}permissions(){return this.http.get(`${this.base}/permissions`)}reassign(t){return this.http.post(`${this.base}/endpoints`,t)}remove(t){return this.http.delete(`${this.base}/endpoints/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};function H(n,t){if(n&1&&(o(0,"mat-option",14),s(1),i()),n&2){let e=t.$implicit;p("value",e.id),r(),f(" ",e.code," ")}}function L(n,t){if(n&1){let e=C();o(0,"tr")(1,"td",7)(2,"span"),y(3,"lowercase"),s(4),i()(),o(5,"td",8)(6,"code"),s(7),i()(),o(8,"td",9)(9,"mat-select",12),P("selectionChange",function(g){let R=u(e).$implicit,V=l(2);return b(V.changePermission(R,g.value))}),c(10,H,2,2,"mat-option",13),i()()()}if(n&2){let e=t.$implicit,a=l(2);r(2),x("method-pill ",E(3,7,e.httpMethod),""),r(2),f(" ",e.httpMethod," "),r(3),O(e.path),r(2),p("value",e.permission.id),r(),p("ngForOf",a.permissions)}}function U(n,t){if(n&1&&(o(0,"tbody"),c(1,L,11,9,"tr",11),i()),n&2){let e=l();r(),p("ngForOf",e.endpoints)}}function q(n,t){n&1&&(o(0,"tr")(1,"td",15)(2,"div",16),v(3,"div",17),s(4," Resolving endpoint \u2192 permission mappings\u2026 "),i()()())}var D=class n{svc=d(m);endpoints=[];permissions=[];loadingEndpoints=!0;loadingPermissions=!0;ngOnInit(){this.load()}load(){this.loadingEndpoints=!0,this.loadingPermissions=!0,this.svc.endpoints().subscribe(t=>{this.endpoints=t,this.loadingEndpoints=!1}),this.svc.permissions().subscribe(t=>{this.permissions=t.sort((e,a)=>e.code.localeCompare(a.code)),this.loadingPermissions=!1})}changePermission(t,e){this.svc.remove(t.id).subscribe(()=>{this.svc.reassign({endpointId:t.id,permissionId:e}).subscribe(()=>this.load())})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=_({type:n,selectors:[["app-acl-endpoint-permissions"]],decls:20,vars:2,consts:[["loadingState",""],[1,"endpoint-surface"],[1,"endpoint-header"],[1,"section-title"],[1,"section-subtitle"],[1,"endpoint-table-wrapper"],[1,"endpoint-table"],[1,"col-method"],[1,"col-path"],[1,"col-permission"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[1,"permission-select",3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["colspan","3"],[1,"progress-block"],[1,"progress-inline"]],template:function(e,a){if(e&1&&(o(0,"div",1)(1,"div",2)(2,"div")(3,"h2",3),s(4,"Endpoint \u2192 Permission Mapping"),i(),o(5,"p",4),s(6," Control which permission guards each API endpoint "),i()()(),o(7,"div",5)(8,"table",6)(9,"thead")(10,"tr")(11,"th",7),s(12,"Method"),i(),o(13,"th",8),s(14,"Path"),i(),o(15,"th",9),s(16,"Permission"),i()()(),c(17,U,2,1,"tbody",10)(18,q,5,0,"ng-template",null,0,w),i()()()),e&2){let g=M(19);r(17),p("ngIf",!a.loadingEndpoints&&!a.loadingPermissions)("ngIfElse",g)}},dependencies:[A,I,S,k,N,j,$,T],styles:[".endpoint-surface[_ngcontent-%COMP%]{background:var(--surface);border-radius:10px;padding:16px;box-shadow:var(--surface-shadow)}.endpoint-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:12px}.section-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600}.section-subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary)}.endpoint-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;border:1px solid var(--border);border-radius:8px}.endpoint-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.endpoint-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:10px 12px;font-size:.75rem;text-transform:uppercase;letter-spacing:.04em;color:var(--text-secondary);background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10}.endpoint-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .08s ease}.endpoint-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:var(--surface-hover)}.endpoint-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:middle}.col-method[_ngcontent-%COMP%]{width:90px}.col-path[_ngcontent-%COMP%], .col-permission[_ngcontent-%COMP%]{width:45%}.method-pill[_ngcontent-%COMP%]{display:inline-block;min-width:56px;text-align:center;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:700;letter-spacing:.04em}.method-pill.get[_ngcontent-%COMP%]{background:#22c55e2e;color:#15803d}.method-pill.post[_ngcontent-%COMP%]{background:#3b82f62e;color:#1d4ed8}.method-pill.patch[_ngcontent-%COMP%]{background:#eab30838;color:#92400e}.method-pill.delete[_ngcontent-%COMP%]{background:#ef444438;color:#991b1b}.col-path[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:.82rem;background:var(--surface-hover);padding:2px 6px;border-radius:4px}.permission-select[_ngcontent-%COMP%]{width:100%}.permission-select[_ngcontent-%COMP%]   .mat-mdc-select-trigger[_ngcontent-%COMP%]{font-size:.8rem}"]})};export{D as AclEndpointPermissionsComponent};
