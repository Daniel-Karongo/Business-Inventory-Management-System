import{a as X}from"./chunk-U5YT4ZGI.js";import{a as Y}from"./chunk-22FAI265.js";import{a as Q,b as W}from"./chunk-4DCSEN5G.js";import{a as H,b as K}from"./chunk-H37LQHOQ.js";import{d as N}from"./chunk-DF6WYVPK.js";import{c as U,d as z}from"./chunk-ZFWGKVXC.js";import{a as R}from"./chunk-CONPK5ZF.js";import{b as A,c as L,h as J}from"./chunk-3ZV2DC5Q.js";import{d as P,f as y,h as T,i as w,m as j,p as G,s as V,v as $,x as B}from"./chunk-Z2GGFO6C.js";import{g as k,h as q}from"./chunk-TENNXE3V.js";import{Ib as o,Jb as r,Kb as s,Ob as F,Qb as M,Rb as f,T as h,Tc as D,Uc as E,ac as m,bb as a,bd as O,cc as u,f as _,gb as c,ma as x,na as S,nb as I,sb as p,w as v,wa as b,zb as n}from"./chunk-3DYKM6ZU.js";import{a as C}from"./chunk-FJYW2LMB.js";function tt(e,i){e&1&&(o(0,"div",3),s(1,"mat-spinner",4),r())}function et(e,i){if(e&1&&(o(0,"div",5),m(1),r()),e&2){let t=f();a(),u(" ",t.error,`
`)}}function it(e,i){e&1&&(o(0,"mat-error"),m(1," Name is required "),r())}function rt(e,i){e&1&&(o(0,"mat-error"),m(1," Name too long "),r())}function ot(e,i){if(e&1&&(o(0,"mat-option",12),m(1),r()),e&2){let t=i.$implicit;n("value",t.id),a(),u(" ",t.name," ")}}function nt(e,i){if(e&1&&(o(0,"mat-option",12),m(1),r()),e&2){let t=i.$implicit;n("value",t.id),a(),u(" ",t.name," ")}}function at(e,i){e&1&&(o(0,"span"),m(1,"Save Category"),r())}function mt(e,i){e&1&&s(0,"mat-spinner",18)}function lt(e,i){if(e&1){let t=F();o(0,"form",6),M("ngSubmit",function(){x(t);let g=f();return S(g.submit())}),o(1,"mat-form-field",7)(2,"mat-label"),m(3,"Name"),r(),s(4,"input",8),p(5,it,2,0,"mat-error",9)(6,rt,2,0,"mat-error",9),r(),o(7,"mat-form-field",7)(8,"mat-label"),m(9,"Description"),r(),s(10,"textarea",10),r(),o(11,"mat-form-field",7)(12,"mat-label"),m(13,"Parent Category"),r(),o(14,"mat-select",11)(15,"mat-option",12),m(16,"\u2014 None \u2014"),r(),p(17,ot,2,2,"mat-option",13),r()(),o(18,"mat-form-field",7)(19,"mat-label"),m(20,"Suppliers"),r(),o(21,"mat-select",14),p(22,nt,2,2,"mat-option",13),r()(),o(23,"div",15)(24,"button",16),p(25,at,2,0,"span",9)(26,mt,1,0,"mat-spinner",17),r()()()}if(e&2){let t=f();n("formGroup",t.form),a(5),n("ngIf",t.nameControl==null?null:t.nameControl.hasError("required")),a(),n("ngIf",t.nameControl==null?null:t.nameControl.hasError("maxlength")),a(9),n("value",null),a(2),n("ngForOf",t.categories),a(5),n("ngForOf",t.suppliers),a(2),n("disabled",t.form.invalid||t.submitting),a(),n("ngIf",!t.submitting),a(),n("ngIf",t.submitting)}}var Z=class e{constructor(i,t,l){this.fb=i;this.categoryService=t;this.supplierService=l}initialData=null;submitted=new b;destroy$=new _;form;loading=!0;submitting=!1;error=null;categories=[];suppliers=[];ngOnInit(){this.form=this.fb.group({name:["",[y.required,y.maxLength(120)]],description:[""],parentId:[null],suppliersIds:[[]]}),this.loadDependencies()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadDependencies(){v({categories:this.categoryService.getAll("tree",!1),suppliers:this.supplierService.getAll(!1)}).pipe(h(this.destroy$)).subscribe({next:({categories:i,suppliers:t})=>{this.categories=this.flatten(i),this.suppliers=t,this.initialData&&this.patchInitialData(),this.loading=!1},error:()=>{this.error="Failed to load dependencies.",this.loading=!1}})}patchInitialData(){this.initialData&&this.form.patchValue({name:this.initialData.name,description:this.initialData.description,parentId:this.initialData.parentId??null,suppliersIds:this.initialData.suppliers?.map(i=>i.id)??[]})}flatten(i){let t=[],l=g=>{for(let d of g)this.initialData&&d.id===this.initialData.id||(t.push(d),d.subcategories?.length&&l(d.subcategories))};return l(i),t}submit(){if(this.form.invalid||this.submitting)return;this.submitting=!0,this.error=null;let i=C({},this.form.value);this.submitted.emit({payload:i,done:()=>this.submitting=!1})}get nameControl(){return this.form.get("name")}static \u0275fac=function(t){return new(t||e)(c($),c(Y),c(X))};static \u0275cmp=I({type:e,selectors:[["app-category-form"]],inputs:{initialData:"initialData"},outputs:{submitted:"submitted"},decls:3,vars:3,consts:[["class","loading-container",4,"ngIf"],["class","error-state",4,"ngIf"],["class","form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],["diameter","32"],[1,"error-state"],[1,"form",3,"ngSubmit","formGroup"],["appearance","fill"],["matInput","","formControlName","name"],[4,"ngIf"],["matInput","","rows","3","formControlName","description"],["formControlName","parentId"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","suppliersIds","multiple",""],[1,"actions"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],["diameter","20"]],template:function(t,l){t&1&&p(0,tt,2,0,"div",0)(1,et,2,1,"div",1)(2,lt,27,9,"form",2),t&2&&(n("ngIf",l.loading),a(),n("ngIf",l.error),a(),n("ngIf",!l.loading))},dependencies:[O,D,E,B,j,P,T,w,G,V,R,J,A,L,z,U,K,H,N,q,k,W,Q],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;max-width:640px}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:1rem}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.error-state[_ngcontent-%COMP%]{padding:1rem;border-radius:8px;background:#ef444414;color:#dc2626;margin-bottom:1rem}@media (max-width: 600px){.actions[_ngcontent-%COMP%]{justify-content:stretch}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})};export{Z as a};
