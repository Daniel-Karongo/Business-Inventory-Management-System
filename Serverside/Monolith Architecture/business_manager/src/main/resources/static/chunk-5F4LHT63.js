import{a as Te}from"./chunk-L7SXC5JW.js";import{a as Re}from"./chunk-6PRU4GVW.js";import{a as Ie}from"./chunk-SXDKZSKL.js";import{a as we}from"./chunk-L3Q7PZHV.js";import{a as ce}from"./chunk-QAS6HGXL.js";import{a as De}from"./chunk-JZXEWDXN.js";import{a as ye,b as Me,c as he,d as be}from"./chunk-2ME7W6RW.js";import{a as Se}from"./chunk-LVP7ARRB.js";import{d as ne}from"./chunk-SEKUPHS7.js";import"./chunk-N4J5OKMY.js";import{b as W,c as j,d as k,e as N,f as L,g as B,h as D}from"./chunk-MA6ZSKR6.js";import{a as se}from"./chunk-XHAJPIPO.js";import"./chunk-MS4AQ6UA.js";import{a as Ce,b as ve}from"./chunk-2JRABG3A.js";import{d as ie}from"./chunk-T2UYCDC2.js";import"./chunk-PZ352SLY.js";import{b as pe,c as le}from"./chunk-TLF4YXFY.js";import{c as ue,d as xe}from"./chunk-CZGJLEOY.js";import{b as de,e as _e,h as fe,i as ge}from"./chunk-J5IGF7DT.js";import"./chunk-SGYCFQGT.js";import{d as oe,h as re,l as ae,w as me}from"./chunk-D2WFNIGL.js";import"./chunk-AYMLXUSV.js";import{g as A,h as V}from"./chunk-SRBP6AOE.js";import"./chunk-AQVBCBXZ.js";import"./chunk-Z7QKINIM.js";import{a as F}from"./chunk-5DTMLZHP.js";import{$b as J,$c as S,Ib as r,Jb as a,Kb as K,Lb as T,Mb as E,Ob as C,Qb as R,Rb as c,Rc as O,Sc as ee,Xc as te,_ as w,ac as l,bb as o,bc as f,cc as h,da as I,dc as Y,fc as v,gb as _,gc as y,hc as M,hd as P,na as u,nb as b,nc as Q,oa as x,oc as Z,sb as g,zb as s}from"./chunk-KLCDKTJS.js";import{h as q}from"./chunk-FJYW2LMB.js";var U=class i{constructor(n){this.data=n}static \u0275fac=function(e){return new(e||i)(_(W))};static \u0275cmp=b({type:i,selectors:[["ng-component"]],decls:7,vars:1,consts:[["mat-dialog-title",""],[1,"error-content"],["align","end"],["mat-flat-button","","color","primary","mat-dialog-close",""]],template:function(e,t){e&1&&(r(0,"h2",0),l(1,"Report error"),a(),r(2,"mat-dialog-content",1),l(3),a(),r(4,"mat-dialog-actions",2)(5,"button",3),l(6," OK "),a()()),e&2&&(o(3),h(" ",t.data.message," "))},dependencies:[S,D,k,N,B,L,V,A],styles:[".error-content[_ngcontent-%COMP%]{color:#b00020;font-size:14px;line-height:1.5;margin-top:8px}"]})};var z=class i{constructor(n){this.http=n}base=F.apiUrl+"/reports";generate(n,e){return this.http.post(`${this.base}/generate`,{reportName:n,parameters:e},{responseType:"blob"})}static \u0275fac=function(e){return new(e||i)(I(P))};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};function We(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"input",20),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),a(),K(4,"mat-datepicker-toggle",21)(5,"mat-datepicker",null,0),a()}if(i&2){let e=J(6),t=c().$implicit,m=c();o(2),f(m.labelFor(t)),o(),s("matDatepicker",e),v("ngModel",m.params[t.name]),o(),s("for",e)}}function je(i,n){if(i&1&&(r(0,"mat-option",23),l(1),a()),i&2){let e=n.$implicit;s("value",e.id),o(),h(" ",e.name," ")}}function ke(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"mat-select",10),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),g(4,je,2,2,"mat-option",22),a()()}if(i&2){let e=c().$implicit,t=c();o(2),f(t.labelFor(e)),o(),v("ngModel",t.params[e.name]),o(),s("ngForOf",t.branches)}}function Ne(i,n){if(i&1&&(r(0,"mat-option",23),l(1),a()),i&2){let e=n.$implicit;s("value",e.id),o(),Y(" ",e.code," \u2014 ",e.name," ")}}function Le(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"mat-select",10),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),g(4,Ne,2,3,"mat-option",22),a()()}if(i&2){let e=c().$implicit,t=c();o(2),f(t.labelFor(e)),o(),v("ngModel",t.params[e.name]),o(),s("ngForOf",t.accounts)}}function Be(i,n){if(i&1&&(r(0,"mat-option",23),l(1),a()),i&2){let e,t=n.$implicit;s("value",t.id),o(),Y(" ",t.name," (",(e=t.phone)!==null&&e!==void 0?e:t.email,") ")}}function Ue(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"mat-select",10),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),g(4,Be,2,3,"mat-option",22),a()()}if(i&2){let e=c().$implicit,t=c();o(2),f(t.labelFor(e)),o(),v("ngModel",t.params[e.name]),o(),s("ngForOf",t.customers)}}function $e(i,n){if(i&1&&(r(0,"mat-option",23),l(1),a()),i&2){let e=n.$implicit;s("value",e.id),o(),h(" ",e.name," ")}}function ze(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"mat-select",10),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),g(4,$e,2,2,"mat-option",22),a()()}if(i&2){let e=c().$implicit,t=c();o(2),f(t.labelFor(e)),o(),v("ngModel",t.params[e.name]),o(),s("ngForOf",t.suppliers)}}function He(i,n){if(i&1&&(r(0,"mat-option",23),l(1),a()),i&2){let e=n.$implicit;s("value",e.id),o(),h(" ",e.name," ")}}function Ge(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"mat-select",24),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),R("selectionChange",function(m){u(e);let p=c(2);return x(p.onProductChange(m.value))}),g(4,He,2,2,"mat-option",22),a()()}if(i&2){let e=c().$implicit,t=c();o(2),f(t.labelFor(e)),o(),v("ngModel",t.params[e.name]),o(),s("ngForOf",t.products)}}function Xe(i,n){if(i&1&&(r(0,"mat-option",23),l(1),a()),i&2){let e=n.$implicit;s("value",e.id),o(),h(" ",e.name," ")}}function Ye(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"mat-select",10),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),g(4,Xe,2,2,"mat-option",22),a()()}if(i&2){let e=c().$implicit,t=c();o(2),f(t.labelFor(e)),o(),v("ngModel",t.params[e.name]),o(),s("ngForOf",t.variants)}}function qe(i,n){if(i&1&&(r(0,"mat-option",23),l(1),a()),i&2){let e=n.$implicit;s("value",e.id),o(),h(" ",e.name," ")}}function Ke(i,n){if(i&1){let e=C();r(0,"mat-form-field",9)(1,"mat-label"),l(2),a(),r(3,"mat-select",10),M("ngModelChange",function(m){u(e);let p=c().$implicit,d=c();return y(d.params[p.name],m)||(d.params[p.name]=m),x(m)}),g(4,qe,2,2,"mat-option",22),a()()}if(i&2){let e=c().$implicit,t=c();o(2),f(t.labelFor(e)),o(),v("ngModel",t.params[e.name]),o(),s("ngForOf",t.categories)}}function Je(i,n){if(i&1&&(T(0),g(1,We,7,4,"mat-form-field",19)(2,ke,5,3,"mat-form-field",19)(3,Le,5,3,"mat-form-field",19)(4,Ue,5,3,"mat-form-field",19)(5,ze,5,3,"mat-form-field",19)(6,Ge,5,3,"mat-form-field",19)(7,Ye,5,3,"mat-form-field",19)(8,Ke,5,3,"mat-form-field",19),E()),i&2){let e=n.$implicit;o(),s("ngIf",e.type==="DATE"),o(),s("ngIf",e.type==="BRANCH"),o(),s("ngIf",e.type==="ACCOUNT"),o(),s("ngIf",e.type==="CUSTOMER"),o(),s("ngIf",e.type==="SUPPLIER"),o(),s("ngIf",e.type==="PRODUCT"),o(),s("ngIf",e.type==="VARIANT"),o(),s("ngIf",e.type==="CATEGORY")}}var H=class i{constructor(n,e,t,m,p,d,tt,it,nt,ot,rt){this.report=n;this.dialog=e;this.customerSvc=t;this.supplierSvc=m;this.productSvc=p;this.categorySvc=d;this.variantSvc=tt;this.reports=it;this.auth=nt;this.accountsSvc=ot;this.branchesSvc=rt}params={};format="PDF";loading=!1;accounts=[];branches=[];customers=[];suppliers=[];products=[];categories=[];variants=[];orderedParams=[];DEFAULT_FROM=new Date(2025,0,1);DEFAULT_TO=new Date(2027,0,1);ngOnInit(){let n=this.auth.getSnapshot();this.orderedParams=[...this.report.parameters].sort((e,t)=>{let m=p=>p.name==="FROM_DATE"?1:p.name==="START_DATE"?2:p.name==="TO_DATE"?3:p.name==="END_DATE"?4:p.type==="DATE"?5:p.type==="BRANCH"?6:p.type==="ACCOUNT"?8:10;return m(e)-m(t)});for(let e of this.orderedParams)e.type==="DATE"&&(e.name==="FROM_DATE"||e.name=="START_DATE"?this.params[e.name]=new Date(this.DEFAULT_FROM):e.name==="TO_DATE"||e.name=="END_DATE"?this.params[e.name]=new Date(this.DEFAULT_TO):this.params[e.name]=new Date),e.type==="BRANCH"&&(this.params[e.name]=n?.branchId,this.branchesSvc.getAll().subscribe(t=>this.branches=t)),e.type==="ACCOUNT"&&this.accountsSvc.list().subscribe(t=>this.accounts=t),e.type==="CUSTOMER"&&this.customerSvc.list(0,1e3).subscribe(t=>{this.customers=t.data??t}),e.type==="SUPPLIER"&&this.supplierSvc.getAll().subscribe(t=>this.suppliers=t),e.type==="PRODUCT"&&this.productSvc.getAll(!1).subscribe(t=>this.products=t),e.type==="CATEGORY"&&this.categorySvc.getAll("flat").subscribe(t=>this.categories=t),e.type==="VARIANT"&&(this.variants=[])}toIsoSafe(n){if(!(n instanceof Date))return null;let e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),m=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${m}`}labelFor(n){return n.name.replace(/_ID$/,"").replace(/_/g," ").toLowerCase().replace(/\b\w/g,t=>t.toUpperCase())}onProductChange(n){if(!n){this.variants=[],this.params.VARIANT_ID=null;return}this.variantSvc.forProduct(n).subscribe(e=>{this.variants=e,this.params.VARIANT_ID=null})}isMissingRequired(){return this.orderedParams.some(n=>n.required&&(this.params[n.name]===void 0||this.params[n.name]===null||this.params[n.name]===""))}generate(){this.loading=!0;let n={format:this.format};for(let e of this.orderedParams)e.type==="DATE"?n[e.name]=this.toIsoSafe(this.params[e.name]):n[e.name]=this.params[e.name];this.reports.generate(this.report.key,n).subscribe({next:e=>{let t=URL.createObjectURL(e);window.open(t,"_blank"),this.loading=!1},error:e=>q(this,null,function*(){this.loading=!1;let t="Failed to generate report";e?.error instanceof Blob?t=(yield e.error.text())||t:typeof e?.error=="string"&&(t=e.error),this.dialog.open(U,{width:"380px",data:{message:t}})})})}static \u0275fac=function(e){return new(e||i)(_(W),_(j),_(Ie),_(De),_(Se),_(Re),_(we),_(z),_(ce),_(Te),_(se))};static \u0275cmp=b({type:i,selectors:[["ng-component"]],decls:29,vars:5,consts:[["dp",""],["mat-dialog-title","",1,"dialog-header"],[1,"dialog-title"],[1,"dialog-subtitle"],[1,"dialog-content"],[1,"form-section"],[1,"section-label"],[1,"form-grid"],[4,"ngFor","ngForOf"],["appearance","fill"],[3,"ngModelChange","ngModel"],["value","PDF"],["value","XLSX"],["value","CSV"],[1,"dialog-footer"],[1,"footer-hint"],[1,"footer-actions"],["mat-stroked-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"],["appearance","fill",4,"ngIf"],["matInput","","placeholder","dd/mm/yyyy",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngModelChange","selectionChange","ngModel"]],template:function(e,t){e&1&&(r(0,"h2",1)(1,"div",2),l(2),a(),r(3,"div",3),l(4),a()(),r(5,"mat-dialog-content",4)(6,"section",5)(7,"div",6),l(8,"Report parameters"),a(),r(9,"div",7),g(10,Je,9,8,"ng-container",8),r(11,"mat-form-field",9)(12,"mat-label"),l(13,"Format"),a(),r(14,"mat-select",10),M("ngModelChange",function(p){return y(t.format,p)||(t.format=p),p}),r(15,"mat-option",11),l(16,"PDF"),a(),r(17,"mat-option",12),l(18,"Excel"),a(),r(19,"mat-option",13),l(20,"CSV"),a()()()()()(),r(21,"mat-dialog-actions",14)(22,"div",15),l(23," Generated reports are immutable and audit-safe "),a(),r(24,"div",16)(25,"button",17),l(26,"Cancel"),a(),r(27,"button",18),R("click",function(){return t.generate()}),l(28," Generate report "),a()()()),e&2&&(o(2),f(t.report.title),o(2),f(t.report.description),o(6),s("ngForOf",t.orderedParams),o(4),v("ngModel",t.format),o(13),s("disabled",t.loading||t.isMissingRequired()))},dependencies:[S,O,ee,me,oe,re,ae,D,k,N,B,L,ge,fe,de,_e,xe,ue,ve,Ce,ie,V,A,be,ye,Me,he,ne],styles:[".dialog-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;padding-bottom:8px}.dialog-title[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:var(--font-semibold)}.dialog-subtitle[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.dialog-content[_ngcontent-%COMP%]{padding-top:8px}.section-label[_ngcontent-%COMP%]{font-size:.7rem;font-weight:600;color:var(--text-secondary)}.form-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.form-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}mat-form-field[_ngcontent-%COMP%]{width:100%}.dialog-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding-top:12px}.footer-hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary);margin-bottom:10px}.footer-actions[_ngcontent-%COMP%]{display:flex;gap:8px}  .mat-mdc-form-field-subscript-wrapper{display:none}"]})};var G=class i{constructor(n){this.http=n}base=F.apiUrl+"/reports";list(){return this.http.get(`${this.base}/definitions`)}static \u0275fac=function(e){return new(e||i)(I(P))};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};function Ze(i,n){if(i&1){let e=C();r(0,"div",8),R("click",function(){let m=u(e).$implicit,p=c(2);return x(p.open(m))}),r(1,"div",9)(2,"mat-icon"),l(3,"assessment"),a()(),r(4,"div",10)(5,"div",11),l(6),a(),r(7,"div",12),l(8),a()()()}if(i&2){let e=n.$implicit;o(6),f(e.title),o(2),f(e.description)}}function et(i,n){if(i&1&&(T(0),r(1,"h3",5),l(2),a(),r(3,"div",6),g(4,Ze,9,2,"div",7),a(),E()),i&2){let e=n.$implicit;o(2),f(e.key),o(2),s("ngForOf",e.value)}}var X=class i{constructor(n,e){this.reportsMeta=n;this.dialog=e}groupedReports={};ngOnInit(){this.reportsMeta.list().subscribe(n=>{this.groupedReports=n.reduce((e,t)=>(e[t.category]??=[],e[t.category].push(t),e),{})})}open(n){this.dialog.open(H,{width:"420px",maxWidth:"95vw",autoFocus:!1,data:n})}static \u0275fac=function(e){return new(e||i)(_(G),_(j))};static \u0275cmp=b({type:i,selectors:[["app-reports-dashboard"]],decls:10,vars:3,consts:[[1,"page-root"],[1,"page-header"],[1,"breadcrumb"],[1,"page-content"],[4,"ngFor","ngForOf"],[1,"category-title"],[1,"reports-grid"],["class","report-tile",3,"click",4,"ngFor","ngForOf"],[1,"report-tile",3,"click"],[1,"tile-icon"],[1,"tile-content"],[1,"tile-title"],[1,"tile-desc"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h2"),l(4,"Reports"),a(),r(5,"div",2),l(6,"Finance / Reports"),a()()(),r(7,"div",3),g(8,et,5,2,"ng-container",4),Q(9,"keyvalue"),a()()),e&2&&(o(8),s("ngForOf",Z(9,1,t.groupedReports)))},dependencies:[S,O,te,D,le,pe],styles:[".page-root[_ngcontent-%COMP%]{padding:20px}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.4rem;font-weight:var(--font-semibold)}.page-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary)}.page-content[_ngcontent-%COMP%]{background:var(--surface);border-radius:10px;padding:20px;border:1px solid var(--border)}.reports-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}.report-tile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:18px;border:1px solid var(--border);border-radius:10px;background:var(--surface);cursor:pointer;transition:box-shadow .15s ease,transform .12s ease,border-color .12s ease}.report-tile[_ngcontent-%COMP%]:hover{border-color:var(--active);box-shadow:0 6px 18px #00000026;transform:translateY(-2px)}.tile-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:8px;background:#005cbb1f;display:flex;align-items:center;justify-content:center}.tile-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#005cbb}.tile-title[_ngcontent-%COMP%]{font-weight:var(--font-semibold)}.tile-desc[_ngcontent-%COMP%]{font-size:var(--text-sm);color:var(--text-secondary)}.category-title[_ngcontent-%COMP%]{margin:22px 0 10px;font-size:.85rem;font-weight:var(--font-semibold);color:var(--text-secondary);text-transform:uppercase;letter-spacing:.6px}"]})};var Ht=[{path:"",component:X}];export{Ht as REPORTS_ROUTES};
