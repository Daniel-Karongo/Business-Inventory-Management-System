import{a}from"./chunk-QAS6HGXL.js";import{d as n}from"./chunk-CSKLPVDL.js";import{a as u}from"./chunk-5DTMLZHP.js";import{_ as r,da as e,ya as s}from"./chunk-KLCDKTJS.js";var m=class i{constructor(t,o,h){this.auth=t;this.router=o;this.zone=h}timeoutId;loggingOut=!1;idleMs=u.idleLogoutMinutes*60*1e3;events=["mousemove","mousedown","keydown","scroll","touchstart"];boundResetTimer=()=>this.resetTimer();start(){this.resetTimer(),this.zone.runOutsideAngular(()=>{this.events.forEach(t=>document.addEventListener(t,this.boundResetTimer,!0))})}stop(){clearTimeout(this.timeoutId),this.events.forEach(t=>document.removeEventListener(t,this.boundResetTimer,!0))}ngOnDestroy(){this.stop()}resetTimer(){clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>this.logout(),this.idleMs)}logout(){this.loggingOut||(this.loggingOut=!0,console.log("[IdleLogout] Logging out due to inactivity"),this.zone.run(()=>{this.auth.logout().subscribe({next:()=>this.finishLogout(),error:()=>this.finishLogout()})}))}finishLogout(){this.auth.clearLocalState(),this.router.navigate(["/login"],{queryParams:{reason:"idle"}})}static \u0275fac=function(o){return new(o||i)(e(a),e(n),e(s))};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
