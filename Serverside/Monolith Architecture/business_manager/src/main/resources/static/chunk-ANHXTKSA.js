import{a as U,b as q}from"./chunk-XU3JDGSP.js";import{a as X,b as qe,c as We}from"./chunk-WVN3VHDB.js";import{a as $t}from"./chunk-HR3AI3AC.js";import{a as le}from"./chunk-QAS6HGXL.js";import{a as Qt,b as Zt,c as ii}from"./chunk-U77Y5IN4.js";import{a as Jt,b as Xt,c as ei,d as ti}from"./chunk-UTOEPDRR.js";import{a as Kt}from"./chunk-7B2346SR.js";import{a as Wt}from"./chunk-CD2D6BMO.js";import{a as $e,b as qt,c as Ge,d as Ye}from"./chunk-TWWBRTKE.js";import{a as Te,b as Ae,c as Re,d as Fe,e as Ve,f as Ne,g as Be,h as Le,i as je,j as He,k as ze}from"./chunk-I3US72OE.js";import"./chunk-N4J5OKMY.js";import{a as Vt,b as Nt}from"./chunk-YVNRBVUQ.js";import{a as Bt,c as Pe,d as Lt,e as jt,f as Ht,g as zt,h as ve}from"./chunk-MA6ZSKR6.js";import{a as j}from"./chunk-XHAJPIPO.js";import"./chunk-MS4AQ6UA.js";import{a as G,b as Y}from"./chunk-2JRABG3A.js";import{d as V}from"./chunk-T2UYCDC2.js";import{c as Rt}from"./chunk-PZ352SLY.js";import{b as T,c as O}from"./chunk-TLF4YXFY.js";import{a as H,b as z}from"./chunk-SNZ3II6O.js";import{c as de,d as pe}from"./chunk-CZGJLEOY.js";import{b as me,c as Gt,e as Yt,h as $,i as ce}from"./chunk-J5IGF7DT.js";import"./chunk-SGYCFQGT.js";import{d as N,f as S,h as B,i as re,l as Ft,m as Ie,p as oe,q as ke,r as De,s as ae,v as Ue,w as Oe,x as se}from"./chunk-D2WFNIGL.js";import"./chunk-AYMLXUSV.js";import{f as L,g as A,h as R}from"./chunk-SRBP6AOE.js";import{G as At}from"./chunk-AQVBCBXZ.js";import{b as Ee,d as F}from"./chunk-CSKLPVDL.js";import"./chunk-Z7QKINIM.js";import"./chunk-5DTMLZHP.js";import{$ as vt,$b as Se,$c as D,Bb as he,D as Ce,Ib as o,J as ye,Jb as r,Kb as C,Lb as M,Mb as E,Ob as v,Qb as f,Qc as Tt,Rb as d,Rc as P,Sc as k,Ub as Mt,Wb as Et,Wc as ne,Xb as It,Yb as kt,_ as we,_a as yt,ac as s,bb as l,bc as b,cc as x,dc as be,ec as Dt,f as bt,fc as Q,ga as xt,gb as h,gc as Z,ha as Ct,hc as J,kc as Ut,lc as Ot,m as ee,mc as Pt,na as u,nb as I,nc as te,oa as _,ob as wt,pc as ie,qb as St,rc as Me,sb as p,xc as ot,yb as w,zb as c}from"./chunk-KLCDKTJS.js";import{a as gt,b as ht,g as nt,h as rt}from"./chunk-FJYW2LMB.js";var at=(()=>{class i{changes=new bt;static \u0275fac=function(n){return new(n||i)};static \u0275prov=we({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function ci(i){return i||new at}var di={provide:at,deps:[[new xt,new Ct,at]],useFactory:ci};var ni=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=wt({type:i});static \u0275inj=vt({providers:[di],imports:[At]})}return i})();var ri={title:"Bulk Import Users",confirmLabel:"Import Now",csvFileName:"users-bulk-template.csv",excelFileName:"users-bulk-template.xlsx",headers:["username","password","role","emails","phones","branchCode","departmentName","position"],fields:[{name:"username",required:!0},{name:"password",defaultValue:"1234"},{name:"role",defaultValue:"EMPLOYEE"},{name:"emails"},{name:"phones"},{name:"branchCode"},{name:"departmentName"},{name:"position",defaultValue:"member"}],previewColumns:[{key:"username",label:"Username"},{key:"role",label:"Role"},{key:"emails",label:"Emails"},{key:"phones",label:"Phones"},{key:"branchCode",label:"Branch"},{key:"departmentName",label:"Department"}],excelSheetName:"Users",excelColumns:[{header:"username",key:"username",width:18},{header:"password",key:"password",width:12},{header:"role",key:"role",width:14},{header:"emails",key:"emails",width:32},{header:"phones",key:"phones",width:22,format:"text"},{header:"branchCode",key:"branchCode",width:14},{header:"departmentName",key:"departmentName",width:18},{header:"position",key:"position",width:12}],exampleRow:{username:"jdoe",password:"1234",role:"EMPLOYEE",emails:"jdoe@company.com",phones:"0712345678",branchCode:"MAIN",departmentName:"GENERAL",position:"member"},emptyRow:{password:"1234",role:"EMPLOYEE",position:"member"},emptyRowCount:200,defaultOptions:{dryRun:!0,skipDuplicates:!0},mapRowToItem(i){return{username:i.username,password:i.password,role:i.role,emailAddresses:i.emails?[i.emails]:[],phoneNumbers:i.phones?[i.phones]:[],branchCode:i.branchCode||null,departmentName:i.departmentName||null,position:i.position}},mapPreviewRow(i){return ht(gt({},i),{emails:Array.isArray(i.emailAddresses)?i.emailAddresses.join(", "):"",phones:Array.isArray(i.phoneNumbers)?i.phoneNumbers.join(", "):""})},submit(i){return null}};function ui(i,t){if(i&1&&(o(0,"mat-option",32),s(1),r()),i&2){let e=t.$implicit;c("value",e.branchCode),l(),x(" ",e.name," ")}}function _i(i,t){if(i&1&&(o(0,"mat-option",32),s(1),r()),i&2){let e=t.$implicit;c("value",e.name),l(),x(" ",e.name," ")}}function fi(i,t){if(i&1&&(o(0,"div",12)(1,"mat-form-field")(2,"mat-select",25)(3,"mat-option",26),s(4,"Auto"),r(),p(5,ui,2,2,"mat-option",27),r()(),o(6,"mat-form-field")(7,"mat-select",28)(8,"mat-option",26),s(9,"Auto"),r(),p(10,_i,2,2,"mat-option",27),r()(),o(11,"mat-form-field")(12,"mat-select",29)(13,"mat-option",30),s(14,"Member"),r(),o(15,"mat-option",31),s(16,"Head"),r()()()()),i&2){let e=d(2);l(5),c("ngForOf",e.branches),l(5),c("ngForOf",e.departments)}}function gi(i,t){if(i&1&&(o(0,"div",33),s(1),r()),i&2){let e=d().$implicit;l(),x(" ",e.value._error," ")}}function hi(i,t){if(i&1){let e=v();o(0,"div",9)(1,"div",10)(2,"span"),s(3),r(),o(4,"button",11),f("click",function(){let a=u(e).index,m=d();return _(m.removeRow(a))}),o(5,"mat-icon"),s(6,"delete"),r()()(),o(7,"div",12)(8,"mat-form-field"),C(9,"input",13),r(),o(10,"mat-form-field"),C(11,"input",14),r(),o(12,"mat-form-field")(13,"mat-select",15)(14,"mat-option",16),s(15,"EMPLOYEE"),r(),o(16,"mat-option",17),s(17,"SUPERVISOR"),r(),o(18,"mat-option",18),s(19,"MANAGER"),r(),o(20,"mat-option",19),s(21,"ADMIN"),r()()()(),o(22,"div",20)(23,"mat-form-field"),C(24,"input",21),r(),o(25,"mat-form-field"),C(26,"input",22),r()(),p(27,fi,17,2,"div",23)(28,gi,2,1,"div",24),r()}if(i&2){let e=t.$implicit,n=t.index,a=d();c("formGroupName",n),l(3),x("User ",n+1,""),l(24),c("ngIf",!a.hideOrgFields),l(),c("ngIf",e.value._error)}}var Ke=class i extends Qt{constructor(e,n,a,m,g){super();this.userService=e;this.branchService=n;this.departmentService=a;this.submitEngine=m;this.dialogRef=g}config=ri;branches=[];departments=[];hideOrgFields=!1;ngOnInit(){this.initForm(),this.loadOrgMeta()}loadOrgMeta(){Promise.all([this.branchService.getAll(!1).toPromise(),this.departmentService.getAll(!1).toPromise()]).then(([e,n])=>{this.branches=e||[],this.departments=n||[],this.hideOrgFields=this.branches.length===1&&this.departments.length===1})}submit(){if(this.form.invalid)return;let e={items:this.rows.controls.map(n=>this.config.mapRowToItem(n.value)),options:{dryRun:this.form.value.dryRun,skipDuplicates:!0}};this.submitEngine.execute({submitFn:n=>this.userService.bulkImport(n),payload:e,rows:this.rows.controls,dryRun:this.form.value.dryRun,title:this.config.title,confirmLabel:this.config.confirmLabel,columns:this.config.previewColumns,onErrorsApplied:n=>{this.cacheErrors(n),this.config.mapPreviewRow&&Array.isArray(n.data)&&(n.data=n.data.map(a=>this.config.mapPreviewRow(a)))},onFinalSuccess:()=>this.dialogRef.close(!0),onConfirmRetry:()=>{this.form.patchValue({dryRun:!1}),this.submit()}})}importExcel(e){return rt(this,null,function*(){if(!e)return;let n=yield this.confirmMerge();n&&nt(i.prototype,this,"importExcelFile").call(this,e,void 0,n)})}importCsv(e){return rt(this,null,function*(){if(!e)return;let n=yield this.confirmMerge();n&&nt(i.prototype,this,"importCsvFile").call(this,e,n)})}close(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||i)(h(U),h(j),h(q),h(ii),h(Bt))};static \u0275cmp=I({type:i,selectors:[["app-user-bulk-import-dialog"]],features:[St],decls:12,vars:8,consts:[["bottomAnchor",""],[3,"keydown.enter","formGroup"],[3,"importCsv","importExcel","downloadCsv","downloadExcel","submit","cancel","goToLine","goTop","goBottom","prevError","nextError","clearAll","exportCsv","exportExcel","title","rowCount","submitting","formInvalid","loading","progress"],[1,"users-body"],["bulk-options","",1,"grid-2"],["formControlName","dryRun"],["formArrayName","rows",1,"rows"],["class","row-card",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],[1,"row-card",3,"formGroupName"],[1,"row-header"],["mat-icon-button","","color","warn",3,"click"],[1,"grid-3"],["matInput","","placeholder","Username","formControlName","username"],["matInput","","placeholder","Password","formControlName","password"],["formControlName","role"],["value","EMPLOYEE"],["value","SUPERVISOR"],["value","MANAGER"],["value","ADMIN"],[1,"grid-2"],["matInput","","placeholder","Emails","formControlName","emails"],["matInput","","placeholder","Phones","formControlName","phones"],["class","grid-3",4,"ngIf"],["class","row-error",4,"ngIf"],["formControlName","branchCode"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","departmentName"],["formControlName","position"],["value","member"],["value","head"],[3,"value"],[1,"row-error"]],template:function(n,a){if(n&1){let m=v();o(0,"form",1),f("keydown.enter",function(y){return u(m),_(y.stopPropagation())}),o(1,"app-bulk-import-shell",2),f("importCsv",function(y){return u(m),_(a.importCsv(y))})("importExcel",function(y){return u(m),_(a.importExcel(y))})("downloadCsv",function(){return u(m),_(a.downloadCsvTemplate())})("downloadExcel",function(){return u(m),_(a.downloadExcelTemplate())})("submit",function(){return u(m),_(a.submit())})("cancel",function(){return u(m),_(a.close())})("goToLine",function(y){return u(m),_(a.goToLine(y))})("goTop",function(){return u(m),_(a.scrollToTop())})("goBottom",function(){return u(m),_(a.scrollToBottom())})("prevError",function(){return u(m),_(a.goToPreviousError())})("nextError",function(){return u(m),_(a.goToNextError())})("clearAll",function(){return u(m),_(a.clearRows())})("exportCsv",function(){return u(m),_(a.exportCsvCurrentRows())})("exportExcel",function(){return u(m),_(a.exportExcelCurrentRows())}),o(2,"div",3)(3,"div",4)(4,"mat-checkbox",5),s(5," Dry run (validate only) "),r()(),o(6,"div",6),p(7,hi,29,4,"div",7),r(),o(8,"button",8),f("click",function(){return u(m),_(a.addRow())}),s(9," + Add User "),r(),C(10,"div",null,0),r()()()}n&2&&(c("formGroup",a.form),l(),c("title",a.config.title)("rowCount",a.rowCount)("submitting",a.submitting)("formInvalid",a.form.invalid)("loading",a.submitting||a.loading)("progress",a.progress),l(6),c("ngForOf",a.rows.controls))},dependencies:[D,P,k,se,Ie,N,B,re,oe,ae,ke,De,Zt,ce,$,pe,de,Y,G,V,Ye,Ge,R,A,L,O,T],styles:[".users-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.row-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:20px;background:var(--surface);display:flex;flex-direction:column;gap:16px}.row-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;border-bottom:1px dashed var(--border);padding-bottom:6px}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}.mat-form-field[_ngcontent-%COMP%]{width:100%}.row-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.highlight-line[_ngcontent-%COMP%]{outline:2px solid #1976d2;outline-offset:4px;transition:outline .3s ease}"]})};var bi=new Set(["SUPERUSER","ADMIN","MANAGER"]);function si(i){return!!i&&bi.has(i.role)}var K=class i{roles=[{name:"SUPERUSER"},{name:"ADMIN"},{name:"MANAGER"},{name:"SUPERVISOR"},{name:"EMPLOYEE"}];list(){return ee(this.roles)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=we({token:i,factory:i.\u0275fac,providedIn:"root"})};var xi=()=>[1,5,10,20,50],Ci=(i,t)=>({"text-green-400":i,"text-red-400":t}),yi=i=>({"row-selected":i});function wi(i,t){if(i&1){let e=v();o(0,"button",26),f("click",function(){u(e);let a=d(2);return _(a.bulkDisable())}),s(1," Disable Selected "),r()}}function Si(i,t){if(i&1){let e=v();o(0,"button",27),f("click",function(){u(e);let a=d(2);return _(a.bulkRestore())}),s(1," Restore Selected "),r()}}function Mi(i,t){if(i&1){let e=v();o(0,"button",28),f("click",function(){u(e);let a=d(2);return _(a.bulkDelete())}),s(1," Delete Permanently "),r()}}function Ei(i,t){i&1&&(o(0,"span",29),s(1," Cannot perform bulk action \u2014 selected users have mixed status "),r())}function Ii(i,t){if(i&1&&(o(0,"div",20)(1,"span",21),s(2),r(),p(3,wi,2,0,"button",22)(4,Si,2,0,"button",23)(5,Mi,2,0,"button",24)(6,Ei,2,0,"span",25),r()),i&2){let e=d();l(2),x(" ",e.selection.selected.length," selected "),l(),c("ngIf",e.bulkState==="active"),l(),c("ngIf",e.bulkState==="deleted"),l(),c("ngIf",e.bulkState==="deleted"),l(),c("ngIf",e.bulkState==="mixed")}}function ki(i,t){if(i&1){let e=v();o(0,"mat-checkbox",30),J("ngModelChange",function(a){u(e);let m=d();return Z(m.showDeleted,a)||(m.showDeleted=a),_(a)}),f("change",function(){u(e);let a=d();return _(a.applyFilters())}),s(1," Show deleted users "),r()}if(i&2){let e=d();Q("ngModel",e.showDeleted),w("aria-label","Toggle visibility of deleted users")}}function Di(i,t){if(i&1&&(o(0,"mat-option",31),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),x(" ",e.name," ")}}function Ui(i,t){if(i&1&&(o(0,"mat-option",31),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),x(" ",e.name," ")}}function Oi(i,t){if(i&1&&(o(0,"mat-option",31),s(1),r()),i&2){let e=t.$implicit;c("value",e.name),l(),x(" ",e.name," ")}}function Pi(i,t){if(i&1){let e=v();o(0,"mat-form-field",11)(1,"mat-label"),s(2,"Status"),r(),o(3,"mat-select",12),J("ngModelChange",function(a){u(e);let m=d();return Z(m.filterStatus,a)||(m.filterStatus=a),_(a)}),f("selectionChange",function(){u(e);let a=d();return _(a.applyFilters())}),o(4,"mat-option",13),s(5,"All"),r(),o(6,"mat-option",32),s(7,"Active"),r(),o(8,"mat-option",33),s(9,"Disabled"),r()()()}if(i&2){let e=d();l(3),Q("ngModel",e.filterStatus)}}function Ti(i,t){i&1&&(o(0,"div",34),s(1," Loading\u2026 "),r())}function Ai(i,t){if(i&1){let e=v();o(0,"mat-header-cell")(1,"mat-checkbox",55),f("change",function(){u(e);let a=d(2);return _(a.masterToggle())}),r()()}if(i&2){let e=d(2);l(),c("checked",e.isAllSelected())("indeterminate",e.selection.selected.length>0&&!e.isAllSelected()),w("aria-label","Select all users")}}function Ri(i,t){if(i&1){let e=v();o(0,"mat-cell")(1,"mat-checkbox",56),f("click",function(a){return u(e),_(a.stopPropagation())})("change",function(){let a=u(e).$implicit,m=d(2);return _(m.selection.toggle(a))}),r()()}if(i&2){let e=t.$implicit,n=d(2);l(),c("checked",n.selection.isSelected(e)),w("aria-label","Select user {{ row.username }}")}}function Fi(i,t){if(i&1){let e=v();o(0,"mat-header-cell",57),f("click",function(){u(e);let a=d(2);return _(a.sortBy("username"))}),s(1," Username "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);w("aria-label","Sort by username"),l(3),x(" ",e.sortField==="username"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Vi(i,t){if(i&1){let e=v();o(0,"mat-cell")(1,"a",59),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.view(a))}),s(2),r()()}if(i&2){let e=t.$implicit;l(2),x(" ",e.username," ")}}function Ni(i,t){i&1&&(o(0,"mat-header-cell"),s(1," Emails "),r()),i&2&&w("aria-label","User email addresses")}function Bi(i,t){if(i&1&&(o(0,"div",62),s(1),r()),i&2){let e=t.$implicit;l(),b(e)}}function Li(i,t){if(i&1&&(o(0,"mat-cell")(1,"div",60),p(2,Bi,2,1,"div",61),r()()),i&2){let e=t.$implicit;l(2),c("ngForOf",e.emailAddresses)}}function ji(i,t){i&1&&(o(0,"mat-header-cell"),s(1," Phones "),r()),i&2&&w("aria-label","User phone numbers")}function Hi(i,t){if(i&1&&(o(0,"div",65),s(1),r()),i&2){let e=t.$implicit;l(),x(" ",e," ")}}function zi(i,t){if(i&1&&(o(0,"mat-cell")(1,"div",63),p(2,Hi,2,1,"div",64),r()()),i&2){let e=t.$implicit;l(2),c("ngForOf",e.phoneNumbers)}}function $i(i,t){if(i&1){let e=v();o(0,"mat-header-cell",66),f("click",function(){u(e);let a=d(2);return _(a.sortBy("branch"))}),s(1," Branches / Departments "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);w("aria-label","Sort by branch or department"),l(3),x(" ",e.sortField==="branch"||e.sortField==="department"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Gi(i,t){if(i&1&&(M(0),o(1,"div",69),s(2),r(),o(3,"div",70),s(4),r(),o(5,"div",71),s(6),r(),E()),i&2){let e=t.$implicit;l(2),b(e.branchName),l(2),b(e.departmentName),l(2),b(e.position||"\u2014")}}function Yi(i,t){if(i&1&&(o(0,"mat-cell")(1,"div",67),p(2,Gi,7,3,"ng-container",68),r()()),i&2){let e=t.$implicit,n=d(2);l(2),c("ngForOf",n.branchDeptRows(e))}}function qi(i,t){if(i&1){let e=v();o(0,"mat-header-cell",72),f("click",function(){u(e);let a=d(2);return _(a.sortBy("role"))}),s(1," Role "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);w("aria-label","Sort by role"),l(3),x(" ",e.sortField==="role"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Wi(i,t){if(i&1&&(o(0,"mat-cell"),s(1),r()),i&2){let e=t.$implicit;l(),x(" ",e.role," ")}}function Ki(i,t){if(i&1&&(o(0,"mat-icon",58),s(1),r()),i&2){let e=d(3);l(),x(" ",e.sortField==="status"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Qi(i,t){if(i&1){let e=v();o(0,"mat-header-cell",73),f("click",function(){u(e);let a=d(2);return _(a.sortBy("status"))}),s(1," Status "),p(2,Ki,2,1,"mat-icon",74),r()}if(i&2){let e=d(2);w("aria-label","User status"),l(2),c("ngIf",e.allowShowDeleted)}}function Zi(i,t){if(i&1&&(o(0,"mat-cell")(1,"span",75),s(2),r()()),i&2){let e=t.$implicit;l(),c("ngClass",Pt(2,Ci,!e.deleted,e.deleted)),l(),x(" ",e.deleted?"Disabled":"Active"," ")}}function Ji(i,t){if(i&1){let e=v();o(0,"mat-header-cell",76),f("click",function(){u(e);let a=d(2);return _(a.sortBy("createdAt"))}),s(1," Created "),o(2,"mat-icon",58),s(3),r()()}if(i&2){let e=d(2);w("aria-label","Sort by date created"),l(3),x(" ",e.sortField==="createdAt"?e.sortDir==="asc"?"arrow_upward":"arrow_downward":"unfold_more"," ")}}function Xi(i,t){if(i&1&&(o(0,"mat-cell"),s(1),te(2,"date"),r()),i&2){let e=t.$implicit;l(),x(" ",ie(2,1,e.createdAt,"medium")," ")}}function en(i,t){i&1&&(o(0,"mat-header-cell"),s(1," Actions "),r()),i&2&&w("aria-label","User actions")}function tn(i,t){if(i&1){let e=v();o(0,"mat-cell",77)(1,"button",78),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.view(a))}),o(2,"mat-icon"),s(3,"visibility"),r()(),o(4,"button",79),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.edit(a))}),o(5,"mat-icon"),s(6,"edit"),r()(),o(7,"button",80),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.toggleActive(a))}),o(8,"mat-icon"),s(9),r()()()}if(i&2){let e=t.$implicit;l(),w("aria-label","View user {{ u.username }}"),l(3),w("aria-label","Edit user {{ u.username }}"),l(3),Mt("matTooltip",e.deleted?"Restore/Delete user":"Disable User"),w("aria-label",(e.deleted?"Restore/Delete user ":"Disable user ")+e.username),l(2),b(e.deleted?"toggle_off":"toggle_on")}}function nn(i,t){i&1&&C(0,"mat-header-row")}function rn(i,t){if(i&1){let e=v();o(0,"mat-row",81),f("click",function(){let a=u(e).$implicit,m=d(2);return _(m.toggleRowSelection(a))}),r()}if(i&2){let e=t.$implicit,n=d(2);c("ngClass",Ot(1,yi,n.selection.isSelected(e)))}}function on(i,t){if(i&1&&(o(0,"mat-table",35),M(1,36),p(2,Ai,2,3,"mat-header-cell",37)(3,Ri,2,2,"mat-cell",38),E(),M(4,39),p(5,Fi,4,2,"mat-header-cell",40)(6,Vi,3,1,"mat-cell",38),E(),M(7,41),p(8,Ni,2,1,"mat-header-cell",37)(9,Li,3,1,"mat-cell",38),E(),M(10,42),p(11,ji,2,1,"mat-header-cell",37)(12,zi,3,1,"mat-cell",38),E(),M(13,43),p(14,$i,4,2,"mat-header-cell",44)(15,Yi,3,1,"mat-cell",38),E(),M(16,45),p(17,qi,4,2,"mat-header-cell",46)(18,Wi,2,1,"mat-cell",38),E(),M(19,47),p(20,Qi,3,2,"mat-header-cell",48)(21,Zi,3,5,"mat-cell",38),E(),M(22,49),p(23,Ji,4,2,"mat-header-cell",50)(24,Xi,3,4,"mat-cell",38),E(),M(25,51),p(26,en,2,1,"mat-header-cell",37)(27,tn,10,5,"mat-cell",52),E(),p(28,nn,1,0,"mat-header-row",53)(29,rn,1,3,"mat-row",54),r()),i&2){let e=d();c("dataSource",e.users),l(28),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns)}}var Ze=class i{constructor(t,e,n,a,m,g,y,ge){this.userService=t;this.branchService=e;this.authService=n;this.departmentService=a;this.roleService=m;this.snackbar=g;this.dialog=y;this.router=ge}displayedColumns=["select","username","emails","phones","branches_depts","role","status","createdAt","actions"];allUsers=[];filteredUsers=[];users=[];branches=[];departments=[];roles=[];total=0;page=0;size=10;q="";filterBranch="";filterDepartment="";filterRole="";filterStatus="";showDeleted=!1;allowShowDeleted=!1;loading=!1;selection=new Rt(!0,[]);sortField=null;sortDir="asc";paginator;ngOnInit(){this.loadFilters(),this.loadUsersOnce();let t=this.authService.getSnapshot();this.allowShowDeleted=si(t)}loadFilters(){this.branchService.getAll().subscribe(t=>this.branches=t||[]),this.departmentService.getAll().subscribe(t=>this.departments=t||[]),this.roleService.list().subscribe(t=>this.roles=t||[])}loadUsersOnce(){this.loading=!0,this.userService.list(0,999999,{}).pipe(ye(()=>this.loading=!1)).subscribe({next:t=>{this.allUsers=t.data||[],this.filteredUsers=[...this.allUsers],this.total=this.filteredUsers.length,this.applyFilters()},error:()=>{this.snackbar.open("Failed to load users","Close",{duration:3e3})}})}applyFilters(){let t=[...this.allUsers],e=(this.q||"").trim().toLowerCase();e&&(t=t.filter(n=>(n.username||"").toLowerCase().includes(e)||(n.emailAddresses||[]).some(a=>a.toLowerCase().includes(e))||(n.phoneNumbers||[]).some(a=>a.includes(e)))),this.filterBranch&&(t=t.filter(n=>(n.branchHierarchy||[]).some(a=>a.branchId===this.filterBranch))),this.filterDepartment&&(t=t.filter(n=>(n.branchHierarchy||[]).some(a=>(a.departments||[]).some(m=>m.departmentId===this.filterDepartment)))),this.filterRole&&(t=t.filter(n=>n.role===this.filterRole)),this.filterStatus==="active"?t=t.filter(n=>n.deleted===!1):this.filterStatus==="deleted"&&(t=t.filter(n=>n.deleted===!0)),!this.showDeleted&&this.filterStatus===""&&(t=t.filter(n=>!n.deleted)),this.sortField&&t.sort((n,a)=>this.compareForField(n,a,this.sortField,this.sortDir)),this.filteredUsers=t,this.total=t.length,this.selection.clear(),this.applyPagination()}compareForField(t,e,n,a){let m=a==="asc"?1:-1,g=null,y=null;switch(n){case"username":g=(t.username||"").toLowerCase(),y=(e.username||"").toLowerCase();break;case"role":g=(t.role||"").toLowerCase(),y=(e.role||"").toLowerCase();break;case"createdAt":g=t.createdAt?new Date(t.createdAt).getTime():0,y=e.createdAt?new Date(e.createdAt).getTime():0;break;case"email":g=t.emailAddresses&&t.emailAddresses[0]?t.emailAddresses[0].toLowerCase():"",y=e.emailAddresses&&e.emailAddresses[0]?e.emailAddresses[0].toLowerCase():"";break;case"phone":g=t.phoneNumbers&&t.phoneNumbers[0]?t.phoneNumbers[0]:"",y=e.phoneNumbers&&e.phoneNumbers[0]?e.phoneNumbers[0]:"";break;case"department":g=this.firstDepartmentName(t).toLowerCase(),y=this.firstDepartmentName(e).toLowerCase();break;case"branch":g=t.branchHierarchy&&t.branchHierarchy[0]&&t.branchHierarchy[0].branchName||"",y=e.branchHierarchy&&e.branchHierarchy[0]&&e.branchHierarchy[0].branchName||"",g=g.toLowerCase(),y=y.toLowerCase();break;case"status":g=t.deleted||"",y=e.deleted||"";break;default:g="",y=""}return g<y?-1*m:g>y?1*m:0}firstDepartmentName(t){if(!t.branchHierarchy||!t.branchHierarchy.length)return"";for(let e of t.branchHierarchy)if(e.departments&&e.departments.length){let n=e.departments[0];return n.departmentName||n.departmentId||""}return""}sortBy(t){this.sortField===t?this.sortDir=this.sortDir==="asc"?"desc":"asc":(this.sortField=t,this.sortDir="asc"),this.applyFilters()}applyPagination(){let t=this.page*this.size,e=t+this.size;this.users=this.filteredUsers.slice(t,e)}changePage(t){this.page=t.pageIndex,this.size=t.pageSize,this.applyPagination()}get bulkState(){let t=this.selection.selected;if(t.length===0)return null;let e=new Set(t.map(n=>n.deleted));return e.size>1?"mixed":e.has(!1)?"active":"deleted"}isAllSelected(){let t=this.selection.selected.length,e=this.users.length;return t===e&&e>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.users.forEach(t=>this.selection.select(t))}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"Deselect":"Select"} row ${t.username}`:`${this.isAllSelected()?"Deselect":"Select"} all`}toggleRowSelection(t){this.selection.toggle(t)}toggleActive(t){if(!t.deleted){this.dialog.open(X,{width:"420px",data:{title:"Disable User?",message:`Provide a reason for disabling ${t.username}.`,action:"DISABLE",confirmText:"Disable"}}).afterClosed().subscribe(a=>{a?.confirmed&&this.userService.softDelete(t.id,a.reason).subscribe({next:()=>{this.snackbar.open("User disabled","Close",{duration:2e3}),this.loadUsersOnce()}})});return}this.dialog.open(ut).afterClosed().subscribe(n=>{n&&(n==="RESTORE"?this.openRestoreDialog(t):n==="DELETE"&&this.openDeleteDialog(t))})}openRestoreDialog(t){this.dialog.open(X,{width:"420px",data:{title:"Restore User?",message:`Provide a reason for restoring ${t.username}.`,action:"RESTORE",confirmText:"Restore"}}).afterClosed().subscribe(n=>{n?.confirmed&&this.userService.restore(t.id,n.reason).subscribe({next:()=>{this.snackbar.open("User restored","Close",{duration:2e3}),this.loadUsersOnce()}})})}openDeleteDialog(t){this.dialog.open(X,{width:"420px",data:{title:"Delete Permanently?",message:`Provide an optional reason for deleting ${t.username}. This cannot be undone.`,action:"DELETE",confirmText:"Delete"}}).afterClosed().subscribe(n=>{n?.confirmed&&this.userService.hardDelete(t.id).subscribe({next:()=>{this.snackbar.open("User permanently deleted","Close",{duration:2e3}),this.loadUsersOnce()}})})}validateBulkStatus(){return new Set(this.selection.selected.map(e=>e.deleted)).size>1?(this.snackbar.open("Bulk action failed \u2014 selected users have mixed status","Close",{duration:2500}),!1):!0}bulkDisable(){if(!this.validateBulkStatus())return;let t=this.selection.selected;if(t[0].deleted){this.snackbar.open("All selected users are already disabled","Close",{duration:1500});return}this.dialog.open(X,{width:"480px",data:{title:"Disable Users?",message:`Provide a reason for disabling ${t.length} users.`,action:"DISABLE",confirmText:"Disable"}}).afterClosed().subscribe(n=>{if(!n?.confirmed)return;let a=t.map(m=>m.id);this.userService.softDeleteBulk(a,n.reason).subscribe({next:()=>{this.snackbar.open("Users disabled","Close",{duration:2e3}),this.loadUsersOnce()}})})}bulkRestore(){if(!this.validateBulkStatus())return;let t=this.selection.selected;if(!t[0].deleted){this.snackbar.open("Cannot restore active users","Close",{duration:1800});return}this.dialog.open(X,{width:"480px",data:{title:"Restore Users?",message:`Provide a reason for restoring ${t.length} user(s).`,action:"RESTORE",confirmText:"Restore"}}).afterClosed().subscribe(n=>{if(!n?.confirmed)return;let a=t.map(m=>m.id);this.userService.restoreBulk(a,n.reason).subscribe({next:()=>{this.snackbar.open("Users restored","Close",{duration:2e3}),this.loadUsersOnce()}})})}bulkDelete(){let t=this.selection.selected;if(this.bulkState!=="deleted"){this.snackbar.open("Only disabled users can be permanently deleted","Close",{duration:2e3});return}this.dialog.open(X,{width:"480px",data:{title:"Delete Users Permanently?",message:`You are about to permanently delete ${t.length} user(s). This cannot be undone.`,action:"DELETE",confirmText:"Delete"}}).afterClosed().subscribe(n=>{if(!n?.confirmed)return;let a=t.map(m=>m.id);this.userService.hardDeleteBulk(a).subscribe({next:()=>{this.snackbar.open("Users permanently deleted","Close",{duration:2e3}),this.loadUsersOnce()},error:()=>{this.snackbar.open("Bulk delete failed","Close",{duration:3e3})}})})}goCreate(){this.router.navigate(["/users/create"])}edit(t){this.router.navigate([`/users/${t.username}/edit`])}view(t){this.router.navigate([`/users/${t.username}`])}openBulkImport(){this.dialog.open(Ke,{width:"1100px",maxWidth:"95vw",maxHeight:"90vh",autoFocus:!1}).afterClosed().subscribe(t=>{t===!0&&this.loadUsersOnce()})}branchDeptRows(t){let e=[];return(t.branchHierarchy||[]).forEach(n=>{let a=n.branchName||"";!n.departments||!n.departments.length?e.push({branchName:a,departmentName:"\u2014",position:""}):(n.departments||[]).forEach(m=>{e.push({branchName:a,departmentName:m.departmentName||m.departmentId||"\u2014",position:m.position})})}),e}static \u0275fac=function(e){return new(e||i)(h(U),h(j),h(le),h(q),h(K),h(H),h(Pe),h(F))};static \u0275cmp=I({type:i,selectors:[["app-user-list"]],viewQuery:function(e,n){if(e&1&&Et($e,5),e&2){let a;It(a=kt())&&(n.paginator=a.first)}},decls:42,vars:21,consts:[[1,"page-container","p-4"],[1,"page-header","flex","items-center","mb-6"],[1,"text-xl","font-semibold"],[1,"flex","items-center","gap-2","ml-auto"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["class","flex items-center gap-3 mb-4",4,"ngIf"],[1,"flex","items-center","gap-4","mb-4"],["placeholder","Search username, email or phone number",1,"search-input","px-3","py-2","rounded","border",3,"ngModelChange","input","ngModel"],[3,"ngModel","ngModelChange","change",4,"ngIf"],[1,"filters","grid","grid-cols-1","md:grid-cols-auto-fit","md:grid-cols-[repeat(auto-fit,minmax(100px,1fr))]","gap-4","mb-6"],["appearance","fill"],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["appearance","fill",4,"ngIf"],["class","py-8 text-center text-gray-400",4,"ngIf"],[1,"table-wrapper"],["class","mat-elevation-z1 rounded bg-[var(--surface)]",3,"dataSource",4,"ngIf"],[3,"page","length","pageSize","pageSizeOptions"],[1,"flex","items-center","gap-3","mb-4"],[1,"font-medium","text-blue-500"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["class","text-red-500 font-medium",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"text-red-500","font-medium"],[3,"ngModelChange","change","ngModel"],[3,"value"],["value","active"],["value","deleted"],[1,"py-8","text-center","text-gray-400"],[1,"mat-elevation-z1","rounded","bg-[var(--surface)]",3,"dataSource"],["matColumnDef","select"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","username"],["class","sortable","matTooltip","Sort by username","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","emails"],["matColumnDef","phones"],["matColumnDef","branches_depts"],["class","sortable","matTooltip","Sort by branch or department","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","role"],["class","sortable","matTooltip","Sort by role","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","status"],["class","sortable","matTooltip","Sort by status","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","createdAt"],["class","sortable","matTooltip","Sort by date created","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","actions"],["class","action-cell",4,"matCellDef"],[4,"matHeaderRowDef"],["class","clickable-row",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[3,"change","checked","indeterminate"],[3,"click","change","checked"],["matTooltip","Sort by username","matTooltipPosition","above",1,"sortable",3,"click"],[1,"sort-icon"],[1,"text-blue-600","hover:underline",3,"click"],[1,"email-grid"],["class","email-item",4,"ngFor","ngForOf"],[1,"email-item"],[1,"phone-grid"],["class","phone-item",4,"ngFor","ngForOf"],[1,"phone-item"],["matTooltip","Sort by branch or department","matTooltipPosition","above",1,"sortable",3,"click"],[1,"branch-dept-table"],[4,"ngFor","ngForOf"],[1,"bd-row","bd-row-name"],[1,"bd-row","bd-row-department"],[1,"bd-row","bd-row-position"],["matTooltip","Sort by role","matTooltipPosition","above",1,"sortable",3,"click"],["matTooltip","Sort by status","matTooltipPosition","above",1,"sortable",3,"click"],["class","sort-icon",4,"ngIf"],[3,"ngClass"],["matTooltip","Sort by date created","matTooltipPosition","above",1,"sortable",3,"click"],[1,"action-cell"],["mat-icon-button","","matTooltip","View User Details","matTooltipPosition","above",3,"click"],["mat-icon-button","","matTooltip","Edit User","matTooltipPosition","above",3,"click"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],[1,"clickable-row",3,"click","ngClass"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),s(3," Users "),r(),o(4,"div",3)(5,"button",4),f("click",function(){return n.openBulkImport()}),o(6,"mat-icon"),s(7,"cloud_upload"),r(),s(8," Bulk Import "),r(),o(9,"button",5),f("click",function(){return n.goCreate()}),s(10," Create User "),r()()(),p(11,Ii,7,5,"div",6),o(12,"div",7)(13,"input",8),J("ngModelChange",function(m){return Z(n.q,m)||(n.q=m),m}),f("input",function(){return n.applyFilters()}),r(),p(14,ki,2,2,"mat-checkbox",9),r(),o(15,"div",10)(16,"mat-form-field",11)(17,"mat-label"),s(18,"Branch"),r(),o(19,"mat-select",12),J("ngModelChange",function(m){return Z(n.filterBranch,m)||(n.filterBranch=m),m}),f("selectionChange",function(){return n.applyFilters()}),o(20,"mat-option",13),s(21,"All"),r(),p(22,Di,2,2,"mat-option",14),r()(),o(23,"mat-form-field",11)(24,"mat-label"),s(25,"Department"),r(),o(26,"mat-select",12),J("ngModelChange",function(m){return Z(n.filterDepartment,m)||(n.filterDepartment=m),m}),f("selectionChange",function(){return n.applyFilters()}),o(27,"mat-option",13),s(28,"All"),r(),p(29,Ui,2,2,"mat-option",14),r()(),o(30,"mat-form-field",11)(31,"mat-label"),s(32,"Role"),r(),o(33,"mat-select",12),J("ngModelChange",function(m){return Z(n.filterRole,m)||(n.filterRole=m),m}),f("selectionChange",function(){return n.applyFilters()}),o(34,"mat-option",13),s(35,"All"),r(),p(36,Oi,2,2,"mat-option",14),r()(),p(37,Pi,10,1,"mat-form-field",15),r(),p(38,Ti,2,0,"div",16),o(39,"div",17),p(40,on,30,3,"mat-table",18),r(),o(41,"mat-paginator",19),f("page",function(m){return n.changePage(m)}),r()()),e&2&&(l(11),c("ngIf",n.selection.selected.length>0),l(2),Q("ngModel",n.q),w("aria-label","Search users"),l(),c("ngIf",n.allowShowDeleted),l(5),Q("ngModel",n.filterBranch),w("aria-label","Filter users by branch"),l(3),c("ngForOf",n.branches),l(4),Q("ngModel",n.filterDepartment),w("aria-label","Filter users by department"),l(3),c("ngForOf",n.departments),l(4),Q("ngModel",n.filterRole),w("aria-label","Filter users by role"),l(3),c("ngForOf",n.roles),l(),c("ngIf",n.allowShowDeleted),l(),c("ngIf",n.loading),l(2),c("ngIf",!n.loading),l(),c("length",n.total)("pageSize",n.size)("pageSizeOptions",Ut(20,xi)),w("aria-label","Users pagination"))},dependencies:[D,Tt,P,k,ne,Oe,N,B,Ft,ze,Te,Re,Be,Fe,Ae,Le,Ve,Ne,je,He,qt,$e,O,T,R,A,L,z,Nt,Vt,Y,$,me,G,V,ve,Ye,Ge,ni],styles:[".page-container[_ngcontent-%COMP%]{overflow-x:hidden;padding-top:0}mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:var(--text-secondary)!important;background:var(--surface)!important;padding:12px 16px}mat-cell[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem;padding:12px 16px}mat-cell[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{white-space:nowrap}.branch-grid[_ngcontent-%COMP%], .dept-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-table[_ngcontent-%COMP%]{width:100%;border-radius:6px;overflow-x:auto!important}.mat-column-username[_ngcontent-%COMP%], .mat-header-cell.mat-column-username[_ngcontent-%COMP%], .mat-column-emails[_ngcontent-%COMP%], .mat-header-cell.mat-column-emails[_ngcontent-%COMP%], .mat-column-phones[_ngcontent-%COMP%], .mat-header-cell.mat-column-phones[_ngcontent-%COMP%], .mat-column-branches_depts[_ngcontent-%COMP%], .mat-header-cell.mat-column-branches_depts[_ngcontent-%COMP%], .mat-column-role[_ngcontent-%COMP%], .mat-header-cell.mat-column-role[_ngcontent-%COMP%], .mat-column-status[_ngcontent-%COMP%], .mat-header-cell.mat-column-status[_ngcontent-%COMP%], .mat-column-createdAt[_ngcontent-%COMP%], .mat-header-cell.mat-column-createdAt[_ngcontent-%COMP%], .mat-column-actions[_ngcontent-%COMP%], .mat-header-cell.mat-column-actions[_ngcontent-%COMP%], .mat-column-select[_ngcontent-%COMP%], .mat-header-cell.mat-column-select[_ngcontent-%COMP%]{flex:0 0 auto!important;width:auto!important;max-width:none!important}.mat-column-username[_ngcontent-%COMP%]{min-width:160px}.mat-column-emails[_ngcontent-%COMP%]{min-width:250px}.mat-column-phones[_ngcontent-%COMP%]{min-width:140px}.mat-column-branches_depts[_ngcontent-%COMP%]{min-width:450px}.bd-row-name[_ngcontent-%COMP%]{min-width:100px!important}.bd-row-department[_ngcontent-%COMP%]{min-width:155px!important}.bd-row-position[_ngcontent-%COMP%]{min-width:100px!important}.mat-column-role[_ngcontent-%COMP%]{min-width:120px}.mat-column-status[_ngcontent-%COMP%]{min-width:110px}.mat-column-createdAt[_ngcontent-%COMP%]{min-width:230px}.mat-column-actions[_ngcontent-%COMP%]{min-width:150px;text-align:center}.mat-cell[_ngcontent-%COMP%]{padding:12px 16px;vertical-align:middle;word-break:break-word}.mat-column-select[_ngcontent-%COMP%]{width:48px;text-align:center}.mat-column-actions[_ngcontent-%COMP%]{width:120px;text-align:center}.mat-column-createdAt[_ngcontent-%COMP%]{width:160px;text-align:left}.email-grid[_ngcontent-%COMP%], .phone-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:7px;min-width:fit-content}.branch-dept-table[_ngcontent-%COMP%]{display:grid;grid-template-columns:.6fr 1fr 120px;gap:10px 15px;align-items:start;padding-top:10px;padding-bottom:10px;font-size:.9rem}.branch-dept-table[_ngcontent-%COMP%]   .bd-heading[_ngcontent-%COMP%]{font-weight:600;color:var(--text-secondary)}.branch-dept-table[_ngcontent-%COMP%]   .bd-row[_ngcontent-%COMP%]{color:var(--text-primary)}mat-paginator[_ngcontent-%COMP%]{margin-top:12px}.table-wrapper[_ngcontent-%COMP%]{display:block;border-radius:6px}@media (max-width: 900px){.search-input[_ngcontent-%COMP%]{width:100%}.branch-dept-table[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]})},ut=class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["ng-component"]],decls:11,vars:0,consts:[["mat-dialog-title",""],["align","end"],["mat-button","","mat-dialog-close","RESTORE"],["mat-button","","color","warn","mat-dialog-close","DELETE"],["mat-button","","mat-dialog-close",""]],template:function(e,n){e&1&&(o(0,"h2",0),s(1,"User is disabled"),r(),o(2,"mat-dialog-content"),s(3," Choose what you want to do with this user. "),r(),o(4,"mat-dialog-actions",1)(5,"button",2),s(6,"Restore"),r(),o(7,"button",3),s(8,"Delete Permanently"),r(),o(9,"button",4),s(10,"Cancel"),r()())},dependencies:[ve,Lt,jt,zt,Ht,R,A,O],encapsulation:2})};function an(i,t){i&1&&(o(0,"mat-icon"),s(1,"hourglass_top"),r())}function sn(i,t){i&1&&(o(0,"div",17),s(1,"Completed"),r())}function ln(i,t){if(i&1){let e=v();o(0,"div",12),f("click",function(){let a=u(e).index,m=d();return _(m.goTo(a))}),o(1,"div",13),s(2),r(),o(3,"div",14)(4,"div",15),s(5),r(),p(6,sn,2,0,"div",16),r()()}if(i&2){let e=t.$implicit,n=t.index,a=d();he("active",n===a.step)("completed",n<a.step),l(2),b(n+1),l(3),b(e),l(),c("ngIf",n<a.step)}}function mn(i,t){if(i&1){let e=v();o(0,"section")(1,"div",18)(2,"mat-form-field",19)(3,"mat-label"),s(4,"Username"),r(),C(5,"input",20),r(),o(6,"mat-form-field",19)(7,"mat-label"),s(8,"ID Number"),r(),C(9,"input",21),r()(),o(10,"div",22)(11,"button",23),f("click",function(){u(e);let a=d();return _(a.next())}),s(12,"Next"),r()()()}}function cn(i,t){if(i&1){let e=v();o(0,"section")(1,"mat-form-field",24)(2,"mat-label"),s(3,"Email addresses (comma separated)"),r(),o(4,"input",25),f("change",function(a){u(e);let m=d();return _(m.onEmailsChange(a))}),r()(),o(5,"mat-form-field",24)(6,"mat-label"),s(7,"Phone numbers (comma separated)"),r(),o(8,"input",26),f("change",function(a){u(e);let m=d();return _(m.onPhonesChange(a))}),r()(),o(9,"div",22)(10,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(11,"Previous"),r(),o(12,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(13,"Next"),r()()()}if(i&2){let e,n,a=d();l(4),c("value",(e=a.form.get("emailAddresses"))==null||e.value==null?null:e.value.join(", ")),l(4),c("value",(n=a.form.get("phoneNumbers"))==null||n.value==null?null:n.value.join(", "))}}function dn(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e),l(),b(e)}}function pn(i,t){i&1&&(o(0,"mat-error"),s(1," Passwords do not match "),r())}function un(i,t){if(i&1){let e=v();o(0,"section")(1,"mat-form-field",24)(2,"mat-label"),s(3,"Role"),r(),o(4,"mat-select",28),p(5,dn,2,2,"mat-option",29),r()(),o(6,"mat-form-field",24)(7,"mat-label"),s(8,"Password"),r(),C(9,"input",30),o(10,"button",31),f("click",function(){u(e);let a=d();return _(a.hidePw=!a.hidePw)}),o(11,"mat-icon"),s(12),r()()(),o(13,"mat-form-field",24)(14,"mat-label"),s(15,"Confirm Password"),r(),C(16,"input",32),o(17,"button",31),f("click",function(){u(e);let a=d();return _(a.hideConfirmPw=!a.hideConfirmPw)}),o(18,"mat-icon"),s(19),r()(),p(20,pn,2,0,"mat-error",6),r(),o(21,"div",22)(22,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(23,"Previous"),r(),o(24,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(25,"Next"),r()()()}if(i&2){let e,n=d();l(5),c("ngForOf",n.assignableRoles),l(4),c("type",n.hidePw?"password":"text"),l(3),b(n.hidePw?"visibility":"visibility_off"),l(4),c("type",n.hideConfirmPw?"password":"text"),l(3),b(n.hideConfirmPw?"visibility":"visibility_off"),l(),c("ngIf",(e=n.form.get("confirmPassword"))==null?null:e.hasError("pwMismatch"))}}function _n(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),b(e.name)}}function fn(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),x(" ",e.name," ")}}function gn(i,t){if(i&1){let e=v();o(0,"div",37)(1,"mat-form-field",38)(2,"mat-label"),s(3,"Branch"),r(),o(4,"mat-select",39),f("selectionChange",function(){let a=u(e).$implicit;return _(a.get("departmentId").setValue(""))}),p(5,_n,2,2,"mat-option",29),r()(),o(6,"mat-form-field",38)(7,"mat-label"),s(8,"Department"),r(),o(9,"mat-select",40),p(10,fn,2,2,"mat-option",29),r()(),o(11,"mat-form-field",41)(12,"mat-label"),s(13,"Position"),r(),o(14,"mat-select",42)(15,"mat-option",43),s(16,"Member"),r(),o(17,"mat-option",44),s(18,"Head"),r()()(),o(19,"button",45),f("click",function(){let a=u(e).index,m=d(2);return _(m.removeAssignment(a))}),o(20,"mat-icon"),s(21,"delete"),r()()()}if(i&2){let e=t.$implicit,n=d(2);c("formGroup",e),l(5),c("ngForOf",n.branches),l(5),c("ngForOf",n.departmentsForBranch(e.get("branchId").value))}}function hn(i,t){if(i&1){let e=v();o(0,"section")(1,"div",34),p(2,gn,22,3,"div",35),o(3,"button",23),f("click",function(){u(e);let a=d();return _(a.addAssignment())}),s(4,"Add Assignment"),r(),o(5,"div",36),s(6,"If none provided, system will apply MAIN \u2192 GENERAL by default."),r()(),o(7,"div",22)(8,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(9,"Previous"),r(),o(10,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(11,"Next"),r()()()}if(i&2){let e=d();l(2),c("ngForOf",e.assignments.controls)}}function bn(i,t){if(i&1&&C(0,"img",61),i&2){let e=d().index,n=d(2);c("src",n.previews[e].src,yt)}}function vn(i,t){if(i&1&&(o(0,"div",62)(1,"mat-icon"),s(2,"picture_as_pdf"),r(),o(3,"span"),s(4),r()()),i&2){let e=d().index,n=d(2);l(4),b(n.previews[e].name)}}function xn(i,t){if(i&1&&(o(0,"mat-option",33),s(1),r()),i&2){let e=t.$implicit;c("value",e),l(),x(" ",e," ")}}function Cn(i,t){i&1&&(o(0,"mat-form-field",19)(1,"mat-label"),s(2,"Enter description"),r(),C(3,"input",63),r())}function yn(i,t){if(i&1){let e=v();o(0,"div",51)(1,"div",52),f("click",function(){let a=u(e).index,m=d(2);return _(m.viewFile(a))}),p(2,bn,1,1,"img",53)(3,vn,5,1,"div",54),r(),o(4,"div",55)(5,"div",56),s(6),r(),o(7,"mat-form-field",19)(8,"mat-label"),s(9,"Description"),r(),o(10,"mat-select",57),p(11,xn,2,2,"mat-option",29),r()(),p(12,Cn,4,0,"mat-form-field",58),o(13,"div",59)(14,"button",60),f("click",function(){let a=u(e).index,m=d(2);return _(m.viewFile(a))}),o(15,"mat-icon"),s(16,"visibility"),r(),s(17," View "),r(),o(18,"button",45),f("click",function(){let a=u(e).index,m=d(2);return _(m.removeFile(a))}),o(19,"mat-icon"),s(20,"close"),r()()()()()}if(i&2){let e,n=t.$implicit,a=t.index,m=d(2);c("formGroupName",a),l(2),c("ngIf",m.previews[a].src),l(),c("ngIf",m.previews[a].type==="application/pdf"),l(3),b(m.previews[a].name),l(5),c("ngForOf",m.descriptionOptions),l(),c("ngIf",((e=n.get("type"))==null?null:e.value)==="Other")}}function wn(i,t){if(i&1){let e=v();o(0,"section",46)(1,"div",47)(2,"input",48),f("change",function(a){u(e);let m=d();return _(m.onFilesPicked(a))}),r(),o(3,"button",23),f("click",function(){u(e);let a=d();return _(a.openFilePicker())}),s(4,"Upload files"),r(),o(5,"div",49),p(6,yn,21,6,"div",50),r()(),o(7,"div",22)(8,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(9,"Previous"),r(),o(10,"button",27),f("click",function(){u(e);let a=d();return _(a.next())}),s(11,"Next"),r()()()}if(i&2){let e=d();c("formArrayName","files"),l(6),c("ngForOf",e.filesArray.controls)}}function Sn(i,t){if(i&1&&(o(0,"li"),s(1),r()),i&2){let e=t.$implicit;l(),be(" ",e.value.file==null?null:e.value.file.name," \u2014 ",e.value.type==="Other"?e.value.custom||"Other":e.value.type," ")}}function Mn(i,t){if(i&1&&(o(0,"ul"),p(1,Sn,2,2,"li",69),r()),i&2){let e=d(2);l(),c("ngForOf",e.filesArray.controls)}}function En(i,t){i&1&&(o(0,"span",36),s(1,"No files uploaded"),r())}function In(i,t){if(i&1&&(o(0,"li"),s(1),r()),i&2){let e=t.$implicit,n=d(2);l(),Dt(" ",n.getBranchName(e.branchId)," \u2192 ",n.getDeptName(e.departmentId)," (",e.position,") ")}}function kn(i,t){if(i&1){let e=v();o(0,"section")(1,"div",64)(2,"h3",65),s(3,"Summary"),r(),o(4,"div",66)(5,"div",67)(6,"dt"),s(7,"Username"),r(),o(8,"dd"),s(9),r(),o(10,"dt"),s(11,"ID Number"),r(),o(12,"dd"),s(13),r(),o(14,"dt"),s(15,"Emails"),r(),o(16,"dd"),s(17),r()(),o(18,"div",67)(19,"dt"),s(20,"Phones"),r(),o(21,"dd"),s(22),r(),o(23,"dt"),s(24,"Role"),r(),o(25,"dd"),s(26),r(),o(27,"dt"),s(28,"Files"),r(),o(29,"dd"),p(30,Mn,2,1,"ul",68)(31,En,2,0,"ng-template",null,0,Me),r()()(),o(33,"dt"),s(34,"Assignments"),r(),o(35,"dd")(36,"ul"),p(37,In,2,3,"li",69),r()()(),o(38,"div",22)(39,"button",23),f("click",function(){u(e);let a=d();return _(a.prev())}),s(40,"Previous"),r(),o(41,"button",70),f("click",function(){u(e);let a=d();return _(a.submit())}),s(42,"Create User"),r()()()}if(i&2){let e=Se(32),n=d();l(9),b(n.form.value.username),l(4),b(n.form.value.idNumber||"\u2014"),l(4),b((n.form.value.emailAddresses==null?null:n.form.value.emailAddresses.join(", "))||"\u2014"),l(5),b((n.form.value.phoneNumbers==null?null:n.form.value.phoneNumbers.join(", "))||"\u2014"),l(4),b(n.form.value.role),l(4),c("ngIf",n.filesArray.length)("ngIfElse",e),l(7),c("ngForOf",n.assignments.value)}}var Je=class i{constructor(t,e,n,a,m,g,y,ge,_r,fr){this.fb=t;this.userService=e;this.branchService=n;this.departmentService=a;this.roleService=m;this.auth=g;this.snackbar=y;this.cdr=ge;this.dialog=_r;this.router=fr}steps=["Basic","Contacts","Role","Branches and Departments Assignments","Files","Review"];step=0;maxStep=5;form;branches=[];departments=[];assignableRoles=[];hidePw=!0;hideConfirmPw=!0;files=[];previews=[];descriptionOptions=["ID","Passport","Signature","CV","Other"];get filesArray(){return this.form.get("files")}busy=!1;get assignments(){return this.form.get("departmentsAndPositions")}ngOnInit(){this.form=this.fb.group({username:["",S.required],idNumber:[""],emailAddresses:[[]],phoneNumbers:[[]],role:["",S.required],password:["",[S.required,S.minLength(8)]],confirmPassword:["",S.required],departmentsAndPositions:this.fb.array([]),files:this.fb.array([])},{validators:this.passwordValidator}),this.loadBranches(),this.loadDepts(),this.loadRoles(),this.addAssignment()}newFileGroup(t){let e=this.fb.group({file:[t],type:["ID",S.required],custom:[""]});return e.get("type").valueChanges.subscribe(n=>{let a=e.get("custom");n==="Other"?a?.setValidators([S.required,S.minLength(3)]):(a?.clearValidators(),a?.setValue("")),a?.updateValueAndValidity()}),e}get pwMismatch(){return this.form.get("confirmPassword")?.hasError("pwMismatch")}passwordValidator(t){let e=t.get("password").value,n=t.get("confirmPassword").value,a=t.get("confirmPassword");return!e||!n?(a?.setErrors(null),null):e!==n?(a?.setErrors({pwMismatch:!0}),{pwMismatch:!0}):(a?.setErrors(null),null)}validateEmailsPhones(){let t=this.form.get("emailAddresses").value||[],e=this.form.get("phoneNumbers").value||[],n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;for(let m of t)if(m&&!n.test(m))return this.snackbar.open(`Invalid email: ${m}`,"Close",{duration:1800}),!1;let a=/^\+?\d{7,15}$/;for(let m of e)if(m&&!a.test(m))return this.snackbar.open(`Invalid phone number: ${m}`,"Close",{duration:1800}),!1;return!0}validateAssignments(){let t=this.assignments.controls;for(let a=0;a<t.length;a++){let m=t[a].value;if(!m.branchId||!m.departmentId)return this.snackbar.open("Fill all assignment fields","Close",{duration:1800}),!1}let e=new Set;for(let a=0;a<t.length;a++){let m=t[a].value,g=`${m.branchId}::${m.departmentId}`;if(e.has(g))return this.snackbar.open("Duplicate branch/department assignment","Close",{duration:1800}),!1;e.add(g)}let n=new Map;for(let a=0;a<t.length;a++){let m=t[a].value,g=m.departmentId,y=(m.position||"").toLowerCase(),ge=n.get(g)||new Set;ge.add(y),n.set(g,ge)}for(let[a,m]of n.entries())if(m.has("head")&&m.has("member"))return this.snackbar.open("A department cannot have the same user as both Head and Member","Close",{duration:2e3}),!1;return!0}validateStep(t){switch(t){case 0:return this.form.get("username").valid;case 1:return this.validateEmailsPhones();case 2:let e=this.form.get("role").valid,n=!this.pwMismatch&&this.form.get("password").valid&&this.form.get("confirmPassword").valid;return e&&n;case 3:return this.validateAssignments();case 4:return!0;case 5:return!0;default:return!1}}loadBranches(){this.branchService.getAll(!1).pipe(Ce(()=>ee([]))).subscribe(t=>{console.log(t),this.branches=t})}loadDepts(){this.departmentService.getAll(!1).pipe(Ce(()=>ee([]))).subscribe(t=>{console.log(t),this.departments=t})}loadRoles(){this.roleService.list().pipe(Ce(()=>ee([]))).subscribe(t=>{let e=t.map(g=>typeof g=="string"?g:g.name),n=["EMPLOYEE","SUPERVISOR","MANAGER","ADMIN","SUPERUSER"],a=this.auth.getSnapshot()?.role??"",m=n.indexOf(a);this.assignableRoles=e.filter(g=>n.indexOf(g)<=m)})}onEmailsChange(t){let n=t.target.value.split(",").map(a=>a.trim()).filter(a=>a.includes("@"));this.form.get("emailAddresses").setValue(n)}onPhonesChange(t){let n=t.target.value.split(",").map(a=>a.trim()).filter(a=>a.length>=7);this.form.get("phoneNumbers").setValue(n)}newAssignment(){return this.fb.group({branchId:["",S.required],departmentId:["",S.required],position:["member",S.required]})}addAssignment(){this.assignments.push(this.newAssignment())}removeAssignment(t){this.assignments.removeAt(t)}departmentsForBranch(t){return this.departments.filter(e=>e.branches?.some(n=>n.id===t))}getBranchName(t){return this.branches.find(e=>e.id===t)?.name}getDeptName(t){return this.departments.find(e=>e.id===t)?.name}openFilePicker(){document.getElementById("fileInput").click()}onFilesPicked(t){let e=t.target.files;if(e){for(let n=0;n<e.length;n++){let a=e.item(n);if(this.files.push(a),this.filesArray.push(this.newFileGroup(a)),a.type.startsWith("image/")){let m=new FileReader;m.onload=()=>{this.previews.push({src:m.result,name:a.name,type:a.type})},m.readAsDataURL(a)}else this.previews.push({name:a.name,type:a.type})}t.target.value=""}}removeFile(t){this.files.splice(t,1),this.previews.splice(t,1),this.filesArray.removeAt(t)}viewFile(t){this.dialog.open(Wt,{data:{file:this.files[t],preview:this.previews[t]},width:"80%",maxWidth:"1100px"})}next(){if(!this.validateStep(this.step)){this.snackbar.open("Please complete this step before continuing","Close",{duration:1800});return}this.step<this.maxStep&&this.step++}prev(){this.step>0&&this.step--}goTo(t){if(t<this.step){this.step=t;return}for(let e=0;e<t;e++)if(!this.validateStep(e)){this.snackbar.open("Please complete previous steps first","Close",{duration:1800});return}this.step=t}submit(){let t=new FormData;t.append("username",this.form.value.username),t.append("password",this.form.value.password),t.append("role",this.form.value.role),t.append("idNumber",this.form.value.idNumber),this.form.value.emailAddresses?.forEach((e,n)=>{t.append(`emailAddresses[${n}]`,e)}),this.form.value.phoneNumbers?.forEach((e,n)=>{t.append(`phoneNumbers[${n}]`,e)}),this.assignments.value.forEach((e,n)=>{t.append(`departmentsAndPositions[${n}].branchId`,e.branchId),t.append(`departmentsAndPositions[${n}].departmentId`,e.departmentId),t.append(`departmentsAndPositions[${n}].position`,e.position)}),this.filesArray.controls.forEach((e,n)=>{let a=e.value.file,m=e.value.type,g=e.value.custom;t.append(`userFiles[${n}].file`,a,a.name),t.append(`userFiles[${n}].description`,m==="Other"?g:m)}),this.busy=!0,this.userService.create(t).pipe(ye(()=>this.busy=!1)).subscribe({next:()=>{this.snackbar.open("User created","Close",{duration:2e3}),this.router.navigate(["/users"])},error:()=>this.snackbar.open("Failed to create user","Close",{duration:2e3})})}static \u0275fac=function(e){return new(e||i)(h(Ue),h(U),h(j),h(q),h(K),h(le),h(H),h(ot),h(Pe),h(F))};static \u0275cmp=I({type:i,selectors:[["app-user-create"]],decls:18,vars:10,consts:[["noFiles",""],[1,"user-create-root",3,"formGroup"],[1,"wizard-header"],[1,"right"],["mat-stroked-button","",1,"cancel-button",3,"click"],["mat-flat-button","","color","primary",1,"save-button",3,"click","disabled"],[4,"ngIf"],[1,"create-body"],[1,"wizard-steps"],["class","step",3,"active","completed","click",4,"ngFor","ngForOf"],[1,"wizard-body"],[3,"formArrayName",4,"ngIf"],[1,"step",3,"click"],[1,"num"],[1,"label"],[1,"title"],["class","subtitle",4,"ngIf"],[1,"subtitle"],[1,"grid"],["appearance","fill"],["matInput","","formControlName","username","placeholder","e.g. j.smith"],["matInput","","formControlName","idNumber","placeholder","Optional"],[1,"nav"],["mat-stroked-button","",3,"click"],["appearance","fill",1,"w-full"],["matInput","","placeholder","alice@example.com, bob@acme.test",3,"change","value"],["matInput","","placeholder","0712xxxxxxx, +254712xxxxxx",3,"change","value"],["mat-stroked-button","","color","primary",3,"click"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","confirmPassword",3,"type"],[3,"value"],[1,"assignments"],["class","assignment-row",3,"formGroup",4,"ngFor","ngForOf"],[1,"muted"],[1,"assignment-row",3,"formGroup"],["appearance","fill",1,"col"],["formControlName","branchId",3,"selectionChange"],["formControlName","departmentId"],["appearance","fill",1,"col-fluid"],["formControlName","position"],["value","member"],["value","head"],["mat-icon-button","","color","warn",3,"click"],[3,"formArrayName"],[1,"files-section"],["id","fileInput","type","file","hidden","","multiple","","accept","image/*,application/pdf",3,"change"],[1,"preview-grid"],["class","preview-card",3,"formGroupName",4,"ngFor","ngForOf"],[1,"preview-card",3,"formGroupName"],[1,"thumb",3,"click"],[3,"src",4,"ngIf"],["class","pdf-placeholder",4,"ngIf"],[1,"meta"],[1,"filename"],["formControlName","type"],["appearance","fill",4,"ngIf"],[1,"card-actions"],["mat-button","",3,"click"],[3,"src"],[1,"pdf-placeholder"],["matInput","","formControlName","custom"],[1,"review-card"],[1,"summary-title"],[1,"summary-grid"],[1,"col"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,n){e&1&&(o(0,"div",1)(1,"header",2)(2,"div",3)(3,"button",4),f("click",function(){return n.router.navigate(["/users"])}),s(4," Cancel "),r(),o(5,"button",5),f("click",function(){return n.submit()}),p(6,an,2,0,"mat-icon",6),s(7," Save "),r()()(),o(8,"div",7)(9,"nav",8),p(10,ln,7,7,"div",9),r(),o(11,"main",10),p(12,mn,13,0,"section",6)(13,cn,14,2,"section",6)(14,un,26,6,"section",6)(15,hn,12,1,"section",6)(16,wn,12,2,"section",11)(17,kn,43,8,"section",6),r()()()),e&2&&(c("formGroup",n.form),l(5),c("disabled",n.busy),l(),c("ngIf",n.busy),l(4),c("ngForOf",n.steps),l(2),c("ngIf",n.step===0),l(),c("ngIf",n.step===1),l(),c("ngIf",n.step===2),l(),c("ngIf",n.step===3),l(),c("ngIf",n.step===4),l(),c("ngIf",n.step===5))},dependencies:[D,P,k,Oe,N,B,re,se,oe,ae,ke,De,ce,$,me,Gt,Yt,pe,de,Y,G,V,R,A,L,O,T,z,ve],styles:[".user-create-root[_ngcontent-%COMP%]{display:block;padding-top:0}.wizard-header[_ngcontent-%COMP%]{height:80px;position:sticky;top:0;z-index:50;background:var(--surface);border-bottom:1px solid var(--border);padding:12px 18px;display:flex;justify-content:flex-end;align-items:center;margin-top:0;box-shadow:2px 3px 5px 1px #00000040!important}.create-body[_ngcontent-%COMP%]{margin-top:10px;overflow-y:auto}.wizard-steps[_ngcontent-%COMP%]{margin-top:10px;background:var(--surface);display:flex;gap:12px;overflow-x:auto;padding:8px;box-shadow:1px 2px 3px #00000059!important}.step[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:10px;font-size:.9rem;padding:5px 10px;background:var(--surface);border:1px solid var(--border);border-radius:6px;cursor:pointer;box-shadow:1px 1px 1px 1px #0003!important;white-space:nowrap;width:auto;min-width:max-content;flex-shrink:0}.step[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{width:max-content}.step.active[_ngcontent-%COMP%]{background:#1a73e824;border-color:#1a73e873;color:var(--success)}.step.active[_ngcontent-%COMP%]   .num[_ngcontent-%COMP%]{background:var(--active);color:#fff}.step.completed[_ngcontent-%COMP%]   .num[_ngcontent-%COMP%]{background:var(--success);color:#fff}.step.completed[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:var(--text-success)}.num[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;background:var(--surface-hover);display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:1px 1px 1px 1px #00000017!important}.cancel-button[_ngcontent-%COMP%]{margin-right:5px}.wizard-body[_ngcontent-%COMP%]{padding:32px 10px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.assignments[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.assignment-row[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.col[_ngcontent-%COMP%]{width:220px}.col-fluid[_ngcontent-%COMP%]{flex:1}.preview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}.preview-card[_ngcontent-%COMP%]{border:1px solid var(--border);background:var(--surface);border-radius:8px;overflow:hidden;display:flex;flex-direction:column}.thumb[_ngcontent-%COMP%]{height:160px;background:var(--surface-hover);display:flex;justify-content:center;align-items:center;cursor:pointer}.thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.pdf-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--text-secondary)}.meta[_ngcontent-%COMP%]{padding:12px;display:flex;flex-direction:column;gap:8px}.filename[_ngcontent-%COMP%]{font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:8px}.review-card[_ngcontent-%COMP%]{box-shadow:0 0 1px 1px #00000059!important;border-radius:8px;padding:20px;align-self:center}.summary-title[_ngcontent-%COMP%]{text-align:left;font-weight:500;font-size:1.2rem;margin-bottom:10px}.summary-grid[_ngcontent-%COMP%]{display:flex;gap:24px}dt[_ngcontent-%COMP%]{font-weight:700;margin-top:12px;color:var(--text-secondary)}.nav[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px}"]})};function Un(i,t){if(i&1&&(o(0,"mat-option",18),s(1),r()),i&2){let e=t.$implicit;c("value",e.name),l(),x(" ",e.name," ")}}function On(i,t){if(i&1&&(o(0,"mat-option",18),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),x(" ",e.name," ")}}function Pn(i,t){i&1&&(o(0,"mat-option",27),s(1," No departments for this branch "),r())}function Tn(i,t){if(i&1&&(o(0,"mat-option",18),s(1),r()),i&2){let e=t.$implicit;c("value",e.id),l(),x(" ",e.name," ")}}function An(i,t){if(i&1){let e=v();o(0,"div",19)(1,"mat-form-field",9)(2,"mat-label"),s(3,"Branch"),r(),o(4,"mat-select",20),p(5,On,2,2,"mat-option",13),r()(),o(6,"mat-form-field",9)(7,"mat-label"),s(8,"Department"),r(),o(9,"mat-select",21),p(10,Pn,2,0,"mat-option",22)(11,Tn,2,2,"mat-option",13),r()(),o(12,"mat-form-field",9)(13,"mat-label"),s(14,"Position"),r(),o(15,"mat-select",23)(16,"mat-option",24),s(17,"Member"),r(),o(18,"mat-option",25),s(19,"Head"),r()()(),o(20,"button",26),f("click",function(){let a=u(e).index,m=d(2);return _(m.removeAssignment(a))}),o(21,"mat-icon"),s(22,"delete"),r()()()}if(i&2){let e=t.$implicit,n=d(2);c("formGroup",e),l(5),c("ngForOf",n.branches),l(5),c("ngIf",n.departmentsForBranch(e.get("branchId").value).length===0),l(),c("ngForOf",n.departmentsForBranch(e.get("branchId").value))}}function Rn(i,t){if(i&1){let e=v();o(0,"div",1)(1,"div",2)(2,"div")(3,"h2"),s(4,"Edit User"),r(),o(5,"div",3),s(6),r()(),o(7,"div",4)(8,"button",5),f("click",function(){u(e);let a=d();return _(a.cancel())}),s(9,"Cancel"),r(),o(10,"button",6),f("click",function(){u(e);let a=d();return _(a.submit())}),s(11," Save Changes "),r()()(),o(12,"form",7)(13,"mat-card")(14,"h3"),s(15,"Basic Information"),r(),o(16,"div",8)(17,"mat-form-field",9)(18,"mat-label"),s(19,"Username"),r(),C(20,"input",10),r(),o(21,"mat-form-field",9)(22,"mat-label"),s(23,"ID Number"),r(),C(24,"input",11),r()(),o(25,"mat-form-field",9)(26,"mat-label"),s(27,"Role"),r(),o(28,"mat-select",12),p(29,Un,2,2,"mat-option",13),r()()(),o(30,"mat-card")(31,"h3"),s(32,"Contact"),r(),o(33,"mat-form-field",9)(34,"mat-label"),s(35,"Email Addresses"),r(),C(36,"input",14),r(),o(37,"mat-form-field",9)(38,"mat-label"),s(39,"Phone Numbers"),r(),C(40,"input",15),r()(),o(41,"mat-card")(42,"h3"),s(43,"Branch & Department Assignments"),r(),p(44,An,23,4,"div",16),o(45,"button",17),f("click",function(){u(e);let a=d();return _(a.addAssignment())}),o(46,"mat-icon"),s(47,"add"),r(),s(48," Add Assignment "),r()()()()}if(i&2){let e=d();l(6),x("Users / ",e.originalUsername," / Edit"),l(4),c("disabled",e.form.invalid),l(2),c("formGroup",e.form),l(17),c("ngForOf",e.roles),l(15),c("ngForOf",e.assignments.controls)}}var Xe=class i{constructor(t,e,n,a,m,g,y,ge){this.route=t;this.router=e;this.fb=n;this.userService=a;this.roleService=m;this.branchService=g;this.departmentService=y;this.snackbar=ge}form;originalUsername="";roles=[];branches=[];departments=[];ngOnInit(){let t=this.route.snapshot.paramMap.get("username");t&&(this.originalUsername=t,this.form=this.fb.group({username:["",S.required],idNumber:[""],role:["",S.required],emailsInput:[""],phonesInput:[""],departmentsAndPositions:this.fb.array([])}),this.roleService.list().subscribe(e=>this.roles=e),this.branchService.getAll().subscribe(e=>this.branches=e),this.departmentService.getAll().subscribe(e=>this.departments=e),this.userService.get(t).subscribe(e=>this.patchUser(e)))}get assignments(){return this.form.get("departmentsAndPositions")}addAssignment(t){let e=this.fb.group({branchId:[t?.branchId||"",S.required],departmentId:[t?.departmentId||"",S.required],position:[t?.position||"member",S.required]});e.get("branchId").valueChanges.subscribe(()=>{e.get("departmentId").reset()}),this.assignments.push(e)}removeAssignment(t){this.assignments.removeAt(t)}departmentsForBranch(t){return t?this.departments.filter(e=>e.branches?.some(n=>n.id===t)):[]}patchUser(t){this.form.patchValue({username:t.username,idNumber:t.idNumber,role:t.role,emailsInput:(t.emailAddresses||[]).join(", "),phonesInput:(t.phoneNumbers||[]).join(", ")}),this.assignments.clear(),t.branchHierarchy?.length&&this.hydrateAssignmentsFromHierarchy(t.branchHierarchy)}hydrateAssignmentsFromHierarchy(t){t.forEach(e=>{e.departments.forEach(n=>{this.addAssignment({branchId:e.branchId,departmentId:n.departmentId,position:n.position?.toLowerCase()==="head"?"head":"member"})})})}submit(){if(this.form.invalid)return;let t={username:this.form.value.username,idNumber:this.form.value.idNumber,role:this.form.value.role,emailAddresses:this.split(this.form.value.emailsInput),phoneNumbers:this.split(this.form.value.phonesInput),departmentsAndPositions:this.assignments.value};this.userService.update(this.originalUsername,t).subscribe({next:()=>{this.snackbar.open("User updated successfully","Close",{duration:2e3}),this.router.navigate(["/users",t.username])},error:()=>this.snackbar.open("Failed to update user","Close",{duration:3e3})})}cancel(){this.router.navigate(["/users",this.originalUsername])}split(t){return(t||"").split(",").map(e=>e.trim()).filter(Boolean)}static \u0275fac=function(e){return new(e||i)(h(Ee),h(F),h(Ue),h(U),h(K),h(j),h(q),h(H))};static \u0275cmp=I({type:i,selectors:[["app-user-edit"]],decls:1,vars:1,consts:[["class","user-edit-root",4,"ngIf"],[1,"user-edit-root"],[1,"page-header"],[1,"breadcrumb"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"form-grid",3,"formGroup"],[1,"grid-2"],["appearance","fill"],["matInput","","formControlName","username"],["matInput","","formControlName","idNumber"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","emailsInput","placeholder","comma-separated"],["matInput","","formControlName","phonesInput","placeholder","comma-separated"],["class","assignment-row",3,"formGroup",4,"ngFor","ngForOf"],["mat-stroked-button","","type","button",3,"click"],[3,"value"],[1,"assignment-row",3,"formGroup"],["formControlName","branchId"],["formControlName","departmentId"],["disabled","",4,"ngIf"],["formControlName","position"],["value","member"],["value","head"],["mat-icon-button","","color","warn",3,"click"],["disabled",""]],template:function(e,n){e&1&&p(0,Rn,49,5,"div",0),e&2&&c("ngIf",n.form)},dependencies:[D,P,k,se,Ie,N,B,re,oe,ae,We,qe,ce,$,me,Y,G,V,pe,de,R,A,L,O,T,z],styles:[".user-edit-root[_ngcontent-%COMP%]{max-width:1100px;margin:auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600}.page-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.page-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;gap:1rem}mat-card[_ngcontent-%COMP%]{padding:1rem}mat-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;font-weight:600}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}.assignment-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 160px auto;gap:.75rem;align-items:center;margin-bottom:.5rem}"]})};var mi=i=>({listImages:t=>i.listImages(t),listImageAudits:t=>i.imageAuditTarget(t),getImageBlob:(t,e,n)=>i.getUserImageBlob(t,e,n??!1),uploadImages:(t,e)=>i.uploadImages(t,e),softDeleteImage:(t,e)=>i.softDeleteImage(t,e),restoreImage:(t,e)=>i.restoreImage(t,e),hardDeleteImage:(t,e)=>i.hardDeleteImage(t,e)});function Fn(i,t){if(i&1&&(o(0,"div",3)(1,"mat-icon"),s(2,"history"),r(),o(3,"div",4)(4,"div",5),s(5),r(),o(6,"div",6),s(7),te(8,"date"),r(),o(9,"div",7),s(10),r()()()),i&2){let e=t.$implicit;l(5),b(e.action),l(2),be(" ",ie(8,5,e.timestamp,"medium")," \u2014 by ",e.performedByUsername," "),l(3),be(" ",e.oldValue||"\u2014"," \u2192 ",e.newValue||"\u2014"," ")}}function Vn(i,t){i&1&&(o(0,"div",8),s(1," No audit records "),r())}var et=class i{constructor(t){this.userService=t}userId;audits=[];ngOnInit(){this.userId&&this.userService.auditsForUser(this.userId).subscribe(t=>this.audits=t||[])}static \u0275fac=function(e){return new(e||i)(h(U))};static \u0275cmp=I({type:i,selectors:[["app-user-audit-timeline"]],inputs:{userId:"userId"},decls:3,vars:2,consts:[[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],["class","muted",4,"ngIf"],[1,"timeline-item"],[1,"content"],[1,"title"],[1,"meta"],[1,"change"],[1,"muted"]],template:function(e,n){e&1&&(o(0,"div",0),p(1,Fn,11,8,"div",1)(2,Vn,2,0,"div",2),r()),e&2&&(l(),c("ngForOf",n.audits),l(),c("ngIf",!n.audits.length))},dependencies:[D,P,k,ne,O,T],styles:["[_nghost-%COMP%]{display:block}.timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px;padding:16px}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:12px;padding:12px;border:1px solid var(--border);border-radius:6px;background:var(--surface)}.timeline-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:20px;margin-top:2px}.timeline-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.timeline-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;font-size:.95rem}.timeline-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.timeline-item[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{font-size:.85rem}.muted[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}"]})};function Nn(i,t){i&1&&(o(0,"th",11),s(1," Time "),r())}function Bn(i,t){if(i&1&&(o(0,"td",12),s(1),te(2,"date"),r()),i&2){let e=t.$implicit,n=d();l(),x(" ",ie(2,1,e.timestamp,n.DATE_FORMAT)," ")}}function Ln(i,t){i&1&&(o(0,"th",11),s(1," Branch "),r())}function jn(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),b(e.branchName)}}function Hn(i,t){i&1&&(o(0,"th",11),s(1," Department "),r())}function zn(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),b(e.departmentName)}}function $n(i,t){i&1&&(o(0,"th",11),s(1," Status "),r())}function Gn(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),b(e.status)}}function Yn(i,t){i&1&&(o(0,"th",11),s(1," Method "),r())}function qn(i,t){if(i&1&&(o(0,"td",12),s(1),r()),i&2){let e=t.$implicit;l(),b(e.method)}}function Wn(i,t){i&1&&C(0,"tr",13)}function Kn(i,t){i&1&&C(0,"tr",14)}function Qn(i,t){i&1&&(o(0,"div",15),s(1,` No rollcalls found
`),r())}var tt=class i{constructor(t){this.userService=t}userId;displayedColumns=["time","branch","department","status","method"];rollcalls=[];DATE_FORMAT="dd/MM/yy, hh:mm a";ngOnInit(){this.userId&&(this.userService.getUserRollcalls(this.userId).subscribe(t=>this.rollcalls=t||[]),console.log(this.rollcalls))}static \u0275fac=function(e){return new(e||i)(h(U))};static \u0275cmp=I({type:i,selectors:[["app-user-rollcalls"]],inputs:{userId:"userId"},decls:19,vars:4,consts:[["mat-table","",1,"rollcall-table",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","branch"],["matColumnDef","department"],["matColumnDef","status"],["matColumnDef","method"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","muted",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"muted"]],template:function(e,n){e&1&&(o(0,"table",0),M(1,1),p(2,Nn,2,0,"th",2)(3,Bn,3,4,"td",3),E(),M(4,4),p(5,Ln,2,0,"th",2)(6,jn,2,1,"td",3),E(),M(7,5),p(8,Hn,2,0,"th",2)(9,zn,2,1,"td",3),E(),M(10,6),p(11,$n,2,0,"th",2)(12,Gn,2,1,"td",3),E(),M(13,7),p(14,Yn,2,0,"th",2)(15,qn,2,1,"td",3),E(),p(16,Wn,1,0,"tr",8)(17,Kn,1,0,"tr",9),r(),p(18,Qn,2,0,"div",10)),e&2&&(c("dataSource",n.rollcalls),l(16),c("matHeaderRowDef",n.displayedColumns),l(),c("matRowDefColumns",n.displayedColumns),l(),c("ngIf",!n.rollcalls.length))},dependencies:[D,k,ne,ze,Te,Re,Be,Fe,Ae,Le,Ve,Ne,je,He],styles:["[_nghost-%COMP%]{display:block}.rollcall-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:12px}.rollcall-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;font-weight:700;color:var(--text-secondary);padding:10px;border-bottom:1px solid var(--border)}.rollcall-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;font-size:.85rem;border-bottom:1px solid var(--border)}.rollcall-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:var(--surface-hover)}.muted[_ngcontent-%COMP%]{margin-top:16px;font-size:.85rem;color:var(--text-secondary)}"]})};function Zn(i,t){if(i&1&&(o(0,"div",22),s(1),r()),i&2){let e=d(2);l(),x(" ",e.user.id," ")}}function Jn(i,t){if(i&1){let e=v();o(0,"button",27),f("click",function(){u(e);let a=d(3);return _(a.softDeleteUser())}),o(1,"mat-icon"),s(2,"block"),r(),s(3," Disable "),r()}}function Xn(i,t){if(i&1){let e=v();o(0,"button",28),f("click",function(){u(e);let a=d(3);return _(a.restoreUser())}),o(1,"mat-icon"),s(2,"restore"),r(),s(3," Restore "),r()}}function er(i,t){if(i&1){let e=v();o(0,"button",29),f("click",function(){u(e);let a=d(3);return _(a.hardDeleteUser())}),o(1,"mat-icon"),s(2,"delete_forever"),r(),s(3," Delete permanently "),r()}}function tr(i,t){if(i&1&&(o(0,"div",23),p(1,Jn,4,0,"button",24)(2,Xn,4,0,"button",25)(3,er,4,0,"button",26),r()),i&2){let e=d(2);l(),c("ngIf",!e.user.deleted),l(),c("ngIf",e.user.deleted),l(),c("ngIf",e.user.deleted&&e.role==="SUPERUSER")}}function ir(i,t){if(i&1&&(o(0,"div"),s(1),r()),i&2){let e=t.$implicit;l(),b(e)}}function nr(i,t){if(i&1&&(o(0,"div"),s(1),r()),i&2){let e=t.$implicit;l(),b(e)}}function rr(i,t){if(i&1&&(o(0,"li")(1,"span",33),s(2),r(),o(3,"span",34),s(4),r()()),i&2){let e=t.$implicit;l(2),b(e.departmentName),l(2),b(e.position)}}function or(i,t){if(i&1&&(o(0,"div",30)(1,"div",31),s(2),r(),o(3,"ul",32),p(4,rr,5,2,"li",18),r()()),i&2){let e=t.$implicit;l(2),b(e.branchName),l(2),c("ngForOf",e.departments)}}function ar(i,t){if(i&1&&(s(0," Documents "),o(1,"span",37),s(2),r()),i&2){let e=d(3);l(2),b(e.imageCount)}}function sr(i,t){if(i&1&&(o(0,"mat-tab"),p(1,ar,3,1,"ng-template",35),C(2,"app-entity-image-manager",36),r()),i&2){let e=d(2);l(2),c("entityId",e.user.id)("adapter",e.imageAdapter)("allowHardDelete",e.role==="SUPERUSER")}}function lr(i,t){if(i&1&&(s(0," Audits "),o(1,"span",37),s(2),r()),i&2){let e=d(3);l(2),b(e.auditCount)}}function mr(i,t){if(i&1&&(o(0,"mat-tab"),p(1,lr,3,1,"ng-template",35),C(2,"app-user-audit-timeline",38),r()),i&2){let e=d(2);l(2),c("userId",e.user.id)}}function cr(i,t){if(i&1&&(s(0," Rollcalls "),o(1,"span",37),s(2),r()),i&2){let e=d(3);l(2),b(e.rollcallCount)}}function dr(i,t){if(i&1&&(o(0,"mat-tab"),p(1,cr,3,1,"ng-template",35),C(2,"app-user-rollcalls",38),r()),i&2){let e=d(2);l(2),c("userId",e.user.id)}}function pr(i,t){if(i&1){let e=v();o(0,"div",2)(1,"div",3)(2,"div")(3,"h2"),s(4,"User Profile"),r(),o(5,"div",4),s(6),r()(),o(7,"button",5),f("click",function(){u(e);let a=d();return _(a.editUser())}),o(8,"mat-icon"),s(9,"edit"),r(),s(10," Edit "),r()(),o(11,"div",6)(12,"mat-card",7)(13,"div",8),s(14),r(),p(15,Zn,2,1,"div",9),o(16,"div",10),s(17),r(),o(18,"div",11),s(19),r(),p(20,tr,4,3,"div",12),r(),o(21,"div",13)(22,"mat-tab-group",14)(23,"mat-tab",15)(24,"mat-card",16)(25,"h3"),s(26,"Profile"),r(),o(27,"div",17)(28,"div")(29,"label"),s(30,"ID Number"),r(),o(31,"div"),s(32),r()(),o(33,"div")(34,"label"),s(35,"Role"),r(),o(36,"div"),s(37),r()(),o(38,"div")(39,"label"),s(40,"Emails"),r(),p(41,ir,2,1,"div",18),r(),o(42,"div")(43,"label"),s(44,"Phones"),r(),p(45,nr,2,1,"div",18),r(),o(46,"div")(47,"label"),s(48,"Status"),r(),o(49,"div"),s(50),r()(),o(51,"div",19)(52,"label"),s(53,"Branches & Departments"),r(),p(54,or,5,2,"div",20),r()()()(),p(55,sr,3,3,"mat-tab",21)(56,mr,3,1,"mat-tab",21)(57,dr,3,1,"mat-tab",21),r()()()()}if(i&2){let e=d();l(6),x("Users / ",e.user.username,""),l(8),b(e.initials()),l(),c("ngIf",e.canViewUserId()),l(2),b(e.user.username),l(),he("deleted",e.user.deleted),l(),x(" ",e.user.deleted?"DISABLED":e.user.role," "),l(),c("ngIf",e.canManageUser()),l(12),b(e.user.idNumber||"\u2014"),l(5),b(e.user.role),l(4),c("ngForOf",e.user.emailAddresses),l(4),c("ngForOf",e.user.phoneNumbers),l(5),b(e.status()),l(4),c("ngForOf",e.user.branchHierarchy),l(),c("ngIf",e.canViewImages()),l(),c("ngIf",e.canViewAudits()),l(),c("ngIf",e.canViewRollcalls())}}function ur(i,t){i&1&&(o(0,"div",39),s(1,"Loading user\u2026"),r())}var it=class i{constructor(t,e,n,a,m){this.route=t;this.router=e;this.userService=n;this.auth=a;this.snackbar=m}user;loading=!0;role="";auditCount=0;imageCount=0;rollcallCount=0;imageAdapter;ngOnInit(){let t=this.route.snapshot.paramMap.get("username");t&&(this.auth.getCurrentUser().subscribe(e=>{this.role=e?.role??""}),this.imageAdapter=mi(this.userService),this.userService.get(t).subscribe({next:e=>{this.user=e,this.loading=!1,this.loadCounts()},error:()=>{this.snackbar.open("Failed to load user","Close",{duration:3e3}),this.loading=!1}}))}canViewImages(){return["ADMIN","SUPERUSER"].includes(this.role)}canViewAudits(){return["MANAGER","ADMIN","SUPERUSER"].includes(this.role)}canViewRollcalls(){return["SUPERVISOR","MANAGER","ADMIN","SUPERUSER"].includes(this.role)}canViewUserId(){return this.role==="SUPERUSER"}loadCounts(){this.canViewAudits()&&this.userService.auditsForUser(this.user.id).subscribe(t=>this.auditCount=t?.length||0),this.canViewImages()&&this.userService.listImages(this.user.id).subscribe(t=>this.imageCount=t?.length||0),this.canViewRollcalls()&&this.userService.getUserRollcalls(this.user.id).subscribe(t=>this.rollcallCount=t?.length||0)}initials(){return this.user.username.charAt(0).toUpperCase()}status(){return this.user.deleted?"DISABLED":"ACTIVE"}editUser(){this.router.navigate(["/users",this.user.username,"edit"])}canManageUser(){return["ADMIN","SUPERUSER"].includes(this.role)}softDeleteUser(){confirm("Disable this user?")&&this.userService.softDelete(this.user.id,"Disabled from user details").subscribe({next:()=>{this.user.deleted=!0,this.snackbar.open("User disabled","Close",{duration:2e3})}})}hardDeleteUser(){confirm("Permanently delete this user?")&&this.userService.hardDelete(this.user.id).subscribe({next:()=>{this.user.deleted=!0,this.snackbar.open("User disabled","Close",{duration:2e3})}})}restoreUser(){confirm("Restore this user?")&&this.userService.restore(this.user.id,"Restored from user details").subscribe({next:()=>{this.user.deleted=!1,this.snackbar.open("User restored","Close",{duration:2e3})}})}static \u0275fac=function(e){return new(e||i)(h(Ee),h(F),h(U),h(le),h(H))};static \u0275cmp=I({type:i,selectors:[["app-user-details"]],decls:3,vars:2,consts:[["loadingTpl",""],["class","user-details-root",4,"ngIf","ngIfElse"],[1,"user-details-root"],[1,"page-header"],[1,"breadcrumb"],["mat-stroked-button","",3,"click"],[1,"content-grid"],[1,"identity-card"],[1,"avatar"],["class","user-id",4,"ngIf"],[1,"username"],[1,"role-chip"],["class","identity-actions",4,"ngIf"],[1,"details-column"],["dynamicHeight","",1,"user-tabs"],["label","Profile"],[1,"info-card"],[1,"info-grid"],[4,"ngFor","ngForOf"],[1,"col-span-2"],["class","branch-block",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"user-id"],[1,"identity-actions"],["mat-stroked-button","","color","warn","matTooltip","Disable user (can be restored)",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary","matTooltip","Restore disabled user",3,"click",4,"ngIf"],["mat-stroked-button","","class","danger","matTooltip","Permanently delete user",3,"click",4,"ngIf"],["mat-stroked-button","","color","warn","matTooltip","Disable user (can be restored)",3,"click"],["mat-stroked-button","","color","primary","matTooltip","Restore disabled user",3,"click"],["mat-stroked-button","","matTooltip","Permanently delete user",1,"danger",3,"click"],[1,"branch-block"],[1,"branch-name"],[1,"department-list"],[1,"dept-name"],[1,"dept-role"],["mat-tab-label",""],[3,"entityId","adapter","allowHardDelete"],[1,"badge"],[3,"userId"],[1,"loading"]],template:function(e,n){if(e&1&&p(0,pr,58,17,"div",1)(1,ur,2,0,"ng-template",null,0,Me),e&2){let a=Se(2);c("ngIf",!n.loading)("ngIfElse",a)}},dependencies:[D,P,k,We,qe,R,A,O,T,ti,Jt,Xt,ei,z,Kt,et,tt],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.4rem;font-weight:600}.page-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:280px 1fr;gap:16px}.identity-card[_ngcontent-%COMP%]{padding:24px;text-align:center}.identity-card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:50%;background:linear-gradient(135deg,#1a73e8,#4f9cff);color:#fff;font-size:2.2rem;font-weight:700;display:flex;align-items:center;justify-content:center;margin:0 auto 12px}.identity-card[_ngcontent-%COMP%]   .user-id[_ngcontent-%COMP%]{margin-top:6px;font-size:.7rem;color:var(--text-secondary);word-break:break-all}.identity-card[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600}.identity-card[_ngcontent-%COMP%]   .role-chip[_ngcontent-%COMP%]{margin-top:10px;display:inline-block;padding:4px 12px;border-radius:12px;font-size:.75rem;font-weight:700;background:#1a73e81f;color:#1a73e8}.identity-card[_ngcontent-%COMP%]   .role-chip.deleted[_ngcontent-%COMP%]{background:#dc262626;color:#dc2626}.identity-card[_ngcontent-%COMP%]   .identity-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;flex-direction:column;gap:8px;width:100%}.identity-card[_ngcontent-%COMP%]   .identity-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;justify-content:center;gap:6px;padding:6px 12px!important;min-height:36px;font-size:.85rem}.identity-card[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]{border-color:#ef4444!important;color:#ef4444!important}.identity-card[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]:hover{background:#ef444414!important}.details-column[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-tabs[_ngcontent-%COMP%]   .mat-mdc-tab-label[_ngcontent-%COMP%]{font-weight:600}.user-tabs[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{margin-left:6px;padding:2px 8px;border-radius:10px;font-size:.7rem;font-weight:700;background:#1a73e826;color:#1a73e8}.info-card[_ngcontent-%COMP%]{padding:18px}.info-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 12px;font-size:1rem;font-weight:600}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.info-grid[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:var(--text-secondary)}.branch-block[_ngcontent-%COMP%]{margin-top:10px;padding:10px 12px;border:1px solid var(--border);border-radius:6px;background:var(--surface-hover)}.branch-name[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem;margin-bottom:6px}.department-list[_ngcontent-%COMP%]{list-style:none;padding-left:12px;margin:0}.department-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:.85rem}.dept-role[_ngcontent-%COMP%]{font-size:.7rem;font-weight:700;padding:2px 8px;border-radius:10px;background:#1a73e81f;color:#1a73e8;text-transform:capitalize}.loading[_ngcontent-%COMP%]{padding:32px;text-align:center;color:var(--text-secondary)}@media (max-width: 900px){.content-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}']})};var Na=[{path:"",canActivate:[$t],children:[{path:"",component:Ze},{path:"create",component:Je},{path:":username/edit",component:Xe},{path:":username",component:it}]}];export{Na as USER_ROUTES};
