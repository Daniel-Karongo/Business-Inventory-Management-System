import{a as W}from"./chunk-L7YUQAZ5.js";import{a as X}from"./chunk-U5YT4ZGI.js";import{a as Y}from"./chunk-22FAI265.js";import{c as R,h as G}from"./chunk-G6DPSII6.js";import"./chunk-MS4AQ6UA.js";import{a as J,b as Q}from"./chunk-H37LQHOQ.js";import{d as M}from"./chunk-DF6WYVPK.js";import"./chunk-MJONFXFY.js";import{a as L,b as q}from"./chunk-BIVTK5YB.js";import{c as K,d as H}from"./chunk-ZFWGKVXC.js";import"./chunk-3RK6DDJD.js";import{a as $}from"./chunk-CONPK5ZF.js";import{b as z,h as U}from"./chunk-3ZV2DC5Q.js";import"./chunk-SGYCFQGT.js";import{d as k,f as C,h as F,i as N,m as O,n as w,p as D,s as j,v as B,x as V}from"./chunk-Z2GGFO6C.js";import"./chunk-75T6YVBZ.js";import{g as T,h as A}from"./chunk-TENNXE3V.js";import"./chunk-2X53NFZU.js";import{b as P,d as E}from"./chunk-VUFC7WNX.js";import"./chunk-CDHEWSLI.js";import"./chunk-5DTMLZHP.js";import{Ib as r,Jb as i,Kb as s,Ob as h,Qb as _,Rb as u,Sc as I,Tc as S,Uc as b,ac as n,bb as a,bd as x,cc as f,gb as c,ma as g,na as v,nb as y,sb as p,zb as d}from"./chunk-3DYKM6ZU.js";import"./chunk-FJYW2LMB.js";function tt(o,e){o&1&&(r(0,"div",17),n(1," This product is deleted and cannot be edited. "),i())}function et(o,e){if(o&1&&(r(0,"mat-option",18),n(1),i()),o&2){let t=e.$implicit;d("value",t.id),a(),f(" ",t.name," ")}}function it(o,e){if(o&1&&(r(0,"mat-option",18),n(1),i()),o&2){let t=e.$implicit;d("value",t.id),a(),f(" ",t.name," ")}}function rt(o,e){if(o&1){let t=h();r(0,"div",2)(1,"div",3)(2,"div")(3,"h1"),n(4,"Edit Product"),i(),r(5,"span",4),n(6),i()()(),p(7,tt,2,0,"div",5),r(8,"form",6)(9,"mat-form-field",7)(10,"mat-label"),n(11,"Name"),i(),s(12,"input",8),i(),r(13,"mat-form-field",7)(14,"mat-label"),n(15,"Description"),i(),s(16,"textarea",9),i(),r(17,"mat-form-field",7)(18,"mat-label"),n(19,"Category"),i(),r(20,"mat-select",10),p(21,et,2,2,"mat-option",11),i()(),r(22,"mat-form-field",7)(23,"mat-label"),n(24,"Suppliers"),i(),r(25,"mat-select",12),p(26,it,2,2,"mat-option",11),i()(),r(27,"mat-form-field",7)(28,"mat-label"),n(29,"Minimum % Profit"),i(),s(30,"input",13),i(),r(31,"div",14)(32,"button",15),_("click",function(){g(t);let l=u();return v(l.cancel())}),n(33,"Cancel"),i(),r(34,"button",16),_("click",function(){g(t);let l=u();return v(l.save())}),n(35," Save "),i()()()()}if(o&2){let t=u();a(5),d("ngClass",t.product.deleted?"status-deleted":"status-active"),a(),f(" ",t.product.deleted?"Deleted":"Active"," "),a(),d("ngIf",t.product.deleted),a(),d("formGroup",t.form),a(13),d("ngForOf",t.categories),a(5),d("ngForOf",t.suppliers),a(8),d("disabled",t.form.invalid||t.saving||t.product.deleted)}}function ot(o,e){o&1&&(r(0,"div",19),n(1,` Loading product\u2026
`),i())}var Z=class o{constructor(e,t,m,l,nt,at,dt,mt){this.route=e;this.router=t;this.fb=m;this.productService=l;this.categoryService=nt;this.supplierService=at;this.snackbar=dt;this.dialog=mt}productId;product;loading=!0;saving=!1;categories=[];suppliers=[];originalCategoryId;form;ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(!e){this.router.navigate(["/products"]);return}this.form=this.fb.group({name:["",C.required],description:[""],categoryId:[null,C.required],supplierIds:[[]],minimumPercentageProfit:[null]}),this.productId=e,this.loadLookups(),this.loadProduct()}loadLookups(){this.categoryService.getAll("flat",!1).subscribe(e=>this.categories=e||[]),this.supplierService.getAll(!1).subscribe(e=>this.suppliers=e||[])}loadProduct(){let e=history.state?.deleted===!0;this.productService.getById(this.productId,e).subscribe({next:t=>{this.product=t,this.originalCategoryId=t.categoryId,this.form.patchValue({name:t.name,description:t.description,categoryId:t.categoryId,supplierIds:t.suppliers?.map(m=>m.id)||[],minimumPercentageProfit:t.minimumPercentageProfit}),t.deleted&&this.form.disable(),this.loading=!1},error:()=>{this.router.navigate(["/products"])}})}save(){if(this.form.invalid||this.saving||this.product.deleted)return;let e=this.form.value,t=e.categoryId!==this.originalCategoryId,m=()=>{this.saving=!0,this.productService.update(this.productId,e).subscribe({next:()=>{this.snackbar.open("Product updated","Close",{duration:2e3}),this.router.navigate(["/products",this.productId])},error:()=>{this.saving=!1,this.snackbar.open("Update failed","Close",{duration:3e3})}})};t&&!confirm("Changing category may affect SKU structure and reporting. Continue?")||m()}cancel(){this.router.navigate(["/products",this.productId])}static \u0275fac=function(t){return new(t||o)(c(P),c(E),c(B),c(W),c(Y),c(X),c(L),c(R))};static \u0275cmp=y({type:o,selectors:[["app-product-edit"]],decls:2,vars:2,consts:[["class","page",4,"ngIf"],["class","loading",4,"ngIf"],[1,"page"],[1,"header"],[1,"status-pill",3,"ngClass"],["class","warning",4,"ngIf"],[1,"form",3,"formGroup"],["appearance","fill"],["matInput","","formControlName","name"],["matInput","","rows","3","formControlName","description"],["formControlName","categoryId"],[3,"value",4,"ngFor","ngForOf"],["formControlName","supplierIds","multiple",""],["matInput","","type","number","formControlName","minimumPercentageProfit"],[1,"actions"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","button",3,"click","disabled"],[1,"warning"],[3,"value"],[1,"loading"]],template:function(t,m){t&1&&p(0,rt,36,7,"div",0)(1,ot,2,0,"div",1),t&2&&(d("ngIf",!m.loading),a(),d("ngIf",m.loading))},dependencies:[x,I,S,b,V,O,k,w,F,N,D,j,A,T,Q,U,z,J,M,$,H,K,q,G],styles:[".page[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.4rem}.warning[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e;padding:.75rem 1rem;border-radius:4px;margin-bottom:1rem;font-size:.9rem}.form[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:1rem}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;margin-top:1rem}.loading[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:var(--text-secondary)}"]})};export{Z as ProductEditComponent};
