import{a as yi}from"./chunk-KZAHRUYX.js";import{a as ci}from"./chunk-VGRWNKBL.js";import"./chunk-7GLSX2AB.js";import{a as si}from"./chunk-4QH6CCP6.js";import{a as Nt}from"./chunk-L3RCXL5W.js";import{a as li}from"./chunk-5NGCVQ4O.js";import{a as ai}from"./chunk-HCW56HG7.js";import{a as ni,b as oi,c as ri}from"./chunk-DHVK64AT.js";import"./chunk-I43GAN7W.js";import{a as Ae}from"./chunk-6ZHWXBBQ.js";import{a as ii}from"./chunk-VQD42P6V.js";import{a as Re,b as ti,c as H,d as G}from"./chunk-PUDW2OXT.js";import{a as Wt,b as Ht,c as Gt,d as qt,e as Qt,f as Zt,g as Kt,h as Jt,i as Yt,j as Xt,k as ei}from"./chunk-IFBDMVRJ.js";import"./chunk-VGEQVDR7.js";import{a as Rt,b as At}from"./chunk-JNUXAAQA.js";import{a as oe,b as pe,c as re,e as ue,f as ge,g as _e,h as ae}from"./chunk-727AWRP5.js";import"./chunk-MS4AQ6UA.js";import{a as Ut,b as zt}from"./chunk-NUV7N7IM.js";import{d as Pt}from"./chunk-PJQ2W5C7.js";import"./chunk-2CD73GIG.js";import{b as ie,c as ne}from"./chunk-NP55MDY3.js";import{a as fe,b as $t}from"./chunk-NKX2CJ22.js";import{c as Ce,d as xe}from"./chunk-IMZ4R6CL.js";import{b as Ve,e as jt,h as ve,i as he}from"./chunk-EWJIHEWL.js";import"./chunk-SGYCFQGT.js";import{d as de,h as ee,i as It,l as te,m as Ft,n as Dt,p as Tt,q as Et,r as Ot,s as Bt,w as U,x as Vt}from"./chunk-J63CKRDU.js";import"./chunk-CN565FBG.js";import{f as me,g as z,h as W}from"./chunk-A6LP6NU3.js";import{p as Mt}from"./chunk-7XXZ3FER.js";import{d as kt,e as yt,h as St}from"./chunk-PBEYJMJD.js";import"./chunk-LMLMO6HS.js";import{a as Lt}from"./chunk-5DTMLZHP.js";import{$b as tt,$c as D,Bb as X,E as ut,H as gt,Ib as r,Jb as l,Kb as S,Lb as N,Mb as $,Ob as h,Qb as _,Qc as wt,Rb as d,Rc as j,S as Ee,Sc as O,Ub as et,V as Ye,Wb as Pe,Wc as bt,Xb as Ie,Yb as Fe,Z as L,Za as Y,_a as _t,ac as c,bb as s,bc as ce,ca as J,cc as C,da as Xe,dc as ht,fc as V,g as M,gb as x,gc as R,hc as A,kc as De,lc as E,m as Je,ma as p,mc as it,na as u,nb as F,nc as Ct,pb as ft,pc as xt,qb as Be,r as pt,sb as v,wa as Oe,yb as vt,zb as m}from"./chunk-IL4QWM46.js";import{a as le,b as se,f as ki,g as Ke,h as I}from"./chunk-FJYW2LMB.js";var di={title:"Bulk Import Products",confirmLabel:"Import Products",csvFileName:"products-bulk-template.csv",excelFileName:"products-bulk-template.xlsx",supportsArchiveImport:!0,supportsFileDescription:!1,headers:["name","description","categoryName","supplierNames","variants","minimumPercentageProfit"],fields:[{name:"name",required:!0},{name:"description"},{name:"categoryName",required:!0},{name:"supplierNames"},{name:"variants",defaultValue:"STANDARD"},{name:"minimumPercentageProfit"}],previewColumns:[{key:"name",label:"Name"},{key:"categoryName",label:"Category"},{key:"variants",label:"Variants"},{key:"minimumPercentageProfit",label:"Min % Profit"}],excelSheetName:"Products",excelColumns:[{header:"name",key:"name",width:26},{header:"description",key:"description",width:36},{header:"categoryName",key:"categoryName",width:22},{header:"supplierNames",key:"supplierNames",width:30},{header:"variants",key:"variants",width:20},{header:"minimumPercentageProfit",key:"minimumPercentageProfit",width:18}],exampleRow:{name:"Milk 1L",description:"Fresh whole milk",categoryName:"Dairy",supplierNames:"Local Supplier",variants:"STANDARD",minimumPercentageProfit:15},emptyRow:{variants:"STANDARD"},emptyRowCount:200,defaultOptions:{dryRun:!0,skipDuplicates:!0},mapRowToItem(n){return{name:n.name,description:n.description,categoryName:n.categoryName,supplierNames:n.supplierNames?n.supplierNames.split(",").map(t=>t.trim()).filter(Boolean):[],variants:n.variants?n.variants.split(",").map(t=>t.trim()).filter(Boolean):["STANDARD"],minimumPercentageProfit:n.minimumPercentageProfit}},mapPreviewRow:n=>se(le({},n),{variants:typeof n.variants=="string"?n.variants:Array.isArray(n.variants)?n.variants.map(t=>typeof t=="string"?t:t?.classification??"").filter(Boolean).join(", "):""}),submit(n){return null}};function Si(n,t){if(n&1&&S(0,"img",2),n&2){let e=d();m("src",e.data.url,Y)}}function Mi(n,t){if(n&1&&S(0,"iframe",2),n&2){let e=d();m("src",e.data.url,_t)}}var Le=class n{constructor(t){this.data=t;this.isImage=t.isImage}isImage=!0;static \u0275fac=function(e){return new(e||n)(x(pe))};static \u0275cmp=F({type:n,selectors:[["app-bulk-file-preview-dialog"]],decls:3,vars:2,consts:[[1,"preview-wrapper"],[3,"src",4,"ngIf"],[3,"src"]],template:function(e,o){e&1&&(r(0,"div",0),v(1,Si,1,1,"img",1)(2,Mi,1,1,"iframe",1),l()),e&2&&(s(),m("ngIf",o.isImage),s(),m("ngIf",!o.isImage))},dependencies:[D,O,ae],styles:[".preview-wrapper[_ngcontent-%COMP%]{max-height:80vh;max-width:90vw;display:flex;justify-content:center;align-items:center}img[_ngcontent-%COMP%]{max-width:100%;max-height:80vh;border-radius:12px}iframe[_ngcontent-%COMP%]{width:80vw;height:80vh;border:none}"]})};var q=class n{detectFileType(t){return t.type.startsWith("image/")?"image":t.type==="application/pdf"?"pdf":"other"}detectMimeFromName(t){let e=t.split(".").pop()?.toLowerCase();return e?["png","jpg","jpeg","webp","gif"].includes(e)?`image/${e==="jpg"?"jpeg":e}`:e==="pdf"?"application/pdf":"":""}createPreview(t){if(t.type.startsWith("image/"))return URL.createObjectURL(t)}revokePreview(t){t&&URL.revokeObjectURL(t)}normalizeName(t){return t?.toLowerCase().replace(/\.[^/.]+$/,"").replace(/[\s\-_]/g,"").trim()}isImage(t){return t.type.startsWith("image/")}static \u0275fac=function(e){return new(e||n)};static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};function Pi(n,t){if(n&1){let e=h();r(0,"mat-checkbox",14),_("change",function(i){p(e);let a=d().$implicit,g=d();return u(g.toggleSelection(a,i.checked))}),l()}}function Ii(n,t){if(n&1&&S(0,"img",15),n&2){let e=d().$implicit,o=d();m("src",o.getPreview(e),Y)}}function Fi(n,t){n&1&&(r(0,"mat-icon"),c(1," picture_as_pdf "),l())}function Di(n,t){if(n&1){let e=h();r(0,"div",16)(1,"mat-checkbox",17),A("ngModelChange",function(i){p(e);let a=d().$implicit;return R(a.assignToEntity,i)||(a.assignToEntity=i),u(i)}),c(2," Assign to entity "),l()()}if(n&2){let e=d().$implicit;s(),V("ngModel",e.assignToEntity),m("disabled",!e.assignedRowIndexes.length)}}function Ti(n,t){if(n&1){let e=h();r(0,"label")(1,"input",20),_("change",function(i){let a=p(e).$implicit,g=d(2).$implicit,f=d();return u(f.onVariantChange(i,g,a))}),l(),c(2),l()}if(n&2){let e=t.$implicit,o=d(2).$implicit,i=d();s(),m("checked",o.rowVariantMap[i.rowIndex]==null?null:o.rowVariantMap[i.rowIndex].includes(e)),s(),C(" ",e," ")}}function Ei(n,t){if(n&1&&(r(0,"div",18),v(1,Ti,3,2,"label",19),l()),n&2){let e=d(2);s(),m("ngForOf",e.rowVariants)}}function Oi(n,t){if(n&1){let e=h();r(0,"textarea",21),A("ngModelChange",function(i){p(e);let a=d().$implicit;return R(a.description,i)||(a.description=i),u(i)}),c(1,"      "),l()}if(n&2){let e=d().$implicit;V("ngModel",e.description)}}function Bi(n,t){if(n&1){let e=h();r(0,"div",3),v(1,Pi,1,0,"mat-checkbox",4),r(2,"div",5),_("click",function(){let i=p(e).$implicit,a=d();return u(a.preview(i))}),v(3,Ii,1,1,"img",6)(4,Fi,2,0,"mat-icon",7),l(),r(5,"div",8)(6,"div",9)(7,"strong"),c(8),l()(),v(9,Di,3,2,"div",10)(10,Ei,2,1,"div",11)(11,Oi,2,1,"textarea",12),l(),r(12,"button",13),_("click",function(){let i=p(e).$implicit,a=d();return u(a.assign.emit(i))}),c(13," Assign Rows "),l()()}if(n&2){let e=t.$implicit,o=d();s(),m("ngIf",o.multiSelectMode),s(2),m("ngIf",o.isImage(e)&&o.getPreview(e)),s(),m("ngIf",e.fileType==="pdf"),s(4),ce(e.file.name),s(),m("ngIf",e.assignedRowIndexes.length),s(),m("ngIf",o.rowVariants.length),s(),m("ngIf",o.supportsDescription)}}function Vi(n,t){if(n&1){let e=h();r(0,"button",22),_("click",function(){p(e);let i=d();return u(i.emitMultiAssign())}),c(1),l()}if(n&2){let e=d();s(),C(" Assign Selected (",e.selectedIds.size,`)
`)}}var $e=class n{constructor(t,e){this.utils=t;this.dialog=e}files=[];rowIndex;rowVariants=[];supportsDescription=!1;multiSelectMode=!1;multiAssign=new Oe;remove=new Oe;assign=new Oe;selectedIds=new Set;getPreview(t){if(!t.previewUrl){let e=this.utils.createPreview(t.file);if(!e)return null;t.previewUrl=e}return t.previewUrl??null}isImage(t){return this.utils.isImage(t.file)}toggleSelection(t,e){e?this.selectedIds.add(t.id):this.selectedIds.delete(t.id)}onVariantChange(t,e,o){let i=t.target;if(!i)return;let a=e.rowVariantMap[this.rowIndex];a||(a=[],e.rowVariantMap[this.rowIndex]=a),i.checked?a.includes(o)||a.push(o):e.rowVariantMap[this.rowIndex]=a.filter(g=>g!==o)}preview(t){let e=this.getPreview(t);this.dialog.open(Le,{data:{url:e,isImage:this.isImage(t)},maxWidth:"95vw"})}removeFile(t){this.remove.emit(t)}trackByFile(t,e){return e.id}emitMultiAssign(){let t=this.files.filter(e=>this.selectedIds.has(e.id));this.multiAssign.emit(t),this.selectedIds.clear()}clearSelection(){this.selectedIds.clear()}static \u0275fac=function(e){return new(e||n)(x(q),x(re))};static \u0275cmp=F({type:n,selectors:[["app-bulk-file-assignment"]],inputs:{files:"files",rowIndex:"rowIndex",rowVariants:"rowVariants",supportsDescription:"supportsDescription",multiSelectMode:"multiSelectMode"},outputs:{multiAssign:"multiAssign",remove:"remove",assign:"assign"},decls:3,vars:3,consts:[[1,"file-grid"],["class","file-card",4,"ngFor","ngForOf","ngForTrackBy"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"file-card"],[3,"change",4,"ngIf"],[1,"file-preview",3,"click"],[3,"src",4,"ngIf"],[4,"ngIf"],[1,"file-meta"],[1,"file-name"],["class","entity-checkbox",4,"ngIf"],["class","variant-block",4,"ngIf"],["placeholder","File description","rows","2",3,"ngModel","ngModelChange",4,"ngIf"],["mat-stroked-button","",3,"click"],[3,"change"],[3,"src"],[1,"entity-checkbox"],[3,"ngModelChange","ngModel","disabled"],[1,"variant-block"],[4,"ngFor","ngForOf"],["type","checkbox",3,"change","checked"],["placeholder","File description","rows","2",3,"ngModelChange","ngModel"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,o){e&1&&(r(0,"div",0),v(1,Bi,14,7,"div",1),l(),v(2,Vi,2,1,"button",2)),e&2&&(s(),m("ngForOf",o.files)("ngForTrackBy",o.trackByFile),s(),m("ngIf",o.multiSelectMode&&o.selectedIds.size))},dependencies:[D,j,O,U,de,ee,te,G,H,ne,ie],styles:[".file-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}.file-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:12px;background:var(--surface);display:flex;flex-direction:column;gap:10px}.file-card[_ngcontent-%COMP%]{cursor:pointer;transition:.16s ease}.file-card[_ngcontent-%COMP%]:hover{box-shadow:0 8px 20px #00000026;transform:translateY(-2px)}.file-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-height:160px;object-fit:contain}.variant-block[_ngcontent-%COMP%]{margin-left:20px;margin-top:6px;display:flex;flex-direction:column;gap:4px}.file-preview[_ngcontent-%COMP%]{cursor:pointer;transition:transform .12s ease}.file-preview[_ngcontent-%COMP%]:hover{transform:scale(1.03)}.file-name[_ngcontent-%COMP%], .entity-checkbox[_ngcontent-%COMP%]{margin-bottom:6px}.variant-group[_ngcontent-%COMP%]{margin-left:24px}"]})};function Ri(n,t){if(n&1){let e=h();r(0,"div",11)(1,"mat-checkbox",12),_("change",function(i){let a=p(e).$implicit,g=d(2);return u(g.toggle(a.index,i.checked))}),c(2),l()()}if(n&2){let e=t.$implicit;s(),m("checked",!0),s(),C(" ",e.name||"Row "+(e.index+1)," ")}}function Ai(n,t){if(n&1&&(r(0,"div")(1,"h4"),c(2,"Assigned"),l(),v(3,Ri,3,2,"div",10),l()),n&2){let e=d();s(3),m("ngForOf",e.assignedRows())}}function Li(n,t){if(n&1){let e=h();r(0,"div",11)(1,"mat-checkbox",12),_("change",function(i){let a=p(e).$implicit,g=d(2);return u(g.toggle(a.index,i.checked))}),c(2),l()()}if(n&2){let e=t.$implicit;s(),m("checked",!1),s(),C(" ",e.name||"Row "+(e.index+1)," ")}}function Ni(n,t){if(n&1&&(r(0,"div")(1,"h4"),c(2,"Unassigned"),l(),v(3,Li,3,2,"div",10),l()),n&2){let e=d();s(3),m("ngForOf",e.unassignedRows())}}var Ue=class n{constructor(t,e){this.data=t;this.dialogRef=e;t.files[0]?.assignedRowIndexes?.forEach(o=>this.selected.add(o))}search="";selected=new Set;baseFiltered(){return this.search?this.data.rows.filter(t=>(t.name||"").toLowerCase().includes(this.search.toLowerCase())):this.data.rows}assignedRows(){return this.baseFiltered().filter(t=>this.selected.has(t.index))}unassignedRows(){return this.baseFiltered().filter(t=>!this.selected.has(t.index))}toggle(t,e){e?this.selected.add(t):this.selected.delete(t)}save(){this.dialogRef.close([...this.selected])}close(){this.dialogRef.close(null)}static \u0275fac=function(e){return new(e||n)(x(pe),x(oe))};static \u0275cmp=F({type:n,selectors:[["app-bulk-file-row-assignment-dialog"]],decls:18,vars:4,consts:[["mat-dialog-title",""],[1,"content"],[1,"file-name"],["appearance","fill"],["matInput","",3,"ngModelChange","ngModel"],[1,"row-list"],[4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["class","row-item",4,"ngFor","ngForOf"],[1,"row-item"],[3,"change","checked"]],template:function(e,o){e&1&&(r(0,"h2",0),c(1,"Assign File"),l(),r(2,"mat-dialog-content",1)(3,"div",2)(4,"strong"),c(5),l()(),r(6,"mat-form-field",3)(7,"mat-label"),c(8,"Search rows"),l(),r(9,"input",4),A("ngModelChange",function(a){return R(o.search,a)||(o.search=a),a}),l()(),r(10,"div",5),v(11,Ai,4,1,"div",6)(12,Ni,4,1,"div",6),l()(),r(13,"mat-dialog-actions",7)(14,"button",8),_("click",function(){return o.close()}),c(15,"Cancel"),l(),r(16,"button",9),_("click",function(){return o.save()}),c(17,"Save"),l()()),e&2&&(s(5),C(" ",o.data.files.length===1?o.data.files[0].file.name:o.data.files.length+" files selected"," "),s(4),V("ngModel",o.search),s(2),m("ngIf",o.assignedRows().length),s(),m("ngIf",o.unassignedRows().length))},dependencies:[D,j,O,U,de,ee,te,ae,ue,_e,ge,W,z,G,H,xe,Ce,ve,Ve,he],styles:[".content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;width:500px;max-height:70vh;overflow:hidden}.row-list[_ngcontent-%COMP%]{overflow:auto;border:1px solid var(--border);border-radius:8px;padding:8px;max-height:400px}.row-item[_ngcontent-%COMP%]{padding:4px 0}.file-name[_ngcontent-%COMP%]{font-size:.9rem;opacity:.8}"]})};var y=[];for(let n=0;n<256;++n)y.push((n+256).toString(16).slice(1));function ui(n,t=0){return(y[n[t+0]]+y[n[t+1]]+y[n[t+2]]+y[n[t+3]]+"-"+y[n[t+4]]+y[n[t+5]]+"-"+y[n[t+6]]+y[n[t+7]]+"-"+y[n[t+8]]+y[n[t+9]]+"-"+y[n[t+10]]+y[n[t+11]]+y[n[t+12]]+y[n[t+13]]+y[n[t+14]]+y[n[t+15]]).toLowerCase()}var rt,$i=new Uint8Array(16);function at(){if(!rt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");rt=crypto.getRandomValues.bind(crypto)}return rt($i)}var ji=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lt={randomUUID:ji};function Ui(n,t,e){n=n||{};let o=n.random??n.rng?.()??at();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){if(e=e||0,e<0||e+16>t.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let i=0;i<16;++i)t[e+i]=o[i];return t}return ui(o)}function zi(n,t,e){return lt.randomUUID&&!t&&!n?lt.randomUUID():Ui(n,t,e)}var st=zi;var ke=class n{constructor(t){this.utils=t}createAssignedFile(t,e=[],o={}){let i=this.utils.detectFileType(t);return{id:st(),file:t,fileType:i,previewUrl:this.utils.createPreview(t),assignedRowIndexes:[],rowVariantMap:{},assignToEntity:o.assignToEntity??!1,description:void 0}}static \u0275fac=function(e){return new(e||n)(J(q))};static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};var ye=class n{constructor(t){this.utils=t}revokeFile(t){t?.previewUrl&&this.utils.revokePreview(t.previewUrl)}revokeFiles(t=[]){t.forEach(e=>this.revokeFile(e))}revokeRows(t){t.forEach(e=>{this.revokeFiles(e.files??[])})}static \u0275fac=function(e){return new(e||n)(J(q))};static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};var fi=ki(yi());var Se=class n{constructor(t){this.utils=t}parseZipAndMatch(t,e){return I(this,null,function*(){let o=yield fi.default.loadAsync(t),i=[],a=Object.values(o.files).filter(g=>!g.dir);for(let g of a){let f=yield g.async("blob"),w=new File([f],g.name,{type:f.type||this.utils.detectMimeFromName(g.name)}),k=this.utils.normalizeName(g.name),b=null,T=0;e.forEach((Z,K)=>{let Q=this.utils.normalizeName(Z.name);if(!Q)return;if(k.includes(Q)){b=K,T=1;return}let P=this.levenshtein(k,Q),bi=Math.max(k.length,Q.length),mt=1-P/bi;mt>T&&(T=mt,b=K)}),T<.8&&(b=null),i.push({file:w,matchedRowIndex:b!==null?b:void 0})}return{entries:i}})}levenshtein(t,e){let o=[];for(let i=0;i<=e.length;i++)o[i]=[i];for(let i=0;i<=t.length;i++)o[0][i]=i;for(let i=1;i<=e.length;i++)for(let a=1;a<=t.length;a++)e.charAt(i-1)===t.charAt(a-1)?o[i][a]=o[i-1][a-1]:o[i][a]=Math.min(o[i-1][a-1]+1,o[i][a-1]+1,o[i-1][a]+1);return o[e.length][t.length]}static \u0275fac=function(e){return new(e||n)(J(q))};static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};var Hi=["video"],Gi=["canvas"];function qi(n,t){if(n&1){let e=h();r(0,"div",15),S(1,"img",16),r(2,"button",17),_("click",function(){let i=p(e).index,a=d(2);return u(a.remove(i))}),r(3,"mat-icon"),c(4,"delete"),l()()()}if(n&2){let e=t.$implicit;s(),m("src",e.url,Y)}}function Qi(n,t){if(n&1&&(r(0,"div",13),v(1,qi,5,1,"div",14),l()),n&2){let e=d();s(),m("ngForOf",e.previews)}}var We=class n{constructor(t,e,o){this.data=t;this.dialogRef=e;this.snackbar=o}videoRef;canvasRef;stream;captured=[];previews=[];usingFrontCamera=!1;loading=!1;ngAfterViewInit(){return I(this,null,function*(){if(!this.isCameraSupported()){this.snackbar.open("Camera not supported on this device. Use file upload instead.","Close",{duration:4e3});return}yield this.startCamera()})}isCameraSupported(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}startCamera(){return I(this,null,function*(){this.stream&&this.stop(),this.stream=yield navigator.mediaDevices.getUserMedia({video:{facingMode:this.usingFrontCamera?"user":"environment"}});let t=this.videoRef.nativeElement;t.srcObject=this.stream,yield t.play()})}toggleCamera(){return I(this,null,function*(){this.usingFrontCamera=!this.usingFrontCamera,yield this.startCamera()})}capture(){if(this.loading)return;this.loading=!0,this.snackbar.open("Photo captured. Processing...",void 0,{duration:1500});let t=this.videoRef.nativeElement,e=this.canvasRef.nativeElement;e.width=t.videoWidth,e.height=t.videoHeight;let o=e.getContext("2d");o&&(o.drawImage(t,0,0),e.toBlob(i=>{if(!i){this.loading=!1;return}let a=Date.now(),g=`${this.data.entityType}-${this.data.rowIndex}-${a}.jpg`,f=new File([i],g,{type:"image/jpeg"}),w=window.URL.createObjectURL(f);this.captured.push(f),this.previews.push({file:f,url:w}),this.loading=!1},"image/jpeg",1))}remove(t){let e=this.previews[t];e&&window.URL.revokeObjectURL(e.url),this.previews.splice(t,1),this.captured.splice(t,1)}confirm(){this.stop(),this.dialogRef.close(this.captured)}cancel(){this.stop(),this.dialogRef.close(null)}stop(){this.stream?.getTracks().forEach(t=>t.stop())}ngOnDestroy(){this.stop(),this.previews.forEach(t=>window.URL.revokeObjectURL(t.url))}static \u0275fac=function(e){return new(e||n)(x(pe),x(oe),x(fe))};static \u0275cmp=F({type:n,selectors:[["app-bulk-camera-capture-dialog"]],viewQuery:function(e,o){if(e&1&&(Pe(Hi,5),Pe(Gi,5)),e&2){let i;Ie(i=Fe())&&(o.videoRef=i.first),Ie(i=Fe())&&(o.canvasRef=i.first)}},decls:19,vars:3,consts:[["video",""],["canvas",""],["mat-dialog-title",""],[1,"camera-body"],[1,"camera-preview"],["autoplay","","playsinline",""],["hidden",""],[1,"camera-controls"],["mat-flat-button","",3,"click"],["class","captured-list",4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"captured-list"],["class","captured-card",4,"ngFor","ngForOf"],[1,"captured-card"],[3,"src"],["mat-icon-button","","color","warn",3,"click"]],template:function(e,o){if(e&1){let i=h();r(0,"h2",2),c(1,"Capture Photos"),l(),r(2,"mat-dialog-content",3)(3,"div",4),S(4,"video",5,0)(6,"canvas",6,1),l(),r(8,"div",7)(9,"button",8),_("click",function(){return p(i),u(o.capture())}),r(10,"mat-icon"),c(11,"photo_camera"),l(),c(12," Capture "),l()(),v(13,Qi,2,1,"div",9),l(),r(14,"mat-dialog-actions",10)(15,"button",11),_("click",function(){return p(i),u(o.cancel())}),c(16,"Cancel"),l(),r(17,"button",12),_("click",function(){return p(i),u(o.confirm())}),c(18),l()()}e&2&&(s(13),m("ngIf",o.previews.length),s(4),m("disabled",!o.captured.length),s(),C(" Use Photos (",o.captured.length,") "))},dependencies:[D,j,O,ae,ue,_e,ge,W,z,me,ne,ie,$t],styles:[".camera-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.camera-preview[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:#000;border-radius:var(--surface-radius);overflow:hidden}video[_ngcontent-%COMP%]{width:100%;max-height:55vh;object-fit:cover}.camera-controls[_ngcontent-%COMP%]{display:flex;justify-content:center}.captured-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}.captured-card[_ngcontent-%COMP%]{position:relative;border-radius:8px;overflow:hidden;border:1px solid var(--border)}.captured-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:120px;object-fit:cover}.captured-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;top:6px;right:6px;background:#0009}"]})};var Me=class n{constructor(t){this.dialog=t}capture(t,e){return I(this,null,function*(){return this.dialog.open(We,{width:"95vw",maxWidth:"900px",height:"90vh",panelClass:"enterprise-camera-dialog",data:{entityType:t,rowIndex:e}}).afterClosed().toPromise()})}static \u0275fac=function(e){return new(e||n)(J(re))};static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};var He=class n extends ni{constructor(e,o,i,a){super();this.fileFactory=e;this.fileLifecycle=o;this.zipEngine=i;this.camera=a}dialog=Xe(re);snackbar=Xe(fe);allFiles=[];addRow(e){super.addRow(e);let o=this.rows.length-1,i=this.rows.at(o);i.contains("fileIds")||i.addControl("fileIds",this.fb.control([]))}getUnassignedFiles(){return this.allFiles.filter(e=>e.assignedRowIndexes.length===0)}clearRowsInternal(){super.clearRowsInternal(),this.fileLifecycle.revokeFiles(this.allFiles),this.allFiles=[]}ngOnDestroy(){this.fileLifecycle.revokeFiles(this.allFiles),super.ngOnDestroy?.()}openAssignmentDialog(e){let o=Array.isArray(e)?e:[e],i=this.rows.value.map((g,f)=>({index:f,name:g.name}));this.dialog.open(Ue,{data:{files:o,rows:i},maxWidth:"95vw"}).afterClosed().subscribe(g=>{g&&o.forEach(f=>{f.assignedRowIndexes=g,f.assignToEntity=!0,g.forEach(w=>{let b=(this.rows.at(w).get("variants")?.value??"").split(",").map(T=>T.trim().toUpperCase()).filter(Boolean);f.assignToEntity=!0,f.rowVariantMap[w]||(b.includes("STANDARD")?f.rowVariantMap[w]=["STANDARD"]:b.length?f.rowVariantMap[w]=[b[0]]:f.rowVariantMap[w]=[])}),Object.keys(f.rowVariantMap).forEach(w=>{let k=Number(w);g.includes(k)||delete f.rowVariantMap[k]}),this.rows.controls.forEach((w,k)=>{let b=w.get("fileIds")?.value??[];g.includes(k)?b.includes(f.id)||w.patchValue({fileIds:[...b,f.id]}):w.patchValue({fileIds:b.filter(T=>T!==f.id)})}),o.forEach(w=>w)})})}getRowFiles(e){return this.allFiles.filter(o=>o.assignedRowIndexes.includes(e))}onFileRemove(e){let o=this.allFiles.find(i=>i.id===e);o&&(o.assignedRowIndexes=[])}onRowFilesSelected(e,o){o&&Array.from(o).forEach(i=>{let a=this.fileFactory.createAssignedFile(i);a.assignedRowIndexes=[e],a.assignToEntity=!0;let f=(this.rows.at(e).get("variants")?.value??"").split(",").map(b=>b.trim().toUpperCase()).filter(Boolean);f.includes("STANDARD")?a.rowVariantMap[e]=["STANDARD"]:f.length?a.rowVariantMap[e]=[f[0]]:a.rowVariantMap[e]=[],this.allFiles.push(a);let w=this.rows.at(e),k=w.get("fileIds")?.value??[];w.patchValue({fileIds:[...k,a.id]})})}importZip(e){return I(this,null,function*(){if(!e)return;if(this.allFiles.length>0){let f=yield this.confirmMerge();if(!f)return;f==="replace"&&(this.fileLifecycle.revokeFiles(this.allFiles),this.allFiles=[])}let o=this.rows.value.map(f=>({name:f.name,variants:f.variants?f.variants.split(",").map(w=>w.trim()):[]})),i=yield this.zipEngine.parseZipAndMatch(e,o),a=0,g=0;if(i.entries.forEach(f=>{if(this.allFiles.some(b=>b.file.name===f.file.name&&b.file.size===f.file.size)){g++;return}let k=this.fileFactory.createAssignedFile(f.file);if(f.matchedRowIndex!==void 0){let b=f.matchedRowIndex;k.assignedRowIndexes=[b],k.assignToEntity=!0;let Z=(this.rows.at(b).get("variants")?.value??"").split(",").map(P=>P.trim().toUpperCase()).filter(Boolean);Z.includes("STANDARD")?k.rowVariantMap[b]=["STANDARD"]:Z.length?k.rowVariantMap[b]=[Z[0]]:k.rowVariantMap[b]=[];let K=this.rows.at(b),Q=K.get("fileIds")?.value??[];K.patchValue({fileIds:[...Q,k.id]})}else k.assignToEntity=!1;this.allFiles.push(k),a++}),a||g){let f=[];a&&f.push(`${a} file${a>1?"s":""} uploaded`),g&&f.push(`${g} duplicate${g>1?"s":""} skipped`),this.snackbar.open(`\u2705 ${f.join(", ")}`,"Close",{duration:4e3})}})}buildFileMetadata(){return this.allFiles.map(e=>({id:e.id,fileName:e.file.name,assignedRowIndexes:e.assignedRowIndexes,rowVariantMap:e.rowVariantMap,assignToEntity:e.assignToEntity,description:e.description}))}appendFilesToFormData(e){this.allFiles.forEach(o=>{e.append("files",o.file)})}capturePhotoForRow(e,o){return I(this,null,function*(){let i=yield this.camera.capture(o,e);i?.length&&i.forEach(a=>{let g=this.fileFactory.createAssignedFile(a);g.assignedRowIndexes=[e],g.assignToEntity=!0;let w=(this.rows.at(e).get("variants")?.value??"").split(",").map(T=>T.trim().toUpperCase()).filter(Boolean);w.length?g.rowVariantMap[e]=[w[0]]:g.rowVariantMap[e]=["STANDARD"],this.allFiles.push(g);let k=this.rows.at(e),b=k.get("fileIds")?.value??[];k.patchValue({fileIds:[...b,g.id]})})})}static \u0275fac=function(o){return new(o||n)(x(ke),x(ye),x(Se),x(Me))};static \u0275dir=ft({type:n,features:[Be]})};var Ci=()=>({standalone:!0});function Ki(n,t){if(n&1&&(r(0,"div",26),c(1),l()),n&2){let e=d().$implicit;s(),C(" ",e.value._error," ")}}function Ji(n,t){if(n&1){let e=h();r(0,"div",12)(1,"div",13)(2,"span"),c(3),l(),r(4,"button",14),_("click",function(){let i=p(e).index,a=d();return u(a.removeRow(i))}),r(5,"mat-icon"),c(6,"delete"),l()()(),r(7,"div",15)(8,"mat-form-field"),S(9,"input",16),l(),r(10,"mat-form-field"),S(11,"input",17),l()(),r(12,"div",15)(13,"mat-form-field"),S(14,"input",18),l(),r(15,"mat-form-field")(16,"input",19),_("input",function(){let i=p(e).index,a=d();return u(a.uppercaseVariants(i))}),l()()(),r(17,"mat-form-field"),S(18,"input",20),l(),r(19,"input",21,1),_("change",function(){let i=p(e).index,a=tt(20);return d().onRowFilesSelected(i,a.files),u(a.value="")}),l(),r(21,"div",22)(22,"button",11),_("click",function(){p(e);let i=tt(20);return u(i.click())}),r(23,"mat-icon"),c(24,"upload"),l(),c(25," Upload Files "),l(),r(26,"button",23),_("click",function(){let i=p(e).index,a=d();return u(a.capturePhotoForRow(i,"product"))}),r(27,"mat-icon"),c(28,"photo_camera"),l(),c(29," Take Photo "),l()(),r(30,"app-bulk-file-assignment",24),_("remove",function(i){p(e);let a=d();return u(a.onFileRemove(i))})("assign",function(i){p(e);let a=d();return u(a.openAssignmentDialog(i))})("multiAssign",function(i){p(e);let a=d();return u(a.openAssignmentDialog(i))}),l(),v(31,Ki,2,1,"div",25),l()}if(n&2){let e=t.$implicit,o=t.index,i=d();m("formGroupName",o),s(3),C("Product ",o+1,""),s(27),m("files",i.getRowFiles(o))("rowIndex",o)("rowVariants",i.getRowVariants(o))("multiSelectMode",!0),s(),m("ngIf",e.value._error)}}function Yi(n,t){if(n&1){let e=h();r(0,"div",27)(1,"h3"),c(2,"Unassigned Files"),l(),r(3,"app-bulk-file-assignment",28),_("multiAssign",function(i){p(e);let a=d();return u(a.openAssignmentDialog(i))})("remove",function(i){p(e);let a=d();return u(a.onFileRemove(i))}),l()()}if(n&2){let e=d();s(3),m("files",e.getUnassignedFiles())("multiSelectMode",!0)}}var Ge=class n extends He{constructor(e,o,i,a,g,f,w){super(a,g,f,w);this.productService=e;this.submitEngine=o;this.dialogRef=i}config=di;zipLoading=!1;createMissingCategories=!1;createMissingSuppliers=!1;ngOnInit(){this.initForm()}getRowVariants(e){return(this.rows.at(e).get("variants")?.value??"").split(",").map(i=>i.trim().toUpperCase()).filter(Boolean)}uppercaseVariants(e){let o=this.rows.at(e).get("variants");if(!o)return;let i=o.value??"";o.setValue(i.toUpperCase(),{emitEvent:!1})}trackByIndex(e){return e}importExcel(e){return I(this,null,function*(){if(!e)return;let o=yield this.confirmMerge();o&&Ke(n.prototype,this,"importExcelFile").call(this,e,void 0,o)})}importCsv(e){return I(this,null,function*(){if(!e)return;let o=yield this.confirmMerge();o&&Ke(n.prototype,this,"importCsvFile").call(this,e,o)})}close(){this.dialogRef.close()}get rowNames(){return this.rows.value.map(e=>e.name??"")}submit(){let e={products:this.rows.value.map(i=>se(le({},i),{supplierNames:i.supplierNames?i.supplierNames.split(",").map(a=>a.trim()).filter(Boolean):[],variants:i.variants?i.variants.split(",").map(a=>a.trim()).filter(Boolean):[]})),fileMetadata:this.buildFileMetadata(),options:{dryRun:!0,createMissingCategories:this.createMissingCategories,createMissingSuppliers:this.createMissingSuppliers}},o=new FormData;o.append("payload",new Blob([JSON.stringify(e)],{type:"application/json"})),this.appendFilesToFormData(o),this.submitEngine.executeMultipart({submitFn:i=>this.productService.bulkFullCreate(i),formData:o,rows:this.rows.controls,dryRun:!0,title:this.config.title,confirmLabel:"Confirm Import",columns:this.config.previewColumns,onPreviewTransform:i=>{this.config.mapPreviewRow&&Array.isArray(i.data)&&(i.data=i.data.map(a=>this.config.mapPreviewRow(a)))},onErrorsApplied:i=>this.cacheErrors(i),onConfirmRetry:()=>this.submitBulk(),onFinalSuccess:()=>{}})}submitBulk(){let e={products:this.rows.value.map(i=>se(le({},i),{supplierNames:i.supplierNames?i.supplierNames.split(",").map(a=>a.trim()).filter(Boolean):[],variants:i.variants?i.variants.split(",").map(a=>a.trim()).filter(Boolean):[]})),fileMetadata:this.buildFileMetadata(),options:{dryRun:!1,createMissingCategories:this.createMissingCategories,createMissingSuppliers:this.createMissingSuppliers}},o=new FormData;o.append("payload",new Blob([JSON.stringify(e)],{type:"application/json"})),this.appendFilesToFormData(o),this.submitEngine.executeMultipart({submitFn:i=>this.productService.bulkFullCreate(i),formData:o,rows:this.rows.controls,dryRun:!1,title:this.config.title,columns:this.config.previewColumns,onPreviewTransform:i=>{this.config.mapPreviewRow&&Array.isArray(i.data)&&(i.data=i.data.map(a=>this.config.mapPreviewRow(a)))},onErrorsApplied:i=>this.cacheErrors(i),onFinalSuccess:()=>this.dialogRef.close(!0)})}static \u0275fac=function(o){return new(o||n)(x(Ae),x(ri),x(oe),x(ke),x(ye),x(Se),x(Me))};static \u0275cmp=F({type:n,selectors:[["app-product-bulk-import-dialog"]],features:[Be],decls:17,vars:17,consts:[["bottomAnchor",""],["fileInput",""],[3,"keydown.enter","formGroup"],[3,"importCsv","importExcel","downloadCsv","downloadExcel","submit","cancel","goToLine","goTop","goBottom","prevError","nextError","clearAll","exportCsv","exportExcel","zipDropped","title","rowCount","submitting","formInvalid","loading","progress","supportsArchiveImport"],[1,"products-body"],["bulk-options","",1,"bulk-options"],["formControlName","dryRun"],[3,"ngModelChange","ngModel","ngModelOptions"],["formArrayName","rows",1,"rows"],["class","row-card",3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],["class","unassigned-section",4,"ngIf"],["mat-stroked-button","",3,"click"],[1,"row-card",3,"formGroupName"],[1,"row-header"],["mat-icon-button","","color","warn",3,"click"],[1,"grid-2"],["matInput","","placeholder","Name","formControlName","name"],["matInput","","placeholder","Category","formControlName","categoryName"],["matInput","","placeholder","Suppliers","formControlName","supplierNames"],["matInput","","placeholder","Variants","formControlName","variants",3,"input"],["matInput","","type","number","placeholder","Minimum % Profit","formControlName","minimumPercentageProfit"],["type","file","multiple","","hidden","",3,"change"],[1,"file-actions"],["mat-stroked-button","","color","primary",3,"click"],[3,"remove","assign","multiAssign","files","rowIndex","rowVariants","multiSelectMode"],["class","row-error",4,"ngIf"],[1,"row-error"],[1,"unassigned-section"],[3,"multiAssign","remove","files","multiSelectMode"]],template:function(o,i){if(o&1){let a=h();r(0,"form",2),_("keydown.enter",function(f){return p(a),u(f.stopPropagation())}),r(1,"app-bulk-import-shell",3),_("importCsv",function(f){return p(a),u(i.importCsv(f))})("importExcel",function(f){return p(a),u(i.importExcel(f))})("downloadCsv",function(){return p(a),u(i.downloadCsvTemplate())})("downloadExcel",function(){return p(a),u(i.downloadExcelTemplate())})("submit",function(){return p(a),u(i.submit())})("cancel",function(){return p(a),u(i.close())})("goToLine",function(f){return p(a),u(i.goToLine(f))})("goTop",function(){return p(a),u(i.scrollToTop())})("goBottom",function(){return p(a),u(i.scrollToBottom())})("prevError",function(){return p(a),u(i.goToPreviousError())})("nextError",function(){return p(a),u(i.goToNextError())})("clearAll",function(){return p(a),u(i.clearRows())})("exportCsv",function(){return p(a),u(i.exportCsvCurrentRows())})("exportExcel",function(){return p(a),u(i.exportExcelCurrentRows())})("zipDropped",function(f){return p(a),u(i.importZip(f))}),r(2,"div",4)(3,"div",5)(4,"mat-checkbox",6),c(5," Dry run (validate only) "),l(),r(6,"mat-checkbox",7),A("ngModelChange",function(f){return p(a),R(i.createMissingCategories,f)||(i.createMissingCategories=f),u(f)}),c(7," Auto-create missing categories "),l(),r(8,"mat-checkbox",7),A("ngModelChange",function(f){return p(a),R(i.createMissingSuppliers,f)||(i.createMissingSuppliers=f),u(f)}),c(9," Auto-create missing suppliers "),l()(),r(10,"div",8),v(11,Ji,32,7,"div",9),l(),v(12,Yi,4,2,"div",10),r(13,"button",11),_("click",function(){return p(a),u(i.addRow())}),c(14," + Add Product "),l(),S(15,"div",null,0),l()()()}o&2&&(m("formGroup",i.form),s(),m("title",i.config.title)("rowCount",i.rowCount)("submitting",i.submitting)("formInvalid",i.form.invalid)("loading",i.submitting||i.loading)("progress",i.progress)("supportsArchiveImport",i.supportsArchiveImport),s(5),V("ngModel",i.createMissingCategories),m("ngModelOptions",De(15,Ci)),s(2),V("ngModel",i.createMissingSuppliers),m("ngModelOptions",De(16,Ci)),s(3),m("ngForOf",i.rows.controls)("ngForTrackBy",i.trackByIndex),s(),m("ngIf",i.getUnassignedFiles().length))},dependencies:[D,j,O,Vt,Ft,de,Dt,ee,It,Tt,Bt,Et,Ot,U,te,oi,he,ve,xe,Ce,G,H,W,z,me,ne,ie,$e],styles:[".products-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.bulk-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.row-card[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:20px;background:var(--surface);display:flex;flex-direction:column;gap:16px}.row-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600;border-bottom:1px dashed var(--border);padding-bottom:6px}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.mat-form-field[_ngcontent-%COMP%]{width:100%}.row-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.highlight-line[_ngcontent-%COMP%]{outline:2px solid #1976d2;outline-offset:4px;transition:outline .3s ease}.unassigned-section[_ngcontent-%COMP%]{border:1px dashed var(--border);padding:16px;border-radius:8px;background:var(--surface)}.file-actions[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap}@media (max-width: 768px){.file-actions[_ngcontent-%COMP%]{flex-direction:column}.file-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})};var qe={DISABLE:["Discontinued product","Replaced by new model","Incorrect configuration","Pricing issue","Supplier contract terminated"],RESTORE:["Mistaken disable","Supplier reinstated","Pricing corrected","Inventory discrepancy resolved"],DELETE:["Duplicate product entry","Created in error","Test data cleanup","Regulatory data cleanup"]};var Qe=class n{constructor(t){this.ref=t}restoreTransactions=!0;restoreInventory=!0;syncCheckboxes(t){this.restoreTransactions=t,this.restoreInventory=t}confirm(){this.ref.close({restoreStockTransactions:this.restoreTransactions,restoreInventory:this.restoreInventory})}close(){this.ref.close(null)}static \u0275fac=function(e){return new(e||n)(x(oe))};static \u0275cmp=F({type:n,selectors:[["ng-component"]],decls:12,vars:2,consts:[["mat-dialog-title",""],[3,"ngModelChange","change","ngModel"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,o){e&1&&(r(0,"h2",0),c(1,"Restore Options"),l(),r(2,"mat-dialog-content")(3,"mat-checkbox",1),A("ngModelChange",function(a){return R(o.restoreTransactions,a)||(o.restoreTransactions=a),a}),_("change",function(a){return o.syncCheckboxes(a.checked)}),c(4," Restore stock transactions "),l(),r(5,"mat-checkbox",1),A("ngModelChange",function(a){return R(o.restoreInventory,a)||(o.restoreInventory=a),a}),_("change",function(a){return o.syncCheckboxes(a.checked)}),c(6," Recalculate inventory from transactions "),l()(),r(7,"mat-dialog-actions",2)(8,"button",3),_("click",function(){return o.close()}),c(9,"Cancel"),l(),r(10,"button",4),_("click",function(){return o.confirm()}),c(11," Confirm "),l()()),e&2&&(s(3),V("ngModel",o.restoreTransactions),s(2),V("ngModel",o.restoreInventory))},dependencies:[D,G,H,W,z,U,ee,te,ae,ue,_e,ge],encapsulation:2})};var Xi=()=>[10,25,50,100],Ze=n=>["/products",n],dt=n=>["/products",n,"edit"],ct=n=>({deleted:n}),wi=(n,t)=>({"text-green-400":n,"text-red-400":t}),en=n=>({"row-selected":n});function tn(n,t){if(n&1){let e=h();r(0,"button",28),_("click",function(){p(e);let i=d();return u(i.toggleDensity())}),r(1,"mat-icon"),c(2,"format_line_spacing"),l()()}}function nn(n,t){if(n&1&&(r(0,"mat-option",17),c(1),l()),n&2){let e=t.$implicit;m("value",e.id),s(),C(" ",e.name," ")}}function on(n,t){if(n&1&&(r(0,"mat-option",17),c(1),l()),n&2){let e=t.$implicit;m("value",e.id),s(),C(" ",e.name," ")}}function rn(n,t){if(n&1){let e=h();r(0,"mat-form-field",15)(1,"mat-label"),c(2,"Status"),l(),r(3,"mat-select",16),_("selectionChange",function(i){p(e);let a=d();return u(a.onStatusChange(i.value))}),r(4,"mat-option",29),c(5,"All"),l(),r(6,"mat-option",30),c(7,"Active"),l(),r(8,"mat-option",31),c(9,"Deleted"),l()()()}}function an(n,t){if(n&1){let e=h();r(0,"mat-checkbox",32),_("change",function(i){p(e);let a=d();return u(a.onToggleShowDeleted(i.checked))}),c(1," Show deleted "),l()}}function ln(n,t){if(n&1){let e=h();r(0,"button",40),_("click",function(){p(e);let i=d(2);return u(i.bulkSoftDelete())}),c(1," Soft Delete "),l()}}function sn(n,t){if(n&1){let e=h();r(0,"button",41),_("click",function(){p(e);let i=d(2);return u(i.bulkRestore())}),c(1," Restore "),l()}}function cn(n,t){if(n&1){let e=h();r(0,"button",42),_("click",function(){p(e);let i=d(2);return u(i.bulkHardDelete())}),c(1," Hard Delete "),l()}}function dn(n,t){n&1&&(r(0,"span",43),c(1," Mixed selection \u2014 cannot perform bulk action "),l())}function mn(n,t){if(n&1){let e=h();r(0,"div",33)(1,"span",34),c(2),l(),v(3,ln,2,0,"button",35)(4,sn,2,0,"button",36)(5,cn,2,0,"button",37)(6,dn,2,0,"span",38),r(7,"button",39),_("click",function(){p(e);let i=d();return u(i.clearSelection())}),c(8," Cancel Selection "),l()()}if(n&2){let e=d();s(2),C(" ",e.selectedIds.size," selected "),s(),m("ngIf",e.bulkState==="active"),s(),m("ngIf",e.bulkState==="deleted"),s(),m("ngIf",e.bulkState==="deleted"),s(),m("ngIf",e.bulkState==="mixed")}}function pn(n,t){if(n&1){let e=h();r(0,"img",59),_("error",function(){p(e);let i=d().$implicit,a=d(2);return u(a.onThumbnailError(i))}),l()}if(n&2){let e=d().$implicit;m("src",e.thumbnail,Y)}}function un(n,t){n&1&&(r(0,"div",60)(1,"mat-icon"),c(2,"inventory_2"),l()())}function gn(n,t){if(n&1){let e=h();r(0,"div",46),_("click",function(){let i=p(e).$implicit,a=d(2);return u(a.toggleRowSelection(i))}),r(1,"div",47),_("click",function(i){let a=p(e).$implicit;return d(2).openImageViewer(a),u(i.stopPropagation())}),v(2,pn,1,1,"img",48)(3,un,3,0,"div",49),l(),r(4,"div",50),c(5),l(),r(6,"div",51),c(7),l(),r(8,"div",52),c(9),l(),r(10,"div",53),c(11),l(),r(12,"div",54)(13,"button",55),_("click",function(){let i=p(e).$implicit,a=d(2);return u(a.createSale(i))}),r(14,"mat-icon"),c(15,"point_of_sale"),l()(),r(16,"button",56)(17,"mat-icon"),c(18,"visibility"),l()(),r(19,"button",57)(20,"mat-icon"),c(21,"edit"),l()(),r(22,"button",58),_("click",function(i){let a=p(e).$implicit;return d(2).toggleProductStatus(a),u(i.stopPropagation())}),r(23,"mat-icon"),c(24),l()()()()}if(n&2){let e=t.$implicit,o=d(2);X("compact",o.density==="compact")("comfortable",o.density==="comfortable")("deleted",e.deleted)("selected",o.selectedIds.has(e.id)),s(2),m("ngIf",e.thumbnail),s(),m("ngIf",!e.thumbnail),s(2),C(" ",e.name," "),s(2),C(" ",e.categoryName||"\u2014"," "),s(2),C(" SKU: ",e.sku||"\u2014"," "),s(2),ht(" Variants: ",e.variants.length||0," \xB7 Suppliers: ",e.suppliers.length||0," "),s(2),m("disabled",e.deleted),s(3),m("disabled",e.deleted)("routerLink",E(22,Ze,e.id)),s(3),m("disabled",e.deleted)("routerLink",E(24,dt,e.id)),s(3),et("matTooltip",e.deleted?"Restore/Delete":"Disable"),s(2),C(" ",e.deleted?"toggle_off":"toggle_on"," ")}}function _n(n,t){if(n&1&&(r(0,"div",44),v(1,gn,25,26,"div",45),l()),n&2){let e=d();X("compact",e.density==="compact")("comfortable",e.density==="comfortable"),s(),m("ngForOf",e.products)}}function fn(n,t){if(n&1){let e=h();r(0,"th",85)(1,"mat-checkbox",86),_("change",function(){p(e);let i=d(3);return u(i.masterToggle())}),l()()}if(n&2){let e=d(3);s(),m("checked",e.isAllSelected())("indeterminate",e.selectedIds.size>0&&!e.isAllSelected())}}function vn(n,t){if(n&1){let e=h();r(0,"td",87)(1,"mat-checkbox",88),_("click",function(i){return p(e),u(i.stopPropagation())})("change",function(){let i=p(e).$implicit,a=d(3);return u(a.toggleRowSelection(i))}),l()()}if(n&2){let e=t.$implicit,o=d(3);s(),m("checked",o.selectedIds.has(e.id))}}function hn(n,t){if(n&1){let e=h();r(0,"th",89),_("click",function(){p(e);let i=d(3);return u(i.sortBy("name"))}),r(1,"span",90),c(2," Name "),r(3,"mat-icon",91),c(4),l()()()}if(n&2){let e=d(3);s(4),C(" ",e.getSortIcon("name")," ")}}function Cn(n,t){if(n&1&&(r(0,"td",87)(1,"a",92),c(2),l()()),n&2){let e=t.$implicit;s(),m("routerLink",E(3,Ze,e.id))("state",E(5,ct,e.deleted)),s(),C(" ",e.name," ")}}function xn(n,t){if(n&1){let e=h();r(0,"th",93),_("click",function(){p(e);let i=d(3);return u(i.sortBy("category.name"))}),r(1,"span",90),c(2," Category "),r(3,"mat-icon",91),c(4),l()()()}if(n&2){let e=d(3);s(4),C(" ",e.getSortIcon("category.name")," ")}}function wn(n,t){if(n&1&&(r(0,"td",87),c(1),l()),n&2){let e=t.$implicit;s(),C(" ",e.categoryName||"\u2014"," ")}}function bn(n,t){if(n&1){let e=h();r(0,"th",94),_("click",function(){p(e);let i=d(3);return u(i.sortBy("variantCount"))}),r(1,"span",90),c(2," Variants "),r(3,"mat-icon",91),c(4),l()()()}if(n&2){let e=d(3);s(4),C(" ",e.getSortIcon("variantCount")," ")}}function kn(n,t){if(n&1&&(r(0,"td",87),c(1),l()),n&2){let e=t.$implicit;s(),C(" ",(e.variants==null?null:e.variants.length)||0," ")}}function yn(n,t){if(n&1){let e=h();r(0,"th",95),_("click",function(){p(e);let i=d(3);return u(i.sortBy("sku"))}),r(1,"span",90),c(2," SKU "),r(3,"mat-icon",91),c(4),l()()()}if(n&2){let e=d(3);s(4),C(" ",e.getSortIcon("sku")," ")}}function Sn(n,t){if(n&1&&(r(0,"td",87),c(1),l()),n&2){let e=t.$implicit;s(),C(" ",e.sku||"\u2014"," ")}}function Mn(n,t){if(n&1){let e=h();r(0,"th",94),_("click",function(){p(e);let i=d(3);return u(i.sortBy("supplierCount"))}),r(1,"span",90),c(2," Suppliers "),r(3,"mat-icon",91),c(4),l()()()}if(n&2){let e=d(3);s(4),C(" ",e.getSortIcon("supplierCount")," ")}}function Pn(n,t){if(n&1&&(r(0,"td",87),c(1),l()),n&2){let e=t.$implicit;s(),C(" ",(e.suppliers==null?null:e.suppliers.length)||0," ")}}function In(n,t){if(n&1){let e=h();r(0,"th",96),_("click",function(){p(e);let i=d(3);return u(i.sortBy("deleted"))}),r(1,"span",90),c(2," Status "),r(3,"mat-icon",91),c(4),l()()()}if(n&2){let e=d(3);s(4),C(" ",e.getSortIcon("deleted")," ")}}function Fn(n,t){if(n&1&&(r(0,"td",87)(1,"span",97),c(2),l()()),n&2){let e=t.$implicit;s(),m("ngClass",it(2,wi,!e.deleted,e.deleted)),s(),C(" ",e.deleted?"Disabled":"Active"," ")}}function Dn(n,t){if(n&1){let e=h();r(0,"th",98),_("click",function(){p(e);let i=d(3);return u(i.sortBy("updatedAt"))}),r(1,"span",90),c(2," Updated "),r(3,"mat-icon",91),c(4),l()()()}if(n&2){let e=d(3);s(4),C(" ",e.getSortIcon("updatedAt")," ")}}function Tn(n,t){if(n&1&&(r(0,"td",87),c(1),Ct(2,"date"),l()),n&2){let e=t.$implicit;s(),C(" ",xt(2,1,e.updatedAt,"medium")," ")}}function En(n,t){n&1&&(r(0,"th",85),c(1," Actions"),l()),n&2&&vt("aria-label","Product actions")}function On(n,t){if(n&1){let e=h();r(0,"td",87)(1,"button",55),_("click",function(i){let a=p(e).$implicit;return d(3).createSale(a),u(i.stopPropagation())}),r(2,"mat-icon"),c(3,"point_of_sale"),l()(),r(4,"button",99)(5,"mat-icon"),c(6,"visibility"),l()(),r(7,"button",100)(8,"mat-icon"),c(9,"edit"),l()(),r(10,"button",58),_("click",function(i){let a=p(e).$implicit;return d(3).toggleProductStatus(a),u(i.stopPropagation())}),r(11,"mat-icon"),c(12),l()()()}if(n&2){let e=t.$implicit;s(),m("disabled",e.deleted),s(3),m("disabled",e.deleted)("routerLink",E(9,Ze,e.id))("state",E(11,ct,e.deleted)),s(3),m("disabled",e.deleted)("routerLink",E(13,dt,e.id))("state",E(15,ct,e.deleted)),s(3),et("matTooltip",e.deleted?"Restore/Delete":"Disable"),s(2),C(" ",e.deleted?"toggle_off":"toggle_on"," ")}}function Bn(n,t){n&1&&S(0,"tr",101)}function Vn(n,t){if(n&1){let e=h();r(0,"tr",102),_("click",function(){let i=p(e).$implicit,a=d(3);return u(a.toggleRowSelection(i))}),l()}if(n&2){let e=t.$implicit,o=d(3);m("ngClass",E(1,en,o.selectedIds.has(e.id)))}}function Rn(n,t){if(n&1&&(r(0,"div",64)(1,"table",65),N(2,66),v(3,fn,2,2,"th",67)(4,vn,2,1,"td",68),$(),N(5,69),v(6,hn,5,1,"th",70)(7,Cn,3,7,"td",68),$(),N(8,71),v(9,xn,5,1,"th",72)(10,wn,2,1,"td",68),$(),N(11,73),v(12,bn,5,1,"th",74)(13,kn,2,1,"td",68),$(),N(14,75),v(15,yn,5,1,"th",76)(16,Sn,2,1,"td",68),$(),N(17,77),v(18,Mn,5,1,"th",74)(19,Pn,2,1,"td",68),$(),N(20,78),v(21,In,5,1,"th",79)(22,Fn,3,5,"td",68),$(),N(23,80),v(24,Dn,5,1,"th",81)(25,Tn,3,4,"td",68),$(),N(26,82),v(27,En,2,1,"th",67)(28,On,13,17,"td",68),$(),v(29,Bn,1,0,"tr",83)(30,Vn,1,3,"tr",84),l()()),n&2){let e=d(2);s(),m("dataSource",e.products),s(28),m("matHeaderRowDef",e.displayedColumns),s(),m("matRowDefColumns",e.displayedColumns)}}function An(n,t){if(n&1){let e=h();r(0,"div",105),_("click",function(){let i=p(e).$implicit,a=d(3);return u(a.toggleRowSelection(i))}),r(1,"div",106)(2,"mat-checkbox",88),_("click",function(i){return p(e),u(i.stopPropagation())})("change",function(){let i=p(e).$implicit,a=d(3);return u(a.toggleRowSelection(i))}),l(),r(3,"div",107),c(4),l()(),r(5,"div",108),c(6),l(),r(7,"div",109)(8,"div")(9,"div",110),c(10,"SKU"),l(),r(11,"div",111),c(12),l()(),r(13,"div")(14,"div",110),c(15,"Variants"),l(),r(16,"div",111),c(17),l()(),r(18,"div")(19,"div",110),c(20,"Suppliers"),l(),r(21,"div",111),c(22),l()(),r(23,"div")(24,"div",110),c(25,"Status"),l(),r(26,"div",112),c(27),l()()(),r(28,"div",113)(29,"button",55),_("click",function(i){let a=p(e).$implicit;return d(3).createSale(a),u(i.stopPropagation())}),r(30,"mat-icon"),c(31,"point_of_sale"),l()(),r(32,"button",114),_("click",function(i){return p(e),u(i.stopPropagation())}),r(33,"mat-icon"),c(34,"visibility"),l()(),r(35,"button",115),_("click",function(i){return p(e),u(i.stopPropagation())}),r(36,"mat-icon"),c(37,"edit"),l()()()()}if(n&2){let e=t.$implicit,o=d(3);X("deleted",e.deleted)("selected",o.selectedIds.has(e.id)),s(2),m("checked",o.selectedIds.has(e.id)),s(2),C(" ",e.name," "),s(2),C(" ",e.categoryName||"\u2014"," "),s(6),ce(e.sku),s(5),ce(e.variants.length||0),s(5),ce(e.suppliers.length||0),s(4),m("ngClass",it(17,wi,!e.deleted,e.deleted)),s(),C(" ",e.deleted?"Disabled":"Active"," "),s(2),m("disabled",e.deleted),s(3),m("disabled",e.deleted)("routerLink",E(20,Ze,e.id)),s(3),m("disabled",e.deleted)("routerLink",E(22,dt,e.id))}}function Ln(n,t){if(n&1&&(r(0,"div",103),v(1,An,38,24,"div",104),l()),n&2){let e=d(2);X("compact",e.density==="compact")("comfortable",e.density==="comfortable"),s(),m("ngForOf",e.products)("ngForTrackBy",e.trackById)}}function Nn(n,t){if(n&1&&(r(0,"div",61),v(1,Rn,31,3,"div",62)(2,Ln,2,6,"div",63),l()),n&2){let e=d();X("compact",e.density==="compact"),s(),m("ngIf",!e.isMobile),s(),m("ngIf",e.isMobile)}}var xi=class n{constructor(t,e,o,i,a,g,f,w,k){this.productService=t;this.categoryService=e;this.supplierService=o;this.authService=i;this.entityAction=a;this.snackbar=g;this.dialog=f;this.breakpoint=w;this.router=k}page$=new M(0);serverSize$=new M(100);uiPage$=new M(0);uiPageSize$=new M(20);loadedServerPages=new Set;search$=new M("");sortField$=new M(null);sortDir$=new M("asc");statusFilter$=new M("all");categoryFilter$=new M(null);refresh$=new M(void 0);showDeleted$=new M(!1);minSuppliers$=new M(null);maxSuppliers$=new M(null);supplierFilter$=new M(null);allProducts=[];filteredProducts=[];products=[];categories=[];suppliers=[];loading=!0;showDeleted=!1;filters={name:"",categoryIds:[],includeDeleted:!1};selectedIds=new Set;sortField=null;sortDir="asc";displayedColumns=["select","name","category","variants","sku","suppliers","status","updated","actions"];total=0;totalServerElements=0;page=0;STORAGE_KEY="product_list_prefs";viewMode="table";density="compact";isMobile=!1;canManageDeleted=!1;paginator;productActionConfig={entityName:"Product",displayName:t=>t.name,disableReasons:qe.DISABLE,restoreReasons:qe.RESTORE,deleteReasons:qe.DELETE,disable:(t,e)=>this.productService.softDelete(t,e),restore:(t,e)=>this.openRestoreOptionsDialog().pipe(Ee(o=>o?this.productService.restore(t,e,o):Je(null))),hardDelete:(t,e)=>this.productService.hardDelete(t,e),disableBulk:(t,e)=>this.productService.bulkSoftDelete(t,e),restoreBulk:(t,e)=>this.openRestoreOptionsDialog().pipe(Ee(o=>o?this.productService.bulkRestore(t,e,o):Je(null))),hardDeleteBulk:(t,e)=>this.productService.bulkHardDelete(t,e),reload:()=>{this.resetAccumulation(),this.page$.next(0),this.refresh$.next(),this.clearSelection()}};ngOnInit(){this.loading=!0;let t=this.authService.getSnapshot();t&&(this.canManageDeleted=["SUPERUSER","ADMIN","MANAGER"].includes(t.role)),this.breakpoint.observe(["(max-width: 640px)"]).subscribe(o=>{this.isMobile=o.matches,this.viewMode=this.isMobile?"grid":"table",this.density=this.isMobile?"compact":this.density}),this.loadPreferences(),this.loadCategories(),this.supplierService.getAll(!1).subscribe({next:o=>{this.suppliers=o.map(i=>({id:i.id,name:i.name}))}}),pt([this.page$,this.serverSize$,this.sortField$,this.sortDir$,this.search$.pipe(ut(1e3),gt()),this.statusFilter$,this.categoryFilter$,this.showDeleted$,this.refresh$,this.minSuppliers$,this.maxSuppliers$,this.supplierFilter$]).pipe(Ye(()=>this.loading=!0),Ee(([o,i,a,g,f,w,k,b,T,Z,K,Q])=>{let P={page:o,size:i,includeDeleted:b};return f?.trim()&&(P.keyword=f.trim()),w==="active"&&(P.deleted=!1),w==="deleted"&&(P.deleted=!0),k&&(P.categoryId=k),a&&(P.sortBy=a,P.direction=g),Z!==null&&(P.minSuppliers=Z),K!==null&&(P.maxSuppliers=K),Q&&(P.supplierId=Q),this.productService.getAdvanced(P)}),Ye(o=>{this.totalServerElements=o.totalElements??0;let i=this.page$.value;if(!this.loadedServerPages.has(i)&&o.content?.length){let a=(o.content??[]).map(g=>se(le({},g),{thumbnail:`${Lt.apiUrl}/products/${g.id}/thumbnail`}));this.allProducts=[...this.allProducts,...a],this.loadedServerPages.add(i)}this.applyClientPagination(),this.loading=!1})).subscribe()}applyClientPagination(){let t=this.uiPage$.value,e=this.uiPageSize$.value,o=t*e,i=o+e;this.products=this.allProducts.slice(o,i)}getSelectedProducts(){return this.allProducts.filter(t=>this.selectedIds.has(t.id))}resetAccumulation(){this.allProducts=[],this.loadedServerPages.clear(),this.uiPage$.next(0)}loadCategories(){this.categoryService.getAll("flat",!1).subscribe({next:t=>this.categories=t,error:()=>{}})}onMinSuppliersChange(t){let e=t?+t:null;this.setSupplierRange(e,this.maxSuppliers$.value)}onMaxSuppliersChange(t){let e=t?+t:null;this.setSupplierRange(this.minSuppliers$.value,e)}setSupplierRange(t,e){if(t===null&&e===null){this.minSuppliers$.next(null),this.maxSuppliers$.next(null);return}if(t!==null&&e!==null&&t>e){this.snackbar.open("Minimum suppliers cannot be greater than maximum suppliers","Close",{duration:3e3});return}this.resetAccumulation(),this.page$.next(0),this.minSuppliers$.next(t),this.maxSuppliers$.next(e)}get currentSortField(){return this.sortField$.value}get currentSortDir(){return this.sortDir$.value}get currentPageSize(){return this.serverSize$.value}get currentUiPageSize(){return this.uiPageSize$.value}getSortIcon(t){return this.currentSortField!==t?"unfold_more":this.currentSortDir==="asc"?"arrow_upward":"arrow_downward"}onSearchChange(t){this.resetAccumulation(),this.page$.next(0),this.search$.next(t)}onSupplierChange(t){this.resetAccumulation(),this.page$.next(0),this.supplierFilter$.next(t)}onStatusChange(t){this.resetAccumulation(),this.page$.next(0),this.statusFilter$.next(t)}onCategoryChange(t){this.resetAccumulation(),this.page$.next(0),this.categoryFilter$.next(t)}setView(t){if(this.viewMode=t,t==="table"){let e=this.density==="compact"?25:10;this.uiPageSize$.next(e),this.uiPage$.next(0),this.applyClientPagination()}this.savePreferences()}toggleDensity(){this.density=this.density==="compact"?"comfortable":"compact";let t=this.density==="compact"?25:10;this.uiPageSize$.next(t),this.uiPage$.next(0),this.applyClientPagination(),this.savePreferences()}createSale(t){this.router.navigate(["/sales/new"],{state:{inventorySeed:{productId:t.id,productName:t.name,variantId:null,branchId:null}}})}savePreferences(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify({viewMode:this.viewMode,density:this.density}))}loadPreferences(){let t=localStorage.getItem(this.STORAGE_KEY);if(!t)return;let e=JSON.parse(t);this.viewMode=e.viewMode??this.viewMode,this.density=e.density??this.density}get bulkState(){if(!this.selectedIds.size)return null;let t=this.allProducts.filter(o=>this.selectedIds.has(o.id)),e=new Set(t.map(o=>o.deleted));return e.size>1?"mixed":e.has(!0)?"deleted":"active"}sortBy(t){this.resetAccumulation(),this.page$.next(0),this.sortField$.value===t?this.sortDir$.next(this.sortDir$.value==="asc"?"desc":"asc"):(this.sortField$.next(t),this.sortDir$.next("asc"))}changePage(t){let e=t.pageIndex,o=t.pageSize;this.uiPageSize$.next(o);let i=e*o;if(i<this.allProducts.length){this.uiPage$.next(e),this.applyClientPagination();return}let g=Math.floor(i/this.serverSize$.value);!this.loadedServerPages.has(g)&&this.allProducts.length<this.totalServerElements&&this.page$.next(g),this.uiPage$.next(e)}onToggleShowDeleted(t){this.resetAccumulation(),this.page$.next(0),this.showDeleted$.next(t)}isAllSelected(){return this.products.every(t=>this.selectedIds.has(t.id))}masterToggle(){this.products.every(e=>this.selectedIds.has(e.id))?this.products.forEach(e=>this.selectedIds.delete(e.id)):this.products.forEach(e=>this.selectedIds.add(e.id))}toggleRowSelection(t){this.selectedIds.has(t.id)?this.selectedIds.delete(t.id):this.selectedIds.add(t.id)}trackById(t,e){return e.id}clearSelection(){this.selectedIds.clear()}onThumbnailError(t){t.thumbnail=void 0}openImageViewer(t){t.thumbnail&&this.dialog.open(ii,{width:"90vw",maxWidth:"900px",panelClass:"file-viewer-dialog",data:{preview:{src:t.thumbnail,name:t.name,type:"image"}}})}openRestoreOptionsDialog(){return this.dialog.open(Qe,{width:"450px",disableClose:!0}).afterClosed()}toggleProductStatus(t){this.entityAction.toggleSingle(t,this.productActionConfig)}bulkSoftDelete(){let t=this.getSelectedProducts();t.length&&this.entityAction.bulkDisable(t,this.productActionConfig)}bulkRestore(){let t=this.getSelectedProducts();t.length&&this.entityAction.bulkRestore(t,this.productActionConfig)}bulkHardDelete(){let t=this.getSelectedProducts();t.length&&this.entityAction.bulkHardDelete(t,this.productActionConfig)}openBulkImport(){this.dialog.open(Ge,{width:"1100px",maxWidth:"95vw",maxHeight:"90vh",autoFocus:!1}).afterClosed().subscribe(t=>{t===!0&&(this.resetAccumulation(),this.page$.next(0),this.refresh$.next())})}static \u0275fac=function(e){return new(e||n)(x(Ae),x(si),x(ai),x(Nt),x(ci),x(fe),x(re),x(Mt),x(kt))};static \u0275cmp=F({type:n,selectors:[["app-product-list"]],viewQuery:function(e,o){if(e&1&&Pe(Re,5),e&2){let i;Ie(i=Fe())&&(o.paginator=i.first)}},decls:56,vars:19,consts:[["page-header",""],[1,"product-header"],[1,"header-left"],["mat-icon-button","","matTooltip","Grid View",3,"click"],["mat-icon-button","","matTooltip","Table View",3,"click"],["mat-icon-button","","matTooltip","Toggle Density",3,"click",4,"ngIf"],[1,"header-right"],["mat-stroked-button","",3,"click"],["mat-flat-button","","routerLink","/products/create"],["page-toolbar","",1,"product-toolbar"],[1,"search"],["appearance","fill",1,"search-field"],["matInput","",3,"input"],["matSuffix","","mat-icon-button","",3,"click"],[1,"filters"],["appearance","fill"],[3,"selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number",3,"input"],["appearance","fill",4,"ngIf"],[3,"change",4,"ngIf"],["page-content",""],["class","bulk-bar",4,"ngIf"],["class","product-grid",3,"compact","comfortable",4,"ngIf"],["class","table-wrapper",3,"compact",4,"ngIf"],[1,"shared-paginator"],["showFirstLastButtons","",3,"page","disabled","length","pageSize","pageSizeOptions"],["mat-icon-button","","matTooltip","Toggle Density",3,"click"],["value","all"],["value","active"],["value","deleted"],[3,"change"],[1,"bulk-bar"],[1,"bulk-count"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["class","bulk-error",4,"ngIf"],["mat-button","",1,"cancel-selection",3,"click"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"bulk-error"],[1,"product-grid"],["class","product-card",3,"compact","comfortable","deleted","selected","click",4,"ngFor","ngForOf"],[1,"product-card",3,"click"],[1,"card-thumb",3,"click"],["loading","lazy","class","product-thumb",3,"src","error",4,"ngIf"],["class","thumb-placeholder",4,"ngIf"],[1,"card-title"],[1,"card-sub"],[1,"card-sub","text-xs"],[1,"card-meta"],[1,"card-actions"],["mat-icon-button","","matTooltip","Create Sale",3,"click","disabled"],["mat-icon-button","","matTooltip","View",3,"disabled","routerLink"],["mat-icon-button","","matTooltip","Edit",3,"disabled","routerLink"],["mat-icon-button","",3,"click","matTooltip"],["loading","lazy",1,"product-thumb",3,"error","src"],[1,"thumb-placeholder"],[1,"table-wrapper"],["class","overflow-x-auto",4,"ngIf"],["class","stacked-wrapper",3,"compact","comfortable",4,"ngIf"],[1,"overflow-x-auto"],["mat-table","",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","class","sortable","matTooltip","Sort by name","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","category"],["mat-header-cell","","class","sortable","matTooltip","Sort by category","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","variants"],["mat-header-cell","","class","sortable",3,"click",4,"matHeaderCellDef"],["matColumnDef","sku"],["mat-header-cell","","class","sortable","matTooltip","Sort by sku code","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","suppliers"],["matColumnDef","status"],["mat-header-cell","","class","sortable","matTooltip","Sort by status","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","updated"],["mat-header-cell","","class","sortable","matTooltip","Sort by date of last update","matTooltipPosition","above",3,"click",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable-row",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"click","change","checked"],["mat-header-cell","","matTooltip","Sort by name","matTooltipPosition","above",1,"sortable",3,"click"],[1,"sortable-content"],[1,"sort-icon"],[1,"text-blue-600","hover:underline",3,"routerLink","state"],["mat-header-cell","","matTooltip","Sort by category","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by sku code","matTooltipPosition","above",1,"sortable",3,"click"],["mat-header-cell","","matTooltip","Sort by status","matTooltipPosition","above",1,"sortable",3,"click"],[3,"ngClass"],["mat-header-cell","","matTooltip","Sort by date of last update","matTooltipPosition","above",1,"sortable",3,"click"],["mat-icon-button","","matTooltip","View Product",3,"disabled","routerLink","state"],["mat-icon-button","","matTooltip","Edit Product",3,"disabled","routerLink","state"],["mat-header-row",""],["mat-row","",1,"clickable-row",3,"click","ngClass"],[1,"stacked-wrapper"],["class","stacked-row",3,"deleted","selected","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"stacked-row",3,"click"],[1,"stacked-top"],[1,"stacked-title"],[1,"stacked-sub"],[1,"stacked-grid"],[1,"label"],[1,"value"],[1,"value",3,"ngClass"],[1,"stacked-actions"],["mat-icon-button","","matTooltip","View",3,"click","disabled","routerLink"],["mat-icon-button","","matTooltip","Edit",3,"click","disabled","routerLink"]],template:function(e,o){e&1&&(r(0,"app-page-shell")(1,"div",0)(2,"div",1)(3,"div",2)(4,"button",3),_("click",function(){return o.setView("grid")}),r(5,"mat-icon"),c(6,"grid_view"),l()(),r(7,"button",4),_("click",function(){return o.setView("table")}),r(8,"mat-icon"),c(9,"table_rows"),l()(),v(10,tn,3,0,"button",5),l(),r(11,"div",6)(12,"button",7),_("click",function(){return o.openBulkImport()}),c(13," Bulk Import "),l(),r(14,"button",8),c(15," + Create Product "),l()()()(),r(16,"div",9)(17,"div",10)(18,"mat-form-field",11)(19,"mat-label"),c(20,"Search name, category or SKU"),l(),r(21,"input",12),_("input",function(a){return o.onSearchChange(a.target.value)}),l(),r(22,"button",13),_("click",function(){return o.onSearchChange("")}),r(23,"mat-icon"),c(24,"close"),l()()()(),r(25,"div",14)(26,"mat-form-field",15)(27,"mat-label"),c(28,"Category"),l(),r(29,"mat-select",16),_("selectionChange",function(a){return o.onCategoryChange(a.value)}),r(30,"mat-option",17),c(31,"All"),l(),v(32,nn,2,2,"mat-option",18),l()(),r(33,"mat-form-field",15)(34,"mat-label"),c(35,"Supplier"),l(),r(36,"mat-select",16),_("selectionChange",function(a){return o.onSupplierChange(a.value)}),r(37,"mat-option",17),c(38,"All"),l(),v(39,on,2,2,"mat-option",18),l()(),r(40,"mat-form-field",15)(41,"mat-label"),c(42,"Min Suppliers"),l(),r(43,"input",19),_("input",function(a){return o.onMinSuppliersChange(a.target.value)}),l()(),r(44,"mat-form-field",15)(45,"mat-label"),c(46,"Max Suppliers"),l(),r(47,"input",19),_("input",function(a){return o.onMaxSuppliersChange(a.target.value)}),l()(),v(48,rn,10,0,"mat-form-field",20)(49,an,2,0,"mat-checkbox",21),l()(),r(50,"div",22),v(51,mn,9,5,"div",23)(52,_n,2,5,"div",24)(53,Nn,3,4,"div",25),r(54,"div",26)(55,"mat-paginator",27),_("page",function(a){return o.changePage(a)}),l()()()()),e&2&&(s(4),X("active",o.viewMode==="grid"),s(3),X("active",o.viewMode==="table"),s(3),m("ngIf",!o.isMobile),s(20),m("value",null),s(2),m("ngForOf",o.categories),s(5),m("value",null),s(2),m("ngForOf",o.suppliers),s(9),m("ngIf",o.canManageDeleted),s(),m("ngIf",o.canManageDeleted),s(2),m("ngIf",o.selectedIds.size>0),s(),m("ngIf",!o.loading&&o.viewMode==="grid"),s(),m("ngIf",!o.loading&&o.viewMode==="table"),s(2),m("disabled",o.loading)("length",o.totalServerElements)("pageSize",o.currentUiPageSize)("pageSizeOptions",De(18,Xi)))},dependencies:[D,wt,j,O,bt,St,yt,li,ei,Wt,Gt,Kt,qt,Ht,Jt,Qt,Zt,Yt,Xt,G,H,W,z,me,ne,ie,ti,Re,At,Rt,he,ve,Ve,jt,U,xe,Ce,zt,Ut,Pt],styles:['[_nghost-%COMP%]     [page-header]{width:100%;display:block}.product-header[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.header-left[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#3b82f626;border-radius:6px}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-left:auto;flex-wrap:wrap}.header-right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{white-space:nowrap}.product-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;width:100%}.product-toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:100%}.product-toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.product-toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;align-items:center}.product-toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:220px}.product-toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{white-space:nowrap}@media (max-width: 640px){.product-toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.product-toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], .product-toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{width:100%}}@media (min-width: 1200px){.product-toolbar[_ngcontent-%COMP%]{flex-direction:column}.product-toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:90%}.product-toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{flex-direction:row}}.bulk-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:.75rem 1rem;border-radius:8px;background:#60a5fa14;border:1px solid rgba(96,165,250,.35);flex-wrap:wrap;margin-bottom:1rem}.bulk-count[_ngcontent-%COMP%]{font-weight:600;color:var(--active)}.bulk-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{white-space:nowrap}@media (max-width: 500px){.bulk-bar[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:.75rem}.bulk-count[_ngcontent-%COMP%]{text-align:center}.bulk-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.cancel-selection[_ngcontent-%COMP%]{margin-left:0}}.bulk-error[_ngcontent-%COMP%]{color:#c62828;font-weight:600}.cancel-selection[_ngcontent-%COMP%]{margin-left:auto;font-weight:500;color:var(--text-secondary)}.product-grid[_ngcontent-%COMP%]{display:grid;gap:1.25rem;grid-template-columns:1fr}@media (min-width: 640px){.product-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 1024px){.product-grid.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}.product-grid.comfortable[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.product-card[_ngcontent-%COMP%]{background:var(--surface);border:1px solid var(--border);border-radius:10px;display:flex;flex-direction:column;gap:.75rem;transition:transform .15s ease,box-shadow .15s ease}.product-card.selected[_ngcontent-%COMP%]{border:2px solid var(--active);background:#60a5fa14}.card-thumb[_ngcontent-%COMP%]{aspect-ratio:1/1;overflow:hidden;border-radius:8px;background:var(--surface-hover)}.product-thumb[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:8px;aspect-ratio:1/1;transition:transform .15s ease}.product-card[_ngcontent-%COMP%]:hover   .product-thumb[_ngcontent-%COMP%]{transform:scale(1.03)}.product-card.compact[_ngcontent-%COMP%]{padding:.75rem;gap:.5rem}.product-card.compact[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:.9rem}.product-card.compact[_ngcontent-%COMP%]   .card-sub[_ngcontent-%COMP%], .product-card.compact[_ngcontent-%COMP%]   .card-meta[_ngcontent-%COMP%]{font-size:.75rem}.product-card.compact[_ngcontent-%COMP%]   .card-thumb[_ngcontent-%COMP%]{height:90px}.product-card.compact[_ngcontent-%COMP%]   .thumb-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px}@media (max-width: 640px){.product-card.compact[_ngcontent-%COMP%]   .card-thumb[_ngcontent-%COMP%]{height:75px}.product-card.compact[_ngcontent-%COMP%]{padding:.6rem;gap:.4rem}}.product-card.comfortable[_ngcontent-%COMP%]{padding:1.25rem;gap:.85rem}.product-card.comfortable[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:1rem}.product-card.comfortable[_ngcontent-%COMP%]   .card-sub[_ngcontent-%COMP%], .product-card.comfortable[_ngcontent-%COMP%]   .card-meta[_ngcontent-%COMP%]{font-size:.85rem}.product-card.comfortable[_ngcontent-%COMP%]   .card-thumb[_ngcontent-%COMP%]{height:140px}.product-card.comfortable[_ngcontent-%COMP%]   .thumb-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:42px}.product-card.deleted[_ngcontent-%COMP%]{border:2px solid #dc2626;background:#dc262614;position:relative;opacity:.55}.product-card.deleted[_ngcontent-%COMP%]:after{content:"DISABLED";position:absolute;top:8px;right:8px;font-size:.65rem;font-weight:600;color:#dc2626;background:#fff;padding:2px 6px;border-radius:4px;letter-spacing:.5px}.product-card.deleted[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{text-decoration:line-through}.product-card.deleted.selected[_ngcontent-%COMP%]{border:3px solid #2563eb;background:#2563eb1f;opacity:1}.card-thumb[_ngcontent-%COMP%]{height:120px;display:flex;justify-content:center;align-items:center}.thumb-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;background:var(--surface-hover);border-radius:8px;display:flex;align-items:center;justify-content:center}.thumb-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;opacity:.4}.card-title[_ngcontent-%COMP%]{font-weight:600}.card-sub[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary)}.card-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.card-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;border-top:1px solid var(--border);padding-top:.5rem}.table-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.stacked-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.stacked-wrapper.compact[_ngcontent-%COMP%]   .stacked-row[_ngcontent-%COMP%]{padding:.75rem;gap:.5rem}.stacked-wrapper.comfortable[_ngcontent-%COMP%]   .stacked-row[_ngcontent-%COMP%]{padding:1rem;gap:.85rem}.stacked-row[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;background:var(--surface);display:flex;flex-direction:column;transition:all .15s ease}.stacked-row[_ngcontent-%COMP%]:hover{transform:translate(2px);background:var(--surface-hover);cursor:pointer}.stacked-row.selected[_ngcontent-%COMP%]{border:2px solid var(--active);background:#60a5fa14}.stacked-row.deleted[_ngcontent-%COMP%]{opacity:.65;border:1px solid #ef4444;background:#ef44440d}.stacked-row.deleted.selected[_ngcontent-%COMP%]{border:3px solid #2563eb;background:#2563eb1f;opacity:1}.stacked-row.deleted[_ngcontent-%COMP%]   .stacked-title[_ngcontent-%COMP%]{text-decoration:line-through}.stacked-top[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.stacked-title[_ngcontent-%COMP%]{font-weight:600}.stacked-sub[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary)}.stacked-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem}.label[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-secondary)}.value[_ngcontent-%COMP%]{font-weight:500}.stacked-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;border-top:1px solid var(--border);padding-top:.5rem}.table-wrapper.compact[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]{height:28px}.table-wrapper.compact[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%], .table-wrapper.compact[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{padding-top:1px!important;padding-bottom:1px!important;font-size:.78rem}.table-wrapper[_ngcontent-%COMP%]:not(.compact)   .mat-mdc-row[_ngcontent-%COMP%]{height:48px}.shared-paginator[_ngcontent-%COMP%]{margin-top:2rem;display:flex;justify-content:center}']})};export{xi as ProductListComponent};
