<div class="space-y-6">

  <!-- HEADER -->
  <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold">Access Control Overview</h2>

    <button
      mat-flat-button
      (click)="refreshCache()"
      matTooltip="Reload ACL cache without restart">
      <mat-icon>refresh</mat-icon>
      Refresh Cache
    </button>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <div class="surface">
      <div class="label">Endpoints</div>
      <div class="value">{{ summary?.endpointCount }}</div>
    </div>

    <div class="surface">
      <div class="label">Permissions</div>
      <div class="value">{{ summary?.permissionCount }}</div>
    </div>

    <div class="surface">
      <div class="label">Roles</div>
      <div class="value">{{ roleEntries().length }}</div>
    </div>

  </div>

  <!-- ROLE COUNTS -->
  <div class="surface p-4">
    <h3 class="section-title">Permissions per Role</h3>

    <table mat-table [dataSource]="roleEntries()">

      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef>Role</th>
        <td mat-cell *matCellDef="let r">{{ r.role }}</td>
      </ng-container>

      <ng-container matColumnDef="count">
        <th mat-header-cell *matHeaderCellDef>Permissions</th>
        <td mat-cell *matCellDef="let r">{{ r.count }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="roleColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: roleColumns"></tr>

    </table>
  </div>

  <!-- AUDIT LOG -->
  <div class="surface p-4">
    <h3 class="section-title">Recent ACL Activity</h3>

    <table mat-table [dataSource]="audits">

      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef>Time</th>
        <td mat-cell *matCellDef="let a">
          {{ a.createdAt | date:'dd/MM/yyyy HH:mm:ss' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="entity">
        <th mat-header-cell *matHeaderCellDef>Entity</th>
        <td mat-cell *matCellDef="let a">
          {{ a.entityType }} Â· {{ a.entityId }}
        </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>Action</th>
        <td mat-cell *matCellDef="let a">{{ a.action }}</td>
      </ng-container>

      <ng-container matColumnDef="actor">
        <th mat-header-cell *matHeaderCellDef>Actor</th>
        <td mat-cell *matCellDef="let a">
          {{ a.actorUsername }} ({{ a.actorRole }})
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="auditColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: auditColumns"></tr>

    </table>
  </div>

</div>