<div class="auth-root">
  <div class="auth-card" [formGroup]="form">

    <!-- HEADER -->
    <header class="dialog-header">
      <div class="dialog-title">Reset password</div>
      <div class="dialog-subtitle">
        Enter the verification code and choose a new password
      </div>
    </header>

    <!-- CONTENT -->
    <section class="form-section">
      <div class="section-label">Verification</div>

      <div class="form-grid">

        <!-- STEP 1: VERIFY OTP -->
        <ng-container *ngIf="step === 'VERIFY'">

          <div class="destination-hint">
            We sent a verification code to
            <strong>{{ maskedDestination }}</strong>
          </div>

          <mat-form-field appearance="fill">
            <mat-label>Verification code</mat-label>
            <input matInput formControlName="token" />
          </mat-form-field>

          <div class="otp-meta">
            <span class="countdown">
              Code expires in {{ countdownLabel }}
            </span>

            <button mat-button type="button" [disabled]="remainingSeconds > 0" (click)="resendCode()">
              Resend code
            </button>
          </div>

          <button mat-flat-button color="primary" [disabled]="verifyDisabled" (click)="verifyCode()">
            Verify code
          </button>

        </ng-container>

        <!-- STEP 2: RESET PASSWORD -->
        <ng-container *ngIf="step === 'RESET'">

          <mat-form-field appearance="fill">
            <mat-label>New password</mat-label>
            <input matInput [type]="hidePw ? 'password' : 'text'" formControlName="newPassword" />
            <button mat-icon-button matSuffix type="button" (click)="hidePw = !hidePw">
              <mat-icon>{{ hidePw ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Confirm password</mat-label>
            <input matInput [type]="hideConfirm ? 'password' : 'text'" formControlName="confirmPassword" />
            <button mat-icon-button matSuffix type="button" (click)="hideConfirm = !hideConfirm">
              <mat-icon>{{ hideConfirm ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
          </mat-form-field>

          <button mat-flat-button color="primary" [disabled]="loading" (click)="submit()">
            Reset password
          </button>

        </ng-container>

      </div>
    </section>

    <!-- FOOTER -->
    <footer class="dialog-footer">
      <div class="footer-hint">
        Password changes invalidate all active sessions
      </div>

      <div class="footer-actions">
        <button mat-stroked-button (click)="cancel()">Cancel</button>
      </div>
    </footer>

  </div>
</div>