<!-- HEADER -->
<h2 mat-dialog-title class="dialog-header">
  <div class="dialog-title">{{ report.title }}</div>
  <div class="dialog-subtitle">{{ report.description }}</div>
</h2>

<!-- CONTENT -->
<mat-dialog-content class="dialog-content">

  <section class="form-section">
    <div class="section-label">Report parameters</div>

    <div class="form-grid">

      <ng-container *ngFor="let p of orderedParams">

        <!-- DATE -->
        <mat-form-field *ngIf="p.type === 'DATE'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <input matInput [matDatepicker]="dp" [(ngModel)]="params[p.name]" placeholder="dd/mm/yyyy">
          <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
          <mat-datepicker #dp></mat-datepicker>
        </mat-form-field>

        <!-- BRANCH -->
        <mat-form-field *ngIf="p.type === 'BRANCH'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <mat-select [(ngModel)]="params[p.name]">
            <mat-option *ngFor="let b of branches" [value]="b.id">
              {{ b.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- ACCOUNT -->
        <mat-form-field *ngIf="p.type === 'ACCOUNT'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <mat-select [(ngModel)]="params[p.name]">
            <mat-option *ngFor="let a of accounts" [value]="a.id">
              {{ a.code }} â€” {{ a.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- CUSTOMER -->
        <mat-form-field *ngIf="p.type === 'CUSTOMER'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <mat-select [(ngModel)]="params[p.name]">
            <mat-option *ngFor="let c of customers" [value]="c.id">
              {{ c.name }} ({{ c.phone ?? c.email }})
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- SUPPLIER -->
        <mat-form-field *ngIf="p.type === 'SUPPLIER'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <mat-select [(ngModel)]="params[p.name]">
            <mat-option *ngFor="let s of suppliers" [value]="s.id">
              {{ s.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- PRODUCT -->
        <mat-form-field *ngIf="p.type === 'PRODUCT'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <mat-select [(ngModel)]="params[p.name]" (selectionChange)="onProductChange($event.value)">
            <mat-option *ngFor="let pr of products" [value]="pr.id">
              {{ pr.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- VARIANT -->
        <mat-form-field *ngIf="p.type === 'VARIANT'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <mat-select [(ngModel)]="params[p.name]">
            <mat-option *ngFor="let v of variants" [value]="v.id">
              {{ v.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- CATEGORY -->
        <mat-form-field *ngIf="p.type === 'CATEGORY'" appearance="fill">
          <mat-label>{{ labelFor(p) }}</mat-label>
          <mat-select [(ngModel)]="params[p.name]">
            <mat-option *ngFor="let c of categories" [value]="c.id">
              {{ c.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </ng-container>

      <!-- FORMAT -->
      <mat-form-field appearance="fill">
        <mat-label>Format</mat-label>
        <mat-select [(ngModel)]="format">
          <mat-option value="PDF">PDF</mat-option>
          <mat-option value="XLSX">Excel</mat-option>
          <mat-option value="CSV">CSV</mat-option>
        </mat-select>
      </mat-form-field>

    </div>
  </section>

</mat-dialog-content>

<!-- FOOTER -->
<mat-dialog-actions class="dialog-footer">
  <div class="footer-hint">
    Generated reports are immutable and audit-safe
  </div>

  <div class="footer-actions">
    <button mat-stroked-button mat-dialog-close>Cancel</button>
    <button mat-flat-button color="primary" [disabled]="loading || isMissingRequired()" (click)="generate()">
      Generate report
    </button>
  </div>
</mat-dialog-actions>