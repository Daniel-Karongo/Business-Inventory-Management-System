<div class="flex flex-col gap-4">

  <!-- HEADER -->
  <div class="flex justify-between items-center">
    <h1 class="text-xl font-semibold">Suppliers</h1>
    <button mat-flat-button (click)="goCreate()">Create Supplier</button>
  </div>

  <!-- BULK ACTION BAR -->
  <div *ngIf="selection.selected.length" class="flex items-center gap-3 mb-4">

    <span class="font-medium text-blue-500">
      {{ selection.selected.length }} selected
    </span>

    <button *ngIf="bulkState === 'active'" mat-stroked-button color="warn" (click)="bulkDisable()">
      Disable
    </button>

    <button *ngIf="bulkState === 'deleted'" mat-stroked-button color="primary" (click)="bulkRestore()">
      Restore
    </button>

    <span *ngIf="bulkState === 'mixed'" class="text-red-500 font-medium">
      Mixed supplier status — action blocked
    </span>
  </div>

  <!-- FILTERS -->
  <div class="toolbar-card">
    <mat-form-field appearance="fill" class="search">
      <mat-label>Search suppliers</mat-label>
      <input matInput placeholder="Search name, email or phone" [(ngModel)]="q" (input)="applyFilters()" />
    </mat-form-field>
  </div>

  <div class="filters">
    <mat-form-field appearance="fill" class="min-w-[160px]">
      <mat-label>Region</mat-label>

      <mat-select [(ngModel)]="filterRegion" (selectionChange)="applyFilters()">

        <mat-option value="">All regions</mat-option>
        <mat-option *ngFor="let r of regions" [value]="r">
          {{ r }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill" class="min-w-[160px]">
      <mat-label>Status</mat-label>

      <mat-select [(ngModel)]="statusFilter" (selectionChange)="applyFilters()">

        <mat-option value="all">All</mat-option>
        <mat-option value="active">Active</mat-option>
        <mat-option value="deleted">Disabled</mat-option>

      </mat-select>
    </mat-form-field>
  </div>

  <!-- TABLE -->
  <div class="bg-[var(--surface)] rounded shadow overflow-x-auto">

    <table mat-table [dataSource]="suppliers" class="w-full">

      <!-- SELECT -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox [checked]="isAllSelected()" [indeterminate]="selection.selected.length && !isAllSelected()"
            (change)="masterToggle()">
          </mat-checkbox>
        </th>

        <td mat-cell *matCellDef="let row">
          <mat-checkbox (click)="$event.stopPropagation()" (change)="selection.toggle(row)"
            [checked]="selection.isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- NAME -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef class="sortable" (click)="sortBy('name')">
          <span class="sortable-content">
            Name
            <mat-icon class="sort-icon">
              {{ sortField === 'name'
              ? (sortDir === 'asc' ? 'arrow_upward' : 'arrow_downward')
              : 'unfold_more' }}
            </mat-icon>
          </span>
        </th>

        <td mat-cell *matCellDef="let s">
          <a class="text-blue-600 hover:underline" (click)="view(s)">
            {{ s.name }}
          </a>
        </td>
      </ng-container>

      <!-- EMAILS -->
      <ng-container matColumnDef="emails">
        <th mat-header-cell *matHeaderCellDef>Emails</th>
        <td mat-cell *matCellDef="let s">
          <div *ngFor="let e of s.email">{{ e }}</div>
        </td>
      </ng-container>

      <!-- PHONES -->
      <ng-container matColumnDef="phones">
        <th mat-header-cell *matHeaderCellDef>Phones</th>
        <td mat-cell *matCellDef="let s">
          <div *ngFor="let p of s.phoneNumber">{{ p }}</div>
        </td>
      </ng-container>

      <!-- REGION -->
      <ng-container matColumnDef="region">
        <th mat-header-cell *matHeaderCellDef class="sortable" (click)="sortBy('region')">
          <span class="sortable-content">
            Region
            <mat-icon class="sort-icon">
              {{ sortField === 'region'
              ? (sortDir === 'asc' ? 'arrow_upward' : 'arrow_downward')
              : 'unfold_more' }}
            </mat-icon>
          </span>
        </th>

        <td mat-cell *matCellDef="let s">{{ s.region || '—' }}</td>
      </ng-container>

      <!-- RATING -->
      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef>Rating</th>
        <td mat-cell *matCellDef="let s">{{ s.rating ?? '—' }}</td>
      </ng-container>

      <!-- CREATED -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef class="sortable" (click)="sortBy('createdAt')">
          <span class="sortable-content">
            Created
            <mat-icon class="sort-icon">
              {{ sortField === 'createdAt'
              ? (sortDir === 'asc' ? 'arrow_upward' : 'arrow_downward')
              : 'unfold_more' }}
            </mat-icon>
          </span>
        </th>

        <td mat-cell *matCellDef="let s">
          {{ s.createdAt | date:'medium' }}
        </td>
      </ng-container>

      <!-- STATUS -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let s">
          <span [class.text-red-400]="s.deleted" [class.text-green-400]="!s.deleted">
            {{ s.deleted ? 'Disabled' : 'Active' }}
          </span>
        </td>
      </ng-container>

      <!-- ACTIONS -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let s">
          <button mat-icon-button matTooltip="View" (click)="view(s)">
            <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button matTooltip="Edit" (click)="edit(s)">
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="toggleRow(row)" class="clickable-row"
        [class.row-selected]="selection.isSelected(row)">
      </tr>
    </table>

    <mat-paginator [length]="total" [pageSize]="size" [pageSizeOptions]="[5,10,20,50]" (page)="changePage($event)">
    </mat-paginator>

  </div>
</div>