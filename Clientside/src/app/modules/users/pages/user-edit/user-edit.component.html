<div class="p-4 max-w-3xl">
  <h2 class="text-lg font-semibold mb-4">Edit User</h2>

  <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-6">

    <!-- Username / ID Number -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <mat-form-field appearance="fill">
        <mat-label>Username</mat-label>
        <input matInput formControlName="username" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>ID Number</mat-label>
        <input matInput formControlName="idNumber" />
      </mat-form-field>
    </div>

    <!-- Emails -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Email addresses (comma-separated)</mat-label>
      <input
        matInput
        [value]="form.value.emailAddresses?.join(', ')"
        (change)="onEmailsChanged($event)"
      />
    </mat-form-field>

    <!-- Phones -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Phone numbers (comma-separated)</mat-label>
      <input
        matInput
        [value]="form.value.phoneNumbers?.join(', ')"
        (change)="onPhonesChanged($event)"
      />
    </mat-form-field>

    <!-- Role -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Role</mat-label>
      <mat-select formControlName="role">
        <mat-option *ngFor="let r of roles" [value]="r.name">{{ r.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Department assignments -->
    <div class="space-y-3">
      <h3 class="font-medium">Department Assignments</h3>

      <div
        *ngFor="let d of departmentsAndPositions; let i = index"
        class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center"
      >
        <input
          class="border rounded px-2 py-1"
          placeholder="Branch ID"
          [value]="d.branchId"
          (change)="updateDepartment(i, 'branchId', $event)"
        />

        <input
          class="border rounded px-2 py-1"
          placeholder="Department ID"
          [value]="d.departmentId"
          (change)="updateDepartment(i, 'departmentId', $event)"
        />

        <select
          class="border rounded px-2 py-1"
          [value]="d.position"
          (change)="updateDepartment(i, 'position', $event)"
        >
          <option value="member">Member</option>
          <option value="head">Head</option>
        </select>

        <button mat-icon-button color="warn" (click)="removeDepartmentAssignment(i)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>

      <button mat-stroked-button type="button" (click)="addDepartmentAssignment()">
        Add Assignment
      </button>
    </div>

    <!-- Actions -->
    <div class="flex gap-2">
      <button mat-flat-button color="primary" type="submit">Save</button>
      <button mat-stroked-button type="button" (click)="router.navigate(['/users'])">
        Cancel
      </button>
    </div>

  </form>
</div>