<div class="p-4">

  <!-- ================= TOOLBAR ================= -->
  <div class="toolbar">
    <h3>Images</h3>

    <button mat-flat-button color="primary" (click)="triggerUpload()" [disabled]="uploading">
      <mat-icon>upload</mat-icon>
      Upload
    </button>
  </div>

  <!-- ================= EMPTY STATE ================= -->
  <div class="empty" *ngIf="!loading && images.length === 0">
    No images uploaded
  </div>

  <!-- ================= GRID ================= -->
  <div class="image-grid" *ngIf="!loading">
    <div class="image-card" *ngFor="let img of images" [class.deleted]="img.deleted">

      <!-- IMAGE -->
      <ng-container *ngIf="img.image; else pdfTpl">
        <img [src]="imageUrl(img)" (click)="viewImage(img)" class="clickable-image" />
      </ng-container>

      <!-- PDF -->
      <ng-template #pdfTpl>
        <div class="pdf-card" (click)="openPdf(img)">
          <mat-icon>picture_as_pdf</mat-icon>
          <span>{{ img.fileName }}</span>
        </div>
      </ng-template>

      <!-- META -->
      <div class="image-meta">
        <div class="filename">{{ img.fileName }}</div>

        <div class="description" *ngIf="img.description">
          {{ img.description }}
        </div>

        <div class="deleted" *ngIf="img.deleted">
          Deleted
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="actions">

        <!-- PRIMARY ACTION -->
        <button mat-icon-button (click)="onPrimaryAction(img)"
          [matTooltip]="img.deleted ? 'Restore image' : 'Soft delete image'" matTooltipPosition="above">
          <mat-icon>
            {{ img.deleted ? 'restore' : 'delete' }}
          </mat-icon>
        </button>

        <!-- HARD DELETE (ONLY IF SOFT-DELETED) -->
        <button *ngIf="img.deleted" mat-icon-button color="warn" (click)="onHardDelete(img)"
          matTooltip="Permanently delete image" matTooltipPosition="above">
          <mat-icon>delete_forever</mat-icon>
        </button>

      </div>

    </div>
  </div>

  <!-- ================= IMAGE AUDITS ================= -->
  <div class="audit-section" *ngIf="!loadingAudits && imageAudits.length">

    <h3 class="audit-title">Image Audit Log</h3>

    <div class="audit-list">

      <div class="audit-row" *ngFor="let audit of imageAudits">
        <div class="audit-left">
          <div class="audit-file">{{ audit.fileName }}</div>
          <div class="audit-meta">
            {{ audit.performedByUsername }} â€¢
            {{ audit.timestamp | date:'medium' }}
          </div>
        </div>

        <div class="audit-action" [class.upload]="audit.action === 'UPLOAD'" [class.delete]="audit.action === 'DELETE'"
          [class.restore]="audit.action === 'RESTORE'">
          {{ audit.action }}
        </div>
      </div>

    </div>
  </div>
</div>